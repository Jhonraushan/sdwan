import{u as K}from"./accounts-BDI0ezSF.js";import{d as N,u as F,d4 as ee,r as p,aI as ae,i as D,w as o,l as e,h as w,k as l,aK as te,al as h,m as k,t as u,ak as le,q as $,ad as se,z as P,am as oe,aq as ie,an as ne,ao as L,j as y,F as q,bb as re,ba as ue,_ as B,ap as de,J as ce,aa as fe,L as j,M as O,n as M,Q as T,ai as me,ag as ve,V as X,S as U,T as A,cw as pe,cx as ge,Y as _e,ac as ye,c as we,o as be,g as ke,W as De,y as xe,aj as Q}from"./index-BlEQ5104.js";const Ve={class:"flex items-center gap-2"},Ce={class:"align-center -ml-2.5 flex gap-2 md:ml-0 md:justify-end"},Se=N({__name:"UsersTable",props:{users:{}},emits:["delete","edit"],setup(S,{emit:g}){const b=S,a=g,{t:s}=F(),_=ee(),r=p(10),{currentPage:i,paginatedItems:d}=ae(()=>b.users,{itemsPerPage:r});function c(v){return[{id:"delete",label:s("common.delete"),iconStyle:"fas",icon:"trash",danger:!0,action:()=>{a("delete",v)},disabled:v.username===_.username}]}return(v,n)=>(w(),D(e(ie),{ariaLabel:e(s)("controller.users.title"),cardBreakpoint:"md"},{paginator:o(()=>[l(e(te),{"current-page":e(i),"total-rows":b.users.length,"page-size":r.value,"nav-pagination-label":e(s)("ne_table.pagination"),"next-label":e(s)("ne_table.go_to_next_page"),"previous-label":e(s)("ne_table.go_to_previous_page"),"range-of-total-label":e(s)("ne_table.of"),"page-size-label":e(s)("ne_table.show"),onSelectPage:n[0]||(n[0]=t=>{i.value=t}),onSelectPageSize:n[1]||(n[1]=t=>{r.value=t})},null,8,["current-page","total-rows","page-size","nav-pagination-label","next-label","previous-label","range-of-total-label","page-size-label"])]),default:o(()=>[l(e(le),null,{default:o(()=>[l(e(h),null,{default:o(()=>[k(u(e(s)("controller.users.username")),1)]),_:1}),l(e(h),null,{default:o(()=>[k(u(e(s)("controller.users.display_name")),1)]),_:1}),l(e(h),null,{default:o(()=>[k(u(e(s)("controller.users.two_fa_status")),1)]),_:1}),l(e(h))]),_:1}),l(e(oe),null,{default:o(()=>[(w(!0),$(P,null,se(e(d),t=>(w(),D(e(ne),{key:t.username},{default:o(()=>[l(e(L),{"data-label":e(s)("controller.users.username")},{default:o(()=>[k(u(t.username),1)]),_:2},1032,["data-label"]),l(e(L),{"data-label":e(s)("controller.users.display_name")},{default:o(()=>[k(u(t.display_name),1)]),_:2},1032,["data-label"]),l(e(L),{"data-label":e(s)("controller.users.two_fa_status")},{default:o(()=>[y("span",Ve,[t.two_fa?(w(),$(P,{key:0},[l(e(q),{icon:e(re),class:"text-green-700 dark:text-green-500"},null,8,["icon"]),y("span",null,u(e(s)("controller.users.two_fa_enabled")),1)],64)):(w(),$(P,{key:1},[l(e(q),{icon:e(ue)},null,8,["icon"]),y("span",null,u(e(s)("controller.users.two_fa_disabled")),1)],64))])]),_:2},1032,["data-label"]),l(e(L),{"data-label":e(s)("common.actions")},{default:o(()=>[y("div",Ce,[l(e(B),{kind:"tertiary",onClick:V=>a("edit",t)},{prefix:o(()=>[l(e(q),{icon:["fas","pen-to-square"],class:"h-4 w-4","aria-hidden":"true"})]),default:o(()=>[k(" "+u(e(s)("common.edit")),1)]),_:2},1032,["onClick"]),l(e(de),{items:c(t),"align-to-right":!0},null,8,["items"])])]),_:2},1032,["data-label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["ariaLabel"]))}}),Ae={class:"flex flex-col gap-y-6"},Ee={class:"list-inside list-disc text-sm font-normal text-gray-500 dark:text-gray-400"},Te={class:"flex justify-end"},$e=N({__name:"CreateOrEditUserDrawer",props:{isShown:{type:Boolean},itemToEdit:{}},emits:["close","add-user","edit-user"],setup(S,{emit:g}){const b=S,{t:a}=F(),s=K(),_=g,r=p(!1),i=p({notificationTitle:"",notificationDescription:"",notificationDetails:""}),d=p(new fe),c=p(),v=p(""),n=p(""),t=p(""),V=p(""),C=p(),W=p(),I=p(),R=p();async function G(){b.itemToEdit?(c.value=b.itemToEdit.id,v.value=b.itemToEdit.username,n.value=b.itemToEdit.display_name):(c.value=void 0,v.value="",n.value=""),t.value="",V.value=""}function z(){d.value.clear(),i.value.notificationTitle="",i.value.notificationDescription="",i.value.notificationDetails="",_("close")}function H(){d.value.clear();let f=!0;const m=U(v.value);if(m.valid||(d.value.set("username",[m.errMessage]),f&&(A(C),f=!1)),U(n.value).valid||(d.value.set("display_name",[m.errMessage]),f&&(A(W),f=!1)),!c.value){const E=U(t.value);E.valid||(d.value.set("password",[E.errMessage]),f&&(A(I),f=!1));const J=U(V.value);J.valid||(d.value.set("confirmPassword",[J.errMessage]),f&&(A(R),f=!1))}const Y=pe(t.value);if(!Y.valid&&(!c.value||t.value!=""))d.value.set("password",[Y.errMessage]),f&&(A(I),f=!1);else{const E=ge(t.value,V.value);E.valid||(d.value.set("confirmPassword",[E.errMessage]),f&&(A(R),f=!1))}return f}async function Z(){i.value.notificationTitle="",i.value.notificationDescription="",i.value.notificationDetails="",d.value.clear();try{r.value=!0,H()&&(c.value?(await s.updateAccount(c.value,v.value,t.value,n.value),_("edit-user")):(await s.addAccount(v.value,t.value,n.value),_("add-user")),z())}catch(f){f instanceof ve?d.value=f.errorBag:(i.value.notificationTitle=c.value?a("error.cannot_edit_user"):a("error.cannot_create_user"),i.value.notificationDescription=a(X(f)),i.value.notificationDetails=f.toString())}finally{r.value=!1}}return ce(()=>b.isShown,()=>{b.isShown&&G()}),(f,m)=>(w(),D(e(me),{"is-shown":f.isShown,onClose:m[6]||(m[6]=x=>z()),closeAriaLabel:e(a)("common.shell.close_side_drawer"),title:c.value?e(a)("controller.users.edit_user"):e(a)("controller.users.add_user")},{default:o(()=>[i.value.notificationTitle?(w(),D(e(j),{key:0,title:i.value.notificationTitle,description:i.value.notificationDescription,class:"mb-6",kind:"error"},O({_:2},[i.value.notificationDetails?{name:"details",fn:o(()=>[k(u(i.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):M("",!0),y("div",Ae,[l(e(T),{modelValue:v.value,"onUpdate:modelValue":m[0]||(m[0]=x=>v.value=x),disabled:!!c.value,label:e(a)("controller.users.username"),"invalid-message":e(a)(d.value.getFirstI18nKeyFor("username")),ref_key:"usernameRef",ref:C},null,8,["modelValue","disabled","label","invalid-message"]),l(e(T),{modelValue:n.value,"onUpdate:modelValue":m[1]||(m[1]=x=>n.value=x),label:e(a)("controller.users.display_name"),"invalid-message":e(a)(d.value.getFirstI18nKeyFor("display_name")),ref_key:"displayNameRef",ref:W},null,8,["modelValue","label","invalid-message"]),l(e(T),{modelValue:t.value,"onUpdate:modelValue":m[2]||(m[2]=x=>t.value=x),label:e(a)("controller.users.user_password"),"invalid-message":e(a)(d.value.getFirstI18nKeyFor("password")),"is-password":!0,placeholder:c.value?e(a)("controller.users.unchanged"):"",ref_key:"passwordRef",ref:I},null,8,["modelValue","label","invalid-message","placeholder"]),y("ul",Ee,[y("li",null,u(e(a)("controller.users.password_suggestion_1")),1),y("li",null,u(e(a)("controller.users.password_suggestion_2")),1),y("li",null,u(e(a)("controller.users.password_suggestion_3")),1),y("li",null,u(e(a)("controller.users.password_suggestion_4")),1),y("li",null,u(e(a)("controller.users.password_suggestion_5")),1)]),l(e(T),{modelValue:V.value,"onUpdate:modelValue":m[3]||(m[3]=x=>V.value=x),label:e(a)("controller.users.confirm_user_password"),"invalid-message":e(a)(d.value.getFirstI18nKeyFor("confirmPassword")),"is-password":!0,placeholder:c.value?e(a)("controller.users.unchanged"):"",ref_key:"confirmPasswordRef",ref:R},null,8,["modelValue","label","invalid-message","placeholder"]),m[7]||(m[7]=y("hr",null,null,-1)),y("div",Te,[l(e(B),{kind:"tertiary",class:"mr-4",onClick:m[4]||(m[4]=x=>z())},{default:o(()=>[k(u(e(a)("common.cancel")),1)]),_:1}),l(e(B),{kind:"primary",onClick:m[5]||(m[5]=x=>Z()),disabled:r.value,loading:r.value},{default:o(()=>[k(u(c.value?e(a)("common.save"):e(a)("controller.users.add_user")),1)]),_:1},8,["disabled","loading"])])])]),_:1},8,["is-shown","closeAriaLabel","title"]))}}),Pe=N({__name:"DeleteUserModal",props:{visible:{type:Boolean},itemToDelete:{}},emits:["close","user-deleted"],setup(S,{emit:g}){const b=S,a=g,s=K(),{t:_}=F(),r=p({notificationDescription:"",notificationDetails:""}),i=p(!1);async function d(){if(b.itemToDelete){r.value.notificationDescription="",r.value.notificationDetails="",i.value=!0;try{await s.deleteAccount(b.itemToDelete.id),a("user-deleted"),a("close")}catch(v){r.value.notificationDescription=_(X(v)),r.value.notificationDetails=v.toString()}finally{i.value=!1}}}function c(){r.value.notificationDescription="",r.value.notificationDetails="",a("close")}return(v,n)=>(w(),D(e(_e),{visible:v.visible,kind:"warning",title:e(_)("controller.users.delete_user"),primaryLabel:e(_)("common.delete"),primaryButtonDisabled:i.value,primaryButtonLoading:i.value,primaryButtonKind:"danger","close-aria-label":e(_)("common.close"),onPrimaryClick:n[0]||(n[0]=t=>d()),onClose:n[1]||(n[1]=t=>c())},{default:o(()=>{var t;return[k(u(e(_)("controller.users.delete_user_message",{name:((t=v.itemToDelete)==null?void 0:t.username)??""}))+" ",1),r.value.notificationDescription?(w(),D(e(j),{key:0,kind:"error",title:e(_)("error.cannot_delete_user"),description:r.value.notificationDescription,class:"my-2"},O({_:2},[r.value.notificationDetails?{name:"details",fn:o(()=>[k(u(r.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):M("",!0)]}),_:1},8,["visible","title","primaryLabel","primaryButtonDisabled","primaryButtonLoading","close-aria-label"]))}}),Be={class:"flex flex-col gap-y-6"},he={class:"flex flex-row items-center justify-between"},Le={class:"max-w-2xl text-sm font-normal text-gray-500 dark:text-gray-400"},Ue={class:"ml-2 shrink-0"},Fe=N({__name:"UsersView",setup(S){const g=K(),b=ye(),{t:a}=F(),s=p(""),_=p(),r=p(!1),i=p(!1),d=we(()=>g.accounts.filter(n=>n.display_name.includes(s.value)||n.username.includes(s.value)));function c(n){_.value=n,r.value=!0}function v(n){_.value=n,i.value=!0}return be(()=>{g.loadAccounts()}),(n,t)=>{const V=ke("font-awesome-icon");return w(),$(P,null,[l(e(De),{tag:"h3",class:"mb-7"},{default:o(()=>[k(u(e(a)("controller.users.title")),1)]),_:1}),y("div",Be,[y("div",he,[y("p",Le,u(e(a)("controller.users.description")),1),y("div",Ue,[e(g).accounts.length>0?(w(),D(e(B),{key:0,kind:"secondary",onClick:t[0]||(t[0]=C=>c())},{prefix:o(()=>[l(V,{icon:["fas","circle-plus"],class:"h-4 w-4","aria-hidden":"true"})]),default:o(()=>[k(" "+u(e(a)("controller.users.add_user")),1)]),_:1})):M("",!0)])]),l(e(T),{class:"max-w-xs",placeholder:e(a)("common.filter"),modelValue:s.value,"onUpdate:modelValue":t[1]||(t[1]=C=>s.value=C)},null,8,["placeholder","modelValue"]),e(g).listAccountsError.notificationDescription?(w(),D(e(j),{key:0,kind:"error",title:e(a)("error.cannot_retrieve_users"),description:e(g).listAccountsError.notificationDescription},O({_:2},[e(g).listAccountsError.notificationDetails?{name:"details",fn:o(()=>[k(u(e(g).listAccountsError.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):M("",!0),e(g).listAccountsLoading?(w(),D(e(xe),{key:1,lines:7,size:"lg"})):(w(),$(P,{key:2},[e(g).accounts.length==0?(w(),D(e(Q),{key:0,title:e(a)("controller.users.no_users_found"),icon:["fas","user-group"]},{default:o(()=>[l(e(B),{kind:"primary",onClick:t[2]||(t[2]=C=>c())},{prefix:o(()=>[l(V,{icon:["fas","circle-plus"],class:"h-4 w-4","aria-hidden":"true"})]),default:o(()=>[k(u(e(a)("controller.users.add_user")),1)]),_:1})]),_:1},8,["title"])):d.value.length==0?(w(),D(e(Q),{key:1,title:e(a)("controller.users.no_users_found"),icon:["fas","user-group"]},null,8,["title"])):(w(),D(Se,{key:2,users:d.value,onEdit:c,onDelete:v},null,8,["users"]))],64))]),l($e,{"is-shown":r.value,onAddUser:t[3]||(t[3]=()=>{e(g).loadAccounts(),e(b).addNotification({kind:"success",id:"add-user",title:e(a)("controller.users.user_added")})}),onEditUser:t[4]||(t[4]=()=>{e(g).loadAccounts(),e(b).addNotification({kind:"success",id:"edit-user",title:e(a)("controller.users.user_edited")})}),onClose:t[5]||(t[5]=C=>r.value=!1),"item-to-edit":_.value},null,8,["is-shown","item-to-edit"]),l(Pe,{visible:i.value,"item-to-delete":_.value,onClose:t[6]||(t[6]=C=>i.value=!1),onUserDeleted:t[7]||(t[7]=()=>{e(g).loadAccounts(),e(b).addNotification({kind:"success",id:"delete-user",title:e(a)("controller.users.user_deleted")})})},null,8,["visible","item-to-delete"])],64)}}});export{Fe as default};
