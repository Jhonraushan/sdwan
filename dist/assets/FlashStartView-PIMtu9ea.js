import{d as q,u as A,ac as te,r as u,o as W,e as T,V as R,g as K,h as d,q as I,k as i,w as r,l as e,I as O,m as _,t as y,i as m,y as Q,n as h,L as C,j as U,a1 as se,a5 as le,z as Z,Q as M,s as B,a0 as ne,_ as $,F as oe,S as E,T as N,bN as ie,aS as re,aP as ue,a as de,W as fe,v as P,ax as ce,aj as j}from"./index-BlEQ5104.js";import{_ as pe}from"./FormLayout.vue_vue_type_script_setup_true_lang-DaMAl8E3.js";import{_ as be}from"./NeMultiTextInput.vue_vue_type_script_setup_true_lang-DwfeP71-.js";import{u as me}from"./threatShield-DPhO5atu.js";import"./isArrayLikeObject-CpCvCe5A.js";const ve={key:3,class:"mb-8 flex flex-col gap-y-6"},_e={class:"mt-6"},ge=q({__name:"FlashstartContent",setup(G){const{t:a}=A(),w=te(),s=u({status:!1,username:"",password:"",bypassSource:[""],zones:[]});let g=u(!1),v=u(!1),f=u(!1),D=u([]),S=u(),p=u(),c=u(),L=u(),x={notificationTitle:"",notificationDescription:"",username:"",password:"",zones:"",bypassSource:[""]},b=u({...x}),k=u({...x}),z=u({...x}),V=u({...x});W(()=>{J()});async function H(){var n,t;k.value={...x};try{let o=await T("ns.flashstart","list-zones",{});(t=(n=o==null?void 0:o.data)==null?void 0:n.values)!=null&&t.length&&(D.value=o.data.values.map(l=>({id:l.label,label:l.label})))}catch(o){g.value=!0,k.value.notificationTitle=a("error.cannot_retrieve_zones"),k.value.notificationDescription=a(R(o))}finally{v.value=!1}}async function J(){v.value=!0;try{let n=await T("ns.flashstart","get-config",{});if(n&&n.data&&n.data.values){let t=n.data.values;s.value.status=t.enabled,s.value.username=t.username,s.value.password=t.password,s.value.bypassSource=t.bypass,s.value.zones=t.zones.map(o=>({id:o,label:o})),s.value.bypassSource.length||(s.value.bypassSource=[""])}}catch(n){g.value=!0,z.value.notificationTitle=a("error.cannot_retrieve_flashstart_configuration"),z.value.notificationDescription=a(R(n))}finally{await H()}}function X(){b.value={notificationTitle:"",notificationDescription:"",username:"",password:"",zones:"",bypassSource:[""]}}function Y(){let n=!0,t=!1;if(!s.value.username){let{valid:o,errMessage:l}=E(s.value.username);o||(b.value.username=a(l),n=!1)}if(n||(N(S),t=!0),!s.value.password){let{valid:o,errMessage:l}=E(s.value.password);o||(b.value.password=a(l),n=!1)}if(!n&&!t&&(N(p),t=!0),!s.value.zones.length){let{valid:o,errMessage:l}=ie(s.value.zones);o||(b.value.zones=a(l),n=!1)}!n&&!t&&N(c);for(let[o,l]of s.value.bypassSource.entries())if(l){let F=[re(l),ue(l)];F.every(ae=>!ae.valid)&&(b.value.bypassSource[o]=a(F[0].errMessage),n=!1)}return n}function ee(){if(X(),!s.value.status||Y()){f.value=!0;let n={enabled:s.value.status,username:s.value.username,password:s.value.password,zones:s.value.zones.filter(t=>t.label).map(t=>t.label),bypass:s.value.bypassSource.filter(t=>t)};T("ns.flashstart","set-config",n).then(()=>{w.createNotification({kind:"success",title:a("standalone.flashstart.flashstart_configuration_saved")})}).catch(t=>{V.value.notificationTitle=a("error.cannot_save_configuration"),V.value.notificationDescription=a(R(t))}).finally(()=>f.value=!1)}}return(n,t)=>{const o=K("i18n-t");return d(),I("div",null,[i(pe,{title:e(a)("standalone.flashstart.content_title"),class:"max-w-3xl"},{description:r(()=>[i(o,{keypath:"standalone.flashstart.content_description",tag:"p",scope:"global"},{createAccount:r(()=>[i(e(O),{href:"https://flashstart.nethesis.it/",target:"_blank"},{default:r(()=>[_(y(e(a)("standalone.flashstart.content_link")),1)]),_:1})]),_:1})]),default:r(()=>[e(v)?(d(),m(e(Q),{key:0,lines:5})):h("",!0),e(k).notificationTitle?(d(),m(e(C),{key:1,class:"my-4",kind:"error",title:e(k).notificationTitle,description:e(k).notificationDescription},null,8,["title","description"])):h("",!0),e(z).notificationTitle?(d(),m(e(C),{key:2,class:"my-4",kind:"error",title:e(z).notificationTitle,description:e(z).notificationDescription},null,8,["title","description"])):h("",!0),!e(g)&&!e(v)?(d(),I("div",ve,[U("div",null,[i(e(se),null,{default:r(()=>[_(y(e(a)("standalone.flashstart.status")),1)]),_:1}),i(e(le),{modelValue:s.value.status,"onUpdate:modelValue":t[0]||(t[0]=l=>s.value.status=l),label:s.value.status?e(a)("standalone.flashstart.status_enabled"):e(a)("standalone.flashstart.status_disabled")},null,8,["modelValue","label"])]),s.value.status?(d(),I(Z,{key:0},[i(e(M),{modelValue:s.value.username,"onUpdate:modelValue":t[1]||(t[1]=l=>s.value.username=l),"invalid-message":e(b).username,label:e(a)("standalone.flashstart.username"),ref_key:"usernameRef",ref:S},{tooltip:r(()=>[i(e(B),null,{content:r(()=>[i(o,{keypath:"standalone.flashstart.username_helper",tag:"span",scope:"global"},{flashstartUrl:r(()=>[i(e(O),{invertedTheme:"",href:"https://flashstart.nethesis.it/",target:"_blank"},{default:r(()=>t[6]||(t[6]=[_(" https://flashstart.nethesis.it/ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","invalid-message","label"]),i(e(M),{modelValue:s.value.password,"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.password=l),isPassword:"","invalid-message":e(b).password,label:e(a)("standalone.flashstart.password"),ref_key:"passwordRef",ref:p},null,8,["modelValue","invalid-message","label"]),i(e(ne),{modelValue:s.value.zones,"onUpdate:modelValue":t[3]||(t[3]=l=>s.value.zones=l),label:e(a)("standalone.flashstart.zones"),placeholder:e(a)("standalone.flashstart.zones_placeholder"),multiple:"",options:e(D),"invalid-message":e(b).zones,ref_key:"zonesRef",ref:c,noResultsLabel:e(a)("ne_combobox.no_results"),limitedOptionsLabel:e(a)("ne_combobox.limited_options_label"),noOptionsLabel:e(a)("ne_combobox.no_options_label"),"selected-label":e(a)("ne_combobox.selected"),"user-input-label":e(a)("ne_combobox.user_input_label"),optionalLabel:e(a)("common.optional")},null,8,["modelValue","label","placeholder","options","invalid-message","noResultsLabel","limitedOptionsLabel","noOptionsLabel","selected-label","user-input-label","optionalLabel"]),i(be,{modelValue:s.value.bypassSource,"onUpdate:modelValue":t[4]||(t[4]=l=>s.value.bypassSource=l),title:e(a)("standalone.flashstart.sourcebypass"),"add-item-label":e(a)("standalone.flashstart.add_sourcebypass"),"invalid-messages":e(b).bypassSource,"disable-inputs":e(f),"disable-add-button":e(f),optional:"",optionalLabel:e(a)("common.optional"),ref_key:"bypassSourceRef",ref:L},{tooltip:r(()=>[i(e(B),null,{content:r(()=>[_(y(e(a)("standalone.flashstart.sourcebypass_helper")),1)]),_:1})]),_:1},8,["modelValue","title","add-item-label","invalid-messages","disable-inputs","disable-add-button","optionalLabel"]),e(V).notificationTitle?(d(),m(e(C),{key:0,class:"my-4",kind:"error",title:e(V).notificationTitle,description:e(V).notificationDescription},null,8,["title","description"])):h("",!0)],64)):h("",!0),U("div",_e,[i(e($),{disabled:e(f),kind:"primary",loading:e(f),onClick:t[5]||(t[5]=l=>ee())},{prefix:r(()=>[i(e(oe),{icon:["fas","floppy-disk"],class:"h-4 w-4","aria-hidden":"true"})]),default:r(()=>[_(" "+y(e(a)("common.save")),1)]),_:1},8,["disabled","loading"])])])):h("",!0)]),_:1},8,["title"])])}}}),he={class:"flex flex-col gap-y-6"},Ve=q({__name:"FlashStartView",setup(G){const{t:a}=A(),w=me(),s=de(),g=u(!1),v=u({getSubscriptionInfo:!0}),f=u({getSubscriptionInfo:"",getSubscriptionInfoDetails:""});async function D(){var S,p;v.value.getSubscriptionInfo=!0;try{const c=await T("ns.subscription","info");g.value=((S=c.data)==null?void 0:S.systemd_id)&&((p=c.data)==null?void 0:p.active)||!1,g.value&&w.listDnsSettings()}catch(c){f.value.getSubscriptionInfo=a(R(c)),f.value.getSubscriptionInfoDetails=c.toString()}finally{v.value.getSubscriptionInfo=!1}}return W(()=>{D()}),(S,p)=>{var L;const c=K("font-awesome-icon");return d(),I("div",he,[i(e(fe),{tag:"h3",class:"mb-7"},{default:r(()=>[_(y(e(a)("standalone.flashstart.title")),1)]),_:1}),f.value.getSubscriptionInfo?(d(),m(e(C),{key:0,title:e(a)("error.cannot_retrieve_subscription_info"),description:f.value.getSubscriptionInfo,class:"mb-6",kind:"error"},null,8,["title","description"])):h("",!0),v.value.getSubscriptionInfo||e(w).loadingListDnsSettings?(d(),m(e(Q),{key:1,lines:7,size:"lg"})):(d(),I(Z,{key:2},[g.value?(L=e(w).dnsSettings)!=null&&L.enabled?(d(),m(e(j),{key:1,title:e(a)("standalone.flashstart.flashstart_disabled"),description:e(a)("standalone.flashstart.flashstart_disabled_threat_shield_enabled"),icon:["fas","shield"],class:"pb-8"},{default:r(()=>[i(e($),{kind:"primary",onClick:p[1]||(p[1]=()=>{e(s).push(`${e(P)()}/security/threat-shield-dns?tab=settings`)})},{prefix:r(()=>[i(c,{icon:["fas","arrow-right"],class:"h-4 w-4","aria-hidden":"true"})]),default:r(()=>[_(" "+y(e(a)("common.go_to_page",{page:e(a)("standalone.threat_shield_dns.title")})),1)]),_:1})]),_:1},8,["title","description"])):(d(),m(ge,{key:2})):(d(),m(e(j),{key:0,title:e(a)("standalone.flashstart.flashstart_disabled"),description:e(a)("standalone.flashstart.flashstart_disabled_description",{product:e(ce)()}),icon:["fas","shield"],class:"pb-8"},{default:r(()=>[i(e($),{kind:"primary",onClick:p[0]||(p[0]=()=>{e(s).push(`${e(P)()}/system/subscription`)})},{prefix:r(()=>[i(c,{icon:["fas","arrow-right"],class:"h-4 w-4","aria-hidden":"true"})]),default:r(()=>[_(y(e(a)("common.go_to_page",{page:e(a)("standalone.subscription.title")})),1)]),_:1})]),_:1},8,["title","description"]))],64))])}}});export{Ve as default};
