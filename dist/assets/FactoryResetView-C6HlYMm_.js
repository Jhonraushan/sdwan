import{d as E,u as M,r as o,o as Q,e as h,V as I,h as m,q as P,i as g,l as e,y as U,n as k,M as N,w as r,m as _,t as s,L as F,j as d,k as c,F as S,_ as z,Q as G,Y as $,P as H,W as J}from"./index-BlEQ5104.js";import{_ as O}from"./FormLayout.vue_vue_type_script_setup_true_lang-DaMAl8E3.js";const X={class:"mb-4"},Z={class:"flex"},ee={class:"mb-8"},te={class:"mb-2 text-sm font-normal text-gray-500 dark:text-gray-400"},B=45e3,ae=E({__name:"FactoryResetContent",setup(W){const{t}=M(),p=o({unit_name:""}),y=o(!0),v=o(!1),x=o(!1),b=o(!1),D=o(""),T=o(),A=o(),R=o(0),Y=o(),j=o();let l=o({notificationTitle:"",notificationDescription:"",notificationDetails:""}),u=o({notificationTitle:"",notificationDescription:"",notificationDetails:""});Q(()=>{q()});async function q(){var f,i,a,V,w,C;try{let n=await h("ns.dashboard","system-info",{});(f=n==null?void 0:n.data)!=null&&f.result&&((a=(i=n==null?void 0:n.data)==null?void 0:i.result)!=null&&a.hostname&&(T.value=n.data.result.hostname),(C=(w=(V=n==null?void 0:n.data)==null?void 0:V.result)==null?void 0:w.version)!=null&&C.release&&(D.value=n.data.result.version.release))}catch(n){l.value.notificationTitle=t("error.cannot_load_system_config"),l.value.notificationDescription=t(I(n)),l.value.notificationDetails=n.toString()}finally{y.value=!1}}async function K(){var f,i;v.value=!0;try{let a=await h("ns.factoryreset","reset",{});(f=a==null?void 0:a.data)!=null&&f.result&&((i=a==null?void 0:a.data)==null?void 0:i.result)==="success"&&(x.value=!0,b.value=!1,L())}catch(a){u.value.notificationTitle=t("error.cannot_perform_factory_reset"),u.value.notificationDescription=t(I(a)),u.value.notificationDetails=a.toString()}finally{v.value=!1}}function L(){j.value=setTimeout(()=>{location.reload()},B),Y.value=setInterval(()=>{R.value+=.5},B/200)}return(f,i)=>(m(),P("div",null,[y.value?(m(),g(e(U),{key:0,lines:5})):k("",!0),!y.value&&e(l).notificationTitle?(m(),g(e(F),{key:1,class:"my-4",kind:"error",title:e(l).notificationTitle,description:e(l).notificationDescription},N({_:2},[e(l).notificationDetails?{name:"details",fn:r(()=>[_(s(e(l).notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):k("",!0),!y.value&&!e(l).notificationTitle?(m(),g(O,{key:2,class:"max-w-6xl text-sm text-gray-500 dark:text-gray-400"},{description:r(()=>[d("p",X,s(e(t)("standalone.factory_reset.description")),1),d("div",Z,[c(e(S),{icon:["fa","circle-info"],class:"mr-2 mt-1 text-indigo-700 dark:text-indigo-300"}),d("p",ee,s(e(t)("standalone.factory_reset.description_helper")),1)])]),default:r(()=>[d("div",null,[d("p",te,s(e(t)("standalone.factory_reset.current_version"))+": "+s(D.value),1),d("div",null,[c(e(z),{kind:"secondary",onClick:i[0]||(i[0]=a=>b.value=!0)},{prefix:r(()=>[c(e(S),{icon:["fa","arrow-rotate-left"],"aria-hidden":"true"})]),default:r(()=>[_(" "+s(e(t)("standalone.factory_reset.perform_factory_reset")),1)]),_:1})])])]),_:1})):k("",!0),c(e($),{"primary-label":e(t)("standalone.factory_reset.perform_factory_confirm"),"primary-button-disabled":T.value!==p.value.unit_name,"primary-button-loading":v.value,title:e(t)("standalone.factory_reset.perform_factory_reset"),visible:b.value,"cancel-label":e(t)("common.cancel"),kind:"warning","primary-button-kind":"danger","close-aria-label":e(t)("common.close"),onClose:i[2]||(i[2]=a=>b.value=!1),onPrimaryClick:i[3]||(i[3]=a=>K())},{default:r(()=>[_(s(e(t)("standalone.factory_reset.perform_factory_reset_description"))+" ",1),c(e(G),{class:"mt-4",modelValue:p.value.unit_name,"onUpdate:modelValue":i[1]||(i[1]=a=>p.value.unit_name=a),disabled:v.value,label:e(t)("standalone.factory_reset.type_unit_name",{unit:T.value}),ref_key:"unitNameRef",ref:A},null,8,["modelValue","disabled","label"]),e(u).notificationTitle?(m(),g(e(F),{key:0,class:"my-4",kind:"error",title:e(u).notificationTitle,description:e(u).notificationDescription},N({_:2},[e(u).notificationDetails?{name:"details",fn:r(()=>[_(s(e(u).notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):k("",!0)]),_:1},8,["primary-label","primary-button-disabled","primary-button-loading","title","visible","cancel-label","close-aria-label"]),c(e($),{"primary-label":e(t)("common.cancel"),"primary-button-disabled":!0,title:e(t)("standalone.factory_reset.title"),visible:x.value,"cancel-label":"",kind:"neutral","close-aria-label":e(t)("common.close"),onClose:i[4]||(i[4]=a=>x.value=!1)},{default:r(()=>[_(s(e(t)("standalone.factory_reset.resetting_description"))+" ",1),c(e(H),{class:"my-4",progress:R.value},null,8,["progress"])]),_:1},8,["primary-label","title","visible","close-aria-label"])]))}}),oe=E({__name:"FactoryResetView",setup(W){const{t}=M();return(p,y)=>(m(),P("div",null,[c(e(J),{tag:"h3",class:"mb-7"},{default:r(()=>[_(s(e(t)("standalone.factory_reset.title")),1)]),_:1}),c(ae)]))}});export{oe as default};
