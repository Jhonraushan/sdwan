import{d as A,u as N,r as v,J as G,i as D,w as u,l as e,aa as J,h as y,L as M,M as I,m as k,t as p,n as R,j as _,k as c,Q as F,_ as $,ai as O,V as H,S as T,T as P,cw as ee,cx as Q,s as se,da as te,ac as X,d0 as ie,c as ae,d6 as oe,y as Z,q as B,bI as ne,z as q,ad as le,Y as re,o as ce,g as ue,W as de,$ as fe}from"./index-BlEQ5104.js";import{_ as E}from"./FormLayout.vue_vue_type_script_setup_true_lang-DaMAl8E3.js";import{u as j}from"./accounts-BDI0ezSF.js";import{_ as ve,a as pe}from"./ChangeLangCombobox.vue_vue_type_script_setup_true_lang-DOASKUkR.js";const _e={class:"flex flex-col gap-y-6"},me={class:"list-inside list-disc text-sm font-normal text-gray-500 dark:text-gray-400"},ge={class:"flex justify-end"},ye=A({__name:"ChangePasswordDrawer",props:{isShown:{type:Boolean}},emits:["close","change-password"],setup(L,{emit:d}){const{t:s}=N(),{changePassword:S}=j(),b=L,h=d,f=v(!1),a=v({notificationTitle:"",notificationDescription:"",notificationDetails:""}),t=v(new J),l=v(""),r=v(""),w=v(""),V=v(),x=v(),K=v();function U(){l.value="",r.value="",w.value=""}function C(){t.value.clear(),a.value.notificationTitle="",a.value.notificationDescription="",a.value.notificationDetails="",h("close")}function m(){t.value.clear();let i=!0;const o=T(l.value);o.valid||(t.value.set("old_password",[o.errMessage]),i&&(P(V),i=!1));const g=T(r.value);g.valid||(t.value.set("new_password",[g.errMessage]),i&&(P(x),i=!1));const z=T(w.value);if(z.valid||(t.value.set("confirm_password",[z.errMessage]),i&&(P(K),i=!1)),r.value!=""||w.value!=""){const W=ee(r.value);if(!W.valid)t.value.set("new_password",[W.errMessage]),i&&(P(x),i=!1);else{const Y=Q(r.value,w.value);Y.valid||(t.value.set("confirm_password",[Y.errMessage]),i&&(P(K),i=!1))}}return i}async function n(){if(a.value.notificationTitle="",a.value.notificationDescription="",a.value.notificationDetails="",!!m()){f.value=!0;try{await S(l.value,r.value),h("change-password"),C()}catch(i){a.value.notificationTitle=s("error.cannot_change_password"),a.value.notificationDescription=s(H(i)),a.value.notificationDetails=i.toString()}finally{f.value=!1}}}return G(()=>b.isShown,()=>{b.isShown&&U()}),(i,o)=>(y(),D(e(O),{"is-shown":i.isShown,onClose:o[5]||(o[5]=g=>C()),closeAriaLabel:e(s)("common.shell.close_side_drawer"),title:e(s)("controller.account_settings.change_password")},{default:u(()=>[a.value.notificationTitle?(y(),D(e(M),{key:0,title:a.value.notificationTitle,description:a.value.notificationDescription,class:"mb-6",kind:"error"},I({_:2},[a.value.notificationDetails?{name:"details",fn:u(()=>[k(p(a.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):R("",!0),_("div",_e,[c(e(F),{modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=g=>l.value=g),label:e(s)("controller.account_settings.current_password"),"invalid-message":e(s)(t.value.getFirstI18nKeyFor("old_password")),"is-password":!0,ref_key:"oldPasswordRef",ref:V},null,8,["modelValue","label","invalid-message"]),c(e(F),{modelValue:r.value,"onUpdate:modelValue":o[1]||(o[1]=g=>r.value=g),label:e(s)("controller.account_settings.new_password"),"invalid-message":e(s)(t.value.getFirstI18nKeyFor("new_password")),"is-password":!0,ref_key:"newPasswordRef",ref:x},null,8,["modelValue","label","invalid-message"]),_("ul",me,[_("li",null,p(e(s)("controller.account_settings.password_suggestion_1")),1),_("li",null,p(e(s)("controller.account_settings.password_suggestion_2")),1),_("li",null,p(e(s)("controller.account_settings.password_suggestion_3")),1),_("li",null,p(e(s)("controller.account_settings.password_suggestion_4")),1),_("li",null,p(e(s)("controller.account_settings.password_suggestion_5")),1)]),c(e(F),{modelValue:w.value,"onUpdate:modelValue":o[2]||(o[2]=g=>w.value=g),label:e(s)("controller.account_settings.confirm_password"),"invalid-message":e(s)(t.value.getFirstI18nKeyFor("confirm_password")),"is-password":!0,ref_key:"confirmPasswordRef",ref:K},null,8,["modelValue","label","invalid-message"]),o[6]||(o[6]=_("hr",null,null,-1)),_("div",ge,[c(e($),{kind:"tertiary",class:"mr-4",onClick:o[3]||(o[3]=g=>C())},{default:u(()=>[k(p(e(s)("common.cancel")),1)]),_:1}),c(e($),{kind:"primary",onClick:o[4]||(o[4]=g=>n()),disabled:f.value,loading:f.value},{default:u(()=>[k(p(e(s)("common.save")),1)]),_:1},8,["disabled","loading"])])])]),_:1},8,["is-shown","closeAriaLabel","title"]))}}),we={class:"space-y-6"},ke={class:"flex flex-col gap-y-6"},he={class:"flex justify-end"},be=A({__name:"GenerateSSHKeyPairDrawer",props:{isShown:{type:Boolean}},emits:["close","generate-key-pair"],setup(L,{emit:d}){const{t:s}=N(),{generateSshKeys:S}=j(),b=L,h=d,f=v(!1),a=v({notificationTitle:"",notificationDescription:"",notificationDetails:""}),t=v(new J),l=v(""),r=v(""),w=v(),V=v();function x(){l.value="",r.value=""}function K(){t.value.clear(),a.value.notificationTitle="",a.value.notificationDescription="",a.value.notificationDetails="",h("close")}function U(){t.value.clear();let m=!0;const n=T(l.value);n.valid||(t.value.set("passphrase",[n.errMessage]),m&&(P(w),m=!1));const i=T(r.value);if(i.valid||(t.value.set("confirm_passphrase",[i.errMessage]),m&&(P(V),m=!1)),l.value!=""||r.value!=""){const o=te(l.value);if(!o.valid)t.value.set("passphrase",[o.errMessage]),m&&(P(w),m=!1);else{const g=Q(l.value,r.value);g.valid||(t.value.set("confirm_passphrase",[g.errMessage]),m&&(P(V),m=!1))}}return m}async function C(){if(a.value.notificationTitle="",a.value.notificationDescription="",a.value.notificationDetails="",!!U()){f.value=!0;try{await S(l.value),h("generate-key-pair"),K()}catch(m){a.value.notificationTitle=s("error.cannot_generate_ssh_key_pair"),a.value.notificationDescription=s(H(m)),a.value.notificationDetails=m.toString()}finally{f.value=!1}}}return G(()=>b.isShown,()=>{b.isShown&&x()}),(m,n)=>(y(),D(e(O),{"is-shown":m.isShown,onClose:n[4]||(n[4]=i=>K()),closeAriaLabel:e(s)("common.shell.close_side_drawer"),title:e(s)("controller.account_settings.generate_ssh_key_pair")},{default:u(()=>[_("div",we,[c(e(M),{kind:"info",title:e(s)("controller.account_settings.generate_ssh_key_pair"),description:e(s)("controller.account_settings.generate_ssh_key_pair_description"),closeAriaLabel:e(s)("common.close"),showDetailsLabel:e(s)("notifications.show_details")},null,8,["title","description","closeAriaLabel","showDetailsLabel"]),a.value.notificationTitle?(y(),D(e(M),{key:0,title:a.value.notificationTitle,description:a.value.notificationDescription,kind:"error"},I({_:2},[a.value.notificationDetails?{name:"details",fn:u(()=>[k(p(a.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):R("",!0),_("div",ke,[c(e(F),{modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=i=>l.value=i),label:e(s)("controller.account_settings.new_passphrase"),"invalid-message":e(s)(t.value.getFirstI18nKeyFor("passphrase")),"is-password":!0,"helper-text":e(s)("controller.account_settings.minimum_characters"),ref_key:"passphraseRef",ref:w},{tooltip:u(()=>[c(e(se),null,{content:u(()=>[k(p(e(s)("controller.account_settings.new_passphrase_tooltip")),1)]),_:1})]),_:1},8,["modelValue","label","invalid-message","helper-text"]),c(e(F),{modelValue:r.value,"onUpdate:modelValue":n[1]||(n[1]=i=>r.value=i),label:e(s)("controller.account_settings.confirm_passphrase"),"invalid-message":e(s)(t.value.getFirstI18nKeyFor("confirm_passphrase")),"is-password":!0,ref_key:"confirmPassphraseRef",ref:V},null,8,["modelValue","label","invalid-message"]),n[5]||(n[5]=_("hr",null,null,-1)),_("div",he,[c(e($),{kind:"tertiary",class:"mr-4",onClick:n[2]||(n[2]=i=>K())},{default:u(()=>[k(p(e(s)("common.cancel")),1)]),_:1}),c(e($),{kind:"primary",onClick:n[3]||(n[3]=i=>C()),disabled:f.value,loading:f.value},{default:u(()=>[k(p(e(s)("controller.account_settings.generate_key")),1)]),_:1},8,["disabled","loading"])])])])]),_:1},8,["is-shown","closeAriaLabel","title"]))}}),De={class:"mb-4"},Se=A({__name:"DeleteSSHKeyModal",props:{visible:{type:Boolean}},emits:["close","key-deleted"],setup(L,{emit:d}){const{t:s}=N(),S=j(),b=X(),h=v(!1),f=ie(),a=L,t=d,l=v({notificationDescription:"",notificationDetails:""}),r=v(!1),w=v(!1),V=ae(()=>f.units.filter(n=>n.connected));function x(){C(),K()}async function K(){l.value.notificationDescription="",l.value.notificationDetails="",r.value=!0;try{await S.deleteSshKeys(),t("key-deleted"),U()}catch(n){l.value.notificationDescription=s(H(n)),l.value.notificationDetails=n.toString()}finally{r.value=!1}}function U(){l.value.notificationDescription="",l.value.notificationDetails="",t("close")}G(()=>a.visible,async()=>{a.visible&&(h.value=!1,f.getUnits())});function C(){w.value=!0;const n=[];for(const i of V.value)n.push(m(i));Promise.allSettled(n).then(i=>{w.value=!1;const o=i.filter(g=>g.status==="rejected");o.length>0&&setTimeout(()=>{b.createNotification({title:s("controller.units.cannot_revoke_ssh_key_from_n_units",o.length),kind:"error"})},500)})}async function m(n){const i=S.sshKeys.key_pub;return oe("ns.controller","remove-ssh-key",{ssh_key:i},n.id,{timeout:5e3})}return(n,i)=>(y(),D(e(re),{visible:n.visible,kind:"warning",size:"lg",title:e(s)("controller.account_settings.remove_key"),primaryLabel:e(s)("controller.account_settings.remove_key"),primaryButtonDisabled:r.value||w.value,primaryButtonLoading:r.value||w.value,"primary-button-kind":"danger","close-aria-label":e(s)("common.close"),onPrimaryClick:x,onClose:i[1]||(i[1]=o=>U())},{default:u(()=>[e(f).loadingListUnits?(y(),D(e(Z),{key:0,lines:3})):(y(),B(q,{key:1},[_("p",De,p(e(s)("controller.account_settings.remove_key_description")),1),V.value.length>0?(y(),D(e(ne),{key:0,label:e(s)("controller.account_settings.show_connected_units"),isExpanded:h.value,onSetExpanded:i[0]||(i[0]=o=>h.value=o)},{default:u(()=>[_("ul",null,[(y(!0),B(q,null,le(V.value,o=>(y(),B("li",{class:"list-inside list-disc",key:o.id},p(o.info.unit_name?`${o.info.unit_name} (${o.id})`:o.id),1))),128))])]),_:1},8,["label","isExpanded"])):R("",!0)],64)),e(f).errorListUnits||l.value.notificationDescription?(y(),D(e(M),{key:2,kind:"error",title:e(s)("error.cannot_delete_ssh_key"),description:e(f).errorListUnits?e(f).errorListUnits:l.value.notificationDescription,class:"my-2"},I({_:2},[e(f).errorListUnitsDetails||l.value.notificationDetails?{name:"details",fn:u(()=>[k(p(e(f).errorListUnitsDetails?e(f).errorListUnitsDetails:l.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):R("",!0)]),_:1},8,["visible","title","primaryLabel","primaryButtonDisabled","primaryButtonLoading","close-aria-label"]))}}),Ve={class:"flex max-w-3xl flex-col gap-y-8"},Ke={class:"mb-4 flex flex-row items-center gap-x-2"},Le=A({__name:"AccountView",setup(L){const{t:d}=N(),s=j(),S=X(),b=v(!1),h=v(!1),f=v(!1);return ce(()=>{s.loadSshKeys()}),(a,t)=>{const l=ue("font-awesome-icon");return y(),B(q,null,[c(e(de),{tag:"h3",class:"mb-7"},{default:u(()=>[k(p(e(d)("controller.account_settings.title")),1)]),_:1}),_("div",Ve,[c(E,{title:e(d)("controller.account_settings.change_language")},{default:u(()=>[c(ve)]),_:1},8,["title"]),t[10]||(t[10]=_("hr",null,null,-1)),c(E,{title:e(d)("controller.account_settings.change_password"),description:e(d)("controller.account_settings.change_password_description")},{default:u(()=>[c(e($),{kind:"secondary",onClick:t[0]||(t[0]=r=>b.value=!0)},{default:u(()=>[k(p(e(d)("controller.account_settings.change_password")),1)]),_:1})]),_:1},8,["title","description"]),t[11]||(t[11]=_("hr",null,null,-1)),c(E,{title:e(d)("controller.account_settings.ssh_key"),description:e(d)("controller.account_settings.ssh_key_description")},{default:u(()=>[e(s).listSshKeysError.notificationDescription?(y(),D(e(M),{key:0,title:e(d)("error.cannot_retrieve_ssh_keys"),description:e(s).listSshKeysError.notificationDescription,class:"mb-6",kind:"error"},I({_:2},[e(s).listSshKeysError.notificationDetails?{name:"details",fn:u(()=>[k(p(e(s).listSshKeysError.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):R("",!0),e(s).listSshKeysLoading?(y(),D(e(Z),{key:1,lines:4})):e(s).sshKeys.key&&e(s).sshKeys.key_pub?(y(),B(q,{key:2},[_("div",Ke,[c(l,{icon:["fas","circle-check"],class:"h-4 w-4 text-green-600 dark:text-green-400","aria-hidden":"true"}),_("span",null,p(e(d)("controller.account_settings.passphrase_enabled")),1)]),c(e(fe),{label:e(d)("controller.account_settings.ssh_public_key"),class:"mb-6",modelValue:e(s).sshKeys.key_pub,"onUpdate:modelValue":t[1]||(t[1]=r=>e(s).sshKeys.key_pub=r),disabled:!0},null,8,["label","modelValue"]),c(e($),{kind:"tertiary",class:"-mx-2",onClick:t[2]||(t[2]=r=>f.value=!0)},{prefix:u(()=>[c(l,{icon:["fas","trash"],class:"h-4 w-4","aria-hidden":"true"})]),default:u(()=>[k(p(e(d)("controller.account_settings.remove_key")),1)]),_:1})],64)):(y(),D(e($),{key:3,kind:"secondary",onClick:t[3]||(t[3]=r=>h.value=!0)},{default:u(()=>[k(p(e(d)("controller.account_settings.generate_ssh_key_pair")),1)]),_:1}))]),_:1},8,["title","description"]),t[12]||(t[12]=_("hr",null,null,-1)),c(E,null,{title:u(()=>[k(p(e(d)("standalone.two_fa.title")),1)]),description:u(()=>[k(p(e(d)("standalone.two_fa.description")),1)]),default:u(()=>[c(pe)]),_:1})]),c(ye,{"is-shown":b.value,onClose:t[4]||(t[4]=r=>b.value=!1),onChangePassword:t[5]||(t[5]=()=>{e(S).addNotification({kind:"success",id:"change-password",title:e(d)("controller.account_settings.password_changed")})})},null,8,["is-shown"]),c(be,{"is-shown":h.value,onClose:t[6]||(t[6]=r=>h.value=!1),onGenerateKeyPair:t[7]||(t[7]=()=>{e(S).addNotification({kind:"success",id:"generate-ssh-key",title:e(d)("controller.account_settings.ssh_key_generated")}),e(s).loadSshKeys()})},null,8,["is-shown"]),c(Se,{visible:f.value,onClose:t[8]||(t[8]=r=>f.value=!1),onKeyDeleted:t[9]||(t[9]=()=>{e(S).addNotification({kind:"success",id:"remove-ssh-key",title:e(d)("controller.account_settings.ssh_key_removed")}),e(s).loadSshKeys()})},null,8,["visible"])],64)}}});export{Le as default};
