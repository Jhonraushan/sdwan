import{d as ee,u as ne,r as l,aI as nn,g as xe,h as x,i as A,w as s,k as a,l as e,aK as an,al as Z,m as k,t as d,ak as tn,q as P,ad as on,z as X,am as ln,aq as sn,an as rn,ao as J,j as _,av as oe,s as be,n as O,_ as H,ap as dn,L as le,M as ue,Y as $e,e as K,V as q,aa as Re,J as Te,y as Ve,a1 as ke,a5 as he,a0 as de,Q as Y,ai as Ue,ag as un,S as Q,bk as cn,a_ as Ae,ac as Cn,c as we,W as Ee,F as ge,aj as De,br as Le,ar as Qe,c1 as Ln,aP as Ye,aS as Ze,bL as $n,T as Je,aH as Tn,aJ as Sn,ah as Ge,H as Xe,o as pn,U as In,b as Fn,a9 as An}from"./index-BlEQ5104.js";import{u as En}from"./useTabs-BeLQ169O.js";import{_ as Rn}from"./CannotDeleteObjectModal.vue_vue_type_script_setup_true_lang-CreS7bAa.js";import{d as vn,a as _n}from"./fileUpload-2kJDzwnA.js";import{_ as Fe}from"./NeMultiTextInput.vue_vue_type_script_setup_true_lang-DwfeP71-.js";import"./isArrayLikeObject-CpCvCe5A.js";const Un={class:"flex flex-row gap-x-3"},Nn={class:"text-center"},Mn={class:"px-2 py-1"},On={class:"py-1"},Bn={class:"mr-2 inline-block font-semibold"},Kn={class:"text-gray-300 dark:text-gray-500"},Pn={class:"py-1"},zn={class:"mr-2 inline-block font-semibold"},jn={class:"text-gray-300 dark:text-gray-500"},qn={class:"py-1"},Hn={class:"mr-2 inline-block font-semibold"},Wn={class:"text-gray-300 dark:text-gray-500"},Qn={class:"py-1 align-top"},Yn={class:"mr-2 inline-block align-top font-semibold"},Zn={class:"inline-block align-top text-gray-300 dark:text-gray-500"},Jn={class:"flex flex-row gap-x-3"},Gn={class:"text-center"},Xn=["onClick"],ea={class:"-ml-2.5 flex items-center gap-2 xl:ml-0 xl:justify-end"},na=ee({__name:"RWAccountsTable",props:{users:{},authenticationMode:{}},emits:["delete","edit","enableDisable","downloadConfiguration","downloadCertificate","downloadQrCode","regenerateCertificate"],setup(z,{emit:r}){const{t:i}=ne(),n=z,t=r,b=l(10),{currentPage:w,paginatedItems:p}=nn(()=>n.users,{itemsPerPage:b});function V(h){return[{id:"download_configuration",label:i("standalone.openvpn_rw.download_configuration"),iconStyle:"fas",icon:"circle-arrow-down",danger:!1,action:()=>{t("downloadConfiguration",h)}},{id:"download_certificate",label:i("standalone.openvpn_rw.download_certificate"),iconStyle:"fas",icon:"circle-arrow-down",danger:!1,action:()=>{t("downloadCertificate",h)}},...n.authenticationMode==="username_otp_certificate"?[{id:"download_qr_code",label:i("standalone.openvpn_rw.download_qr_code"),iconStyle:"fas",icon:"circle-arrow-down",danger:!1,action:()=>{t("downloadQrCode",h)}}]:[],{id:"enable_disable",label:h.openvpn_enabled==="1"?i("common.disable"):i("common.enable"),iconStyle:"fas",icon:h.openvpn_enabled==="1"?"circle-xmark":"circle-check",action:()=>{t("enableDisable",h)}},{id:"regenerate_certificate",label:i("standalone.openvpn_rw.regenerate_certificate"),iconStyle:"fas",icon:"arrows-rotate",danger:!1,action:()=>{t("regenerateCertificate",h)}},{id:"delete",label:i("common.delete"),iconStyle:"fas",icon:"trash",danger:!0,action:()=>{t("delete",h)}}]}function c(h){return h.openvpn_enabled==="0"?["opacity-50"]:[]}return(h,I)=>{const E=xe("font-awesome-icon"),S=xe("router-link");return x(),A(e(sn),{ariaLabel:e(i)("standalone.openvpn_rw.roadwarrior_accounts"),cardBreakpoint:"xl"},{paginator:s(()=>{var v;return[a(e(an),{"current-page":e(w),"total-rows":(v=n.users)==null?void 0:v.length,"page-size":b.value,"nav-pagination-label":e(i)("ne_table.pagination"),"next-label":e(i)("ne_table.go_to_next_page"),"previous-label":e(i)("ne_table.go_to_previous_page"),"range-of-total-label":e(i)("ne_table.of"),"page-size-label":e(i)("ne_table.show"),onSelectPage:I[0]||(I[0]=f=>{w.value=f}),onSelectPageSize:I[1]||(I[1]=f=>{b.value=f})},null,8,["current-page","total-rows","page-size","nav-pagination-label","next-label","previous-label","range-of-total-label","page-size-label"])]}),default:s(()=>[a(e(tn),null,{default:s(()=>[a(e(Z),null,{default:s(()=>[k(d(e(i)("standalone.openvpn_rw.username")),1)]),_:1}),a(e(Z),null,{default:s(()=>[k(d(e(i)("standalone.openvpn_rw.expiration")),1)]),_:1}),a(e(Z),null,{default:s(()=>[k(d(e(i)("standalone.openvpn_rw.reserved_ip")),1)]),_:1}),a(e(Z),null,{default:s(()=>[k(d(e(i)("standalone.openvpn_rw.connection")),1)]),_:1}),a(e(Z))]),_:1}),a(e(ln),null,{default:s(()=>[(x(!0),P(X,null,on(e(p),v=>(x(),A(e(rn),{key:v.username},{default:s(()=>[a(e(J),{"data-label":e(i)("standalone.openvpn_rw.username")},{default:s(()=>[_("div",Un,[_("p",{class:oe([c(v)])},d(v.name),3),v.local&&!v.password&&(h.authenticationMode==="username_password"||h.authenticationMode==="username_password_certificate")?(x(),A(e(be),{key:0,interactive:""},{trigger:s(()=>[a(E,{icon:["fas","triangle-exclamation"],class:"h-4 w-4 text-amber-500"})]),content:s(()=>[_("div",Nn,[_("p",null,d(e(i)("standalone.openvpn_rw.password_not_configured")),1),a(S,{class:"text-primary-500 dark:text-primary-800",to:"/standalone/users-objects/users-database"},{default:s(()=>[k(d(e(i)("standalone.openvpn_rw.edit_user_database")),1)]),_:1})])]),_:1})):O("",!0)]),v.connected?(x(),A(e(be),{key:0,interactive:"",placement:"bottom"},{trigger:s(()=>[a(e(H),{size:"sm",kind:"tertiary",class:"-mx-2"},{default:s(()=>[k(d(e(i)("standalone.openvpn_rw.more_info")),1)]),_:1})]),content:s(()=>[_("div",null,[_("div",Mn,[_("div",On,[_("span",Bn,d(e(i)("standalone.openvpn_rw.virtual_ip"))+":",1),_("span",Kn,d(v.virtual_address),1)]),_("div",Pn,[_("span",zn,d(e(i)("standalone.openvpn_rw.remote_ip"))+":",1),_("span",jn,d(v.real_address),1)]),_("div",qn,[_("span",Hn,d(e(i)("standalone.openvpn_rw.started"))+":",1),_("span",Wn,d(`${new Date(v.since*1e3).toLocaleDateString()} ${new Date(v.since*1e3).toLocaleTimeString()}`),1)]),_("div",Qn,[_("span",Yn,d(e(i)("standalone.openvpn_rw.traffic"))+":",1),_("span",Zn,[k(d(parseInt(v.bytes_sent)/1e3)+" KB "+d(e(i)("standalone.openvpn_rw.sent")),1),I[2]||(I[2]=_("br",null,null,-1)),k(d(parseInt(v.bytes_received)/1e3)+" KB "+d(e(i)("standalone.openvpn_rw.received")),1)])])])])]),_:2},1024)):O("",!0)]),_:2},1032,["data-label"]),a(e(J),{"data-label":e(i)("standalone.openvpn_rw.expiration")},{default:s(()=>[_("div",Jn,[_("p",{class:oe([c(v)])},d(v.expiration?new Date(v.expiration*1e3).toLocaleDateString():"-"),3),v.expired?(x(),A(e(be),{key:0,interactive:""},{trigger:s(()=>[a(E,{icon:["fas","triangle-exclamation"],class:"h-4 w-4 text-amber-500"})]),content:s(()=>[_("div",Gn,[_("p",null,d(e(i)("standalone.openvpn_rw.this_certificate_expired")),1),_("p",{class:"cursor-pointer text-primary-500 dark:text-primary-800",onClick:f=>t("regenerateCertificate",v)},d(e(i)("standalone.openvpn_rw.renew_certificate")),9,Xn)])]),_:2},1024)):O("",!0)])]),_:2},1032,["data-label"]),a(e(J),{"data-label":e(i)("standalone.openvpn_rw.reserved_ip")},{default:s(()=>[_("p",{class:oe([c(v)])},d(v.openvpn_ipaddr?v.openvpn_ipaddr:"-"),3)]),_:2},1032,["data-label"]),a(e(J),{"data-label":e(i)("standalone.openvpn_rw.connection")},{default:s(()=>[_("div",{class:oe(["flex","flex-row","items-center",c(v)])},[a(E,{icon:["fas",v.connected?"circle-check":"circle-xmark"],class:oe(["mr-2","h-5","w-5",v.connected?"text-green-600 dark:text-green-400":""]),"aria-hidden":"true"},null,8,["icon","class"]),_("p",null,d(v.connected?e(i)("standalone.openvpn_rw.connected"):e(i)("standalone.openvpn_rw.not_connected")),1)],2)]),_:2},1032,["data-label"]),a(e(J),{"data-label":e(i)("common.actions")},{default:s(()=>[_("div",ea,[a(e(H),{kind:"tertiary",onClick:f=>t("edit",v)},{prefix:s(()=>[a(E,{icon:["fas","pen-to-square"],class:"h-4 w-4","aria-hidden":"true"})]),default:s(()=>[k(" "+d(e(i)("common.edit")),1)]),_:2},1032,["onClick"]),a(e(dn),{items:V(v),"align-to-right":!0},null,8,["items"])])]),_:2},1032,["data-label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["ariaLabel"])}}}),aa=ee({__name:"DeleteRWAccountModal",props:{visible:{type:Boolean},instanceName:{},account:{}},emits:["close","account-deleted"],setup(z,{emit:r}){const i=z,n=r,{t}=ne(),b=l({notificationDescription:"",notificationDetails:""}),w=l(!1);async function p(){if(i.account)try{b.value.notificationDescription="",b.value.notificationDetails="",w.value=!0,await K("ns.ovpnrw","delete-user",{instance:i.instanceName,username:i.account.name}),n("account-deleted"),n("close")}catch(c){b.value.notificationDescription=t(q(c)),b.value.notificationDetails=c.toString()}finally{w.value=!1}}function V(){b.value.notificationDescription="",b.value.notificationDetails="",n("close")}return(c,h)=>{var I,E,S;return x(),P("div",null,[(I=c.account)!=null&&I.used?(x(),A(Rn,{key:0,visible:c.visible,objectName:(E=c.account)==null?void 0:E.name,usageIds:(S=c.account)==null?void 0:S.matches,showGoToObjectsButton:!0,onClose:V},null,8,["visible","objectName","usageIds"])):(x(),A(e($e),{key:1,visible:c.visible,kind:"warning",title:e(t)("standalone.openvpn_rw.delete_account"),primaryLabel:e(t)("common.delete"),primaryButtonDisabled:w.value,primaryButtonLoading:w.value,"primary-button-kind":"danger","close-aria-label":e(t)("common.close"),onPrimaryClick:h[0]||(h[0]=v=>p()),onClose:h[1]||(h[1]=v=>V())},{default:s(()=>{var v;return[k(d(e(t)("standalone.openvpn_rw.delete_account_message",{name:(v=c.account)==null?void 0:v.name}))+" ",1),b.value.notificationDescription?(x(),A(e(le),{key:0,kind:"error",title:e(t)("error.cannot_delete_account"),description:b.value.notificationDescription,class:"my-2"},ue({_:2},[b.value.notificationDetails?{name:"details",fn:s(()=>[k(d(b.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):O("",!0)]}),_:1},8,["visible","title","primaryLabel","primaryButtonDisabled","primaryButtonLoading","close-aria-label"]))])}}}),ta={key:2,class:"flex flex-col gap-y-6"},oa={class:"flex justify-end"},la=ee({__name:"CreateOrEditRWAccountDrawer",props:{isShown:{type:Boolean},itemToEdit:{},instanceData:{},instanceName:{}},emits:["close","add-account","edit-account"],setup(z,{emit:r}){const i=z,{t:n}=ne(),t=r,b=l(!1),w=l(!1),p=l({notificationTitle:"",notificationDescription:"",notificationDetails:""}),V=l(new Re),c=l(!0),h=l(""),I=l(""),E=l("3650"),S=l([]);async function v(){try{b.value=!0,S.value=(await K("ns.users","list-users",{database:i.instanceData.ns_user_db})).data.users.map(D=>({id:D.name,label:D.name,description:D.description}))}catch(D){p.value.notificationTitle=n("error.cannot_retrieve_users"),p.value.notificationDescription=n(q(D)),p.value.notificationDetails=D.toString()}finally{b.value=!1}}async function f(){var D,F,T,C;c.value=i.itemToEdit?i.itemToEdit.openvpn_enabled==="1":!0,h.value=((D=i.itemToEdit)==null?void 0:D.name)??((T=(F=S.value)==null?void 0:F[0])==null?void 0:T.id)??"",I.value=((C=i.itemToEdit)==null?void 0:C.openvpn_ipaddr)??"",E.value=i.itemToEdit?"":"3650"}function B(D,F){for(let T of D)T.valid||V.value.set(F,[T.errMessage]);return D.every(T=>T.valid)}function R(){V.value.clear();const D=[[[Q(E.value),cn(E.value)],"expiration"]],F=[[Ae(I.value)],"ipaddr"];return[[[Q(h.value)],"username"],...I.value?[F]:[],...i.itemToEdit?[]:D].map(([C,U])=>B(C,U)).every(C=>C)}async function $(){p.value.notificationTitle="",p.value.notificationDescription="",p.value.notificationDetails="";const D=!!i.itemToEdit,F=D?"edit-user":"add-user";if(R()){w.value=!0;try{await K("ns.ovpnrw",F,{instance:i.instanceName,username:h.value,enabled:c.value?"1":"0",ipaddr:I.value,...D?{}:{expiration:E.value}}),w.value=!1,t(D?"edit-account":"add-account"),g()}catch(T){T instanceof un?V.value=T.errorBag:(p.value.notificationTitle=n(D?"error.cannot_edit_account":"error.cannot_create_account"),p.value.notificationDescription=n(q(T)),p.value.notificationDetails=T.toString()),w.value=!1;return}}}function g(){w.value||(V.value.clear(),p.value.notificationTitle="",p.value.notificationDescription="",p.value.notificationDetails="",t("close"))}return Te(()=>i.isShown,()=>{i.isShown&&v().then(()=>{f()})}),(D,F)=>(x(),A(e(Ue),{"is-shown":D.isShown,onClose:F[6]||(F[6]=T=>g()),closeAriaLabel:e(n)("common.shell.close_side_drawer"),title:D.itemToEdit?e(n)("standalone.openvpn_rw.edit_vpn_account"):e(n)("standalone.openvpn_rw.add_vpn_account")},{default:s(()=>{var T;return[p.value.notificationTitle?(x(),A(e(le),{key:0,title:p.value.notificationTitle,description:p.value.notificationDescription,class:"mb-6",kind:"error"},ue({_:2},[p.value.notificationDetails?{name:"details",fn:s(()=>[k(d(p.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):O("",!0),b.value?(x(),A(e(Ve),{key:1,lines:20})):(x(),P("div",ta,[_("div",null,[a(e(ke),null,{default:s(()=>[k(d(e(n)("standalone.openvpn_rw.status")),1)]),_:1}),a(e(he),{modelValue:c.value,"onUpdate:modelValue":F[0]||(F[0]=C=>c.value=C),label:c.value?e(n)("common.enabled"):e(n)("common.disabled")},null,8,["modelValue","label"])]),a(e(de),{label:e(n)("standalone.openvpn_rw.user"),disabled:!!D.itemToEdit,options:S.value,"no-options-label":e(n)("ne_combobox.no_options_label"),"no-results-label":e(n)("ne_combobox.no_results"),optionalLabel:e(n)("common.optional"),placeholder:e(n)("standalone.openvpn_rw.choose_user_from_database"),modelValue:h.value,"onUpdate:modelValue":F[1]||(F[1]=C=>h.value=C),"invalid-message":e(n)(V.value.getFirstI18nKeyFor("username"))},null,8,["label","disabled","options","no-options-label","no-results-label","optionalLabel","placeholder","modelValue","invalid-message"]),(T=D.itemToEdit)!=null&&T.expired?(x(),A(e(le),{key:0,kind:"warning",title:e(n)("standalone.openvpn_rw.certificate_expired"),description:e(n)("standalone.openvpn_rw.certificate_expired_message")},null,8,["title","description"])):O("",!0),a(e(Y),{modelValue:I.value,"onUpdate:modelValue":F[2]||(F[2]=C=>I.value=C),label:e(n)("standalone.openvpn_rw.reserved_ip"),helperText:e(n)("standalone.openvpn_rw.reserved_ip_helper",{range:D.instanceData.ifconfig_pool?`${D.instanceData.ifconfig_pool[0]}-${D.instanceData.ifconfig_pool[1]}`:""}),"invalid-message":e(n)(V.value.getFirstI18nKeyFor("ipaddr")),optional:!0,"optional-label":e(n)("common.optional")},null,8,["modelValue","label","helperText","invalid-message","optional-label"]),D.itemToEdit?O("",!0):(x(),A(e(Y),{key:1,modelValue:E.value,"onUpdate:modelValue":F[3]||(F[3]=C=>E.value=C),type:"number",label:e(n)("standalone.openvpn_rw.certificate_expiration_days"),"invalid-message":e(n)(V.value.getFirstI18nKeyFor("expiration"))},null,8,["modelValue","label","invalid-message"])),F[7]||(F[7]=_("hr",null,null,-1)),_("div",oa,[a(e(H),{kind:"tertiary",class:"mr-4",onClick:F[4]||(F[4]=C=>g())},{default:s(()=>[k(d(e(n)("common.cancel")),1)]),_:1}),a(e(H),{kind:"primary",onClick:F[5]||(F[5]=C=>$()),disabled:w.value,loading:w.value},{default:s(()=>[k(d(D.itemToEdit?e(n)("standalone.openvpn_rw.edit_account"):e(n)("standalone.openvpn_rw.add_account")),1)]),_:1},8,["disabled","loading"])])]))]}),_:1},8,["is-shown","closeAriaLabel","title"]))}}),ia={class:"flex flex-col gap-y-6"},sa={class:"flex justify-end"},ra=ee({__name:"RenewCertificateDrawer",props:{isShown:{type:Boolean},account:{},instanceName:{}},emits:["close","renew-certificate"],setup(z,{emit:r}){const i=z,n=r,{t}=ne(),b=l(!1),w=l(!1),p=l({notificationDescription:"",notificationDetails:""}),V=l(new Re),c=l(""),h=l("");async function I(){var R;c.value=((R=i.account)==null?void 0:R.name)??"",h.value=""}function E(R,$){for(let g of R)g.valid||V.value.set($,[g.errMessage]);return R.every(g=>g.valid)}function S(){return E([Q(h.value),cn(h.value)],"expiration")}async function v(){w.value=!0;try{await K("ns.ovpnrw","regenerate-user-certificate",{instance:i.instanceName,username:c.value,expiration:h.value}),w.value=!1,n("renew-certificate"),B()}catch(R){p.value.notificationDescription=t(q(R)),p.value.notificationDetails=R.toString(),w.value=!1}}function f(){n("close")}function B(){w.value||(p.value.notificationDescription="",p.value.notificationDetails="",b.value=!1)}return Te(()=>i.isShown,()=>{i.isShown&&I()}),(R,$)=>(x(),P(X,null,[a(e(Ue),{"is-shown":R.isShown,onClose:$[4]||($[4]=g=>f()),closeAriaLabel:e(t)("common.shell.close_side_drawer"),title:e(t)("standalone.openvpn_rw.renew_certificate")},{default:s(()=>[_("div",ia,[a(e(Y),{modelValue:c.value,"onUpdate:modelValue":$[0]||($[0]=g=>c.value=g),disabled:!0,label:e(t)("standalone.openvpn_rw.username")},null,8,["modelValue","label"]),a(e(Y),{modelValue:h.value,"onUpdate:modelValue":$[1]||($[1]=g=>h.value=g),type:"number",label:e(t)("standalone.openvpn_rw.certificate_expiration_days"),"invalid-message":e(t)(V.value.getFirstI18nKeyFor("expiration"))},null,8,["modelValue","label","invalid-message"]),$[7]||($[7]=_("hr",null,null,-1)),_("div",sa,[a(e(H),{kind:"tertiary",class:"mr-4",onClick:$[2]||($[2]=g=>f())},{default:s(()=>[k(d(e(t)("common.cancel")),1)]),_:1}),a(e(H),{kind:"primary",onClick:$[3]||($[3]=()=>{S()&&(b.value=!0,f())})},{default:s(()=>[k(d(e(t)("standalone.openvpn_rw.renew_certificate")),1)]),_:1})])])]),_:1},8,["is-shown","closeAriaLabel","title"]),a(e($e),{visible:b.value,kind:"warning",title:e(t)("standalone.openvpn_rw.renew_certificate"),primaryLabel:e(t)("standalone.openvpn_rw.renew"),primaryButtonDisabled:w.value,primaryButtonLoading:w.value,"close-aria-label":e(t)("common.close"),onPrimaryClick:$[5]||($[5]=g=>v()),onClose:$[6]||($[6]=g=>B())},{default:s(()=>[k(d(e(t)("standalone.openvpn_rw.renew_certificate_confirm_message",{username:c.value}))+" ",1),p.value.notificationDescription?(x(),A(e(le),{key:0,kind:"error",title:e(t)("error.cannot_renew_certificate"),description:p.value.notificationDescription,class:"my-2"},ue({_:2},[p.value.notificationDetails?{name:"details",fn:s(()=>[k(d(p.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):O("",!0)]),_:1},8,["visible","title","primaryLabel","primaryButtonDisabled","primaryButtonLoading","close-aria-label"])],64))}}),da={class:"flex flex-col"},ua={class:"max-w-2xl text-sm font-normal text-gray-500 dark:text-gray-400"},ca={class:"flex flex-col-reverse items-start justify-between gap-8 xl:flex-row xl:items-center"},pa={class:"flex flex-row gap-x-3"},va={class:"flex flex-row gap-x-3"},_a=ee({__name:"RWAccountsManager",props:{users:{},server:{},instanceName:{},isLoading:{type:Boolean}},emits:["update-users"],setup(z,{emit:r}){const i=z,n=r,{t}=ne(),b=Cn(),w=l(""),p=l(["all"]),V=l(["all"]),c=l({notificationTitle:"",notificationDescription:"",notificationDetails:""}),h=l(),I=l(!1),E=l(!1),S=l(!1),v=l(!1);function f(){c.value={notificationTitle:"",notificationDescription:"",notificationDetails:""}}function B(L){h.value=L,E.value=!0}function R(L){h.value=L,I.value=!0}function $(L){h.value=L,S.value=!0}function g(L,u){let N=document.createElement("a");N.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(L)),N.setAttribute("download",u),document.body.appendChild(N),N.click(),N.remove()}async function D(L){f();try{await K("ns.ovpnrw",L.openvpn_enabled==="1"?"disable-user":"enable-user",{username:L.name,instance:i.instanceName}),n("update-users")}catch(u){c.value.notificationTitle=L.openvpn_enabled==="1"?t("standalone.openvpn_rw.cannot_disable_account"):t("standalone.openvpn_rw.cannot_enable_account"),c.value.notificationDescription=t(q(u)),c.value.notificationDetails=u.toString()}}async function F(L){L.connected&&L.openvpn_enabled=="1"?(h.value=L,v.value=!0):await D(L)}async function T(L){f();try{const u=(await K("ns.ovpnrw","download-user-configuration",{username:L.name,instance:i.instanceName})).data.data;g(u,`${L.name}.ovpn`)}catch(u){c.value.notificationTitle=t("standalone.openvpn_rw.cannot_download_configuration"),c.value.notificationDescription=t(q(u)),c.value.notificationDetails=u.toString()}}async function C(L){f();try{const u=(await K("ns.ovpnrw","download-user-certificate",{username:L.name,instance:i.instanceName})).data.data;g(u,`${L.name}.crt`)}catch(u){c.value.notificationTitle=t("standalone.openvpn_rw.cannot_download_configuration"),c.value.notificationDescription=t(q(u)),c.value.notificationDetails=u.toString()}}async function U(){var L;f();try{let u=await K("ns.ovpnrw","download_all_user_configurations",{instance:i.instanceName});if((L=u==null?void 0:u.data)!=null&&L.archive_path){u.data.archive_path=u.data.archive_path.replace("/var/run/ns-api-server/downloads/","");const N=await vn(u.data.archive_path),ce=URL.createObjectURL(N);let pe=document.createElement("a");pe.href=ce,pe.download=u.data.archive_path.replace(".tar.gz","")+"-"+Date.now().toString()+".tar.gz",pe.click(),await _n(u.data.archive_path)}}catch(u){c.value.notificationTitle=t("standalone.openvpn_rw.cannot_download_configuration"),c.value.notificationDescription=t(q(u)),c.value.notificationDetails=u.toString()}}async function j(L){f();try{const u=(await K("ns.ovpnrw","download-user-2fa",{username:L.name,instance:i.instanceName})).data.data;g(u,`${L.name}.svg`)}catch(u){c.value.notificationTitle=t("standalone.openvpn_rw.cannot_download_qr_code"),c.value.notificationDescription=t(q(u)),c.value.notificationDetails=u.toString()}}const ae=l([{id:"all",label:t("common.any")},{id:"connected",label:t("standalone.openvpn_rw.connected")},{id:"not_connected",label:t("standalone.openvpn_rw.not_connected")}]),ie=l([{id:"all",label:t("common.any")},{id:"expired",label:t("standalone.openvpn_rw.expired")},{id:"not_expired",label:t("standalone.openvpn_rw.not_expired")}]),G=we(()=>i.users.filter(L=>{let u=!0;return w.value&&(u=L.name.includes(w.value)),p.value[0]==="connected"?u=u&&L.connected:p.value[0]==="not_connected"&&(u=u&&!L.connected),V.value[0]==="expired"?u=u&&L.expired:V.value[0]==="not_expired"&&(u=u&&!L.expired),u}));function se(){w.value="",p.value=["all"],V.value=["all"]}return(L,u)=>(x(),P(X,null,[_("div",da,[a(e(Ee),{tag:"h5",class:"mb-2"},{default:s(()=>[k(d(e(t)("standalone.openvpn_rw.roadwarrior_accounts")),1)]),_:1}),_("p",ua,d(e(t)("standalone.openvpn_rw.roadwarrior_accounts_description")),1)]),c.value.notificationDescription?(x(),A(e(le),{key:0,title:e(t)("error.cannot_retrieve_databases"),description:c.value.notificationDescription,class:"mb-6",kind:"error"},ue({_:2},[c.value.notificationDetails?{name:"details",fn:s(()=>[k(d(c.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):O("",!0),L.isLoading?(x(),A(e(Ve),{key:1,lines:8})):L.users.length==0?(x(),A(e(De),{key:2,title:e(t)("standalone.openvpn_rw.no_users_found"),icon:["fas","user-group"]},{default:s(()=>[a(e(H),{kind:"secondary",onClick:u[0]||(u[0]=N=>B())},{prefix:s(()=>[a(e(ge),{icon:["fas","circle-plus"],class:"h-4 w-4","aria-hidden":"true"})]),default:s(()=>[k(" "+d(e(t)("standalone.openvpn_rw.add_vpn_account")),1)]),_:1})]),_:1},8,["title"])):(x(),P(X,{key:3},[_("div",ca,[_("div",pa,[a(e(Y),{modelValue:w.value,"onUpdate:modelValue":u[1]||(u[1]=N=>w.value=N),placeholder:e(t)("common.filter")},null,8,["modelValue","placeholder"]),a(e(Le),{modelValue:V.value,"onUpdate:modelValue":u[2]||(u[2]=N=>V.value=N),kind:"radio",label:e(t)("standalone.openvpn_rw.expiration"),options:ie.value,clearFilterLabel:e(t)("ne_dropdown_filter.clear_filter"),openMenuAriaLabel:e(t)("ne_dropdown_filter.open_filter")},null,8,["modelValue","label","options","clearFilterLabel","openMenuAriaLabel"]),a(e(Le),{modelValue:p.value,"onUpdate:modelValue":u[3]||(u[3]=N=>p.value=N),kind:"radio",label:e(t)("standalone.openvpn_rw.connection"),options:ae.value,clearFilterLabel:e(t)("ne_dropdown_filter.clear_filter"),openMenuAriaLabel:e(t)("ne_dropdown_filter.open_filter")},null,8,["modelValue","label","options","clearFilterLabel","openMenuAriaLabel"]),a(e(H),{kind:"tertiary",onClick:se},{default:s(()=>[k(d(e(t)("common.clear_filters")),1)]),_:1})]),_("div",va,[a(e(H),{kind:"tertiary",onClick:u[4]||(u[4]=N=>U())},{prefix:s(()=>[a(e(ge),{icon:["fas","fa-circle-arrow-down"],class:"h-4 w-4","aria-hidden":"true"})]),default:s(()=>[k(" "+d(e(t)("standalone.openvpn_rw.download_all_configs")),1)]),_:1}),a(e(H),{kind:"secondary",onClick:u[5]||(u[5]=N=>B())},{prefix:s(()=>[a(e(ge),{icon:["fas","circle-plus"],class:"h-4 w-4","aria-hidden":"true"})]),default:s(()=>[k(" "+d(e(t)("standalone.openvpn_rw.add_vpn_account")),1)]),_:1})])]),G.value.length>0?(x(),A(na,{key:0,users:G.value,"authentication-mode":L.server.ns_auth_mode,onDelete:R,onEdit:B,onDownloadCertificate:C,onDownloadConfiguration:T,onDownloadQrCode:j,onEnableDisable:F,onRegenerateCertificate:$},null,8,["users","authentication-mode"])):(x(),A(e(De),{key:1,title:e(t)("standalone.openvpn_rw.no_users_found"),icon:["fas","user-group"]},null,8,["title"]))],64)),a(aa,{visible:I.value,account:h.value,"instance-name":L.instanceName,onAccountDeleted:u[6]||(u[6]=()=>{e(b).addNotification({kind:"success",id:"delete-account",title:e(t)("standalone.openvpn_rw.account_deleted")}),n("update-users")}),onClose:u[7]||(u[7]=N=>I.value=!1)},null,8,["visible","account","instance-name"]),a(la,{"is-shown":E.value,"instance-data":L.server,"instance-name":L.instanceName,"item-to-edit":h.value,onClose:u[8]||(u[8]=N=>E.value=!1),onAddAccount:u[9]||(u[9]=()=>{e(b).addNotification({kind:"success",id:"add-account",title:e(t)("standalone.openvpn_rw.account_created")}),n("update-users")}),onEditAccount:u[10]||(u[10]=()=>{e(b).addNotification({kind:"success",id:"edit-account",title:e(t)("standalone.openvpn_rw.account_edited")}),n("update-users")})},null,8,["is-shown","instance-data","instance-name","item-to-edit"]),a(ra,{account:h.value,"instance-name":L.instanceName,"is-shown":S.value,onClose:u[11]||(u[11]=N=>S.value=!1),onRenewCertificate:u[12]||(u[12]=N=>n("update-users"))},null,8,["account","instance-name","is-shown"]),a(e($e),{visible:v.value,kind:"warning",title:e(t)("standalone.openvpn_rw.disable_account"),primaryLabel:e(t)("common.disable"),"primary-button-kind":"danger",onPrimaryClick:u[13]||(u[13]=()=>{v.value=!1,D(h.value)}),"close-aria-label":e(t)("common.close"),onClose:u[14]||(u[14]=N=>v.value=!1)},{default:s(()=>[k(d(e(t)("standalone.openvpn_rw.disable_account_message")),1)]),_:1},8,["visible","title","primaryLabel","close-aria-label"])],64))}}),fa={class:"flex w-full flex-col gap-6 2xl:flex-row"},ma={class:"flex grow flex-row items-center justify-between rounded-md border-l-4 border-indigo-400 bg-gray-100 p-2 dark:border-indigo-500 dark:bg-gray-800 sm:rounded-lg sm:shadow"},ba={class:"ml-4 flex flex-row items-center"},wa={class:"ml-4 mr-10 grow border-l border-gray-800 py-3 pl-4 text-sm dark:border-gray-600 md:ml-8 md:pl-8"},ga={class:"flex max-w-xl flex-col justify-between gap-y-4 sm:flex-row sm:gap-x-4"},ya={class:"mb-2 font-semibold"},ka={class:oe(["flex","flex-row","items-center"])},ha={class:"mb-2 font-semibold"},xa={class:"mb-2 font-semibold"},Da={class:"flex flex-row items-center"},Va={class:"flex flex-row items-center justify-between rounded-md bg-gray-100 p-5 dark:bg-gray-800 sm:rounded-lg sm:shadow"},Ca={class:"flex flex-row items-center"},La={class:"mx-2"},$a={class:"ml-4 text-3xl"},Ta=ee({__name:"RWServerDetails",props:{server:{},connectedClients:{}},emits:["delete-server","edit-server"],setup(z,{emit:r}){const{t:i}=ne(),n=r;return(t,b)=>{const w=xe("font-awesome-icon");return x(),P("div",fa,[_("div",ma,[_("div",ba,[a(w,{icon:["fas","server"],"aria-hidden":"true",class:oe("mr-5 h-4 w-4 rounded-full bg-gray-900 p-2 text-gray-300 dark:bg-gray-50 dark:text-gray-600")}),_("p",null,d(t.server.ns_description),1)]),_("div",wa,[_("div",ga,[_("div",null,[_("p",ya,d(e(i)("standalone.openvpn_rw.status")),1),_("div",ka,[a(w,{icon:["fas",t.server.enabled=="1"?"circle-check":"circle-xmark"],class:oe(["mr-2","h-4","w-4",t.server.enabled=="1"?"text-green-500":"text-rose-500"]),"aria-hidden":"true"},null,8,["icon","class"]),_("p",null,d(t.server.enabled==="1"?e(i)("common.enabled"):e(i)("common.disabled")),1)])]),_("div",null,[_("p",ha,d(e(i)("standalone.openvpn_rw.authentication_mode")),1),_("p",null,d(e(i)(`standalone.openvpn_rw.${t.server.ns_auth_mode}`)),1)]),_("div",null,[_("p",xa,d(e(i)("standalone.openvpn_rw.database")),1),_("p",null,d(t.server.ns_user_db==="main"?e(i)("standalone.openvpn_rw.local_database"):t.server.ns_user_db),1)])])]),_("div",Da,[a(e(H),{kind:"tertiary",class:"mr-2",onClick:b[0]||(b[0]=p=>n("edit-server"))},{prefix:s(()=>[a(w,{icon:["fas","pen-to-square"],class:"h-4 w-4","aria-hidden":"true"})]),default:s(()=>[k(" "+d(e(i)("common.edit")),1)]),_:1}),a(e(dn),{items:[{id:"delete",label:e(i)("common.delete"),iconStyle:"fas",icon:"trash",danger:!0,action:()=>{n("delete-server")}}],"align-to-right":!0},null,8,["items"])])]),_("div",Va,[_("div",Ca,[a(w,{icon:["fas","user-group"],"aria-hidden":"true",class:oe("mr-5 h-4 w-4 rounded-full bg-gray-900 p-2 text-gray-300 dark:bg-gray-50 dark:text-gray-600")}),_("p",La,d(e(i)("standalone.openvpn_rw.connected_clients")),1)]),_("p",$a,d(t.connectedClients),1)])])}}}),Sa=ee({__name:"DeleteRWServerModal",props:{visible:{type:Boolean},instanceName:{}},emits:["close","server-deleted"],setup(z,{emit:r}){const i=z,n=r,{t}=ne(),b=l({notificationDescription:"",notificationDetails:""}),w=l(!1);async function p(){if(i.instanceName)try{b.value.notificationDescription="",b.value.notificationDetails="",w.value=!0,await K("ns.ovpnrw","remove-instance",{instance:i.instanceName}),n("server-deleted"),n("close")}catch(c){b.value.notificationDescription=t(q(c)),b.value.notificationDetails=c.toString()}finally{w.value=!1}}function V(){b.value.notificationDescription="",b.value.notificationDetails="",n("close")}return(c,h)=>(x(),A(e($e),{visible:c.visible,kind:"warning",title:e(t)("standalone.openvpn_rw.delete_roadwarrior_server"),primaryLabel:e(t)("common.delete"),primaryButtonDisabled:w.value,primaryButtonLoading:w.value,"primary-button-kind":"danger","close-aria-label":e(t)("common.close"),onPrimaryClick:h[0]||(h[0]=I=>p()),onClose:h[1]||(h[1]=I=>V())},{default:s(()=>[k(d(e(t)("standalone.openvpn_rw.delete_roadwarrior_server_message"))+" ",1),b.value.notificationDescription?(x(),A(e(le),{key:0,kind:"error",title:e(t)("error.cannot_delete_server"),description:b.value.notificationDescription,class:"my-2"},ue({_:2},[b.value.notificationDetails?{name:"details",fn:s(()=>[k(d(b.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):O("",!0)]),_:1},8,["visible","title","primaryLabel","primaryButtonDisabled","primaryButtonLoading","close-aria-label"]))}}),Ia={key:2,class:"flex flex-col gap-y-6"},Fa={key:0},Aa={class:"flex justify-end"},Ea=ee({__name:"CreateOrEditRWServerDrawer",props:{isShown:{type:Boolean},itemToEdit:{},instanceName:{}},emits:["close","add-edit-server"],setup(z,{emit:r}){const i=z,{t:n}=ne(),t=r,b=l(!1),w=l(!1),p=l({notificationTitle:"",notificationDescription:"",notificationDetails:""}),V=l(new Re),c=l([]),h=l([]),I=l(!1),E=l(!0),S=l(""),v=l(),f=l("main"),B=l(),R=l(!1),$=l("username_password"),g=l("routed"),D=l(""),F=l(),T=l([]),C=l("udp"),U=l(""),j=l(),ae=l(!1),ie=l([]),G=l(!1),se=l("disabled"),L=l("auto"),u=l("auto"),N=l("auto"),ce=l(""),pe=l(),ve=l(""),Ne=l(),_e=l(""),Me=l(),fe=l(""),Oe=l(),me=l(""),Be=l(),Ce=l([]),Ke=l([]),Pe=l([]),ze=l([]),Se=l([]),je=l([]),qe=l([]),fn=[{id:"disabled",label:n("common.disabled")},{id:"lzo",label:"LZO"},{id:"lz4",label:"LZ4"}],mn=[{id:"routed",label:n("standalone.openvpn_rw.routed")},{id:"bridged",label:n("standalone.openvpn_rw.bridged")}],bn=[{id:"udp",label:n("standalone.openvpn_rw.udp")},{id:"tcp",label:n("standalone.openvpn_rw.tcp")}],wn=[{id:"auto",label:n("standalone.openvpn_rw.auto")},{id:"1.1",label:"1.1"},{id:"1.2",label:"1.2"}],ye=l();async function gn(){try{b.value=!0,Pe.value=[{id:"auto",label:n("standalone.openvpn_rw.auto"),description:`(${n("standalone.openvpn_rw.server_client_negotiation")})`},...(await K("ns.ovpnrw","list-cipher")).data.ciphers.map(o=>({id:o.name,label:o.name,description:"("+n("standalone.openvpn_rw."+o.description)+")"}))],Ke.value=[{id:"auto",label:n("standalone.openvpn_rw.auto"),description:`(${n("standalone.openvpn_rw.server_client_negotiation")})`},...(await K("ns.ovpnrw","list-digest")).data.digests.map(o=>({id:o.name,label:o.name,description:"("+n("standalone.openvpn_rw."+o.description)+")"}))],ze.value=(await K("ns.ovpnrw","list-auth-modes")).data.options.map(o=>({id:o,label:n(`standalone.openvpn_rw.${o}`)})),je.value=(await K("ns.users","list-databases")).data.databases.map(o=>({id:o.name,label:o.name==="main"?n("standalone.openvpn_rw.local_database"):o.name,description:o.description})),qe.value=(await K("ns.ovpnrw","list-dhcp-options")).data.options.map(o=>({id:o,label:o})),Se.value=(await K("ns.ovpnrw","list-bridges")).data.bridges.map(o=>({id:o,label:o})),b.value=!1,Je(v)}catch(o){p.value.notificationTitle=n("error.cannot_retrieve_server_options"),p.value.notificationDescription=n(q(o)),p.value.notificationDetails=o.toString()}}function He(){V.value.clear(),c.value=[],h.value=[]}function yn(){var m,W,M,te;const o=i.itemToEdit;S.value=(o==null?void 0:o.ns_description)??"",f.value=o!=null&&o.ns_user_db?o.ns_user_db:"main",R.value=!1,$.value=(o==null?void 0:o.ns_auth_mode)??"username_password",g.value=(o==null?void 0:o.dev_type)==="tun"?"routed":"bridged",D.value=(o==null?void 0:o.server)??"",fe.value=(m=o==null?void 0:o.ifconfig_pool)!=null&&m.length?o.ifconfig_pool[0]:"",me.value=(W=o==null?void 0:o.ifconfig_pool)!=null&&W.length?o.ifconfig_pool[1]:"",T.value=(o==null?void 0:o.ns_public_ip)??[],C.value=(o==null?void 0:o.proto)??"udp",U.value=(o==null?void 0:o.port)??"",ie.value=(o==null?void 0:o.ns_local)??[],se.value=(o==null?void 0:o.compress)??"disabled",u.value=(o==null?void 0:o.cipher)??"auto",L.value=(o==null?void 0:o.auth)??"auto",ve.value=(o==null?void 0:o.ns_pool_start)??"",_e.value=(o==null?void 0:o.ns_pool_end)??"",ce.value=(o==null?void 0:o.ns_bridge)??((te=(M=Se.value)==null?void 0:M[0])==null?void 0:te.id)??"",N.value=(o==null?void 0:o.tls_version_min)??"auto",Ce.value=(o==null?void 0:o.ns_dhcp_options.map(re=>({key:re.option,value:re.value})))??[],o?(ae.value=o.ns_redirect_gateway==="1",G.value=o.client_to_client==="1",E.value=o.enabled==="1"):(ae.value=!1,G.value=!1,E.value=!0)}function kn(o,m,W){for(let M of o)M.valid||(V.value.set(m,[M.errMessage]),ye.value||(ye.value=W));return o.every(M=>M.valid)}function We(o,m){let W=[];m.forEach(()=>{W.push("")});for(let[M,te]of m.entries())for(let re of o){const y=re(te);if(!y.valid){W[M]=n(y.errMessage);break}}return W}function hn(){He();let o=!0,m=!0;T.value.length==0?(V.value.set("ns_public_ip",["required"]),o=!1):(c.value=We([Q,Ln],T.value),o=c.value.every(y=>y==="")),h.value=We([Q,Ye],ie.value),m=h.value.every(y=>y==="");const W=[[[Q(ve.value),Ae(ve.value)],"ns_pool_start",Ne],[[Q(_e.value),Ae(_e.value)],"ns_pool_end",Me],[[Q(ce.value)],"ns_bridge",pe]],M=[[[Q(D.value),Ye(D.value)],"server",F],[[Q(fe.value),Ze(fe.value)],"ifconfig_pool_start",Oe],[[Q(me.value),Ze(me.value)],"ifconfig_pool_end",Be]],te=[[[Q(S.value)],"ns_description",v],[[Q(f.value)],"ns_user_db",B],[[Q(U.value),$n(U.value)],"port",j],...g.value==="bridged"?W:M];ye.value=void 0;const re=te.map(([y,Dn,Vn])=>kn(y,Dn,Vn)).every(y=>y)&&o&&m;return ye.value&&Je(ye.value),re}async function xn(){var m,W;p.value.notificationTitle="",p.value.notificationDescription="",p.value.notificationDetails="";const o=!!((m=i.itemToEdit)!=null&&m.ns_description);if(hn()){w.value=!0;try{await K("ns.ovpnrw","set-configuration",{instance:i.instanceName,ns_description:S.value,enabled:E.value?"1":"0",ns_user_db:f.value,ns_auth_mode:$.value,dev_type:g.value==="routed"?"tun":"tap",server:g.value==="routed"?D.value:"",ns_bridge:g.value==="bridged"?ce.value:"",ns_pool_start:g.value==="bridged"?ve.value:"",ns_pool_end:g.value==="bridged"?_e.value:"",proto:C.value,ifconfig_pool:g.value==="routed"?[fe.value,me.value]:[],ns_public_ip:T.value,port:U.value,ns_local:ie.value,ns_redirect_gateway:ae.value?"1":"0",client_to_client:G.value?"1":"0",compress:se.value==="disabled"?"":se.value,cipher:u.value==="auto"?"":u.value,auth:L.value==="auto"?"":L.value,tls_version_min:N.value==="auto"?"":N.value,ns_dhcp_options:Ce.value.filter(M=>M.key).map(M=>({option:M.key,value:M.value}))})}catch(M){M instanceof un?V.value=M.errorBag:(p.value.notificationTitle=n(o?"error.cannot_edit_server":"error.cannot_create_server"),p.value.notificationDescription=n(q(M)),p.value.notificationDetails=M.toString()),w.value=!1;return}try{!((W=i.itemToEdit)!=null&&W.ns_description)&&R.value&&await K("ns.ovpnrw","import-users",{instance:i.instanceName})}catch(M){p.value.notificationTitle=n("error.cannot_import_users"),p.value.notificationDescription=n(q(M)),p.value.notificationDetails=M.toString();return}finally{w.value=!1}t("add-edit-server"),Ie()}}function Ie(){w.value||(He(),p.value.notificationTitle="",p.value.notificationDescription="",p.value.notificationDetails="",t("close"))}return Te(()=>i.isShown,()=>{i.isShown&&(I.value=!1,gn().then(()=>{yn()}))}),(o,m)=>{var M;const W=xe("font-awesome-icon");return x(),A(e(Ue),{"is-shown":o.isShown,onClose:m[26]||(m[26]=te=>Ie()),closeAriaLabel:e(n)("common.shell.close_side_drawer"),title:(M=o.itemToEdit)!=null&&M.ns_description?e(n)("standalone.openvpn_rw.edit_server"):e(n)("standalone.openvpn_rw.create_server")},{default:s(()=>{var te,re;return[p.value.notificationTitle?(x(),A(e(le),{key:0,title:p.value.notificationTitle,description:p.value.notificationDescription,class:"mb-6",kind:"error"},ue({_:2},[p.value.notificationDetails?{name:"details",fn:s(()=>[k(d(p.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):O("",!0),b.value?(x(),A(e(Ve),{key:1,lines:20})):(x(),P("div",Ia,[_("div",null,[a(e(ke),null,{default:s(()=>[k(d(e(n)("standalone.openvpn_rw.status")),1)]),_:1}),a(e(he),{modelValue:E.value,"onUpdate:modelValue":m[0]||(m[0]=y=>E.value=y),label:E.value?e(n)("common.enabled"):e(n)("common.disabled")},null,8,["modelValue","label"])]),a(e(Y),{modelValue:S.value,"onUpdate:modelValue":m[1]||(m[1]=y=>S.value=y),label:e(n)("standalone.openvpn_rw.server_name"),"invalid-message":e(n)(V.value.getFirstI18nKeyFor("ns_description")),ref_key:"nameRef",ref:v},null,8,["modelValue","label","invalid-message"]),a(e(de),{label:e(n)("standalone.openvpn_rw.user_database"),disabled:((te=o.itemToEdit)==null?void 0:te.ns_description)!=""||!1,options:je.value,"no-options-label":e(n)("ne_combobox.no_options_label"),"no-results-label":e(n)("ne_combobox.no_results"),optionalLabel:e(n)("common.optional"),modelValue:f.value,"onUpdate:modelValue":m[2]||(m[2]=y=>f.value=y),"invalid-message":e(n)(V.value.getFirstI18nKeyFor("ns_user_db")),ref_key:"userDatabaseRef",ref:B},null,8,["label","disabled","options","no-options-label","no-results-label","optionalLabel","modelValue","invalid-message"]),(re=o.itemToEdit)!=null&&re.ns_description?O("",!0):(x(),P("div",Fa,[a(e(ke),null,{default:s(()=>[k(d(e(n)("standalone.openvpn_rw.create_accounts_for_all_users"))+" ",1),a(e(be),null,{content:s(()=>[k(d(e(n)("standalone.openvpn_rw.create_accounts_for_all_users_tooltip")),1)]),_:1})]),_:1}),a(e(he),{modelValue:R.value,"onUpdate:modelValue":m[3]||(m[3]=y=>R.value=y),label:R.value?e(n)("common.enabled"):e(n)("common.disabled")},null,8,["modelValue","label"])])),a(e(de),{label:e(n)("standalone.openvpn_rw.authentication_mode"),options:ze.value,"no-options-label":e(n)("ne_combobox.no_options_label"),"no-results-label":e(n)("ne_combobox.no_results"),optionalLabel:e(n)("common.optional"),modelValue:$.value,"onUpdate:modelValue":m[4]||(m[4]=y=>$.value=y)},null,8,["label","options","no-options-label","no-results-label","optionalLabel","modelValue"]),a(e(Qe),{label:e(n)("standalone.openvpn_rw.mode"),options:mn,modelValue:g.value,"onUpdate:modelValue":m[5]||(m[5]=y=>g.value=y)},null,8,["label","modelValue"]),g.value==="bridged"?(x(),P(X,{key:1},[a(e(de),{label:e(n)("standalone.openvpn_rw.bridge"),options:Se.value,"no-options-label":e(n)("ne_combobox.no_options_label"),"no-results-label":e(n)("ne_combobox.no_results"),optionalLabel:e(n)("common.optional"),modelValue:ce.value,"onUpdate:modelValue":m[6]||(m[6]=y=>ce.value=y),"invalid-message":e(n)(V.value.getFirstI18nKeyFor("ns_bridge")),ref_key:"bridgeRef",ref:pe},null,8,["label","options","no-options-label","no-results-label","optionalLabel","modelValue","invalid-message"]),a(e(Y),{modelValue:ve.value,"onUpdate:modelValue":m[7]||(m[7]=y=>ve.value=y),label:e(n)("standalone.openvpn_rw.range_ip_start"),"invalid-message":e(n)(V.value.getFirstI18nKeyFor("ns_pool_start")),ref_key:"rangeIpStartRef",ref:Ne},null,8,["modelValue","label","invalid-message"]),a(e(Y),{modelValue:_e.value,"onUpdate:modelValue":m[8]||(m[8]=y=>_e.value=y),label:e(n)("standalone.openvpn_rw.range_ip_end"),"invalid-message":e(n)(V.value.getFirstI18nKeyFor("ns_pool_end")),ref_key:"rangeIpEndRef",ref:Me},null,8,["modelValue","label","invalid-message"])],64)):(x(),P(X,{key:2},[a(e(Y),{modelValue:D.value,"onUpdate:modelValue":m[9]||(m[9]=y=>D.value=y),label:e(n)("standalone.openvpn_rw.vpn_network"),"invalid-message":e(n)(V.value.getFirstI18nKeyFor("server")),ref_key:"vpnNetworkRef",ref:F},{tooltip:s(()=>[a(e(be),null,{content:s(()=>[k(d(e(n)("standalone.openvpn_rw.vpn_network_tooltip")),1)]),_:1})]),_:1},8,["modelValue","label","invalid-message"]),a(e(le),{kind:"info",title:e(n)("standalone.openvpn_rw.dynamic_range_ip"),description:e(n)("standalone.openvpn_rw.dynamic_range_ip_message"),closeAriaLabel:e(n)("common.close"),class:"mt-2"},null,8,["title","description","closeAriaLabel"]),a(e(Y),{modelValue:fe.value,"onUpdate:modelValue":m[10]||(m[10]=y=>fe.value=y),label:e(n)("standalone.openvpn_rw.dynamic_range_ip_start"),"invalid-message":e(n)(V.value.getFirstI18nKeyFor("ifconfig_pool_start")),ref_key:"dynamicRangeIpStartRef",ref:Oe},null,8,["modelValue","label","invalid-message"]),a(e(Y),{modelValue:me.value,"onUpdate:modelValue":m[11]||(m[11]=y=>me.value=y),label:e(n)("standalone.openvpn_rw.dynamic_range_ip_end"),"invalid-message":e(n)(V.value.getFirstI18nKeyFor("ifconfig_pool_end")),ref_key:"dynamicRangeIpEndRef",ref:Be},null,8,["modelValue","label","invalid-message"])],64)),a(Fe,{modelValue:T.value,"onUpdate:modelValue":m[12]||(m[12]=y=>T.value=y),"add-item-label":e(n)("standalone.openvpn_rw.add_public_ip_host"),title:e(n)("standalone.openvpn_rw.public_ip_hostname_unit"),"invalid-messages":c.value,"general-invalid-message":e(n)(V.value.getFirstI18nKeyFor("ns_public_ip"))},null,8,["modelValue","add-item-label","title","invalid-messages","general-invalid-message"]),_("div",null,[a(e(H),{kind:"tertiary",onClick:m[13]||(m[13]=y=>I.value=!I.value)},{suffix:s(()=>[a(W,{icon:["fas",I.value?"chevron-up":"chevron-down"],class:"h-4 w-4","aria-hidden":"true"},null,8,["icon"])]),default:s(()=>[k(d(e(n)("common.advanced_settings"))+" ",1)]),_:1})]),I.value?(x(),P(X,{key:3},[a(e(Qe),{label:e(n)("standalone.openvpn_rw.protocol"),options:bn,modelValue:C.value,"onUpdate:modelValue":m[14]||(m[14]=y=>C.value=y)},null,8,["label","modelValue"]),a(e(Y),{modelValue:U.value,"onUpdate:modelValue":m[15]||(m[15]=y=>U.value=y),label:e(n)("standalone.openvpn_rw.port"),"invalid-message":e(n)(V.value.getFirstFor("port")),ref_key:"portRef",ref:j},null,8,["modelValue","label","invalid-message"]),_("div",null,[a(e(ke),null,{default:s(()=>[k(d(e(n)("standalone.openvpn_rw.route_all_client_traffic_through_vpn")),1)]),_:1}),a(e(he),{modelValue:ae.value,"onUpdate:modelValue":m[16]||(m[16]=y=>ae.value=y),label:ae.value?e(n)("common.enabled"):e(n)("common.disabled")},null,8,["modelValue","label"])]),a(Fe,{modelValue:ie.value,"onUpdate:modelValue":m[17]||(m[17]=y=>ie.value=y),"add-item-label":e(n)("standalone.openvpn_rw.add_network"),title:e(n)("standalone.openvpn_rw.push_custom_network_routes"),"invalid-messages":h.value},null,8,["modelValue","add-item-label","title","invalid-messages"]),_("div",null,[a(e(ke),null,{default:s(()=>[k(d(e(n)("standalone.openvpn_rw.allow_client_to_client_network_traffic")),1)]),_:1}),a(e(he),{modelValue:G.value,"onUpdate:modelValue":m[18]||(m[18]=y=>G.value=y),label:G.value?e(n)("common.enabled"):e(n)("common.disabled")},null,8,["modelValue","label"])]),a(e(de),{label:e(n)("standalone.openvpn_rw.compression"),options:fn,"no-options-label":e(n)("ne_combobox.no_options_label"),"no-results-label":e(n)("ne_combobox.no_results"),optionalLabel:e(n)("common.optional"),modelValue:se.value,"onUpdate:modelValue":m[19]||(m[19]=y=>se.value=y)},null,8,["label","no-options-label","no-results-label","optionalLabel","modelValue"]),a(e(de),{label:e(n)("standalone.openvpn_rw.digest"),options:Ke.value,"no-options-label":e(n)("ne_combobox.no_options_label"),"no-results-label":e(n)("ne_combobox.no_results"),optionalLabel:e(n)("common.optional"),modelValue:L.value,"onUpdate:modelValue":m[20]||(m[20]=y=>L.value=y)},null,8,["label","options","no-options-label","no-results-label","optionalLabel","modelValue"]),a(e(de),{label:e(n)("standalone.openvpn_rw.cipher"),options:Pe.value,"no-options-label":e(n)("ne_combobox.no_options_label"),"no-results-label":e(n)("ne_combobox.no_results"),optionalLabel:e(n)("common.optional"),modelValue:u.value,"onUpdate:modelValue":m[21]||(m[21]=y=>u.value=y)},null,8,["label","options","no-options-label","no-results-label","optionalLabel","modelValue"]),a(e(de),{label:e(n)("standalone.openvpn_rw.enforce_minimum_tls_version"),"no-options-label":e(n)("ne_combobox.no_options_label"),"no-results-label":e(n)("ne_combobox.no_results"),options:wn,optionalLabel:e(n)("common.optional"),modelValue:N.value,"onUpdate:modelValue":m[22]||(m[22]=y=>N.value=y)},null,8,["label","no-options-label","no-results-label","optionalLabel","modelValue"]),a(Fe,{modelValue:Ce.value,"onUpdate:modelValue":m[23]||(m[23]=y=>Ce.value=y),title:e(n)("standalone.openvpn_rw.custom_dhcp_options"),"use-key-input":!0,"key-input-type":"combobox","add-item-label":e(n)("standalone.openvpn_rw.add_option"),optional:!0,"optional-label":e(n)("common.optional"),"key-options":qe.value,"key-input-placeholder":e(n)("standalone.openvpn_rw.custom_option_combobox_placeholder")},{tooltip:s(()=>[a(e(be),null,{content:s(()=>[k(d(e(n)("standalone.openvpn_rw.custom_dhcp_options_tooltip")),1)]),_:1})]),_:1},8,["modelValue","title","add-item-label","optional-label","key-options","key-input-placeholder"])],64)):O("",!0),m[27]||(m[27]=_("hr",null,null,-1)),_("div",Aa,[a(e(H),{kind:"tertiary",class:"mr-4",onClick:m[24]||(m[24]=y=>Ie())},{default:s(()=>[k(d(e(n)("common.cancel")),1)]),_:1}),a(e(H),{kind:"primary",onClick:m[25]||(m[25]=y=>xn()),disabled:w.value,loading:w.value},{default:s(()=>{var y;return[k(d((y=o.itemToEdit)!=null&&y.ns_description?e(n)("common.save"):e(n)("standalone.openvpn_rw.create")),1)]}),_:1},8,["disabled","loading"])])]))]}),_:1},8,["is-shown","closeAriaLabel","title"])}}}),Ra={class:oe(["flex","flex-row","items-center"])},Ua=ee({__name:"UserConnectionsTable",props:{connectionsRecords:{}},setup(z){const{t:r}=ne(),i=z,n=l(10),t=l("startTime"),b=l(!0);function w(S,v){const f=S.split(".").map(Number),B=v.split(".").map(Number);for(let R=0;R<4;R++)if(f[R]!==B[R])return f[R]-B[R];return 0}const p={endTime:(S,v)=>(S.endTime??0)-(v.endTime??0),duration:(S,v)=>(S.duration??0)-(v.duration??0),virtualIpAddress:(S,v)=>w(S.virtualIpAddress,v.virtualIpAddress),remoteIpAddress:(S,v)=>w(S.remoteIpAddress,v.remoteIpAddress)},{sortedItems:V}=Tn(we(()=>i.connectionsRecords),t,b,p),c=S=>{t.value=S.key,b.value=S.descending},{currentPage:h,paginatedItems:I}=nn(()=>V.value,{itemsPerPage:n});function E(S){const v=Math.floor(S/3600),f=Math.floor(S%3600/60),B=S%60,R=$=>String($).padStart(2,"0");return`${R(v)}h ${R(f)}m ${R(B)}s`}return(S,v)=>(x(),P(X,null,[a(e(Sn),{sortKey:t.value,"onUpdate:sortKey":v[0]||(v[0]=f=>t.value=f),sortDescending:b.value,"onUpdate:sortDescending":v[1]||(v[1]=f=>b.value=f),label:e(r)("sort.sort"),options:[{id:"account",label:e(r)("standalone.openvpn_rw.history.account")},{id:"startTime",label:e(r)("standalone.openvpn_rw.history.start_time")},{id:"endTime",label:e(r)("standalone.openvpn_rw.history.end_time")},{id:"duration",label:e(r)("standalone.openvpn_rw.history.duration")},{id:"virtualIpAddress",label:e(r)("standalone.openvpn_rw.history.virtual_ip_address")},{id:"remoteIpAddress",label:e(r)("standalone.openvpn_rw.history.remote_ip_address")},{id:"bytesReceived",label:e(r)("standalone.openvpn_rw.history.bytes_received")},{id:"bytesSent",label:e(r)("standalone.openvpn_rw.history.bytes_sent")}],openMenuAriaLabel:e(r)("ne_dropdown.open_menu"),sortByLabel:e(r)("sort.sort_by"),sortDirectionLabel:e(r)("sort.direction"),ascendingLabel:e(r)("sort.ascending"),descendingLabel:e(r)("sort.descending"),class:"xl:hidden"},null,8,["sortKey","sortDescending","label","options","openMenuAriaLabel","sortByLabel","sortDirectionLabel","ascendingLabel","descendingLabel"]),a(e(sn),{sortKey:t.value,sortDescending:b.value,ariaLabel:e(r)("standalone.openvpn_rw.history.connections_table"),cardBreakpoint:"xl",skeletonColumns:5,skeletonRows:5},{paginator:s(()=>[a(e(an),{"current-page":e(h),"total-rows":i.connectionsRecords.length,"page-size":n.value,"nav-pagination-label":e(r)("ne_table.pagination"),"next-label":e(r)("ne_table.go_to_next_page"),"previous-label":e(r)("ne_table.go_to_previous_page"),"range-of-total-label":e(r)("ne_table.of"),"page-size-label":e(r)("ne_table.show"),onSelectPage:v[2]||(v[2]=f=>{h.value=f}),onSelectPageSize:v[3]||(v[3]=f=>{n.value=f})},null,8,["current-page","total-rows","page-size","nav-pagination-label","next-label","previous-label","range-of-total-label","page-size-label"])]),default:s(()=>[a(e(tn),null,{default:s(()=>[a(e(Z),{sortable:"",columnKey:"account",onSort:c},{default:s(()=>[k(d(e(r)("standalone.openvpn_rw.history.account")),1)]),_:1}),a(e(Z),{sortable:"",columnKey:"startTime",onSort:c},{default:s(()=>[k(d(e(r)("standalone.openvpn_rw.history.start_time")),1)]),_:1}),a(e(Z),{sortable:"",columnKey:"endTime",onSort:c},{default:s(()=>[k(d(e(r)("standalone.openvpn_rw.history.end_time")),1)]),_:1}),a(e(Z),{sortable:"",columnKey:"duration",onSort:c},{default:s(()=>[k(d(e(r)("standalone.openvpn_rw.history.duration")),1)]),_:1}),a(e(Z),{sortable:"",columnKey:"virtualIpAddress",onSort:c},{default:s(()=>[k(d(e(r)("standalone.openvpn_rw.history.virtual_ip_address")),1)]),_:1}),a(e(Z),{sortable:"",columnKey:"remoteIpAddress",onSort:c},{default:s(()=>[k(d(e(r)("standalone.openvpn_rw.history.remote_ip_address")),1)]),_:1}),a(e(Z),null,{default:s(()=>[k(d(e(r)("standalone.openvpn_rw.history.received_sent")),1)]),_:1})]),_:1}),a(e(ln),null,{default:s(()=>[(x(!0),P(X,null,on(e(I),f=>(x(),A(e(rn),{key:f.startTime},{default:s(()=>[a(e(J),{"data-label":e(r)("standalone.openvpn_rw.history.account")},{default:s(()=>[k(d(f.account),1)]),_:2},1032,["data-label"]),a(e(J),{"data-label":e(r)("standalone.openvpn_rw.history.start_time")},{default:s(()=>[k(d(f!=null&&f.startTime?e(Ge)(new Date(Number(f.startTime)*1e3),"PPpp"):"-"),1)]),_:2},1032,["data-label"]),a(e(J),{"data-label":e(r)("standalone.openvpn_rw.history.end_time")},{default:s(()=>[k(d(f!=null&&f.endTime?e(Ge)(new Date(Number(f.endTime)*1e3),"PPpp"):"-"),1)]),_:2},1032,["data-label"]),a(e(J),{"data-label":e(r)("standalone.openvpn_rw.history.duration")},{default:s(()=>[k(d(f!=null&&f.duration?E(f.duration):"-"),1)]),_:2},1032,["data-label"]),a(e(J),{"data-label":e(r)("standalone.openvpn_rw.history.virtual_ip_address")},{default:s(()=>[k(d(f!=null&&f.virtualIpAddress?f.virtualIpAddress:"-"),1)]),_:2},1032,["data-label"]),a(e(J),{"data-label":e(r)("standalone.openvpn_rw.history.remote_ip_address")},{default:s(()=>[k(d(f!=null&&f.remoteIpAddress?f.remoteIpAddress:"-"),1)]),_:2},1032,["data-label"]),a(e(J),{"data-label":e(r)("standalone.openvpn_rw.history.received_sent")},{default:s(()=>[_("div",Ra,[a(e(ge),{icon:["fas","arrow-down"],class:"mr-2 h-4 w-4","aria-hidden":"true"}),k(" "+d(f!=null&&f.bytesReceived?e(Xe)(f.bytesReceived):"-")+" / "+d(f!=null&&f.bytesSent?e(Xe)(f.bytesSent):"-")+" ",1),a(e(ge),{icon:["fas","arrow-up"],class:"ml-2 h-4 w-4","aria-hidden":"true"})])]),_:2},1032,["data-label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["sortKey","sortDescending","ariaLabel"])],64))}}),Na={class:"flex flex-col gap-y-6"},Ma={class:"mb-4 flex flex-row justify-between"},Oa={class:"max-w-2xl text-sm font-normal text-gray-500 dark:text-gray-400"},Ba={class:"shrink-0"},Ka={key:0,class:"flex items-center gap-4"},Pa=ee({__name:"ConnectionsHistory",props:{instance:{}},setup(z){const{t:r}=ne(),i=l(!1),n=l([]),t=l({notificationDescription:"",notificationDetails:"",notificationTitle:""}),b=l(""),w=z,p=l(["today"]),V=l([{id:"today",label:r("standalone.openvpn_rw.history.today")},{id:"last_week",label:r("standalone.openvpn_rw.history.last_week")},{id:"last_month",label:r("standalone.openvpn_rw.history.last_month")},{id:"last_3_months",label:r("standalone.openvpn_rw.history.last_3_months")},{id:"all",label:r("standalone.openvpn_rw.history.all")}]),c=l([]),h=we(()=>{const $=E(n.value,"",p.value[0],[]);return Array.from(new Set($.map(g=>g.account))).sort((g,D)=>g.localeCompare(D))}),I=we(()=>h.value.map($=>({id:$,label:$})));function E($,g,D,F){const T=g.toLowerCase(),C=new Date;let U=null;return D==="today"?U=new Date(C.getFullYear(),C.getMonth(),C.getDate()):D==="last_week"?(U=new Date(C),U.setDate(C.getDate()-7)):D==="last_month"?U=new Date(C.getFullYear(),C.getMonth()-1,1):D==="last_3_months"?(U=new Date(C),U.setMonth(C.getMonth()-3),U.setDate(1)):D==="all"&&(U=null),$.filter(j=>{const ae=j.startTime?new Date(j.startTime*1e3):new Date(0),ie=j.account.toLowerCase().includes(T)||j.remoteIpAddress.toLowerCase().includes(T)||j.virtualIpAddress.toLowerCase().includes(T),G=U?ae>=U:!0,se=F.length===0||F.includes(j.account);return ie&&G&&se})}const S=we(()=>["all","today","last_week","last_month","last_3_months"].includes(p.value[0])?E(n.value,b.value,p.value[0],c.value):n.value);function v(){t.value={notificationTitle:"",notificationDescription:"",notificationDetails:""}}function f(){b.value="",p.value=["today"],c.value=[]}async function B(){var $;v();try{let g=await K("ns.ovpnrw","connection-history-csv",{instance:w.instance,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"});if(($=g==null?void 0:g.data)!=null&&$.csv_path){g.data.csv_path=g.data.csv_path.replace("/var/run/ns-api-server/downloads/","");const D=await vn(g.data.csv_path),F=URL.createObjectURL(D);let T=document.createElement("a");T.href=F,T.download=g.data.csv_path.replace(".csv","")+"-"+Date.now().toString()+".csv",T.click(),await _n(g.data.csv_path)}}catch(g){t.value.notificationTitle=r("standalone.openvpn_rw.history.cannot_download_history"),t.value.notificationDescription=r(q(g)),t.value.notificationDetails=g.toString()}}async function R(){t.value.notificationDescription="",t.value.notificationDetails="";try{i.value=!0,n.value=(await K("ns.ovpnrw","connection-history",{instance:w.instance,time_interval:"all"})).data}catch($){t.value.notificationTitle=r("standalone.openvpn_rw.history.cannot_fetch_history"),t.value.notificationDescription=r(q($)),t.value.notificationDetails=$.toString()}finally{i.value=!1}}return pn(()=>{R()}),Te(p,()=>{c.value=[]}),($,g)=>(x(),P("div",Na,[_("div",Ma,[_("p",Oa,d(e(r)("standalone.openvpn_rw.history.connection_history_description")),1),_("div",Ba,[n.value.length>0?(x(),A(e(H),{key:0,kind:"secondary",size:"lg",onClick:g[0]||(g[0]=D=>B()),class:"ml-4 shrink-0"},{prefix:s(()=>[a(e(ge),{icon:["fas","fa-circle-arrow-down"],class:"h-4 w-4","aria-hidden":"true"})]),default:s(()=>[k(" "+d(e(r)("standalone.openvpn_rw.history.download_history")),1)]),_:1})):O("",!0)])]),n.value.length>0?(x(),P("div",Ka,[a(e(Y),{class:"max-w-xs",isSearch:!0,placeholder:e(r)("common.filter"),modelValue:b.value,"onUpdate:modelValue":g[1]||(g[1]=D=>b.value=D)},null,8,["placeholder","modelValue"]),a(e(Le),{modelValue:p.value,"onUpdate:modelValue":g[2]||(g[2]=D=>p.value=D),kind:"radio",label:e(r)("standalone.openvpn_rw.history.time_range"),options:V.value,clearFilterLabel:e(r)("ne_dropdown_filter.clear_selection"),openMenuAriaLabel:e(r)("ne_dropdown_filter.open_filter")},null,8,["modelValue","label","options","clearFilterLabel","openMenuAriaLabel"]),a(e(Le),{modelValue:c.value,"onUpdate:modelValue":g[3]||(g[3]=D=>c.value=D),kind:"checkbox",label:e(r)("standalone.openvpn_rw.history.accounts"),options:I.value,clearFilterLabel:e(r)("ne_dropdown_filter.clear_selection"),openMenuAriaLabel:e(r)("ne_dropdown_filter.open_filter"),showOptionsFilter:!0,noOptionsLabel:e(r)("ne_dropdown_filter.no_options"),optionsFilterPlaceholder:e(r)("standalone.openvpn_rw.history.filter_accounts"),moreOptionsHiddenLabel:e(r)("ne_dropdown_filter.more_options_hidden")},null,8,["modelValue","label","options","clearFilterLabel","openMenuAriaLabel","noOptionsLabel","optionsFilterPlaceholder","moreOptionsHiddenLabel"]),a(e(H),{kind:"tertiary",onClick:f,disabled:i.value},{default:s(()=>[k(d(e(r)("standalone.openvpn_rw.history.reset_filters")),1)]),_:1},8,["disabled"])])):O("",!0),t.value.notificationDescription?(x(),A(e(le),{key:1,kind:"error",title:t.value.notificationTitle,description:t.value.notificationDescription},ue({_:2},[t.value.notificationDetails?{name:"details",fn:s(()=>[k(d(t.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):O("",!0),i.value?(x(),A(e(Ve),{key:2,lines:10,size:"lg"})):(x(),P(X,{key:3},[n.value.length==0?(x(),A(e(De),{key:0,title:e(r)("standalone.openvpn_rw.history.no_connections_found"),icon:["fas","clock-rotate-left"]},null,8,["title"])):S.value.length==0?(x(),A(e(De),{key:1,title:e(r)("standalone.openvpn_rw.history.no_connections_found"),description:e(r)("standalone.openvpn_rw.history.filter_change_suggestion"),icon:["fas","clock-rotate-left"]},null,8,["title","description"])):O("",!0),S.value.length>0?(x(),A(Ua,{key:2,connectionsRecords:S.value},null,8,["connectionsRecords"])):O("",!0)],64))]))}}),za={class:"flex flex-col justify-between md:flex-row md:items-center"},ja={key:0,class:"mb-6 text-sm text-gray-500 dark:text-gray-400"},qa={key:2,class:"flex flex-col"},Ha={class:"flex flex-col gap-y-6"},Wa={key:0,class:"flex flex-col gap-y-6"},Qa={key:1,class:"flex flex-col gap-y-6"},Ya={class:"max-w-2xl text-sm font-normal text-gray-500 dark:text-gray-400"},en=1e4,at=ee({__name:"OpenvpnRoadWarriorView",setup(z){const{t:r}=ne(),i=In(),n=l(!0),t=l(!0),b=l(""),w=l(),p=l([]),V=l({notificationTitle:"",notificationDescription:"",notificationDetails:""}),c=l(!1),h=l(!1),I=l(!1),E=l(!1),S=l(0),v=we(()=>p.value.filter(T=>T.connected).length),{tabs:f,selectedTab:B}=En([{name:"road-warrior-server",label:r("standalone.openvpn_rw.tabs.road_warrior_server")},{name:"connection-history",label:r("standalone.openvpn_rw.tabs.connections_history")}]);async function R(T=!0){try{T&&(t.value=!0),p.value=(await K("ns.ovpnrw","list-users",{instance:b.value})).data.users}catch(C){V.value.notificationTitle=r("error.cannot_retrieve_users"),V.value.notificationDescription=r(q(C)),V.value.notificationDetails=C.toString(),E.value=!0}finally{T&&(t.value=!1)}}async function $(T=!0){var C;try{T&&(n.value=!0);const U=(await K("ns.ovpnrw","list-instances")).data.instances;U.length>0&&(b.value=U[0],w.value=(await K("ns.ovpnrw","get-configuration",{instance:b.value})).data,(C=w.value)!=null&&C.ns_description&&await R(T))}catch(U){V.value.notificationTitle=r("error.cannot_retrieve_rw_server"),V.value.notificationDescription=r(q(U)),V.value.notificationDetails=U.toString(),E.value=!0}finally{T&&(n.value=!1)}}async function g(){await i.getChanges(),b.value="",w.value=void 0,await $()}async function D(){await i.getChanges(),await R()}async function F(){if(!b.value){c.value=!0;try{await K("ns.ovpnrw","add-instance"),await g()}catch(T){V.value.notificationTitle=r("error.cannot_initialize_server"),V.value.notificationDescription=r(q(T)),V.value.notificationDetails=T.toString();return}finally{c.value=!1}}I.value=!0}return pn(()=>{$(),S.value=setInterval(()=>$(!1),en)}),Fn(()=>{S.value&&clearInterval(S.value)}),(T,C)=>{const U=xe("font-awesome-icon");return x(),P(X,null,[_("div",za,[a(e(Ee),{tag:"h3",class:"mb-7"},{default:s(()=>[k(d(e(r)("standalone.openvpn_rw.title")),1)]),_:1}),e(B)=="road-warrior-server"?(x(),P("div",ja,d(e(r)("common.data_updated_every_seconds",{seconds:en/1e3})),1)):O("",!0)]),V.value.notificationDescription?(x(),A(e(le),{key:0,title:e(r)("error.cannot_retrieve_databases"),description:V.value.notificationDescription,class:"mb-6",kind:"error"},ue({_:2},[V.value.notificationDetails?{name:"details",fn:s(()=>[k(d(V.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):O("",!0),n.value?(x(),A(e(Ve),{key:1,size:"lg",lines:10})):E.value?O("",!0):(x(),P("div",qa,[_("div",Ha,[w.value&&w.value.ns_description?(x(),A(e(An),{key:0,selected:e(B),srSelectTabLabel:e(r)("ne_tabs.select_a_tab"),srTabsLabel:e(r)("ne_tabs.tabs"),tabs:e(f),class:"mb-8",onSelectTab:C[0]||(C[0]=j=>B.value=j)},null,8,["selected","srSelectTabLabel","srTabsLabel","tabs"])):O("",!0)]),e(B)=="connection-history"?(x(),P("div",Wa,[a(Pa,{instance:b.value},null,8,["instance"])])):O("",!0),e(B)=="road-warrior-server"?(x(),P("div",Qa,[a(e(Ee),{tag:"h5",class:"mb-2"},{default:s(()=>[k(d(e(r)("standalone.openvpn_rw.roadwarrior_server")),1)]),_:1}),_("p",Ya,d(e(r)("standalone.openvpn_rw.roadwarrior_server_description")),1),!w.value||!w.value.ns_description?(x(),A(e(De),{key:0,title:e(r)("standalone.openvpn_rw.no_openvpn_rw_server_found"),icon:["fas","globe"]},{default:s(()=>[a(e(H),{kind:"primary",onClick:C[1]||(C[1]=j=>F()),loading:c.value,disabled:c.value},{prefix:s(()=>[a(U,{icon:["fas","wrench"],class:"h-4 w-4","aria-hidden":"true"})]),default:s(()=>[k(d(e(r)("standalone.openvpn_rw.create_server")),1)]),_:1},8,["loading","disabled"])]),_:1},8,["title"])):(x(),A(Ta,{key:1,"connected-clients":v.value,server:w.value,onDeleteServer:C[2]||(C[2]=j=>h.value=!0),onEditServer:C[3]||(C[3]=j=>I.value=!0)},null,8,["connected-clients","server"])),w.value&&w.value.ns_description?(x(),A(_a,{key:2,users:p.value,server:w.value,"instance-name":b.value,"is-loading":t.value,onUpdateUsers:D},null,8,["users","server","instance-name","is-loading"])):O("",!0)])):O("",!0),a(Sa,{visible:h.value,"instance-name":b.value,onClose:C[4]||(C[4]=j=>h.value=!1),onServerDeleted:g},null,8,["visible","instance-name"]),a(Ea,{"item-to-edit":w.value,"instance-name":b.value,"is-shown":I.value,onClose:C[5]||(C[5]=j=>I.value=!1),onAddEditServer:g},null,8,["item-to-edit","instance-name","is-shown"])]))],64)}}});export{at as default};
