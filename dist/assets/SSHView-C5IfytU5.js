import{d as B,u as z,U as W,r as i,aa as K,o as T,X as Y,V as U,h as v,q as g,l as e,ab as M,i as V,L as R,n as j,y as D,w as p,j as r,k as c,Q as G,a7 as $,F as A,m as C,t as m,R as L,_ as E,z as w,e as N,ac as q,Y as H,ad as Q,ae as X,af as J,ag as Z,T as ee,W as se}from"./index-BlEQ5104.js";import{_ as O}from"./FormLayout.vue_vue_type_script_setup_true_lang-DaMAl8E3.js";const ae={class:"mb-8 flex flex-col gap-y-4"},le={class:"flex justify-end"},te=B({__name:"SshConfig",setup(F){const{t:n}=z(),l=W(),d=i("22"),k=i(!1),h=i(!1),f=i(!1),y=i(!0),b=i(!1),u=i(new K),t=i(void 0);T(()=>{S()});function x(){t.value=void 0,P(),u.value.size>0?t.value=new M:(b.value=!0,N("uci","set",{config:"dropbear",section:"@dropbear[0]",values:{Port:d.value,PasswordAuth:k.value?"on":"off",RootPasswordAuth:h.value?"on":"off",GatewayPorts:f.value?"on":"off"}}).then(()=>{l.getChanges()}).catch(a=>{t.value=new Error(U(a))}).finally(()=>{b.value=!1}))}function P(){u.value=new K,Number.isNaN(Number(d.value))&&u.value.set("port",[n("standalone.ssh.ssh_access.tcp_port_invalid")]),Number(d.value)<1&&u.value.set("port",[n("standalone.ssh.ssh_access.tcp_port_too_low")]),Number(d.value)>65535&&u.value.set("port",[n("standalone.ssh.ssh_access.tcp_port_too_high")])}function S(){t.value=void 0,y.value=!0,Y("dropbear").then(a=>{d.value=a.dropbear[0].Port,k.value=a.dropbear[0].PasswordAuth=="on",h.value=a.dropbear[0].RootPasswordAuth=="on",f.value=a.dropbear[0].GatewayPorts=="on"}).catch(a=>{t.value=new Error(U(a))}).finally(()=>{y.value=!1})}return(a,s)=>(v(),g(w,null,[t.value!=null&&!(t.value instanceof e(M))?(v(),V(e(R),{key:0,title:e(n)(t.value.message),kind:"error"},null,8,["title"])):j("",!0),y.value?(v(),V(e(D),{key:1,lines:10})):(v(),V(O,{key:2,description:e(n)("standalone.ssh.ssh_access.description"),title:e(n)("standalone.ssh.ssh_access.title")},{default:p(()=>{var o;return[r("form",null,[r("div",ae,[c(e(G),{modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=_=>d.value=_),modelModifiers:{number:!0},"invalid-message":(o=u.value.get("port"))==null?void 0:o[0],label:e(n)("standalone.ssh.ssh_access.tcp_port_label"),max:"65535",min:"1",type:"number"},null,8,["modelValue","invalid-message","label"]),s[5]||(s[5]=r("h3",{class:"font-medium"},"Options",-1)),c(e($),{modelValue:k.value,"onUpdate:modelValue":s[1]||(s[1]=_=>k.value=_),label:e(n)("standalone.ssh.ssh_access.allow_ssh_password_auth")},null,8,["modelValue","label"]),c(e($),{modelValue:h.value,"onUpdate:modelValue":s[2]||(s[2]=_=>h.value=_),label:e(n)("standalone.ssh.ssh_access.allow_root_login_with_password")},null,8,["modelValue","label"]),c(e($),{modelValue:f.value,"onUpdate:modelValue":s[3]||(s[3]=_=>f.value=_),label:e(n)("standalone.ssh.ssh_access.allow_remote_host_connection")},null,8,["modelValue","label"])])]),r("div",le,[c(e(E),{disabled:b.value,loading:b.value,kind:"primary",size:"lg",onClick:s[4]||(s[4]=L(_=>x(),["prevent"]))},{prefix:p(()=>[c(e(A),{icon:["fas","floppy-disk"],"aria-hidden":"true"})]),default:p(()=>[C(" "+m(e(n)("common.save")),1)]),_:1},8,["disabled","loading"])])]}),_:1},8,["description","title"]))],64))}}),oe={class:"my-1 break-all"},ne={class:"space-y-4"},ie={class:"space-y-2"},de={class:"min-w-0 flex-grow rounded border border-gray-200 p-3 text-xs dark:border-gray-700"},ue={class:"mb-1 font-bold"},re={class:"mb-1"},ce={class:"truncate"},ve=B({__name:"SshKeys",setup(F){const n=q(),{t:l}=z(),d=i(""),k=i([]),h=i(!0),f=i(!1),y=i(!1),b=i(new K),u=i(),t=i();T(()=>{x()});function x(){u.value=void 0,h.value=!0,N("ns.ssh","list-keys").then(a=>{k.value=a.data.keys}).catch(a=>{u.value=a}).finally(()=>{h.value=!1})}function P(){f.value=!0,b.value.clear(),u.value=void 0,N("ns.ssh","add-key",{key:d.value}).then(()=>{d.value="",x(),n.addNotification({kind:"success",id:"added-ssh-key",title:l("standalone.ssh.ssh_keys.key_added_notification")})}).catch(a=>{a instanceof Z?(b.value=a.errorBag,ee("uploadSshKeyInput")):u.value=a}).finally(()=>{f.value=!1})}function S(){var a;y.value=!0,u.value=void 0,N("ns.ssh","delete-key",{key:(a=t.value)==null?void 0:a.key}).then(()=>{t.value=void 0,x(),n.addNotification({kind:"success",id:"deleted-ssh-key",title:l("standalone.ssh.ssh_keys.key_deleted_notification")})}).catch(s=>{u.value=s}).finally(()=>{y.value=!1})}return(a,s)=>(v(),g(w,null,[c(e(H),{"primary-button-kind":"danger","primary-label":e(l)("standalone.ssh.ssh_keys.delete_key_modal.button"),title:e(l)("standalone.ssh.ssh_keys.delete_key_modal.title"),visible:t.value!=null,onClose:s[0]||(s[0]=o=>t.value=void 0),onPrimaryClick:s[1]||(s[1]=o=>S()),"primary-button-loading":y.value,"primary-button-disabled":y.value,"close-aria-label":e(l)("common.close")},{default:p(()=>{var o,_,I;return[r("div",null,m(e(l)("standalone.ssh.ssh_keys.delete_key_modal.body")),1),r("code",oe,m((o=t.value)==null?void 0:o.type)+" "+m((_=t.value)==null?void 0:_.key)+" "+m((I=t.value)==null?void 0:I.comment),1)]}),_:1},8,["primary-label","title","visible","primary-button-loading","primary-button-disabled","close-aria-label"]),u.value!=null?(v(),V(e(R),{key:0,description:e(l)(e(U)(u.value)),kind:"error",title:e(l)("error.generic_error")},null,8,["description","title"])):j("",!0),h.value?(v(),V(e(D),{key:1,lines:10})):(v(),V(O,{key:2,description:e(l)("standalone.ssh.ssh_keys.description"),title:e(l)("standalone.ssh.ssh_keys.title")},{default:p(()=>[r("div",ne,[r("ul",ie,[(v(!0),g(w,null,Q(k.value,o=>(v(),g("li",{key:o.key,class:"flex items-center gap-2"},[r("div",de,[r("p",ue,[o.comment!=""?(v(),g(w,{key:0},[C(m(o.comment),1)],64)):(v(),g(w,{key:1},[C(m(e(l)("standalone.ssh.ssh_keys.unnamed_key")),1)],64))]),r("p",re,m(o.type),1),r("code",ce,m(o.key),1)]),c(e(E),{kind:"tertiary",size:"lg",onClick:_=>t.value=o},{default:p(()=>[c(e(A),{icon:e(J),class:"h-4 w-4"},null,8,["icon"])]),_:2},1032,["onClick"])]))),128))]),r("form",{class:"flex flex-col gap-y-4",onSubmit:s[3]||(s[3]=L(o=>P(),["prevent"]))},[c(e(G),{ref:"uploadSshKeyInput",modelValue:d.value,"onUpdate:modelValue":s[2]||(s[2]=o=>d.value=o),disabled:f.value,"invalid-message":e(l)(b.value.getFirstI18nKeyFor("key")),label:e(l)("standalone.ssh.ssh_keys.add_new_ssh_key.label"),placeholder:e(l)("standalone.ssh.ssh_keys.add_new_ssh_key.placeholder")},null,8,["modelValue","disabled","invalid-message","label","placeholder"]),c(e(E),{disabled:f.value,loading:f.value,class:"self-start",size:"lg",type:"submit"},{prefix:p(()=>[c(e(A),{icon:e(X),"aria-hidden":"true"},null,8,["icon"])]),default:p(()=>[C(" "+m(e(l)("standalone.ssh.ssh_keys.add_key_button")),1)]),_:1},8,["disabled","loading"])],32)])]),_:1},8,["description","title"]))],64))}}),_e={class:"flex max-w-3xl flex-col gap-y-8"},pe=B({__name:"SSHView",setup(F){const{t:n}=z();return(l,d)=>(v(),g(w,null,[c(e(se),{tag:"h3",class:"mb-7"},{default:p(()=>[C(m(e(n)("standalone.ssh.title")),1)]),_:1}),r("div",_e,[c(te),d[0]||(d[0]=r("hr",null,null,-1)),c(ve)])],64))}});export{pe as default};
