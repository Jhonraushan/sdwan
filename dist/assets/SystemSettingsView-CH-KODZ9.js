import{d as H,u as P,U as Y,r as m,c as ee,J as A,o as te,e as z,V as T,X as ae,g as se,h as g,q as L,l as e,i as D,L as F,n as x,y as ne,j as C,k as u,Z as V,Q as K,$ as re,a0 as le,w as k,m as U,t as I,a1 as de,a2 as ue,_ as G,S as ie,T as Q,a3 as ce,a4 as me,a5 as X,a6 as q,a7 as ve,a8 as fe,W as pe,a9 as _e}from"./index-BlEQ5104.js";import{_ as Z}from"./FormLayout.vue_vue_type_script_setup_true_lang-DaMAl8E3.js";import{_ as be}from"./NeMultiTextInput.vue_vue_type_script_setup_true_lang-DwfeP71-.js";import{u as ye}from"./uniq-DGkY_-95.js";import{u as ge}from"./useTabs-BeLQ169O.js";import"./isArrayLikeObject-CpCvCe5A.js";const he={class:"max-w-xl"},ke={key:2},Ce={class:"border-b border-gray-200 pb-6 dark:border-gray-700"},Se={class:"space-y-6"},Ve={class:"text-sm"},we={class:"-ml-2.5"},ze={class:"flex justify-end py-6"},Te=H({__name:"GeneralSettings",setup(J){const{t}=P(),O=Y();let l=m(""),h=m(),p=m(""),_=m(""),N=m(null),o=m(""),S=m(),i=m([]),c=m({}),M=m(""),s=m({systemConfig:!0,systemInfo:!0,timezones:!0,syncWithBrowser:!1,syncWithNtpServer:!1,save:!1}),r=m({hostname:"",timezone:"",notificationTitle:"",notificationDescription:""});const $=ee(()=>s.value.systemConfig||s.value.systemInfo||s.value.timezones);A(()=>s.value.systemConfig,()=>{!s.value.systemConfig&&!s.value.timezones&&(o.value=c.value.system[0].zonename)}),A(()=>s.value.timezones,()=>{!s.value.systemConfig&&!s.value.timezones&&(o.value=c.value.system[0].zonename)}),te(()=>{R()});async function R(){j(),W(),B()}async function W(){s.value.systemInfo=!0;try{const n=await z("system","info");N.value=new Date(n.data.localtime*1e3),s.value.systemInfo=!0}catch(n){console.error(n),r.value.notificationTitle=t("error.cannot_load_system_info"),r.value.notificationDescription=t(T(n))}s.value.systemInfo=!1}async function j(){s.value.systemConfig=!0;try{const n=await ae("system");c.value=n,l.value=n.system[0].hostname,M.value=l.value,p.value=n.system[0].description,_.value=n.system[0].notes}catch(n){console.error(n),r.value.notificationTitle=t("error.cannot_load_system_config"),r.value.notificationDescription=t(T(n))}s.value.systemConfig=!1}async function B(){s.value.timezones=!0;try{const n=await z("luci","getTimezones"),v=[{id:"UTC",label:"UTC",timezone:""}];for(const[w,y]of Object.entries(n.data))v.push({id:w,label:w,timezone:y.tzstring});i.value=v}catch(n){console.error(n),r.value.notificationTitle=t("error.cannot_load_timezones"),r.value.notificationDescription=t(T(n))}s.value.timezones=!1}function E(){r.value.hostname="",r.value.timezone="",r.value.notificationTitle="",r.value.notificationDescription="";let n=!0;{let{valid:v,errMessage:w}=ie(l.value);if(!v)r.value.hostname=t(w),n=!1,Q(h);else{let{valid:y,errMessage:oe}=ce(l.value);y||(r.value.hostname=t(oe),n=!1,Q(h))}}return n}async function f(){const n=i.value.find(v=>v.id===o.value);await z("uci","set",{config:"system",section:"@system[0]",values:{hostname:l.value,description:p.value,notes:_.value,zonename:o.value,timezone:n.timezone}})}async function a(){await z("luci","setInitAction",{name:"sysntpd",action:"enable"})}async function b(){if(E()){s.value.save=!0;try{await f(),await a(),R()}catch(v){console.error(v),r.value.notificationTitle=t("error.cannot_save_configuration"),r.value.notificationDescription=t(T(v))}finally{s.value.save=!1,await O.getChanges()}}}async function d(){s.value.syncWithNtpServer=!0;try{await z("luci","setInitAction",{name:"sysntpd",action:"restart"}),W()}catch(n){console.error(n),r.value.notificationTitle=t("error.cannot_sync_local_time"),r.value.notificationDescription=t(T(n))}s.value.syncWithNtpServer=!1}return(n,v)=>{const w=se("font-awesome-icon");return g(),L("div",he,[e(r).notificationTitle?(g(),D(e(F),{key:0,kind:"error",title:e(r).notificationTitle,description:e(r).notificationDescription,class:"mb-4"},null,8,["title","description"])):x("",!0),$.value?(g(),D(e(ne),{key:1,size:"lg",lines:12})):(g(),L("div",ke,[C("div",Ce,[C("div",Se,[e(M)==="NethSec"?(g(),D(e(F),{key:0,kind:"warning",title:e(t)("standalone.system_settings.default_hostname"),description:e(t)("standalone.system_settings.default_hostname_description"),closeAriaLabel:e(t)("common.close")},null,8,["title","description","closeAriaLabel"])):x("",!0),u(e(K),{label:e(t)("standalone.system_settings.hostname"),modelValue:e(l),"onUpdate:modelValue":v[0]||(v[0]=y=>V(l)?l.value=y:l=y),modelModifiers:{trim:!0},invalidMessage:e(r).hostname,disabled:e(s).save,ref_key:"hostnameRef",ref:h},null,8,["label","modelValue","invalidMessage","disabled"]),u(e(K),{label:e(t)("standalone.system_settings.short_description"),modelValue:e(p),"onUpdate:modelValue":v[1]||(v[1]=y=>V(p)?p.value=y:p=y),modelModifiers:{trim:!0},placeholder:e(t)("standalone.system_settings.short_description_placeholder"),optional:"",optionalLabel:e(t)("common.optional"),disabled:e(s).save},null,8,["label","modelValue","placeholder","optionalLabel","disabled"]),u(e(re),{label:e(t)("standalone.system_settings.notes"),modelValue:e(_),"onUpdate:modelValue":v[2]||(v[2]=y=>V(_)?_.value=y:_=y),modelModifiers:{trim:!0},placeholder:e(t)("standalone.system_settings.notes_placeholder"),optional:"",optionalLabel:e(t)("common.optional"),disabled:e(s).save},null,8,["label","modelValue","placeholder","optionalLabel","disabled"]),u(e(le),{modelValue:e(o),"onUpdate:modelValue":v[3]||(v[3]=y=>V(o)?o.value=y:o=y),options:e(i),label:e(t)("standalone.system_settings.timezone"),invalidMessage:e(r).timezone,noResultsLabel:e(t)("ne_combobox.no_results"),limitedOptionsLabel:e(t)("ne_combobox.limited_options_label"),disabled:e(s).save,ref_key:"timezoneRef",ref:S,noOptionsLabel:e(t)("ne_combobox.no_options_label"),"selected-label":e(t)("ne_combobox.selected"),"user-input-label":e(t)("ne_combobox.user_input_label"),optionalLabel:e(t)("common.optional")},null,8,["modelValue","options","label","invalidMessage","noResultsLabel","limitedOptionsLabel","disabled","noOptionsLabel","selected-label","user-input-label","optionalLabel"]),C("div",null,[u(e(de),null,{default:k(()=>[U(I(e(t)("standalone.system_settings.local_time")),1)]),_:1}),C("div",Ve,[C("div",null,I(e(ue)(e(N),"Pp","UTC")),1)])]),C("div",we,[u(e(G),{onClick:d,kind:"tertiary",size:"lg",loading:e(s).syncWithNtpServer,disabled:e(s).syncWithNtpServer||e(s).save},{default:k(()=>[U(I(e(t)("standalone.system_settings.sync_with_ntp_server")),1)]),_:1},8,["loading","disabled"])])])]),C("div",ze,[u(e(G),{kind:"primary",size:"lg",onClick:b,loading:e(s).save,disabled:e(s).save},{prefix:k(()=>[u(w,{icon:["fas","floppy-disk"],class:"h-4 w-4","aria-hidden":"true"})]),default:k(()=>[U(" "+I(e(t)("common.save")),1)]),_:1},8,["loading","disabled"])])]))])}}}),Le={class:"max-w-screen-md"},xe={key:2},De={class:"space-y-6"},Ie={key:0,class:"space-y-6"},Oe={key:0},Ne={key:0},Ue={class:"flex justify-end py-6"},Me=H({__name:"TimeSynchronization",setup(J){const{t}=P(),O=Y();let l=m(!1),h=m(!1),p=m(!1),_=m(""),N=m([]),o=m([]),S=m({}),i=m({systemConfig:!0,networkInterfaces:!0,save:!1}),c=m({ntpServerCandidate:[""],notificationTitle:"",notificationDescription:""});const M=ee(()=>i.value.systemConfig||i.value.networkInterfaces);A(()=>i.value.systemConfig,()=>{!i.value.systemConfig&&!i.value.networkInterfaces&&(_.value=S.value.interface||"all")}),A(()=>i.value.networkInterfaces,()=>{!i.value.systemConfig&&!i.value.networkInterfaces&&(_.value=S.value.interface||"all")}),te(()=>{s()});async function s(){r(),$()}async function r(){i.value.systemConfig=!0;try{const f=await ae("system");S.value=f.timeserver[0],S.value.enabled==="0"?l.value=!1:l.value=!0,S.value.enable_server==="1"?h.value=!0:h.value=!1,S.value.use_dhcp==="0"?p.value=!1:p.value=!0;const a=S.value.server,b=[];if(!me(a))for(const d of a)b.push(d);o.value=b}catch(f){console.error(f),c.value.notificationTitle=t("error.cannot_load_system_config"),c.value.notificationDescription=t(T(f))}i.value.systemConfig=!1}async function $(){i.value.networkInterfaces=!0;try{const f=await z("network.interface","dump");let a=[{id:"all",label:t("standalone.system_settings.all_interfaces")}];for(const b of f.data.interface)b.interface!=="loopback"&&a.push({id:b.interface,label:`${b.interface} (${b.device})`,rawObj:b});N.value=a}catch(f){console.error(f),c.value.notificationTitle=t("error.cannot_load_network_interfaces"),c.value.notificationDescription=t(T(f))}i.value.networkInterfaces=!1}async function R(){const f=l.value?"":0,a=l.value&&h.value?"1":"",b=l.value&&h.value&&_.value!=="all"?_.value:"",d=l.value&&!p.value?"0":"",n=l.value&&o.value.length?o.value:"";await z("uci","set",{config:"system",section:"ntp",values:{enabled:f,enable_server:a,interface:b,use_dhcp:d,server:n}})}async function W(){await z("luci","setInitAction",{name:"sysntpd",action:"enable"})}function j(){c.value.notificationTitle="",c.value.notificationDescription="",o.value=o.value.filter(a=>a),o.value=ye(o.value),c.value.ntpServerCandidate=[],o.value.forEach(()=>{c.value.ntpServerCandidate.push("")});let f=!0;for(let a=0;a<o.value.length;a++){const b=o.value[a];{let{valid:d,errMessage:n}=ie(b);if(!d)c.value.ntpServerCandidate[a]=t(n),f=!1;else{let{valid:v,errMessage:w}=fe(b);v||(c.value.ntpServerCandidate[a]=t(w),f=!1)}}}return f}async function B(){if(j()){i.value.save=!0;try{await R(),await W(),s()}catch(a){console.error(a),c.value.notificationTitle=t("error.cannot_save_configuration"),c.value.notificationDescription=t(T(a))}finally{i.value.save=!1,await O.getChanges()}}}function E(){c.value.ntpServerCandidate=[]}return(f,a)=>{const b=se("font-awesome-icon");return g(),L("div",Le,[e(c).notificationTitle?(g(),D(e(F),{key:0,kind:"error",title:e(c).notificationTitle,description:e(c).notificationDescription,class:"mb-4"},null,8,["title","description"])):x("",!0),M.value?(g(),D(e(ne),{key:1,size:"lg",lines:10})):(g(),L("div",xe,[u(Z,{title:e(t)("standalone.system_settings.settings")},{default:k(()=>[C("div",De,[u(e(X),{modelValue:e(l),"onUpdate:modelValue":a[0]||(a[0]=d=>V(l)?l.value=d:l=d),label:e(t)("standalone.system_settings.enable_ntp_client"),disabled:e(i).save},null,8,["modelValue","label","disabled"]),u(q,{name:"fade"},{default:k(()=>[e(l)?(g(),L("div",Ie,[u(e(X),{modelValue:e(h),"onUpdate:modelValue":a[1]||(a[1]=d=>V(h)?h.value=d:h=d),label:e(t)("standalone.system_settings.provide_ntp_server"),disabled:e(i).save},null,8,["modelValue","label","disabled"]),u(q,{name:"fade"},{default:k(()=>[e(h)?(g(),L("div",Oe,[u(e(le),{modelValue:e(_),"onUpdate:modelValue":a[2]||(a[2]=d=>V(_)?_.value=d:_=d),options:e(N),label:e(t)("standalone.system_settings.provide_ntp_server_to_interface"),noResultsLabel:e(t)("ne_combobox.no_results"),limitedOptionsLabel:e(t)("ne_combobox.limited_options_label"),disabled:e(i).save,noOptionsLabel:e(t)("ne_combobox.no_options_label"),"selected-label":e(t)("ne_combobox.selected"),"user-input-label":e(t)("ne_combobox.user_input_label"),optionalLabel:e(t)("common.optional")},null,8,["modelValue","options","label","noResultsLabel","limitedOptionsLabel","disabled","noOptionsLabel","selected-label","user-input-label","optionalLabel"])])):x("",!0)]),_:1}),u(e(ve),{modelValue:e(p),"onUpdate:modelValue":a[3]||(a[3]=d=>V(p)?p.value=d:p=d),label:e(t)("standalone.system_settings.use_dhcp_advertised_servers"),disabled:e(i).save},null,8,["modelValue","label","disabled"])])):x("",!0)]),_:1})])]),_:1},8,["title"]),u(q,{name:"fade"},{default:k(()=>[e(l)?(g(),L("div",Ne,[a[6]||(a[6]=C("hr",{class:"my-8"},null,-1)),u(Z,{title:e(t)("standalone.system_settings.ntp_server_candidates")},{default:k(()=>[u(be,{"add-item-label":e(t)("standalone.system_settings.add_ntp_server"),"invalid-messages":e(c).ntpServerCandidate,"disable-inputs":e(i).save,"disable-add-button":e(i).save,modelValue:e(o),"onUpdate:modelValue":a[4]||(a[4]=d=>V(o)?o.value=d:o=d),onDeleteItem:a[5]||(a[5]=d=>E())},null,8,["add-item-label","invalid-messages","disable-inputs","disable-add-button","modelValue"])]),_:1},8,["title"])])):x("",!0)]),_:1}),C("div",Ue,[u(e(G),{kind:"primary",size:"lg",onClick:B,loading:e(i).save,disabled:e(i).save},{prefix:k(()=>[u(b,{icon:["fas","floppy-disk"],class:"h-4 w-4","aria-hidden":"true"})]),default:k(()=>[U(" "+I(e(t)("common.save")),1)]),_:1},8,["loading","disabled"])])]))])}}}),Ee=H({__name:"SystemSettingsView",setup(J){const{t}=P(),{tabs:O,selectedTab:l}=ge([{name:"general",label:t("standalone.system_settings.general_settings")},{name:"timeSync",label:t("standalone.system_settings.time_synchronization")}]);return(h,p)=>(g(),L("div",null,[u(e(pe),{tag:"h3",class:"mb-7"},{default:k(()=>[U(I(e(t)("standalone.system_settings.title")),1)]),_:1}),u(e(_e),{tabs:e(O),selected:e(l),srTabsLabel:e(t)("ne_tabs.tabs"),srSelectTabLabel:e(t)("ne_tabs.select_a_tab"),onSelectTab:p[0]||(p[0]=_=>l.value=_),class:"mb-8"},null,8,["tabs","selected","srTabsLabel","srSelectTabLabel"]),C("div",null,[e(l)==="general"?(g(),D(Te,{key:0})):e(l)==="timeSync"?(g(),D(Me,{key:1})):x("",!0)])]))}});export{Ee as default};
