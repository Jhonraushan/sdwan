import{d as V,u as L,r as d,J as K,h as o,i as y,w as b,j as a,t as i,l as e,L as q,M as O,m as x,n as B,Y as W,e as M,V as T,O as A,c as Y,q as S,k as c,y as P,z as U,Q as z,W as C,B as F,_ as R,R as J,S as Q,T as G,o as E}from"./index-BlEQ5104.js";import{_ as I}from"./FormLayout.vue_vue_type_script_setup_true_lang-DaMAl8E3.js";import{_ as H}from"./NeCopyField.vue_vue_type_style_index_0_lang-D72fhwZm.js";const X={class:"space-y-2"},Z={class:"list-inside list-disc"},ee=V({__name:"CancelSubscriptionModal",props:{visible:{type:Boolean,required:!0}},emits:["close","subscription-update"],setup(h,{emit:r}){const s=h,_=r,{t}=L();let p=d({unregister:!1}),n=d({unregister:"",unregisterDetails:""});K(()=>s.visible,()=>{s.visible&&(n.value.unregister="",n.value.unregisterDetails="")});async function u(){n.value.unregister="",n.value.unregisterDetails="",p.value.unregister=!0;try{await M("ns.subscription","unregister"),_("close"),_("subscription-update")}catch(l){n.value.unregister=t(T(l)),n.value.unregisterDetails=l.toString()}finally{p.value.unregister=!1}}return(l,m)=>(o(),y(e(W),{visible:h.visible,title:e(t)("standalone.subscription.cancel_registration"),kind:"warning",size:"lg",primaryLabel:e(t)("standalone.subscription.cancel_registration"),cancelLabel:e(t)("common.cancel"),primaryButtonKind:"danger",primaryButtonDisabled:e(p).unregister,primaryButtonLoading:e(p).unregister,closeAriaLabel:e(t)("common.close"),onClose:m[0]||(m[0]=w=>_("close")),onPrimaryClick:u},{default:b(()=>[a("div",X,[a("p",null,i(e(t)("standalone.subscription.confirm_cancel_subscription"))+":",1),a("ul",Z,[a("li",null,i(e(t)("standalone.subscription.dpi_filter")),1),a("li",null,i(e(t)("standalone.subscription.automatic_updates")),1),a("li",null,i(e(t)("standalone.subscription.remote_backup")),1),a("li",null,i(e(t)("standalone.subscription.remote_vpn_users_databases")),1),a("li",null,i(e(t)("standalone.subscription.unlimited_controlled_units")),1),a("li",null,i(e(t)("standalone.subscription.threat_shield")),1),a("li",null,i(e(t)("standalone.subscription.monitoring_service")),1),a("li",null,i(e(t)("standalone.subscription.remote_support")),1)]),e(n).unregister?(o(),y(e(q),{key:0,kind:"error",title:e(t)("error.cancel_registration_error"),description:e(n).unregister,class:"!my-4"},O({_:2},[e(n).unregisterDetails?{name:"details",fn:b(()=>[x(i(e(n).unregisterDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):B("",!0)])]),_:1},8,["visible","title","primaryLabel","cancelLabel","primaryButtonDisabled","primaryButtonLoading","closeAriaLabel"]))}}),te={key:0,class:"flex flex-col gap-y-8"},se={class:"text-sm font-normal text-gray-500 dark:text-gray-400"},ne={class:"text-sm font-normal text-gray-500 dark:text-gray-400"},ae={class:"align-center flex flex-row"},ie={class:"mt-6 flex justify-end"},le=V({__name:"UnitSubscription",props:{subscriptionData:{type:Object,default:null},loading:{type:Boolean,default:!1}},emits:["subscription-update"],setup(h,{emit:r}){const{t:s}=L(),_=h,{subscriptionData:t,loading:p}=A(_),n=r,u=d(),l=d(""),m=d(!1),w=d(!1),v=d({authToken:"",request:""}),$=Y(()=>t.value?t.value.expiration==0?s("standalone.subscription.no_expiration"):new Date(t.value.expiration).toLocaleDateString():"");function k(){v.value.authToken="";let{valid:D,errMessage:g}=Q(l.value);return D||(v.value.authToken=s(g),G(u)),D}async function f(){try{if(v.value.request="",!k())return;m.value=!0,await M("ns.subscription","register",{secret:l.value}),l.value="",n("subscription-update")}catch(D){D.response.data.message=="invalid_secret_or_server_not_found"?v.value.request=s("standalone.subscription.invalid_secret_or_server_not_found"):v.value.request=s(T(D))}finally{m.value=!1}}function j(){w.value=!0}return(D,g)=>(o(),S(U,null,[c(I,{title:e(s)("standalone.subscription.unit_subscription"),description:e(s)("standalone.subscription.unit_subscription_description"),class:"max-w-3xl"},{default:b(()=>[e(p)?(o(),y(e(P),{key:0,lines:5})):(o(),S(U,{key:1},[e(t)?(o(),S("div",te,[c(e(z),{label:e(s)("standalone.subscription.system_id"),disabled:!0,modelValue:e(t).systemd_id},null,8,["label","modelValue"]),a("div",null,[c(e(C),{tag:"h6",class:"mb-1.5"},{default:b(()=>[x(i(e(s)("standalone.subscription.plan")),1)]),_:1}),a("p",se,i(e(t).plan),1)]),a("div",null,[c(e(C),{tag:"h6",class:"mb-1.5"},{default:b(()=>[x(i(e(s)("standalone.subscription.expiration")),1)]),_:1}),a("p",ne,i($.value),1)]),a("div",ae,[c(e(C),{tag:"h6",class:"!mb-0 mr-4 inline-block"},{default:b(()=>[x(i(e(s)("standalone.subscription.status")),1)]),_:1}),c(e(F),{text:e(t).active?e(s)("standalone.subscription.active"):e(s)("standalone.subscription.inactive"),kind:e(t).active?"success":"warning",size:"sm"},null,8,["text","kind"])]),v.value.request?(o(),y(e(q),{key:0,kind:"error",title:e(s)("error.cancel_registration_error"),description:v.value.request},null,8,["title","description"])):B("",!0),a("div",null,[c(e(R),{kind:"tertiary",class:"-ml-2.5",onClick:j},{default:b(()=>[x(i(e(s)("standalone.subscription.cancel_registration")),1)]),_:1})])])):(o(),S("form",{key:1,onSubmit:g[1]||(g[1]=J(()=>{},["prevent"]))},[c(e(z),{label:e(s)("standalone.subscription.authentication_token"),placeholder:e(s)("standalone.subscription.authentication_token_placeholder"),invalidMessage:v.value.authToken,disabled:m.value,modelValue:l.value,"onUpdate:modelValue":g[0]||(g[0]=N=>l.value=N),modelModifiers:{trim:!0},ref_key:"authTokenRef",ref:u},null,8,["label","placeholder","invalidMessage","disabled","modelValue"]),v.value.request?(o(),y(e(q),{key:0,kind:"error",title:e(s)("error.register_unit_error"),description:v.value.request,class:"my-4"},null,8,["title","description"])):B("",!0),a("div",ie,[c(e(R),{type:"submit",kind:"primary",onClick:f,disabled:m.value,loading:m.value},{default:b(()=>[x(i(e(s)("standalone.subscription.register")),1)]),_:1},8,["disabled","loading"])])],32))],64))]),_:1},8,["title","description"]),c(ee,{visible:w.value,onClose:g[2]||(g[2]=N=>w.value=!1),onSubscriptionUpdate:g[3]||(g[3]=N=>n("subscription-update"))},null,8,["visible"])],64))}}),oe={key:1},re={class:"mt-6 flex justify-end"},ue=V({__name:"RemoteSupport",props:{enableRemoteSupport:{type:Boolean,required:!0},loading:{type:Boolean,default:!1}},setup(h){const{t:r}=L(),s=h,{enableRemoteSupport:_,loading:t}=A(s),p=d(!0),n=d(""),u=d(!1),l=d("");async function m(){let k=await $("start");l.value=k.data.session_id}async function w(){await $("stop"),l.value=""}async function v(){p.value=!0;const k=await $("status");k.data.result==="no_session"?l.value="":l.value=k.data.session_id,p.value=!1}async function $(k){try{return n.value="",u.value=!0,await M("ns.don",k)}catch(f){throw n.value=r(T(f)),f}finally{u.value=!1}}return E(()=>{v()}),(k,f)=>(o(),y(I,{title:e(r)("standalone.subscription.remote_support"),description:e(r)("standalone.subscription.remote_support_description"),class:"max-w-3xl"},{default:b(()=>[n.value?(o(),y(e(q),{key:0,kind:"error",title:e(r)("error.generic_error"),description:n.value,class:"mb-4"},null,8,["title","description"])):B("",!0),p.value||e(t)?(o(),y(e(P),{key:1,lines:5})):(o(),S(U,{key:2},[l.value?(o(),S("div",oe,[c(H,{label:e(r)("standalone.subscription.session_id"),value:l.value,"copy-value-label":e(r)("standalone.subscription.copy_id")},null,8,["label","value","copy-value-label"]),a("div",re,[c(e(R),{kind:"primary",onClick:f[1]||(f[1]=j=>w()),disabled:u.value,loading:u.value},{default:b(()=>[x(i(e(r)("standalone.subscription.end_session")),1)]),_:1},8,["disabled","loading"])])])):(o(),y(e(R),{key:0,kind:"secondary",disabled:!e(_)||u.value,loading:u.value,onClick:f[0]||(f[0]=j=>m())},{default:b(()=>[x(i(e(r)("standalone.subscription.start_session")),1)]),_:1},8,["disabled","loading"]))],64))]),_:1},8,["title","description"]))}}),ce={class:"flex flex-col gap-y-6"},be=V({__name:"SubscriptionView",setup(h){const{t:r}=L(),s=d(!0),_=d(""),t=d(null);async function p(){try{s.value=!0;const n=await M("ns.subscription","info");t.value=n.data.systemd_id!=""?n.data:null,s.value=!1}catch(n){_.value=T(n)}}return E(()=>{p()}),(n,u)=>(o(),S("div",ce,[c(e(C),{tag:"h3",class:"mb-7"},{default:b(()=>[x(i(e(r)("standalone.subscription.title")),1)]),_:1}),_.value?(o(),y(e(q),{key:0,kind:"error",title:e(r)("error.generic_error"),description:e(r)(_.value)},null,8,["title","description"])):B("",!0),c(le,{"subscription-data":t.value,loading:s.value,onSubscriptionUpdate:u[0]||(u[0]=l=>p())},null,8,["subscription-data","loading"]),u[1]||(u[1]=a("hr",null,null,-1)),c(ue,{"enable-remote-support":t.value!=null,loading:s.value},null,8,["enable-remote-support","loading"])]))}});export{be as default};
