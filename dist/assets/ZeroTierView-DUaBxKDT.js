import{d as ne,ac as we,u as oe,r as a,aa as Se,c as se,J,h as b,i as D,w as n,j as y,l as e,L as ie,n as re,k as o,a5 as Re,Q as De,m as d,t as g,R as le,_ as G,ai as ke,bH as he,T as Te,e as M,V as L,ay as ue,az as ce,S as je,U as xe,o as Ce,b as Ae,g as Oe,q as H,W as Ee,M as ze,y as Ve,z as Q,al as C,ak as Ie,ad as Pe,am as Me,aq as Le,aj as Ue,an as Be,ao as A}from"./index-BlEQ5104.js";/* empty css                                                */import{_ as qe}from"./DeleteTunnelModal.vue_vue_type_script_setup_true_lang-2XdVzv1U.js";import{u as Ne}from"./firewall-C9mbeSo1.js";import{u as $e}from"./useObjects-D-lIOcFM.js";const Fe={class:"space-y-6"},Ze={class:"flex justify-end"},We=ne({__name:"ZeroTierDrawer",props:{ruleType:{type:String,required:!0},currentRule:{type:Object},isDuplicatingRule:{type:Boolean,default:!1},isShown:{type:Boolean,default:!1},knownTags:{type:Array,required:!0}},emits:["close","reloadData","save"],setup(U,{emit:v}){const B=we(),s=U,z=v,{t:i}=oe();$e(),Ne();const S=a(""),V=a(),k=a(),c=a(!1),m=a(""),h=a("source_address"),R=a("destination_address"),O=a([""]);a([""]);const T=a([""]),j=a(""),I=a("");a(),a();const _=a("*");a();const r=a("*");a();const q=a([]),f=a("*");a();const N=a([]),K=a("DROP"),E=a([]);a();const de=a([]),$=a("");a();const X=a("bottom"),Y=a(!1),F=a([]),Z=a(!1),x=a(new Se);a([]),a([]),a([]);let p=a({listServiceSuggestions:!1,listObjectSuggestions:!1,listProtocols:!1,saveRule:!1}),w=a({listServiceSuggestions:"",listServiceSuggestionsDetails:"",listObjectSuggestions:"",listObjectSuggestionsDetails:"",listProtocols:"",listProtocolsDetails:"",saveRule:"",saveRuleDetails:""});const ee=se(()=>!s.currentRule),te=se(()=>!!s.currentRule&&!s.isDuplicatingRule);J(()=>s.isShown,()=>{var t;s.isShown&&(ge(),x.value.clear(),he(()=>{Te(V)}),pe(),_e(),ee.value?(c.value=!0,S.value="",h.value="source_address",R.value="destination_address",O.value=[""],j.value="",T.value=[""],I.value="",_.value="*",r.value="*",f.value="*",K.value="DROP",E.value=[],$.value="",X.value="bottom",F.value=[],Z.value=!1,Y.value=!1):s.currentRule&&(c.value=s.currentRule.enabled||!1,_.value=s.currentRule.src||"*",r.value=s.currentRule.dest||"*",f.value="*",E.value=[],K.value=s.currentRule.target||"DROP",X.value="bottom",F.value=((t=s.currentRule.ns_tag)==null?void 0:t.map(l=>({id:l,label:l})))||[],Z.value=s.currentRule.log||!1,Y.value=F.value.length>0||Z.value,te.value?S.value=s.currentRule.name||"":S.value=i("standalone.firewall_rules.duplicated_rule_name",{name:s.currentRule.name})))}),J(()=>f.value,()=>{f.value==="custom"&&me()});function ve(t){if(!t.src_ip)return[];const l=[];if(t.ns_src)h.value="source_object",j.value=t.ns_src;else if(t.src_ip.length){h.value="source_address";for(const u of t.src_ip)l.push(u.value)}else h.value="source_any";l.length?O.value=l:O.value=[""]}function fe(t){if(!t.dest_ip)return[];const l=[];if(t.ns_dst)R.value="destination_object",I.value=t.ns_dst;else if(t.dest_ip.length){R.value="destination_address";for(const u of t.dest_ip)l.push(u.value)}else R.value="destination_any";l.length?T.value=l:T.value=[""]}function W(){z("close")}function ge(){for(const[t,l]of Object.entries(w.value))typeof l=="string"?w.value[t]="":Array.isArray(l)&&(w.value[t]=[])}async function _e(){p.value.listObjectSuggestions=!0;try{const t=await M("ns.firewall","list-object-suggestions");q.value=t.data.objects,s.currentRule&&(ve(s.currentRule),fe(s.currentRule))}catch(t){console.error(t),w.value.listObjectSuggestions=i(L(t)),w.value.listObjectSuggestionsDetails=t.toString()}finally{p.value.listObjectSuggestions=!1}}async function pe(){p.value.listServiceSuggestions=!0;try{const t=await M("ns.firewall","list-service-suggestions");N.value=t.data.services.map(l=>{const u=i("standalone.firewall_rules.service_ports",{protocols:l.proto.join("/").toUpperCase(),ports:l.port},1);return{id:l.id,label:l.id,description:u,protocols:l.proto,port:l.port}}),s.currentRule&&(s.currentRule.ns_service==="custom"?(f.value="custom",$.value=s.currentRule.dest_port.join(", ")||""):(f.value=s.currentRule.ns_service||"*",$.value="",E.value=[]))}catch(t){console.error(t),w.value.listServiceSuggestions=i(L(t)),w.value.listServiceSuggestionsDetails=t.toString()}finally{p.value.listServiceSuggestions=!1}}async function me(){p.value.listProtocols=!0;try{const l=(await M("ns.redirects","list-protocols")).data.protocols.filter(u=>u!=="all");de.value=l.map(u=>({id:u,label:u.toUpperCase()})),s.currentRule&&(s.currentRule.proto.length&&s.currentRule.ns_service==="custom"?E.value=s.currentRule.proto.map(u=>({id:u,label:u.toUpperCase()})):E.value=[])}catch(t){console.error(t),w.value.listProtocols=i(L(t)),w.value.listProtocolsDetails=t.toString()}finally{p.value.listProtocols=!1}}const be=()=>{x.value.clear();let t=!0;return[{key:"zeroTierID",value:m,ref:k}].forEach(u=>{je(u.value.value).valid||(x.value.set(u.key,i("required")),t=!1)}),t},ae={zeroTierID:m};Object.keys(ae).forEach(t=>{J(ae[t],l=>{l!==""&&x.value.delete(t)})});const ye=async()=>{try{if(!be())return;const t={service:c.value,join:m.value};console.log("payload=======",t);const l=await ue.post(`${ce()}/zerotier`,{method:"set-config",payload:{service:c.value,join:m.value}});if(console.log("response======",l),l.data.code===200)B.createNotification({title:"Success",description:"Configuration saved successfully.",kind:"success"}),c.value=!1,x.value.clear(),z("save",t),W();else throw new Error("Failed to save configuration.")}catch(t){console.error("Error:====",t)}};return(t,l)=>(b(),D(e(ke),{isShown:U.isShown,title:e(i)("standalone.wire_guard.add_client_tunnel"),closeAriaLabel:e(i)("standalone.wire_guard.add_client_tunnel"),onClose:W},{default:n(()=>{var u;return[y("form",null,[y("div",Fe,[te.value&&((u=s.currentRule)!=null&&u.system_rule)?(b(),D(e(ie),{key:0,kind:"warning",title:e(i)("standalone.firewall_rules.editing_system_rule_warning_title"),description:e(i)("standalone.firewall_rules.editing_system_rule_warning_description")},null,8,["title","description"])):re("",!0),o(e(Re),{modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=P=>c.value=P),label:c.value?e(i)("common.enabled"):e(i)("common.disabled"),topLabel:e(i)("common.status"),disabled:e(p).saveRule},null,8,["modelValue","label","topLabel","disabled"]),o(e(De),{label:e(i)("standalone.zero-tier.zero_tier_id"),modelValue:m.value,"onUpdate:modelValue":l[1]||(l[1]=P=>m.value=P),modelModifiers:{trim:!0},invalidMessage:x.value.getFirstFor("zeroTierID"),disabled:e(p).saveRule,ref_key:"zeroTierIDRef",ref:k},null,8,["label","modelValue","invalidMessage","disabled"])]),l[2]||(l[2]=y("hr",{class:"my-8 border-gray-200 dark:border-gray-700"},null,-1)),y("div",Ze,[o(e(G),{kind:"tertiary",size:"lg",onClick:le(W,["prevent"]),disabled:e(p).saveRule,class:"mr-3"},{default:n(()=>[d(g(e(i)("common.cancel")),1)]),_:1},8,["disabled"]),o(e(G),{kind:"primary",size:"lg",onClick:le(ye,["prevent"]),disabled:e(p).saveRule,loading:e(p).saveRule},{default:n(()=>[d(g(ee.value?e(i)("standalone.wire_guard.save"):e(i)("standalone.wire_guard.save")),1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["isShown","title","closeAriaLabel"]))}}),Je={class:"flex flex-col"},He={class:"flex flex-col justify-between md:flex-row md:items-center"},Qe={class:"mb-6 text-sm text-gray-500 dark:text-gray-400"},Ge={class:"space-y-6"},Ke={class:"flex flex-col items-start justify-between gap-6 lg:flex-row"},Xe={class:"max-w-2xl text-sm font-normal text-gray-500 dark:text-gray-400"},Ye=1e4,nt=ne({__name:"ZeroTierView",setup(U){const{t:v}=oe(),B=xe(),s=a(!0),z=a([]),i=a(null),S=a(!1),V=a(!1),k=a(0),c=a({notificationTitle:"",notificationDescription:"",notificationDetails:""});async function m(_=!0){try{_&&(s.value=!0),z.value=(await M("ns.ipsectunnel","list-tunnels")).data.tunnels,s.value=!1}catch(r){c.value.notificationTitle=v("error.cannot_retrieve_ipsec_tunnels"),c.value.notificationDescription=v(L(r)),c.value.notificationDetails=r.toString()}finally{_&&(s.value=!1)}}function h(_){i.value=_,S.value=!0}function R(){i.value=null,V.value=!1,S.value=!1}function O(){c.value={notificationTitle:"",notificationDescription:"",notificationDetails:""}}async function T(){O(),await m(),await B.getChanges()}Ce(()=>{m(),I(),k.value=setInterval(()=>m(!1),Ye)}),Ae(()=>{k.value&&clearInterval(k.value)});const j=a(),I=async()=>{try{s.value=!0;const _=await ue.post(`${ce()}/zerotier`,{method:"get-config",payload:{}});_.data.code===200&&(s.value=!1,j.value=[_.data.data])}catch{s.value=!1}s.value=!1};return(_,r)=>{const q=Oe("font-awesome-icon");return b(),H(Q,null,[y("div",Je,[y("div",He,[o(e(Ee),{tag:"h3",class:"mb-7"},{default:n(()=>[d(g(e(v)("standalone.zero-tier.title")),1)]),_:1}),y("div",Qe,g(e(v)("common.data_updated_every_seconds",{seconds:10})),1)]),y("div",Ge,[y("div",Ke,[y("p",Xe,g(e(v)("standalone.wire_guard.description")),1)]),c.value.notificationTitle?(b(),D(e(ie),{key:0,kind:"error",title:c.value.notificationTitle,description:c.value.notificationDescription},ze({_:2},[c.value.notificationDetails?{name:"details",fn:n(()=>[d(g(c.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):re("",!0),s.value?(b(),D(e(Ve),{key:1,lines:8,size:"lg"})):(b(),H(Q,{key:2},[j.value.length>0?(b(),D(e(Le),{key:0,cardBreakpoint:"md",class:"mt-2"},{default:n(()=>[o(e(Ie),null,{default:n(()=>[o(e(C),null,{default:n(()=>r[1]||(r[1]=[d("Join")])),_:1}),o(e(C),null,{default:n(()=>r[2]||(r[2]=[d("ID")])),_:1}),o(e(C),null,{default:n(()=>r[3]||(r[3]=[d("Version")])),_:1}),o(e(C),null,{default:n(()=>r[4]||(r[4]=[d("Network")])),_:1}),o(e(C),null,{default:n(()=>r[5]||(r[5]=[d("MAC")])),_:1}),o(e(C),null,{default:n(()=>r[6]||(r[6]=[d("Status")])),_:1})]),_:1}),o(e(Me),null,{default:n(()=>[(b(!0),H(Q,null,Pe(j.value,(f,N)=>(b(),D(e(Be),{key:N},{default:n(()=>[o(e(A),{"data-label":e(v)("standalone.real_time_monitor.interface")},{default:n(()=>[d(g(f.join),1)]),_:2},1032,["data-label"]),o(e(A),{"data-label":e(v)("standalone.real_time_monitor.interface")},{default:n(()=>[d(g(f.id),1)]),_:2},1032,["data-label"]),o(e(A),{"data-label":e(v)("standalone.real_time_monitor.interface")},{default:n(()=>[d(g(f.version),1)]),_:2},1032,["data-label"]),o(e(A),{"data-label":e(v)("standalone.real_time_monitor.interface")},{default:n(()=>[d(g(f.network),1)]),_:2},1032,["data-label"]),o(e(A),{"data-label":e(v)("standalone.real_time_monitor.interface")},{default:n(()=>[d(g(f.mac),1)]),_:2},1032,["data-label"]),o(e(A),{"data-label":e(v)("standalone.real_time_monitor.interface")},{default:n(()=>[d(g(f.status),1)]),_:2},1032,["data-label"])]),_:2},1024))),128))]),_:1})]),_:1})):(b(),D(e(Ue),{key:1,title:e(v)("standalone.wire_guard.no_wire_guard_found"),icon:["fas","globe"]},{default:n(()=>[o(e(G),{kind:"primary",onClick:r[0]||(r[0]=f=>h(null))},{prefix:n(()=>[o(q,{icon:["fas","circle-plus"],class:"h-4 w-4","aria-hidden":"true"})]),default:n(()=>[d(" "+g(e(v)("standalone.wire_guard.add_wire_guard_tunnel")),1)]),_:1})]),_:1},8,["title"]))],64))])]),o(qe,{visible:V.value,"item-to-delete":i.value,onClose:R,onTunnelDeleted:T},null,8,["visible","item-to-delete"]),o(We,{"item-to-edit":i.value,"rule-type":"forward","known-tags":[],onClose:R,onAddEditTunnel:T,"is-shown":S.value},null,8,["item-to-edit","is-shown"])],64)}}});export{nt as default};
