import{d as ke,u as Le,O as Ze,g as Be,h as b,q as F,j,m as f,t as p,l as e,k as n,w as i,ak as lt,al as N,am as nt,z as we,ad as Me,i as V,an as st,ao as q,av as W,n as S,_ as ue,ap as rt,aq as it,r,aa as dt,c as ie,aZ as ut,J as ct,L as ge,V as A,M as je,y as Ne,a1 as pt,a5 as xe,Q as de,a0 as te,s as ae,ar as $e,aA as be,aR as ve,bI as _t,ai as ft,e as z,bJ as bt,S as me,bK as Te,bL as Ue,bM as Ee,a_ as vt,bN as mt,T as Ae,U as wt,o as gt,W as yt,aj as ze}from"./index-BlEQ5104.js";import{_ as Ot}from"./ObjectTooltip.vue_vue_type_script_setup_true_lang-DvwD7JWX.js";import{_ as xt}from"./NeMultiTextInput.vue_vue_type_script_setup_true_lang-DwfeP71-.js";import{u as jt,Z as kt}from"./firewall-C9mbeSo1.js";import{u as Lt}from"./useObjects-D-lIOcFM.js";import{_ as Vt}from"./DeleteModal.vue_vue_type_script_setup_true_lang-DxXJd-w5.js";import"./objects-B0tOUNaX.js";import"./isArrayLikeObject-CpCvCe5A.js";const Dt={class:"z-0 -my-1 table max-w-md rounded-se-md rounded-ss-md bg-indigo-300 p-2 text-sm dark:bg-indigo-800"},ht={key:0},St={key:0},Rt={class:"-ml-2.5 flex items-center gap-2 xl:ml-0 xl:justify-end"},Pt=ke({__name:"PortForwardTable",props:{portForwards:{},header:{}},emits:["port-forward-duplicate","port-forward-toggle-enable","port-forward-delete","port-forward-edit"],setup(ce,{emit:v}){const{t:a}=Le(),t=ce,{portForwards:L,header:D}=Ze(t),m=v;function R(k){return[{id:"enable_disable",label:k.enabled?a("standalone.port_forward.disable"):a("standalone.port_forward.enable"),iconStyle:"fas",icon:k.enabled?"circle-xmark":"circle-check",action:()=>{m("port-forward-toggle-enable",k)}},{id:"duplicate",label:a("standalone.port_forward.duplicate"),iconStyle:"fas",icon:"clone",action:()=>{m("port-forward-duplicate",k)}},{id:"delete",label:a("common.delete"),iconStyle:"fas",icon:"trash",danger:!0,action:()=>{m("port-forward-delete",k)}}]}function w(k){return k.enabled?[]:["text-gray-400","dark:text-gray-700"]}return(k,y)=>{const c=Be("font-awesome-icon");return b(),F("div",null,[j("p",Dt,[f(p(e(a)("standalone.port_forward.destination"))+": ",1),j("strong",null,p(e(D)),1)]),n(e(it),{ariaLabel:e(a)("standalone.port_forward.port_forwards_for_destination_name",{name:e(D)}),cardBreakpoint:"xl",class:"z-10"},{default:i(()=>[n(e(lt),null,{default:i(()=>[n(e(N),null,{default:i(()=>[f(p(e(a)("standalone.port_forward.name")),1)]),_:1}),n(e(N),null,{default:i(()=>[f(p(e(a)("standalone.port_forward.source_port")),1)]),_:1}),n(e(N),null,{default:i(()=>[f(p(e(a)("standalone.port_forward.destination_port")),1)]),_:1}),n(e(N),null,{default:i(()=>[f(p(e(a)("standalone.port_forward.protocols")),1)]),_:1}),n(e(N),null,{default:i(()=>[f(p(e(a)("standalone.port_forward.wan_ip")),1)]),_:1}),n(e(N),null,{default:i(()=>[f(p(e(a)("standalone.port_forward.restrict_access_from")),1)]),_:1}),n(e(N),null,{default:i(()=>[f(p(e(a)("standalone.port_forward.status")),1)]),_:1}),n(e(N))]),_:1}),n(e(nt),null,{default:i(()=>[(b(!0),F(we,null,Me(e(L),d=>(b(),V(e(st),{key:d.id},{default:i(()=>[n(e(q),{"data-label":e(a)("standalone.port_forward.name")},{default:i(()=>[j("p",{class:W([...w(d)])},p(d.name),3)]),_:2},1032,["data-label"]),n(e(q),{"data-label":e(a)("standalone.port_forward.source_port")},{default:i(()=>[j("p",{class:W([...w(d)])},p(d.source_port?d.source_port:e(a)("common.any"))+" "+p(d.source_port_name?`(${d.source_port_name})`:""),3)]),_:2},1032,["data-label"]),n(e(q),{"data-label":e(a)("standalone.port_forward.destination_port")},{default:i(()=>[j("p",{class:W([...w(d)])},p(d.destination_port?d.destination_port:e(a)("common.any")),3)]),_:2},1032,["data-label"]),n(e(q),{"data-label":e(a)("standalone.port_forward.protocols")},{default:i(()=>[j("p",{class:W([...w(d),"uppercase"])},[f(p(d.protocol.slice(0,3).join(", ")),1),d.protocol.length>3?(b(),F("span",ht,"...")):S("",!0)],2)]),_:2},1032,["data-label"]),n(e(q),{"data-label":e(a)("standalone.port_forward.wan_ip")},{default:i(()=>[j("p",{class:W([...w(d)])},p(d.wan==="any"?e(a)("common.any"):d.wan),3)]),_:2},1032,["data-label"]),n(e(q),{"data-label":e(a)("standalone.port_forward.restrict_access_from")},{default:i(()=>[d.ns_src?(b(),V(Ot,{key:0,"object-id":d.ns_src},null,8,["object-id"])):d.restrict.length>0?(b(),F("p",{key:1,class:W([...w(d)])},[f(p(d.restrict.slice(0,2).join(", ")),1),d.restrict.length>2?(b(),F("span",St,"...")):S("",!0)],2)):(b(),F("p",{key:2,class:W([...w(d)])},"-",2))]),_:2},1032,["data-label"]),n(e(q),{"data-label":e(a)("standalone.port_forward.status")},{default:i(()=>[j("div",{class:W(["flex","flex-row","items-center",...w(d)])},[n(c,{icon:["fas",d.enabled?"circle-check":"circle-xmark"],class:"mr-2 h-5 w-5","aria-hidden":"true"},null,8,["icon"]),j("p",null,p(d.enabled?e(a)("standalone.port_forward.enabled"):e(a)("standalone.port_forward.disabled")),1)],2)]),_:2},1032,["data-label"]),n(e(q),{"data-label":e(a)("common.actions")},{default:i(()=>[j("div",Rt,[n(e(ue),{kind:"tertiary",onClick:h=>m("port-forward-edit",d)},{prefix:i(()=>[n(c,{icon:["fas","pen-to-square"],class:"h-4 w-4","aria-hidden":"true"})]),default:i(()=>[f(" "+p(e(a)("common.edit")),1)]),_:2},1032,["onClick"]),n(e(rt),{items:R(d),"align-to-right":!0},null,8,["items"])])]),_:2},1032,["data-label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["ariaLabel"])])}}}),It={key:2,class:"flex flex-col gap-y-6"},Ft={class:"space-y-6"},Ct={class:"flex justify-end"},$t=ke({__name:"CreateOrEditPortForwardDrawer",props:{isShown:{type:Boolean},initialItem:{},destinationObjectSuggestions:{},restrictObjectSuggestions:{}},emits:["close","add-edit-port-forward"],setup(ce,{emit:v}){const a=ce,{t}=Le(),L=jt(),{getObjectIcon:D}=Lt(),{isShown:m}=Ze(a),R=v,w=r(!1),k=r({listProtocolsAndZones:!1,listObjectSuggestions:!1}),y=r(!1),c=r({notificationTitle:"",notificationDescription:"",notificationDetails:"",listObjectSuggestions:"",listObjectSuggestionsDetails:""}),d=r(new dt),h=r([]),Z=r(),B=r([]),pe=r([]),_e=r([]),ye=ie(()=>L.loading?[]:[{id:"any",label:t("standalone.port_forward.automatic")},...L.zones.filter(u=>u.type()!=kt.WAN).map(u=>({id:u.name,label:u.name.toUpperCase()}))]),C=r(""),J=r(""),oe=r(),$=r(""),fe=r(),s=r(""),_=r(),O=r(""),g=r(),P=r(""),qe=r(),le=r(!0),M=r([""]),Ve=r(),Y=r([{id:"tcp",label:"TCP"},{id:"udp",label:"UDP"}]),We=r(),ne=r(!1),K=r(!1),se=r([]),De=r(),re=r(""),Je=r(),T=r("address"),H=r(""),he=r(),U=r("address"),ee=r(""),Ke=r(),He=r([{id:"address",label:t("standalone.port_forward.enter_destination_address")},{id:"object",label:t("standalone.port_forward.select_an_object")}]),Qe=r([{id:"address",label:t("standalone.port_forward.enter_restricted_addresses")},{id:"object",label:t("standalone.port_forward.select_an_object")}]),Ge=ie(()=>a.destinationObjectSuggestions.map(u=>({id:u.id,label:u.name,description:t(`standalone.objects.subtype_${u.subtype}`),icon:D(u.subtype)}))),Xe=ie(()=>{const u={id:"",label:t("standalone.port_forward.no_object")},o=a.restrictObjectSuggestions.filter(l=>{var x;return!((x=l.ipaddr)!=null&&x.some(I=>I.includes("objects/")))}).map(l=>({id:l.id,label:l.name,description:t(`standalone.objects.subtype_${l.subtype}`),icon:D(l.subtype)}));return[u,...o]}),Q=ie(()=>Y.value.length==0);function Se(){var u,o,l,x,I,G,X,Re,Pe,Ie,Fe,Ce;d.value.clear(),C.value=((u=a.initialItem)==null?void 0:u.id)??"",J.value=((o=a.initialItem)==null?void 0:o.name)??"",$.value=((l=a.initialItem)==null?void 0:l.source_port)??"",a.initialItem?a.initialItem.ns_dst?(T.value="object",s.value="",H.value=a.initialItem.ns_dst):(T.value="address",s.value=a.initialItem.dest_ip,H.value=""):(T.value="address",s.value="",H.value=""),O.value=((x=a.initialItem)==null?void 0:x.destination_port)??"",P.value=((I=a.initialItem)==null?void 0:I.wan)??"any",le.value=((G=a.initialItem)==null?void 0:G.enabled)??!0,a.initialItem?a.initialItem.ns_src?(U.value="object",M.value=[""],ee.value=a.initialItem.ns_src):(U.value="address",M.value=a.initialItem.restrict instanceof Array&&a.initialItem.restrict.length>0?a.initialItem.restrict.map(E=>E):[""],ee.value=""):(U.value="address",M.value=[""],ee.value=""),a.initialItem&&((X=a.initialItem)!=null&&X.protocol.some(E=>E==="all"))?Y.value=[]:Y.value=(((Re=a.initialItem)==null?void 0:Re.protocol)??["tcp","udp"]).map(E=>({id:E,label:E.toUpperCase()})),ne.value=((Pe=a.initialItem)==null?void 0:Pe.log)??!1,K.value=((Ie=a.initialItem)==null?void 0:Ie.reflection)??!1,se.value=((Fe=a.initialItem)==null?void 0:Fe.reflection_zone.map(E=>({id:E,label:E.toUpperCase()})))??[],re.value=((Ce=a.initialItem)==null?void 0:Ce.dest)??"any"}async function Ye(){k.value.listProtocolsAndZones=!0;try{B.value=(await z("ns.redirects","list-protocols")).data.protocols.map(u=>({id:u,label:u.toUpperCase()}))}catch(u){c.value.notificationTitle=t("error.cannot_retrieve_protocols"),c.value.notificationDescription=t(A(u)),c.value.notificationDetails=u.toString();return}try{pe.value=(await z("ns.redirects","list-zones")).data.zones.map(u=>({id:u,label:u.toUpperCase()}))}catch(u){c.value.notificationTitle=t("error.cannot_retrieve_zones"),c.value.notificationDescription=t(A(u)),c.value.notificationDetails=u.toString();return}try{_e.value=[{id:"any",label:t("common.any")},...(await z("ns.redirects","list-wans")).data.wans.map(u=>({id:u.ipaddr,label:u.ipaddr,description:u.device}))]}catch(u){c.value.notificationTitle=t("error.cannot_retrieve_wan_interfaces"),c.value.notificationDescription=t(A(u)),c.value.notificationDetails=u.toString();return}k.value.listProtocolsAndZones=!1,Ae(oe)}ut(()=>{Se()});function Oe(){c.value.notificationTitle="",c.value.notificationDescription="",c.value.notificationDetails="",d.value.clear(),h.value=[],w.value=!1,Se(),R("close")}ct(()=>a.isShown,()=>{a.isShown&&(Ye(),(L.loading||L.error)&&L.fetch())});function et(){h.value=[]}function tt(u,o,l){for(let x of u)x.valid||(d.value.set(o,[t(x.errMessage)]),Z.value||(Z.value=l));return u.every(x=>x.valid)}function at(){d.value.clear(),h.value=[],M.value.forEach(()=>{h.value.push("")}),Z.value=void 0;let u=!0;if(U.value==="address"){for(let[I,G]of M.value.entries())if(G){let X=bt(G);if(!X.valid){h.value[I]=t(X.errMessage),u=!1,Z.value=Ve;break}}}u||(w.value=!0);const o=[[[O.value?me($.value):{valid:!0},$.value?Te([Ue,Ee],$.value,t("error.invalid_port_or_port_range")):{valid:!0}],"sourcePort",fe],[[O.value?Te([Ue,Ee],O.value,t("error.invalid_port_or_port_range")):{valid:!0}],"destinationPort",g]],x=[[[me(J.value)],"name",oe],...Q.value?[]:o,T.value==="address"?[[me(s.value),vt(s.value)],"destinationIP",_]:[[me(H.value)],"destinationAddressObject",he],[K.value?[mt(se.value)]:[],"reflectionZones",De]].map(([I,G,X])=>tt(I,G,X)).every(I=>I);return Z.value&&Ae(Z.value),u&&x}async function ot(){c.value.notificationTitle="",c.value.notificationDescription="",c.value.notificationDetails="";const u=C.value!="";try{y.value=!0;const o=u?"edit-redirect":"add-redirect";if(at()){const l={dest_ip:"",ns_dst:"",proto:Q.value?["all"]:Y.value.map(x=>x.id),src_dport:Q.value?"":$.value,dest_port:Q.value?"":O.value,name:J.value,src_dip:P.value==="any"?"":P.value,enabled:le.value?"1":"0",log:ne.value?"1":"0",reflection:K.value?"1":"0",restrict:[""],ns_src:"",dest:re.value==="any"?"":re.value,reflection_zone:se.value.map(x=>x.id)};u&&(l.id=C.value),T.value==="address"?l.dest_ip=s.value:l.ns_dst=H.value,U.value==="address"?l.restrict=M.value.filter(x=>x!=""):l.ns_src=ee.value,await z("ns.redirects",o,l),R("add-edit-port-forward"),Oe()}}catch(o){c.value.notificationTitle=t(u?"error.cannot_edit_port_forward":"error.cannot_create_port_forward"),c.value.notificationDescription=t(A(o)),c.value.notificationDetails=o.toString()}finally{y.value=!1}}return(u,o)=>(b(),V(e(ft),{"is-shown":e(m),onClose:o[19]||(o[19]=l=>Oe()),closeAriaLabel:e(t)("common.shell.close_side_drawer"),title:C.value?e(t)("standalone.port_forward.edit_port_forward"):e(t)("standalone.port_forward.add_port_forward")},{default:i(()=>[c.value.notificationTitle||e(L).error?(b(),V(e(ge),{key:0,title:e(L).error?e(t)("error.cannot_retrieve_zones"):c.value.notificationTitle,description:e(L).error?e(t)(e(A)(e(L).error)):c.value.notificationDescription,class:"mb-6",kind:"error"},je({_:2},[c.value.notificationDetails?{name:"details",fn:i(()=>[f(p(c.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):S("",!0),k.value.listProtocolsAndZones||k.value.listObjectSuggestions||e(L).loading?(b(),V(e(Ne),{key:1,size:"lg",lines:10})):e(L).error?S("",!0):(b(),F("div",It,[j("div",null,[n(e(pt),null,{default:i(()=>[f(p(e(t)("standalone.port_forward.status")),1)]),_:1}),n(e(xe),{label:le.value?e(t)("standalone.port_forward.enabled"):e(t)("standalone.port_forward.disabled"),modelValue:le.value,"onUpdate:modelValue":o[0]||(o[0]=l=>le.value=l)},null,8,["label","modelValue"])]),n(e(de),{label:e(t)("standalone.port_forward.name"),modelValue:J.value,"onUpdate:modelValue":o[1]||(o[1]=l=>J.value=l),disabled:y.value,"invalid-message":d.value.getFirstFor("name"),ref_key:"nameRef",ref:oe},null,8,["label","modelValue","disabled","invalid-message"]),n(e(te),{label:e(t)("standalone.port_forward.protocols"),"helper-text":e(t)("standalone.port_forward.protocol_helper"),multiple:!0,options:B.value,modelValue:Y.value,"onUpdate:modelValue":o[2]||(o[2]=l=>Y.value=l),placeholder:e(t)("standalone.port_forward.choose_protocol"),"invalid-message":d.value.getFirstFor("protocols"),disabled:y.value,noResultsLabel:e(t)("ne_combobox.no_results"),limitedOptionsLabel:e(t)("ne_combobox.limited_options_label"),noOptionsLabel:e(t)("ne_combobox.no_options_label"),"selected-label":e(t)("ne_combobox.selected"),"user-input-label":e(t)("ne_combobox.user_input_label"),optionalLabel:e(t)("common.optional"),ref_key:"protocolsRef",ref:We},null,8,["label","helper-text","options","modelValue","placeholder","invalid-message","disabled","noResultsLabel","limitedOptionsLabel","noOptionsLabel","selected-label","user-input-label","optionalLabel"]),Q.value?(b(),V(e(ge),{key:0,kind:"info",title:e(t)("standalone.port_forward.any_protocol"),description:e(t)("standalone.port_forward.any_protocol_message")},null,8,["title","description"])):S("",!0),Q.value?S("",!0):(b(),V(e(de),{key:1,label:e(t)("standalone.port_forward.source_port"),modelValue:$.value,"onUpdate:modelValue":o[3]||(o[3]=l=>$.value=l),"invalid-message":d.value.getFirstFor("sourcePort"),optional:!0,disabled:y.value,optionalLabel:e(t)("common.optional"),"helper-text":e(t)("standalone.port_forward.source_destination_port_helper"),ref_key:"sourcePortRef",ref:fe},{tooltip:i(()=>[n(e(ae),null,{content:i(()=>[f(p(e(t)("standalone.port_forward.source_port_tooltip")),1)]),_:1})]),_:1},8,["label","modelValue","invalid-message","disabled","optionalLabel","helper-text"])),c.value.listObjectSuggestions?(b(),V(e(ge),{key:2,kind:"error",title:e(t)("error.cannot_retrieve_object_suggestions"),description:c.value.listObjectSuggestions},je({_:2},[c.value.listObjectSuggestionsDetails?{name:"details",fn:i(()=>[f(p(c.value.listObjectSuggestionsDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):S("",!0),n(e($e),{modelValue:T.value,"onUpdate:modelValue":o[4]||(o[4]=l=>T.value=l),label:e(t)("standalone.port_forward.destination_address_type"),options:He.value,disabled:y.value},{tooltip:i(()=>[n(e(ae),null,{content:i(()=>[f(p(e(t)("standalone.port_forward.destination_address_tooltip")),1)]),_:1})]),_:1},8,["modelValue","label","options","disabled"]),be(n(e(de),{label:e(t)("standalone.port_forward.destination_address"),modelValue:s.value,"onUpdate:modelValue":o[5]||(o[5]=l=>s.value=l),"invalid-message":d.value.getFirstFor("destinationIP"),disabled:y.value,ref_key:"destinationIpRef",ref:_},null,8,["label","modelValue","invalid-message","disabled"]),[[ve,T.value==="address"]]),be(n(e(te),{modelValue:H.value,"onUpdate:modelValue":o[6]||(o[6]=l=>H.value=l),disabled:y.value,label:e(t)("standalone.port_forward.destination_object"),options:Ge.value,"invalid-message":d.value.getFirstFor("destinationAddressObject"),placeholder:e(t)("ne_combobox.choose"),optionalLabel:e(t)("common.optional"),noResultsLabel:e(t)("ne_combobox.no_results"),limitedOptionsLabel:e(t)("ne_combobox.limited_options_label"),noOptionsLabel:e(t)("ne_combobox.no_options_label"),"selected-label":e(t)("ne_combobox.selected"),"user-input-label":e(t)("ne_combobox.user_input_label"),ref_key:"destinationObjectRef",ref:he},{tooltip:i(()=>[n(e(ae),null,{content:i(()=>[f(p(e(t)("standalone.port_forward.restricted_object_tooltip")),1)]),_:1})]),_:1},8,["modelValue","disabled","label","options","invalid-message","placeholder","optionalLabel","noResultsLabel","limitedOptionsLabel","noOptionsLabel","selected-label","user-input-label"]),[[ve,T.value==="object"]]),Q.value?S("",!0):(b(),V(e(de),{key:3,label:e(t)("standalone.port_forward.destination_port"),modelValue:O.value,"onUpdate:modelValue":o[7]||(o[7]=l=>O.value=l),"invalid-message":d.value.getFirstFor("destinationPort"),optional:!0,optionalLabel:e(t)("common.optional"),"helper-text":e(t)("standalone.port_forward.source_destination_port_helper"),disabled:y.value,ref_key:"destinationPortRef",ref:g},{tooltip:i(()=>[n(e(ae),null,{content:i(()=>[f(p(e(t)("standalone.port_forward.destination_port_tooltip")),1)]),_:1})]),_:1},8,["label","modelValue","invalid-message","optionalLabel","helper-text","disabled"])),n(e(_t),{label:e(t)("common.advanced_settings"),isExpanded:w.value,onSetExpanded:o[16]||(o[16]=l=>w.value=l)},{default:i(()=>[j("div",Ft,[n(e(te),{label:e(t)("standalone.port_forward.destination_zone"),placeholder:e(t)("standalone.port_forward.choose_zone"),options:ye.value,modelValue:re.value,"onUpdate:modelValue":o[8]||(o[8]=l=>re.value=l),disabled:y.value,noResultsLabel:e(t)("ne_combobox.no_results"),limitedOptionsLabel:e(t)("ne_combobox.limited_options_label"),noOptionsLabel:e(t)("ne_combobox.no_options_label"),"selected-label":e(t)("ne_combobox.selected"),"user-input-label":e(t)("ne_combobox.user_input_label"),optionalLabel:e(t)("common.optional"),ref_key:"destinationZoneRef",ref:Je},null,8,["label","placeholder","options","modelValue","disabled","noResultsLabel","limitedOptionsLabel","noOptionsLabel","selected-label","user-input-label","optionalLabel"]),n(e(te),{label:e(t)("standalone.port_forward.wan_ip"),options:_e.value,modelValue:P.value,"onUpdate:modelValue":o[9]||(o[9]=l=>P.value=l),disabled:y.value,noResultsLabel:e(t)("ne_combobox.no_results"),limitedOptionsLabel:e(t)("ne_combobox.limited_options_label"),noOptionsLabel:e(t)("ne_combobox.no_options_label"),"selected-label":e(t)("ne_combobox.selected"),"user-input-label":e(t)("ne_combobox.user_input_label"),optionalLabel:e(t)("common.optional"),ref_key:"wanRef",ref:qe},null,8,["label","options","modelValue","disabled","noResultsLabel","limitedOptionsLabel","noOptionsLabel","selected-label","user-input-label","optionalLabel"]),n(e($e),{modelValue:U.value,"onUpdate:modelValue":o[10]||(o[10]=l=>U.value=l),label:e(t)("standalone.port_forward.restrict_access_from"),options:Qe.value,disabled:y.value},{tooltip:i(()=>[n(e(ae),null,{content:i(()=>[f(p(e(t)("standalone.port_forward.restrict_access_from_tooltip")),1)]),_:1})]),_:1},8,["modelValue","label","options","disabled"]),be(n(xt,{title:e(t)("standalone.port_forward.restricted_addresses"),optional:!0,"optional-label":e(t)("common.optional"),"add-item-label":e(t)("standalone.port_forward.add_ip_address"),"invalid-messages":h.value,modelValue:M.value,"onUpdate:modelValue":o[11]||(o[11]=l=>M.value=l),disabled:y.value,onDeleteItem:et,ref_key:"restrictRef",ref:Ve},null,8,["title","optional-label","add-item-label","invalid-messages","modelValue","disabled"]),[[ve,U.value==="address"]]),be(n(e(te),{modelValue:ee.value,"onUpdate:modelValue":o[12]||(o[12]=l=>ee.value=l),optional:!0,disabled:y.value,label:e(t)("standalone.port_forward.restricted_object"),options:Xe.value,"invalid-message":d.value.getFirstFor("restrictObject"),placeholder:e(t)("ne_combobox.choose"),optionalLabel:e(t)("common.optional"),noResultsLabel:e(t)("ne_combobox.no_results"),limitedOptionsLabel:e(t)("ne_combobox.limited_options_label"),noOptionsLabel:e(t)("ne_combobox.no_options_label"),"selected-label":e(t)("ne_combobox.selected"),"user-input-label":e(t)("ne_combobox.user_input_label"),ref_key:"restrictObjectRef",ref:Ke},{tooltip:i(()=>[n(e(ae),null,{content:i(()=>[f(p(e(t)("standalone.port_forward.restricted_object_tooltip")),1)]),_:1})]),_:1},8,["modelValue","disabled","label","options","invalid-message","placeholder","optionalLabel","noResultsLabel","limitedOptionsLabel","noOptionsLabel","selected-label","user-input-label"]),[[ve,U.value==="object"]]),n(e(xe),{topLabel:e(t)("standalone.port_forward.log"),label:ne.value?e(t)("standalone.port_forward.enabled"):e(t)("standalone.port_forward.disabled"),modelValue:ne.value,"onUpdate:modelValue":o[13]||(o[13]=l=>ne.value=l),disabled:y.value},null,8,["topLabel","label","modelValue","disabled"]),n(e(xe),{topLabel:e(t)("standalone.port_forward.hairpin_nat"),label:K.value?e(t)("standalone.port_forward.enabled"):e(t)("standalone.port_forward.disabled"),modelValue:K.value,"onUpdate:modelValue":o[14]||(o[14]=l=>K.value=l),disabled:y.value},null,8,["topLabel","label","modelValue","disabled"]),K.value?(b(),V(e(te),{key:0,label:e(t)("standalone.port_forward.hairpin_nat_zones"),placeholder:e(t)("standalone.port_forward.choose_zone"),options:pe.value,modelValue:se.value,"onUpdate:modelValue":o[15]||(o[15]=l=>se.value=l),"invalid-message":d.value.getFirstFor("reflectionZones"),multiple:!0,noResultsLabel:e(t)("ne_combobox.no_results"),limitedOptionsLabel:e(t)("ne_combobox.limited_options_label"),noOptionsLabel:e(t)("ne_combobox.no_options_label"),"selected-label":e(t)("ne_combobox.selected"),"user-input-label":e(t)("ne_combobox.user_input_label"),optionalLabel:e(t)("common.optional"),ref_key:"reflectionZonesRef",ref:De},null,8,["label","placeholder","options","modelValue","invalid-message","noResultsLabel","limitedOptionsLabel","noOptionsLabel","selected-label","user-input-label","optionalLabel"])):S("",!0)])]),_:1},8,["label","isExpanded"]),o[20]||(o[20]=j("hr",null,null,-1)),j("div",Ct,[n(e(ue),{kind:"tertiary",class:"mr-4",onClick:o[17]||(o[17]=l=>Oe())},{default:i(()=>[f(p(e(t)("common.cancel")),1)]),_:1}),n(e(ue),{kind:"primary",onClick:o[18]||(o[18]=l=>ot()),disabled:y.value,loading:y.value},{default:i(()=>[f(p(C.value?e(t)("standalone.port_forward.save_port_forward"):e(t)("standalone.port_forward.add_port_forward")),1)]),_:1},8,["disabled","loading"])])]))]),_:1},8,["is-shown","closeAriaLabel","title"]))}}),Tt={class:"flex flex-col gap-y-6"},Ut={class:"flex flex-row items-center justify-between"},Et={class:"max-w-2xl text-sm font-normal text-gray-500 dark:text-gray-400"},At={class:"ml-2 shrink-0"},Kt=ke({__name:"PortForward",setup(ce){const{t:v}=Le(),a=wt(),t=r([]),L=r([]),D=r({listRedirects:!1,listObjectSuggestions:!1}),m=r({notificationTitle:"",notificationDescription:"",notificationDetails:"",listObjectSuggestions:"",listObjectSuggestionsDetails:""}),R=r({}),w=r(""),k=r(!1),y=r(!1),c=r(null),d=ie(()=>w.value==""?R.value:Object.fromEntries(Object.entries(R.value).map(([s,_])=>[s,_.filter(O=>O.name.includes(w.value)||O.source_port.includes(w.value)||O.destination_port.includes(w.value)||O.protocol.filter(g=>g.includes(w.value)).length>0||O.wan.includes(w.value)||O.dest_ip.includes(w.value)||O.restrict instanceof Array&&O.restrict.filter(g=>g.includes(w.value)).length>0)]).filter(([,s])=>s.length>0)));function h(){m.value={notificationTitle:"",notificationDescription:"",notificationDetails:"",listObjectSuggestions:"",listObjectSuggestionsDetails:""}}async function Z(){try{h(),D.value.listRedirects=!0;const s=await z("ns.redirects","list-redirects");R.value=s.data.redirects}catch(s){m.value.notificationTitle=v("error.generic_error"),m.value.notificationDescription=v(A(s)),m.value.notificationDetails=s.toString()}finally{D.value.listRedirects=!1}}function B(){a.getChanges(),Z(),pe()}async function pe(){D.value.listObjectSuggestions=!0;try{const s=await z("ns.redirects","list-object-suggestions");t.value=s.data.objects.ns_dst,L.value=s.data.objects.ns_src}catch(s){console.error(s),m.value.listObjectSuggestions=v(A(s)),m.value.listObjectSuggestionsDetails=s.toString()}finally{D.value.listObjectSuggestions=!1}}async function _e(s){try{h(),await z("ns.redirects",s.enabled?"disable-redirect":"enable-redirect",{id:s.id}),B()}catch(_){m.value.notificationTitle=v(s.enabled?"error.cannot_disable_port_forward":"error.cannot_enable_port_forward"),m.value.notificationDescription=v(A(_)),m.value.notificationDetails=_.toString()}}async function ye(s){try{h();let _={dest_ip:s.dest_ip,ns_dst:s.ns_dst||"",proto:s.protocol,src_dport:s.source_port,src_dip:s.wan==="any"?"":s.wan,dest_port:s.destination_port,name:`${s.name} (${v("standalone.port_forward.copy")})`,enabled:s.enabled?"1":"0",log:s.log?"1":"0",restrict:s.restrict,ns_src:s.ns_src||"",reflection:s.reflection?"1":"0",reflection_zone:s.reflection_zone,dest:s.dest};await z("ns.redirects","add-redirect",_),B()}catch(_){m.value.notificationTitle=v("error.cannot_duplicate_port_forward"),m.value.notificationDescription=v(A(_)),m.value.notificationDetails=_.toString()}}function C(s){c.value=s,k.value=!0}function J(){c.value=null,k.value=!1}function oe(s){c.value=s,y.value=!0}function $(){c.value=null,y.value=!1}function fe(s,_){const O=s[0];if(O.ns_dst){const g=t.value.find(P=>P.id===O.ns_dst);return g?`${g.name} (${_})`:_}else return _}return gt(()=>{B()}),(s,_)=>{const O=Be("font-awesome-icon");return b(),F(we,null,[n(e(yt),{tag:"h3",class:"mb-7"},{default:i(()=>[f(p(e(v)("standalone.port_forward.title")),1)]),_:1}),j("div",Tt,[j("div",Ut,[j("p",Et,p(e(v)("standalone.port_forward.description")),1),j("div",At,[Object.keys(R.value).length>0?(b(),V(e(ue),{key:0,kind:"secondary",onClick:_[0]||(_[0]=g=>C(null))},{prefix:i(()=>[n(O,{icon:["fas","circle-plus"],class:"h-4 w-4","aria-hidden":"true"})]),default:i(()=>[f(" "+p(e(v)("standalone.port_forward.add_port_forward")),1)]),_:1})):S("",!0)])]),n(e(de),{class:"max-w-xs",placeholder:e(v)("standalone.port_forward.filter"),modelValue:w.value,"onUpdate:modelValue":_[1]||(_[1]=g=>w.value=g)},null,8,["placeholder","modelValue"]),m.value.notificationDescription?(b(),V(e(ge),{key:0,kind:"error",title:m.value.notificationTitle,description:m.value.notificationDescription},je({_:2},[m.value.notificationDetails?{name:"details",fn:i(()=>[f(p(m.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):S("",!0),D.value.listRedirects||D.value.listObjectSuggestions?(b(),V(e(Ne),{key:1,lines:10,size:"lg"})):(b(),F(we,{key:2},[Object.keys(R.value).length==0?(b(),V(e(ze),{key:0,title:e(v)("standalone.port_forward.no_port_forward_found"),icon:["fas","circle-info"]},{default:i(()=>[n(e(ue),{kind:"primary",onClick:_[2]||(_[2]=g=>C(null))},{prefix:i(()=>[n(O,{icon:["fas","circle-plus"],class:"h-4 w-4","aria-hidden":"true"})]),default:i(()=>[f(p(e(v)("standalone.port_forward.add_port_forward")),1)]),_:1})]),_:1},8,["title"])):Object.keys(d.value).length==0?(b(),V(e(ze),{key:1,title:e(v)("standalone.port_forward.no_port_forward_found"),description:e(v)("standalone.port_forward.filter_change_suggestion"),icon:["fas","circle-info"]},null,8,["title","description"])):(b(!0),F(we,{key:2},Me(d.value,(g,P)=>(b(),V(Pt,{key:P,"port-forwards":g,header:fe(g,P),onPortForwardDelete:oe,onPortForwardDuplicate:ye,onPortForwardEdit:C,onPortForwardToggleEnable:_e},null,8,["port-forwards","header"]))),128))],64))]),n($t,{"is-shown":k.value,"initial-item":c.value,"destination-object-suggestions":t.value,"restrict-object-suggestions":L.value,onClose:_[3]||(_[3]=g=>J()),onAddEditPortForward:B},null,8,["is-shown","initial-item","destination-object-suggestions","restrict-object-suggestions"]),n(Vt,{visible:y.value,title:e(v)("standalone.port_forward.delete_port_forward"),deleteButtonLabel:e(v)("standalone.port_forward.delete_port_forward"),errorNotificationTitle:e(v)("error.cannot_delete_port_forward"),deleteFunction:()=>{var g;return e(z)("ns.redirects","delete-redirect",{id:(g=c.value)==null?void 0:g.id})},onClose:_[4]||(_[4]=g=>$()),onReloadData:B},{default:i(()=>{var g;return[f(p(e(v)("standalone.port_forward.delete_port_forward_message",{name:(g=c.value)==null?void 0:g.name})),1)]}),_:1},8,["visible","title","deleteButtonLabel","errorNotificationTitle","deleteFunction"])],64)}}});export{Kt as default};
