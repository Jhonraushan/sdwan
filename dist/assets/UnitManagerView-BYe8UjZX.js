import{d as ue,u as ce,d0 as fe,ac as $e,r as S,c as ae,J as me,i as D,w as h,l as e,d1 as Vt,V as oe,h as b,m as T,t as y,L as J,M as be,n as W,Y as _e,bm as ft,d2 as as,d3 as rs,d4 as jt,aI as ls,o as tt,cY as Ft,q as K,k as E,G as st,aK as is,ak as os,al as Ue,am as us,z as Q,ad as nt,aq as cs,an as ds,ao as Ae,j as R,s as ne,F as pe,_ as Z,H as vt,ah as ps,B as Be,d5 as fs,b8 as vs,C as ms,I as Qe,ap as Kt,cV as Gt,ay as Mt,T as de,y as Re,Q as Le,d6 as ve,aa as Xt,a0 as Bt,R as qe,ai as at,d7 as hs,bN as _s,e as ge,au as qt,ar as Wt,a1 as zt,b as gs,W as ys,d8 as we,P as bs,N as $s,a4 as mt,aj as ht}from"./index-BlEQ5104.js";import{u as Ve}from"./defaults-BLfb5pmS.js";import{u as Ht}from"./accounts-BDI0ezSF.js";import{j as Yt}from"./vue-datepicker-Cy0B1WeD.js";import"./index-D2UKjnCl.js";const Es=ue({__name:"RemoveUnitModal",props:{visible:{type:Boolean,required:!0},unit:{type:Object,default:null}},emits:["close","reloadData"],setup(a,{emit:n}){const t=a,l=n,{t:s}=ce(),c=fe(),u=$e();let $=S({removeUnit:!1}),r=S({notificationTitle:"",notificationDescription:"",notificationDetails:""});const i=ae(()=>{var v,_;return((v=t.unit)==null?void 0:v.info.unit_name)||((_=t.unit)==null?void 0:_.id)});me(()=>t.visible,()=>{t.visible&&(r.value.notificationTitle="",r.value.notificationDescription="",r.value.notificationDetails="")});async function d(){if(t.unit){r.value.notificationTitle="",r.value.notificationDescription="",r.value.notificationDetails="",$.value.removeUnit=!0;try{await c.removeUnit(t.unit.id),Vt(`unit-${t.unit.id}`),l("close"),l("reloadData"),setTimeout(()=>{u.createNotification({title:s("controller.units.unit_name_removed",{name:i.value}),kind:"success"})},500)}catch(v){console.error(v),r.value.notificationTitle=s("error.cannot_remove_unit"),r.value.notificationDescription=s(oe(v)),r.value.notificationDetails=v.toString()}finally{$.value.removeUnit=!1}}}return(v,_)=>(b(),D(e(_e),{visible:a.visible,title:e(s)("controller.units.remove_unit"),kind:"warning",primaryLabel:e(s)("controller.units.remove_unit"),cancelLabel:e(s)("common.cancel"),primaryButtonKind:"danger",primaryButtonDisabled:e($).removeUnit,primaryButtonLoading:e($).removeUnit,closeAriaLabel:e(s)("common.close"),onClose:_[0]||(_[0]=p=>l("close")),onPrimaryClick:d},{default:h(()=>[T(y(e(s)("controller.units.confirm_remove_unit",{name:i.value}))+" ",1),e(r).notificationTitle?(b(),D(e(J),{key:0,kind:"error",title:e(r).notificationTitle,description:e(r).notificationDescription,closeAriaLabel:e(s)("common.close"),class:"mt-4"},be({_:2},[e(r).notificationDetails?{name:"details",fn:h(()=>[T(y(e(r).notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description","closeAriaLabel"])):W("",!0)]),_:1},8,["visible","title","primaryLabel","cancelLabel","primaryButtonDisabled","primaryButtonLoading","closeAriaLabel"]))}});var et={exports:{}};const ks="2.0.0",Jt=256,ws=Number.MAX_SAFE_INTEGER||9007199254740991,Ss=16,Ls=Jt-6,Rs=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var je={MAX_LENGTH:Jt,MAX_SAFE_COMPONENT_LENGTH:Ss,MAX_SAFE_BUILD_LENGTH:Ls,MAX_SAFE_INTEGER:ws,RELEASE_TYPES:Rs,SEMVER_SPEC_VERSION:ks,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},We={};const Is=typeof process=="object"&&We&&We.NODE_DEBUG&&/\bsemver\b/i.test(We.NODE_DEBUG)?(...a)=>console.error("SEMVER",...a):()=>{};var Fe=Is;(function(a,n){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:l,MAX_LENGTH:s}=je,c=Fe;n=a.exports={};const u=n.re=[],$=n.safeRe=[],r=n.src=[],i=n.t={};let d=0;const v="[a-zA-Z0-9-]",_=[["\\s",1],["\\d",s],[v,l]],p=F=>{for(const[V,N]of _)F=F.split(`${V}*`).join(`${V}{0,${N}}`).split(`${V}+`).join(`${V}{1,${N}}`);return F},g=(F,V,N)=>{const w=p(V),C=d++;c(F,C,V),i[F]=C,r[C]=V,u[C]=new RegExp(V,N?"g":void 0),$[C]=new RegExp(w,N?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${v}*`),g("MAINVERSION",`(${r[i.NUMERICIDENTIFIER]})\\.(${r[i.NUMERICIDENTIFIER]})\\.(${r[i.NUMERICIDENTIFIER]})`),g("MAINVERSIONLOOSE",`(${r[i.NUMERICIDENTIFIERLOOSE]})\\.(${r[i.NUMERICIDENTIFIERLOOSE]})\\.(${r[i.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASEIDENTIFIER",`(?:${r[i.NUMERICIDENTIFIER]}|${r[i.NONNUMERICIDENTIFIER]})`),g("PRERELEASEIDENTIFIERLOOSE",`(?:${r[i.NUMERICIDENTIFIERLOOSE]}|${r[i.NONNUMERICIDENTIFIER]})`),g("PRERELEASE",`(?:-(${r[i.PRERELEASEIDENTIFIER]}(?:\\.${r[i.PRERELEASEIDENTIFIER]})*))`),g("PRERELEASELOOSE",`(?:-?(${r[i.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${r[i.PRERELEASEIDENTIFIERLOOSE]})*))`),g("BUILDIDENTIFIER",`${v}+`),g("BUILD",`(?:\\+(${r[i.BUILDIDENTIFIER]}(?:\\.${r[i.BUILDIDENTIFIER]})*))`),g("FULLPLAIN",`v?${r[i.MAINVERSION]}${r[i.PRERELEASE]}?${r[i.BUILD]}?`),g("FULL",`^${r[i.FULLPLAIN]}$`),g("LOOSEPLAIN",`[v=\\s]*${r[i.MAINVERSIONLOOSE]}${r[i.PRERELEASELOOSE]}?${r[i.BUILD]}?`),g("LOOSE",`^${r[i.LOOSEPLAIN]}$`),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE",`${r[i.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),g("XRANGEIDENTIFIER",`${r[i.NUMERICIDENTIFIER]}|x|X|\\*`),g("XRANGEPLAIN",`[v=\\s]*(${r[i.XRANGEIDENTIFIER]})(?:\\.(${r[i.XRANGEIDENTIFIER]})(?:\\.(${r[i.XRANGEIDENTIFIER]})(?:${r[i.PRERELEASE]})?${r[i.BUILD]}?)?)?`),g("XRANGEPLAINLOOSE",`[v=\\s]*(${r[i.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r[i.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r[i.XRANGEIDENTIFIERLOOSE]})(?:${r[i.PRERELEASELOOSE]})?${r[i.BUILD]}?)?)?`),g("XRANGE",`^${r[i.GTLT]}\\s*${r[i.XRANGEPLAIN]}$`),g("XRANGELOOSE",`^${r[i.GTLT]}\\s*${r[i.XRANGEPLAINLOOSE]}$`),g("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),g("COERCE",`${r[i.COERCEPLAIN]}(?:$|[^\\d])`),g("COERCEFULL",r[i.COERCEPLAIN]+`(?:${r[i.PRERELEASE]})?(?:${r[i.BUILD]})?(?:$|[^\\d])`),g("COERCERTL",r[i.COERCE],!0),g("COERCERTLFULL",r[i.COERCEFULL],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM",`(\\s*)${r[i.LONETILDE]}\\s+`,!0),n.tildeTrimReplace="$1~",g("TILDE",`^${r[i.LONETILDE]}${r[i.XRANGEPLAIN]}$`),g("TILDELOOSE",`^${r[i.LONETILDE]}${r[i.XRANGEPLAINLOOSE]}$`),g("LONECARET","(?:\\^)"),g("CARETTRIM",`(\\s*)${r[i.LONECARET]}\\s+`,!0),n.caretTrimReplace="$1^",g("CARET",`^${r[i.LONECARET]}${r[i.XRANGEPLAIN]}$`),g("CARETLOOSE",`^${r[i.LONECARET]}${r[i.XRANGEPLAINLOOSE]}$`),g("COMPARATORLOOSE",`^${r[i.GTLT]}\\s*(${r[i.LOOSEPLAIN]})$|^$`),g("COMPARATOR",`^${r[i.GTLT]}\\s*(${r[i.FULLPLAIN]})$|^$`),g("COMPARATORTRIM",`(\\s*)${r[i.GTLT]}\\s*(${r[i.LOOSEPLAIN]}|${r[i.XRANGEPLAIN]})`,!0),n.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE",`^\\s*(${r[i.XRANGEPLAIN]})\\s+-\\s+(${r[i.XRANGEPLAIN]})\\s*$`),g("HYPHENRANGELOOSE",`^\\s*(${r[i.XRANGEPLAINLOOSE]})\\s+-\\s+(${r[i.XRANGEPLAINLOOSE]})\\s*$`),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(et,et.exports);var Ie=et.exports;const Us=Object.freeze({loose:!0}),As=Object.freeze({}),Os=a=>a?typeof a!="object"?Us:a:As;var rt=Os;const _t=/^[0-9]+$/,Zt=(a,n)=>{const t=_t.test(a),l=_t.test(n);return t&&l&&(a=+a,n=+n),a===n?0:t&&!l?-1:l&&!t?1:a<n?-1:1},Ts=(a,n)=>Zt(n,a);var Qt={compareIdentifiers:Zt,rcompareIdentifiers:Ts};const Oe=Fe,{MAX_LENGTH:gt,MAX_SAFE_INTEGER:Te}=je,{safeRe:yt,t:bt}=Ie,Ns=rt,{compareIdentifiers:ye}=Qt;let xs=class ie{constructor(n,t){if(t=Ns(t),n instanceof ie){if(n.loose===!!t.loose&&n.includePrerelease===!!t.includePrerelease)return n;n=n.version}else if(typeof n!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof n}".`);if(n.length>gt)throw new TypeError(`version is longer than ${gt} characters`);Oe("SemVer",n,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const l=n.trim().match(t.loose?yt[bt.LOOSE]:yt[bt.FULL]);if(!l)throw new TypeError(`Invalid Version: ${n}`);if(this.raw=n,this.major=+l[1],this.minor=+l[2],this.patch=+l[3],this.major>Te||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Te||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Te||this.patch<0)throw new TypeError("Invalid patch version");l[4]?this.prerelease=l[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){const c=+s;if(c>=0&&c<Te)return c}return s}):this.prerelease=[],this.build=l[5]?l[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(n){if(Oe("SemVer.compare",this.version,this.options,n),!(n instanceof ie)){if(typeof n=="string"&&n===this.version)return 0;n=new ie(n,this.options)}return n.version===this.version?0:this.compareMain(n)||this.comparePre(n)}compareMain(n){return n instanceof ie||(n=new ie(n,this.options)),ye(this.major,n.major)||ye(this.minor,n.minor)||ye(this.patch,n.patch)}comparePre(n){if(n instanceof ie||(n=new ie(n,this.options)),this.prerelease.length&&!n.prerelease.length)return-1;if(!this.prerelease.length&&n.prerelease.length)return 1;if(!this.prerelease.length&&!n.prerelease.length)return 0;let t=0;do{const l=this.prerelease[t],s=n.prerelease[t];if(Oe("prerelease compare",t,l,s),l===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(l===void 0)return-1;if(l===s)continue;return ye(l,s)}while(++t)}compareBuild(n){n instanceof ie||(n=new ie(n,this.options));let t=0;do{const l=this.build[t],s=n.build[t];if(Oe("build compare",t,l,s),l===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(l===void 0)return-1;if(l===s)continue;return ye(l,s)}while(++t)}inc(n,t,l){switch(n){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,l);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,l);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,l),this.inc("pre",t,l);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,l),this.inc("pre",t,l);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const s=Number(l)?1:0;if(!t&&l===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[s];else{let c=this.prerelease.length;for(;--c>=0;)typeof this.prerelease[c]=="number"&&(this.prerelease[c]++,c=-2);if(c===-1){if(t===this.prerelease.join(".")&&l===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(t){let c=[t,s];l===!1&&(c=[t]),ye(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=c):this.prerelease=c}break}default:throw new Error(`invalid increment argument: ${n}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var te=xs;const $t=te,Cs=(a,n,t=!1)=>{if(a instanceof $t)return a;try{return new $t(a,n)}catch(l){if(!t)return null;throw l}};var Ee=Cs;const Ps=Ee,Ds=(a,n)=>{const t=Ps(a,n);return t?t.version:null};var Vs=Ds;const js=Ee,Fs=(a,n)=>{const t=js(a.trim().replace(/^[=v]+/,""),n);return t?t.version:null};var Ks=Fs;const Et=te,Gs=(a,n,t,l,s)=>{typeof t=="string"&&(s=l,l=t,t=void 0);try{return new Et(a instanceof Et?a.version:a,t).inc(n,l,s).version}catch{return null}};var Ms=Gs;const kt=Ee,Xs=(a,n)=>{const t=kt(a,null,!0),l=kt(n,null,!0),s=t.compare(l);if(s===0)return null;const c=s>0,u=c?t:l,$=c?l:t,r=!!u.prerelease.length;if(!!$.prerelease.length&&!r)return!$.patch&&!$.minor?"major":u.patch?"patch":u.minor?"minor":"major";const d=r?"pre":"";return t.major!==l.major?d+"major":t.minor!==l.minor?d+"minor":t.patch!==l.patch?d+"patch":"prerelease"};var Bs=Xs;const qs=te,Ws=(a,n)=>new qs(a,n).major;var zs=Ws;const Hs=te,Ys=(a,n)=>new Hs(a,n).minor;var Js=Ys;const Zs=te,Qs=(a,n)=>new Zs(a,n).patch;var en=Qs;const tn=Ee,sn=(a,n)=>{const t=tn(a,n);return t&&t.prerelease.length?t.prerelease:null};var nn=sn;const wt=te,an=(a,n,t)=>new wt(a,t).compare(new wt(n,t));var re=an;const rn=re,ln=(a,n,t)=>rn(n,a,t);var on=ln;const un=re,cn=(a,n)=>un(a,n,!0);var dn=cn;const St=te,pn=(a,n,t)=>{const l=new St(a,t),s=new St(n,t);return l.compare(s)||l.compareBuild(s)};var lt=pn;const fn=lt,vn=(a,n)=>a.sort((t,l)=>fn(t,l,n));var mn=vn;const hn=lt,_n=(a,n)=>a.sort((t,l)=>hn(l,t,n));var gn=_n;const yn=re,bn=(a,n,t)=>yn(a,n,t)>0;var Ke=bn;const $n=re,En=(a,n,t)=>$n(a,n,t)<0;var it=En;const kn=re,wn=(a,n,t)=>kn(a,n,t)===0;var es=wn;const Sn=re,Ln=(a,n,t)=>Sn(a,n,t)!==0;var ts=Ln;const Rn=re,In=(a,n,t)=>Rn(a,n,t)>=0;var ot=In;const Un=re,An=(a,n,t)=>Un(a,n,t)<=0;var ut=An;const On=es,Tn=ts,Nn=Ke,xn=ot,Cn=it,Pn=ut,Dn=(a,n,t,l)=>{switch(n){case"===":return typeof a=="object"&&(a=a.version),typeof t=="object"&&(t=t.version),a===t;case"!==":return typeof a=="object"&&(a=a.version),typeof t=="object"&&(t=t.version),a!==t;case"":case"=":case"==":return On(a,t,l);case"!=":return Tn(a,t,l);case">":return Nn(a,t,l);case">=":return xn(a,t,l);case"<":return Cn(a,t,l);case"<=":return Pn(a,t,l);default:throw new TypeError(`Invalid operator: ${n}`)}};var ss=Dn;const Vn=te,jn=Ee,{safeRe:Ne,t:xe}=Ie,Fn=(a,n)=>{if(a instanceof Vn)return a;if(typeof a=="number"&&(a=String(a)),typeof a!="string")return null;n=n||{};let t=null;if(!n.rtl)t=a.match(n.includePrerelease?Ne[xe.COERCEFULL]:Ne[xe.COERCE]);else{const r=n.includePrerelease?Ne[xe.COERCERTLFULL]:Ne[xe.COERCERTL];let i;for(;(i=r.exec(a))&&(!t||t.index+t[0].length!==a.length);)(!t||i.index+i[0].length!==t.index+t[0].length)&&(t=i),r.lastIndex=i.index+i[1].length+i[2].length;r.lastIndex=-1}if(t===null)return null;const l=t[2],s=t[3]||"0",c=t[4]||"0",u=n.includePrerelease&&t[5]?`-${t[5]}`:"",$=n.includePrerelease&&t[6]?`+${t[6]}`:"";return jn(`${l}.${s}.${c}${u}${$}`,n)};var Kn=Fn;class Gn{constructor(){this.max=1e3,this.map=new Map}get(n){const t=this.map.get(n);if(t!==void 0)return this.map.delete(n),this.map.set(n,t),t}delete(n){return this.map.delete(n)}set(n,t){if(!this.delete(n)&&t!==void 0){if(this.map.size>=this.max){const s=this.map.keys().next().value;this.delete(s)}this.map.set(n,t)}return this}}var Mn=Gn,ze,Lt;function le(){if(Lt)return ze;Lt=1;const a=/\s+/g;class n{constructor(f,L){if(L=s(L),f instanceof n)return f.loose===!!L.loose&&f.includePrerelease===!!L.includePrerelease?f:new n(f.raw,L);if(f instanceof c)return this.raw=f.value,this.set=[[f]],this.formatted=void 0,this;if(this.options=L,this.loose=!!L.loose,this.includePrerelease=!!L.includePrerelease,this.raw=f.trim().replace(a," "),this.set=this.raw.split("||").map(U=>this.parseRange(U.trim())).filter(U=>U.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const U=this.set[0];if(this.set=this.set.filter(P=>!F(P[0])),this.set.length===0)this.set=[U];else if(this.set.length>1){for(const P of this.set)if(P.length===1&&V(P[0])){this.set=[P];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let f=0;f<this.set.length;f++){f>0&&(this.formatted+="||");const L=this.set[f];for(let U=0;U<L.length;U++)U>0&&(this.formatted+=" "),this.formatted+=L[U].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(f){const U=((this.options.includePrerelease&&p)|(this.options.loose&&g))+":"+f,P=l.get(U);if(P)return P;const O=this.options.loose,j=O?r[i.HYPHENRANGELOOSE]:r[i.HYPHENRANGE];f=f.replace(j,k(this.options.includePrerelease)),u("hyphen replace",f),f=f.replace(r[i.COMPARATORTRIM],d),u("comparator trim",f),f=f.replace(r[i.TILDETRIM],v),u("tilde trim",f),f=f.replace(r[i.CARETTRIM],_),u("caret trim",f);let B=f.split(" ").map(Y=>w(Y,this.options)).join(" ").split(/\s+/).map(Y=>A(Y,this.options));O&&(B=B.filter(Y=>(u("loose invalid filter",Y,this.options),!!Y.match(r[i.COMPARATORLOOSE])))),u("range list",B);const M=new Map,H=B.map(Y=>new c(Y,this.options));for(const Y of H){if(F(Y))return[Y];M.set(Y.value,Y)}M.size>1&&M.has("")&&M.delete("");const se=[...M.values()];return l.set(U,se),se}intersects(f,L){if(!(f instanceof n))throw new TypeError("a Range is required");return this.set.some(U=>N(U,L)&&f.set.some(P=>N(P,L)&&U.every(O=>P.every(j=>O.intersects(j,L)))))}test(f){if(!f)return!1;if(typeof f=="string")try{f=new $(f,this.options)}catch{return!1}for(let L=0;L<this.set.length;L++)if(G(this.set[L],f,this.options))return!0;return!1}}ze=n;const t=Mn,l=new t,s=rt,c=Ge(),u=Fe,$=te,{safeRe:r,t:i,comparatorTrimReplace:d,tildeTrimReplace:v,caretTrimReplace:_}=Ie,{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:g}=je,F=o=>o.value==="<0.0.0-0",V=o=>o.value==="",N=(o,f)=>{let L=!0;const U=o.slice();let P=U.pop();for(;L&&U.length;)L=U.every(O=>P.intersects(O,f)),P=U.pop();return L},w=(o,f)=>(u("comp",o,f),o=q(o,f),u("caret",o),o=z(o,f),u("tildes",o),o=x(o,f),u("xrange",o),o=m(o,f),u("stars",o),o),C=o=>!o||o.toLowerCase()==="x"||o==="*",z=(o,f)=>o.trim().split(/\s+/).map(L=>ee(L,f)).join(" "),ee=(o,f)=>{const L=f.loose?r[i.TILDELOOSE]:r[i.TILDE];return o.replace(L,(U,P,O,j,B)=>{u("tilde",o,U,P,O,j,B);let M;return C(P)?M="":C(O)?M=`>=${P}.0.0 <${+P+1}.0.0-0`:C(j)?M=`>=${P}.${O}.0 <${P}.${+O+1}.0-0`:B?(u("replaceTilde pr",B),M=`>=${P}.${O}.${j}-${B} <${P}.${+O+1}.0-0`):M=`>=${P}.${O}.${j} <${P}.${+O+1}.0-0`,u("tilde return",M),M})},q=(o,f)=>o.trim().split(/\s+/).map(L=>X(L,f)).join(" "),X=(o,f)=>{u("caret",o,f);const L=f.loose?r[i.CARETLOOSE]:r[i.CARET],U=f.includePrerelease?"-0":"";return o.replace(L,(P,O,j,B,M)=>{u("caret",o,P,O,j,B,M);let H;return C(O)?H="":C(j)?H=`>=${O}.0.0${U} <${+O+1}.0.0-0`:C(B)?O==="0"?H=`>=${O}.${j}.0${U} <${O}.${+j+1}.0-0`:H=`>=${O}.${j}.0${U} <${+O+1}.0.0-0`:M?(u("replaceCaret pr",M),O==="0"?j==="0"?H=`>=${O}.${j}.${B}-${M} <${O}.${j}.${+B+1}-0`:H=`>=${O}.${j}.${B}-${M} <${O}.${+j+1}.0-0`:H=`>=${O}.${j}.${B}-${M} <${+O+1}.0.0-0`):(u("no pr"),O==="0"?j==="0"?H=`>=${O}.${j}.${B}${U} <${O}.${j}.${+B+1}-0`:H=`>=${O}.${j}.${B}${U} <${O}.${+j+1}.0-0`:H=`>=${O}.${j}.${B} <${+O+1}.0.0-0`),u("caret return",H),H})},x=(o,f)=>(u("replaceXRanges",o,f),o.split(/\s+/).map(L=>I(L,f)).join(" ")),I=(o,f)=>{o=o.trim();const L=f.loose?r[i.XRANGELOOSE]:r[i.XRANGE];return o.replace(L,(U,P,O,j,B,M)=>{u("xRange",o,U,P,O,j,B,M);const H=C(O),se=H||C(j),Y=se||C(B),ke=Y;return P==="="&&ke&&(P=""),M=f.includePrerelease?"-0":"",H?P===">"||P==="<"?U="<0.0.0-0":U="*":P&&ke?(se&&(j=0),B=0,P===">"?(P=">=",se?(O=+O+1,j=0,B=0):(j=+j+1,B=0)):P==="<="&&(P="<",se?O=+O+1:j=+j+1),P==="<"&&(M="-0"),U=`${P+O}.${j}.${B}${M}`):se?U=`>=${O}.0.0${M} <${+O+1}.0.0-0`:Y&&(U=`>=${O}.${j}.0${M} <${O}.${+j+1}.0-0`),u("xRange return",U),U})},m=(o,f)=>(u("replaceStars",o,f),o.trim().replace(r[i.STAR],"")),A=(o,f)=>(u("replaceGTE0",o,f),o.trim().replace(r[f.includePrerelease?i.GTE0PRE:i.GTE0],"")),k=o=>(f,L,U,P,O,j,B,M,H,se,Y,ke)=>(C(U)?L="":C(P)?L=`>=${U}.0.0${o?"-0":""}`:C(O)?L=`>=${U}.${P}.0${o?"-0":""}`:j?L=`>=${L}`:L=`>=${L}${o?"-0":""}`,C(H)?M="":C(se)?M=`<${+H+1}.0.0-0`:C(Y)?M=`<${H}.${+se+1}.0-0`:ke?M=`<=${H}.${se}.${Y}-${ke}`:o?M=`<${H}.${se}.${+Y+1}-0`:M=`<=${M}`,`${L} ${M}`.trim()),G=(o,f,L)=>{for(let U=0;U<o.length;U++)if(!o[U].test(f))return!1;if(f.prerelease.length&&!L.includePrerelease){for(let U=0;U<o.length;U++)if(u(o[U].semver),o[U].semver!==c.ANY&&o[U].semver.prerelease.length>0){const P=o[U].semver;if(P.major===f.major&&P.minor===f.minor&&P.patch===f.patch)return!0}return!1}return!0};return ze}var He,Rt;function Ge(){if(Rt)return He;Rt=1;const a=Symbol("SemVer ANY");class n{static get ANY(){return a}constructor(d,v){if(v=t(v),d instanceof n){if(d.loose===!!v.loose)return d;d=d.value}d=d.trim().split(/\s+/).join(" "),u("comparator",d,v),this.options=v,this.loose=!!v.loose,this.parse(d),this.semver===a?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(d){const v=this.options.loose?l[s.COMPARATORLOOSE]:l[s.COMPARATOR],_=d.match(v);if(!_)throw new TypeError(`Invalid comparator: ${d}`);this.operator=_[1]!==void 0?_[1]:"",this.operator==="="&&(this.operator=""),_[2]?this.semver=new $(_[2],this.options.loose):this.semver=a}toString(){return this.value}test(d){if(u("Comparator.test",d,this.options.loose),this.semver===a||d===a)return!0;if(typeof d=="string")try{d=new $(d,this.options)}catch{return!1}return c(d,this.operator,this.semver,this.options)}intersects(d,v){if(!(d instanceof n))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new r(d.value,v).test(this.value):d.operator===""?d.value===""?!0:new r(this.value,v).test(d.semver):(v=t(v),v.includePrerelease&&(this.value==="<0.0.0-0"||d.value==="<0.0.0-0")||!v.includePrerelease&&(this.value.startsWith("<0.0.0")||d.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&d.operator.startsWith(">")||this.operator.startsWith("<")&&d.operator.startsWith("<")||this.semver.version===d.semver.version&&this.operator.includes("=")&&d.operator.includes("=")||c(this.semver,"<",d.semver,v)&&this.operator.startsWith(">")&&d.operator.startsWith("<")||c(this.semver,">",d.semver,v)&&this.operator.startsWith("<")&&d.operator.startsWith(">")))}}He=n;const t=rt,{safeRe:l,t:s}=Ie,c=ss,u=Fe,$=te,r=le();return He}const Xn=le(),Bn=(a,n,t)=>{try{n=new Xn(n,t)}catch{return!1}return n.test(a)};var Me=Bn;const qn=le(),Wn=(a,n)=>new qn(a,n).set.map(t=>t.map(l=>l.value).join(" ").trim().split(" "));var zn=Wn;const Hn=te,Yn=le(),Jn=(a,n,t)=>{let l=null,s=null,c=null;try{c=new Yn(n,t)}catch{return null}return a.forEach(u=>{c.test(u)&&(!l||s.compare(u)===-1)&&(l=u,s=new Hn(l,t))}),l};var Zn=Jn;const Qn=te,ea=le(),ta=(a,n,t)=>{let l=null,s=null,c=null;try{c=new ea(n,t)}catch{return null}return a.forEach(u=>{c.test(u)&&(!l||s.compare(u)===1)&&(l=u,s=new Qn(l,t))}),l};var sa=ta;const Ye=te,na=le(),It=Ke,aa=(a,n)=>{a=new na(a,n);let t=new Ye("0.0.0");if(a.test(t)||(t=new Ye("0.0.0-0"),a.test(t)))return t;t=null;for(let l=0;l<a.set.length;++l){const s=a.set[l];let c=null;s.forEach(u=>{const $=new Ye(u.semver.version);switch(u.operator){case">":$.prerelease.length===0?$.patch++:$.prerelease.push(0),$.raw=$.format();case"":case">=":(!c||It($,c))&&(c=$);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${u.operator}`)}}),c&&(!t||It(t,c))&&(t=c)}return t&&a.test(t)?t:null};var ra=aa;const la=le(),ia=(a,n)=>{try{return new la(a,n).range||"*"}catch{return null}};var oa=ia;const ua=te,ns=Ge(),{ANY:ca}=ns,da=le(),pa=Me,Ut=Ke,At=it,fa=ut,va=ot,ma=(a,n,t,l)=>{a=new ua(a,l),n=new da(n,l);let s,c,u,$,r;switch(t){case">":s=Ut,c=fa,u=At,$=">",r=">=";break;case"<":s=At,c=va,u=Ut,$="<",r="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(pa(a,n,l))return!1;for(let i=0;i<n.set.length;++i){const d=n.set[i];let v=null,_=null;if(d.forEach(p=>{p.semver===ca&&(p=new ns(">=0.0.0")),v=v||p,_=_||p,s(p.semver,v.semver,l)?v=p:u(p.semver,_.semver,l)&&(_=p)}),v.operator===$||v.operator===r||(!_.operator||_.operator===$)&&c(a,_.semver))return!1;if(_.operator===r&&u(a,_.semver))return!1}return!0};var ct=ma;const ha=ct,_a=(a,n,t)=>ha(a,n,">",t);var ga=_a;const ya=ct,ba=(a,n,t)=>ya(a,n,"<",t);var $a=ba;const Ot=le(),Ea=(a,n,t)=>(a=new Ot(a,t),n=new Ot(n,t),a.intersects(n,t));var ka=Ea;const wa=Me,Sa=re;var La=(a,n,t)=>{const l=[];let s=null,c=null;const u=a.sort((d,v)=>Sa(d,v,t));for(const d of u)wa(d,n,t)?(c=d,s||(s=d)):(c&&l.push([s,c]),c=null,s=null);s&&l.push([s,null]);const $=[];for(const[d,v]of l)d===v?$.push(d):!v&&d===u[0]?$.push("*"):v?d===u[0]?$.push(`<=${v}`):$.push(`${d} - ${v}`):$.push(`>=${d}`);const r=$.join(" || "),i=typeof n.raw=="string"?n.raw:String(n);return r.length<i.length?r:n};const Tt=le(),dt=Ge(),{ANY:Je}=dt,Se=Me,pt=re,Ra=(a,n,t={})=>{if(a===n)return!0;a=new Tt(a,t),n=new Tt(n,t);let l=!1;e:for(const s of a.set){for(const c of n.set){const u=Ua(s,c,t);if(l=l||u!==null,u)continue e}if(l)return!1}return!0},Ia=[new dt(">=0.0.0-0")],Nt=[new dt(">=0.0.0")],Ua=(a,n,t)=>{if(a===n)return!0;if(a.length===1&&a[0].semver===Je){if(n.length===1&&n[0].semver===Je)return!0;t.includePrerelease?a=Ia:a=Nt}if(n.length===1&&n[0].semver===Je){if(t.includePrerelease)return!0;n=Nt}const l=new Set;let s,c;for(const p of a)p.operator===">"||p.operator===">="?s=xt(s,p,t):p.operator==="<"||p.operator==="<="?c=Ct(c,p,t):l.add(p.semver);if(l.size>1)return null;let u;if(s&&c){if(u=pt(s.semver,c.semver,t),u>0)return null;if(u===0&&(s.operator!==">="||c.operator!=="<="))return null}for(const p of l){if(s&&!Se(p,String(s),t)||c&&!Se(p,String(c),t))return null;for(const g of n)if(!Se(p,String(g),t))return!1;return!0}let $,r,i,d,v=c&&!t.includePrerelease&&c.semver.prerelease.length?c.semver:!1,_=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1;v&&v.prerelease.length===1&&c.operator==="<"&&v.prerelease[0]===0&&(v=!1);for(const p of n){if(d=d||p.operator===">"||p.operator===">=",i=i||p.operator==="<"||p.operator==="<=",s){if(_&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===_.major&&p.semver.minor===_.minor&&p.semver.patch===_.patch&&(_=!1),p.operator===">"||p.operator===">="){if($=xt(s,p,t),$===p&&$!==s)return!1}else if(s.operator===">="&&!Se(s.semver,String(p),t))return!1}if(c){if(v&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===v.major&&p.semver.minor===v.minor&&p.semver.patch===v.patch&&(v=!1),p.operator==="<"||p.operator==="<="){if(r=Ct(c,p,t),r===p&&r!==c)return!1}else if(c.operator==="<="&&!Se(c.semver,String(p),t))return!1}if(!p.operator&&(c||s)&&u!==0)return!1}return!(s&&i&&!c&&u!==0||c&&d&&!s&&u!==0||_||v)},xt=(a,n,t)=>{if(!a)return n;const l=pt(a.semver,n.semver,t);return l>0?a:l<0||n.operator===">"&&a.operator===">="?n:a},Ct=(a,n,t)=>{if(!a)return n;const l=pt(a.semver,n.semver,t);return l<0?a:l>0||n.operator==="<"&&a.operator==="<="?n:a};var Aa=Ra;const Ze=Ie,Pt=je,Oa=te,Dt=Qt,Ta=Ee,Na=Vs,xa=Ks,Ca=Ms,Pa=Bs,Da=zs,Va=Js,ja=en,Fa=nn,Ka=re,Ga=on,Ma=dn,Xa=lt,Ba=mn,qa=gn,Wa=Ke,za=it,Ha=es,Ya=ts,Ja=ot,Za=ut,Qa=ss,er=Kn,tr=Ge(),sr=le(),nr=Me,ar=zn,rr=Zn,lr=sa,ir=ra,or=oa,ur=ct,cr=ga,dr=$a,pr=ka,fr=La,vr=Aa;var Ce={parse:Ta,valid:Na,clean:xa,inc:Ca,diff:Pa,major:Da,minor:Va,patch:ja,prerelease:Fa,compare:Ka,rcompare:Ga,compareLoose:Ma,compareBuild:Xa,sort:Ba,rsort:qa,gt:Wa,lt:za,eq:Ha,neq:Ya,gte:Ja,lte:Za,cmp:Qa,coerce:er,Comparator:tr,Range:sr,satisfies:nr,toComparators:ar,maxSatisfying:rr,minSatisfying:lr,minVersion:ir,validRange:or,outside:ur,gtr:cr,ltr:dr,intersects:pr,simplifyRange:fr,subset:vr,SemVer:Oa,re:Ze.re,src:Ze.src,tokens:Ze.t,SEMVER_SPEC_VERSION:Pt.SEMVER_SPEC_VERSION,RELEASE_TYPES:Pt.RELEASE_TYPES,compareIdentifiers:Dt.compareIdentifiers,rcompareIdentifiers:Dt.rcompareIdentifiers};const mr={class:"space-y-1"},hr={key:0,class:"flex items-center gap-2"},_r={key:0},gr={class:"space-y-1 px-2 py-1"},yr={class:"mr-2 inline-block font-semibold"},br={class:"text-gray-300 dark:text-gray-600"},$r={class:"mr-2 inline-block font-semibold"},Er={class:"text-gray-300 dark:text-gray-600"},kr={key:0},wr={class:"mr-2 inline-block font-semibold"},Sr={class:"text-gray-300 dark:text-gray-600"},Lr={key:1},Rr={class:"mr-2 inline-block font-semibold"},Ir={class:"text-gray-300 dark:text-gray-600"},Ur={key:2},Ar={class:"mr-2 inline-block font-semibold"},Or={class:"text-gray-300 dark:text-gray-600"},Tr={key:3},Nr={class:"mr-2 inline-block font-semibold"},xr={class:"text-gray-300 dark:text-gray-600"},Cr={key:4},Pr={class:"mr-2 inline-block font-semibold"},Dr={class:"text-gray-300 dark:text-gray-600"},Vr={class:"flex items-center gap-2"},jr={key:0,class:"flex flex-wrap items-center gap-2"},Fr={key:1,class:"space-x-2"},Kr={class:"-ml-2.5 flex items-center gap-2 xl:ml-0 xl:justify-end"},Gr=ue({__name:"UnitsTable",props:{filteredUnits:{type:Object,required:!0}},emits:["reloadData","openSshModal","scheduleUpdate","abortUpdate","upgradeUnitPackages"],setup(a,{emit:n}){const t=a;ft.add(as),ft.add(rs);const l=n,{t:s}=ce(),c=fe(),u=Ve(),$=jt(),r=S(10),{currentPage:i,paginatedItems:d}=ls(()=>t.filteredUnits,{itemsPerPage:r}),v=S(!1),_=S(),p=S(!1),g=S(!1),F=S(!1),V=S(!1);let N=S({openUnit:""});tt(()=>{v.value=Ft("hideOpenUnitPopupsTooltip",$.username)});async function w(k,G=!0){var o;N.value.openUnit="",_.value=k,g.value=!0;try{await c.getUnitInfo(_.value.id),await c.getUnits(),_.value=c.units.find(L=>L.id==k.id);let f=Ce.coerce((o=_.value)==null?void 0:o.info.api_version);if(f==null&&(f=Ce.coerce("0.0.0")),G&&!Ce.satisfies(f,"~3.0.0"))Ce.outside(f,"~3.0.0",">")?V.value=!0:F.value=!0;else{await c.checkUnitToken(k.id);const L=st.resolve({path:`/controller/manage/${k.id}/dashboard`});window.open(L.href,"_blank"),V.value=!1}}catch(f){console.error(f),N.value.openUnit=s(oe(f))}finally{g.value=!1}}function C(k){var o;const G=[];return k.registered?G.push({id:"openMetrics",label:s("controller.units.open_metrics"),icon:"arrow-up-right-from-square",iconStyle:"fas",action:()=>q(k)},{id:"openLogs",label:s("controller.units.open_logs"),icon:"arrow-up-right-from-square",iconStyle:"fas",action:()=>X(k),disabled:!k.info.fqdn},{id:"openSsh",label:s("controller.units.open_ssh_terminal"),icon:"terminal",iconStyle:"fas",action:()=>l("openSshModal",k),disabled:!k.connected}):G.push({id:"copyJoinCode",label:s("controller.units.copy_join_code"),icon:"copy",iconStyle:"fas",action:()=>ee(k)}),(((o=k.info)==null?void 0:o.version_update)??!1)&&G.push({id:"scheduleUpdate",label:k.info.scheduled_update>0?s("controller.units.edit_scheduled_image_update"):s("standalone.update.update_system"),icon:k.info.scheduled_update>0?"pen-to-square":"circle-arrow-up",iconStyle:"fas",action:()=>l("scheduleUpdate",k),disabled:!k.connected||c.unitUpgradingImage.find(f=>f==k.id)}),k.info.scheduled_update>0&&G.push({id:"cancelScheduledUpdate",label:s("controller.units.cancel_scheduled_image_update"),icon:"circle-xmark",iconStyle:"fas",action:()=>l("abortUpdate",k),disabled:!k.connected}),G.push({id:"upgradeUnitPackages",label:s("controller.units.check_packages_updates"),icon:"arrows-rotate",iconStyle:"fas",action:()=>l("upgradeUnitPackages",k),disabled:!k.connected||c.unitUpdatingPackages.find(f=>f==k.id)},{id:"refreshUnitInfo",label:s("controller.units.sync_unit_info"),icon:"cloud-arrow-up",iconStyle:"fas",action:()=>z(k),disabled:!k.connected},{id:"divider1"},{id:"removeUnit",label:s("controller.units.remove_unit"),icon:"trash",iconStyle:"fas",action:()=>m(k),danger:!0}),G}async function z(k){await c.getUnitInfo(k.id),l("reloadData")}function ee(k){k.join_code&&navigator.clipboard.writeText(k.join_code)}function q(k){window.open(`https://${u.fqdn}${u.grafanaPath}/d/W3S__804z/unit-metrics?var-unit=${k.id}`)}function X(k){const G=k.info.fqdn;G&&window.open(`https://${u.fqdn}${u.grafanaPath}/d/liz0yRCZz/logs?var-hostname=${G}&var-level=error`)}function x(){v.value=!0,Gt("hideOpenUnitPopupsTooltip",!0,$.username)}function I(k){switch(k){case"community":return s("controller.units.subscription_community");case"enterprise":return s("controller.units.subscription_enterprise");default:return s("controller.units.subscription_none")}}async function m(k){k.registered?A(k):(await c.removeUnit(k.id),Vt(`unit-${k.id}`),l("reloadData"))}function A(k){_.value=k,p.value=!0}return(k,G)=>(b(),K("div",null,[e(N).openUnit?(b(),D(e(J),{key:0,kind:"error",title:e(s)("error.cannot_open_unit"),description:e(N).openUnit,closeAriaLabel:e(s)("common.close"),class:"mb-6"},null,8,["title","description","closeAriaLabel"])):W("",!0),E(e(cs),{ariaLabel:e(s)("controller.units.units"),cardBreakpoint:"xl"},{paginator:h(()=>[E(e(is),{"current-page":e(i),"total-rows":t.filteredUnits.length,"page-size":r.value,"nav-pagination-label":e(s)("ne_table.pagination"),"next-label":e(s)("ne_table.go_to_next_page"),"previous-label":e(s)("ne_table.go_to_previous_page"),"range-of-total-label":e(s)("ne_table.of"),"page-size-label":e(s)("ne_table.show"),onSelectPage:G[0]||(G[0]=o=>{i.value=o}),onSelectPageSize:G[1]||(G[1]=o=>{r.value=o})},null,8,["current-page","total-rows","page-size","nav-pagination-label","next-label","previous-label","range-of-total-label","page-size-label"])]),default:h(()=>[E(e(os),null,{default:h(()=>[E(e(Ue),null,{default:h(()=>[T(y(e(s)("controller.units.unit_name")),1)]),_:1}),E(e(Ue),null,{default:h(()=>[T(y(e(s)("controller.units.status")),1)]),_:1}),E(e(Ue),null,{default:h(()=>[T(y(e(s)("controller.units.installed_version")),1)]),_:1}),E(e(Ue))]),_:1}),E(e(us),null,{default:h(()=>[(b(!0),K(Q,null,nt(e(d),o=>(b(),D(e(ds),{key:o.name},{default:h(()=>[E(e(Ae),{"data-label":e(s)("controller.units.unit_name")},{default:h(()=>[R("div",mr,[R("div",null,[o.info.unit_name?(b(),K("div",hr,[E(e(ne),{interactive:""},{trigger:h(()=>[E(e(pe),{icon:["fas",o.info.subscription_type==="enterprise"?"award":"users"],class:"h-4 w-4","aria-hidden":"true"},null,8,["icon"])]),content:h(()=>[T(y(I(o.info.subscription_type)),1)]),_:2},1024),T(" "+y(o.info.unit_name),1)])):(b(),K(Q,{key:1},[T(y(o.id||"-"),1)],64))]),o.registered?(b(),K("div",_r,[E(e(ne),{interactive:"",maxWidth:450},{trigger:h(()=>[E(e(Z),{size:"sm",kind:"tertiary",class:"-mx-2"},{default:h(()=>[T(y(e(s)("common.more_info")),1)]),_:1})]),content:h(()=>[R("div",gr,[R("div",null,[R("span",yr,y(e(s)("controller.units.hostname"))+": ",1),R("span",br,y(o.info.fqdn||"-"),1)]),R("div",null,[R("span",$r,y(e(s)("controller.units.unit_id"))+": ",1),R("span",Er,y(o.id),1)]),o.vpn.bytes_rcvd?(b(),K("div",kr,[R("span",wr,y(e(s)("controller.units.data_received"))+": ",1),R("span",Sr,y(e(vt)(o.vpn.bytes_rcvd)),1)])):W("",!0),o.vpn.bytes_sent?(b(),K("div",Lr,[R("span",Rr,y(e(s)("controller.units.data_sent"))+": ",1),R("span",Ir,y(e(vt)(o.vpn.bytes_sent)),1)])):W("",!0),o.vpn.connected_since?(b(),K("div",Ur,[R("span",Ar,y(e(s)("controller.units.connected_since"))+": ",1),R("span",Or,y(e(ps)(new Date(Number(o.vpn.connected_since)*1e3),"PPpp")||"-"),1)])):W("",!0),o.vpn.real_address?(b(),K("div",Tr,[R("span",Nr,y(e(s)("controller.units.real_address"))+": ",1),R("span",xr,y(o.vpn.real_address||"-"),1)])):W("",!0),o.vpn.virtual_address?(b(),K("div",Cr,[R("span",Pr,y(e(s)("controller.units.virtual_address"))+": ",1),R("span",Dr,y(o.vpn.virtual_address||"-"),1)])):W("",!0)])]),_:2},1024)])):W("",!0)])]),_:2},1032,["data-label"]),E(e(Ae),{"data-label":e(s)("controller.units.status")},{default:h(()=>[R("div",Vr,[o.connected?(b(),K(Q,{key:0},[E(e(pe),{icon:["fas","circle-check"],class:"h-4 w-4 text-green-700 dark:text-green-500","aria-hidden":"true"}),R("span",null,y(e(s)("controller.units.connected")),1)],64)):o.registered?(b(),K(Q,{key:1},[E(e(pe),{icon:["fas","circle-xmark"],class:"h-4 w-4","aria-hidden":"true"}),R("span",null,y(e(s)("controller.units.not_connected")),1)],64)):(b(),K(Q,{key:2},[E(e(pe),{icon:["fas","circle-xmark"],class:"h-4 w-4","aria-hidden":"true"}),R("span",null,y(e(s)("controller.units.not_registered_yet")),1)],64))])]),_:2},1032,["data-label"]),E(e(Ae),{"data-label":e(s)("controller.units.installed_version")},{default:h(()=>[o.info.version?(b(),K("span",jr,[R("span",null,y(o.info.version),1),o.connected?(b(),K(Q,{key:0},[e(c).unitUpgradingImage.find(f=>f==o.id)?(b(),D(e(ne),{key:0},{trigger:h(()=>[E(e(Be),{icon:e(fs),text:e(s)("controller.units.updating_image"),clickable:"",kind:"info"},null,8,["icon","text"])]),content:h(()=>[R("div",null,y(e(s)("controller.units.updating_image_description")),1)]),_:1})):o.info.scheduled_update>0?(b(),D(e(ne),{key:1},{trigger:h(()=>[E(e(Be),{icon:e(vs),text:e(s)("controller.units.scheduled_image_update"),clickable:"",kind:"info"},null,8,["icon","text"])]),content:h(()=>[R("div",null,y(e(s)("controller.units.scheduled_image_update_tooltip",{version:o.info.version_update,date:new Date(o.info.scheduled_update*1e3).toLocaleString()})),1)]),_:2},1024)):o.info.version_update?(b(),D(e(ne),{key:2},{trigger:h(()=>[E(e(Be),{icon:e(ms),text:e(s)("controller.units.image_update_available"),clickable:"",kind:"warning"},null,8,["icon","text"])]),content:h(()=>[R("div",null,y(e(s)("controller.units.image_update_available_tooltip",{version:o.info.version_update})),1)]),_:2},1024)):W("",!0)],64)):W("",!0)])):o.connected?(b(),K("div",Fr,[R("span",null,y(e(s)("controller.units.syncing_data")),1),E(e(ne),null,{content:h(()=>[T(y(e(s)("controller.units.syncing_data_description")),1)]),_:1})])):(b(),K(Q,{key:2},[T("-")],64))]),_:2},1032,["data-label"]),E(e(Ae),{"data-label":e(s)("common.actions")},{default:h(()=>{var f,L;return[R("div",Kr,[o.connected?(b(),K(Q,{key:0},[v.value?(b(),D(e(Z),{key:0,disabled:g.value&&((f=_.value)==null?void 0:f.id)==o.id,loading:g.value&&((L=_.value)==null?void 0:L.id)==o.id,kind:"tertiary",onClick:U=>w(o),class:"shrink-0"},{prefix:h(()=>[E(e(pe),{icon:["fas","arrow-up-right-from-square"],class:"h-4 w-4","aria-hidden":"true"})]),default:h(()=>[T(" "+y(e(s)("controller.units.open_unit")),1)]),_:2},1032,["disabled","loading","onClick"])):(b(),D(e(ne),{key:1,triggerEvent:"mouseenter focus",placement:"top-end",class:"shrink-0"},{trigger:h(()=>[E(e(Z),{kind:"tertiary",onClick:U=>w(o)},{prefix:h(()=>[E(e(pe),{icon:["fas","arrow-up-right-from-square"],class:"h-3.5 w-3.5","aria-hidden":"true"})]),default:h(()=>[T(" "+y(e(s)("controller.units.open_unit")),1)]),_:2},1032,["onClick"])]),content:h(()=>[R("div",null,y(e(s)("controller.units.open_unit_tooltip")),1),E(e(Qe),{invertedTheme:"",onClick:x},{default:h(()=>[T(y(e(s)("common.dont_show_again")),1)]),_:1})]),_:2},1024))],64)):W("",!0),E(e(Kt),{items:C(o),alignToRight:!0},null,8,["items"])])]}),_:2},1032,["data-label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["ariaLabel"]),E(Es,{visible:p.value,unit:_.value,onClose:G[2]||(G[2]=o=>p.value=!1),onReloadData:G[3]||(G[3]=o=>l("reloadData"))},null,8,["visible","unit"]),E(e(_e),{primaryLabel:e(s)("common.close"),closeAriaLabel:e(s)("common.close"),title:e(s)("controller.units.cannot_open_unit"),visible:F.value,kind:"info",onClose:G[4]||(G[4]=o=>F.value=!1),onPrimaryClick:G[5]||(G[5]=o=>F.value=!1)},{default:h(()=>{var o;return[T(y(e(s)("controller.units.cannot_open_unit_description",{name:(o=_.value)==null?void 0:o.info.unit_name})),1)]}),_:1},8,["primaryLabel","closeAriaLabel","title","visible"]),E(e(_e),{primaryLabel:e(s)("controller.units.open_unit"),cancelLabel:e(s)("common.close"),closeAriaLabel:e(s)("common.close"),title:e(s)("controller.units.warning_open_unit"),visible:V.value,kind:"info",onClose:G[6]||(G[6]=o=>V.value=!1),onPrimaryClick:G[7]||(G[7]=o=>w(_.value,!1))},{default:h(()=>[T(y(e(s)("controller.units.warning_open_unit_description")),1)]),_:1},8,["primaryLabel","cancelLabel","closeAriaLabel","title","visible"])]))}});var he=256,De=[],Pe;for(;he--;)De[he]=(he+256).toString(16).substring(1);function Mr(){var a=0,n,t="";if(!Pe||he+16>256){for(Pe=Array(a=256);a--;)Pe[a]=256*Math.random()|0;a=he=0}for(;a<16;a++)n=Pe[he+a],a==6?t+=De[n&15|64]:a==8?t+=De[n&63|128]:t+=De[n],a&1&&a>1&&a<11&&(t+="-");return he++,t}const Xr={class:"list-inside list-decimal space-y-2"},Br=ue({__name:"AddUnitModal",props:{visible:{type:Boolean}},emits:["close","reloadData"],setup(a,{emit:n}){const t=a,l=n,{t:s}=ce(),c=fe(),u=S(!1),$=S(""),r=S({addUnit:""});me(()=>t.visible,()=>{t.visible&&i()});async function i(){var _,p;r.value.addUnit="";const v=Mr();try{$.value=await c.addUnit(v),l("reloadData")}catch(g){((p=(_=g.response)==null?void 0:_.data)==null?void 0:p.message)==="subscription limit reached"?r.value.addUnit=s("error.max_units_reached"):r.value.addUnit=s(oe(g))}}function d(){$.value&&(navigator.clipboard.writeText($.value),u.value=!0,setTimeout(()=>{u.value=!1},3e3))}return(v,_)=>(b(),D(e(_e),{visible:a.visible,title:e(s)("controller.units.add_unit"),kind:"info",primaryLabel:e(s)("common.close"),cancelLabel:"",closeAriaLabel:e(s)("common.close"),size:"lg",onClose:_[0]||(_[0]=p=>l("close")),onPrimaryClick:_[1]||(_[1]=p=>l("close"))},{default:h(()=>[r.value.addUnit?(b(),D(e(J),{key:0,kind:"error",title:e(s)("error.cannot_add_unit"),description:r.value.addUnit,class:"mb-4"},null,8,["title","description"])):W("",!0),R("ol",Xr,[R("li",null,[u.value?(b(),D(e(ne),{key:0,triggerEvent:"mouseenter focus",placement:"top-start"},{trigger:h(()=>[E(e(Qe),{onClick:d},{default:h(()=>[T(y(e(s)("controller.units.add_unit_step_1")),1)]),_:1})]),content:h(()=>[T(y(e(s)("common.copied")),1)]),_:1})):(b(),D(e(Qe),{key:1,onClick:d},{default:h(()=>[T(y(e(s)("controller.units.add_unit_step_1")),1)]),_:1}))]),R("li",null,y(e(s)("controller.units.add_unit_step_2")),1),R("li",null,y(e(s)("controller.units.add_unit_step_3")),1),R("li",null,y(e(s)("controller.units.add_unit_step_4")),1)])]),_:1},8,["visible","title","primaryLabel","closeAriaLabel"]))}});async function qr(){var c;const a=Ve(),n=await Mt.get(`https://${a.fqdn}${a.websshPath}`,{withCredentials:!0});return(c=new DOMParser().parseFromString(n.data,"text/html").getElementsByName("_xsrf")[0])==null?void 0:c.value}async function Wr(a){const n=Ve(),t=new FormData;t.append("hostname",a.hostname),t.append("port",a.port.toString()),t.append("username",a.username),t.append("password",a.password),t.append("passphrase",a.passphrase),t.append("privatekey",a.privatekey),t.append("totp",a.totp),t.append("term",a.term),t.append("_xsrf",a._xsrf);const l=await Mt.post(`https://${n.fqdn}${n.websshPath}`,t,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0});if(l.data.status)throw{response:{status:401}};return l.data.id}const zr={class:"space-y-6"},Hr=ue({__name:"OpenSshModal",props:{visible:{type:Boolean,required:!0},unit:{type:Object,default:null}},emits:["close"],setup(a,{emit:n}){const t=a,l=n,{t:s}=ce(),c=jt(),u=Ht(),$=S(""),r=S("root"),i=S(""),d=S(""),v=S(!1),_=S(),p=S(),g=S(!1),F=S(""),V=S();let N=S({getXsrfToken:!1,getWebsocketId:!1,sshKeys:!1}),w=S({unitUsername:"",unitPassword:"",passphrase:"",getXsrfToken:"",getXsrfTokenDetails:"",getWebsocketId:"",getWebsocketIdDetails:"",authError:"",getUnitSshKeys:"",getUnitSshKeysDetails:""});const C=ae(()=>N.value.getXsrfToken||N.value.sshKeys);me(()=>t.visible,()=>{t.visible&&(q(),r.value="root",i.value="",F.value="",X(),z())}),me(()=>C.value,()=>{C.value||(g.value?de(V):de(p))}),tt(()=>{v.value=Ft("hideOpenSshPopupsTooltip",c.username)});async function z(){N.value.sshKeys=!0;try{await u.loadSshKeys();const m=u.sshKeys.key_pub;if(!m){g.value=!1,N.value.sshKeys=!1;return}try{(await ve("ns.ssh","list-keys",{},t.unit.id)).data.keys.split(`
`).map(o=>o.trim()).filter(o=>o).includes(m.trim())?g.value=!0:g.value=!1}catch(A){w.value.getUnitSshKeys=s(oe(A)),w.value.getUnitSshKeysDetails=A.toString()}}finally{N.value.sshKeys=!1}}function ee(){v.value=!0,Gt("hideOpenSshPopupsTooltip",!0,c.username)}function q(){for(const m of Object.keys(w.value))w.value[m]=""}async function X(){N.value.getXsrfToken=!0;try{$.value=await qr()}catch(m){w.value.getXsrfToken=s(oe(m)),w.value.getXsrfTokenDetails=m.toString()}finally{N.value.getXsrfToken=!1}}function x(){q();let m=!0;return r.value||(w.value.unitUsername=s("error.required"),m&&(m=!1,de(_))),g.value?F.value||(w.value.passphrase=s("error.required"),m&&(m=!1,de(V))):i.value||(w.value.unitPassword=s("error.required"),m&&(m=!1,de(p))),m}async function I(){var k,G,o,f;if(!x())return;const A={hostname:t.unit.ipaddress,port:t.unit.info.ssh_port,username:r.value,password:g.value?"":i.value,passphrase:g.value?F.value:"",privatekey:g.value?u.sshKeys.key:"",totp:"",term:"xterm-256color",_xsrf:$.value};N.value.getWebsocketId=!0,d.value="";try{d.value=await Wr(A)}catch(L){((k=L.response)==null?void 0:k.status)===401?(w.value.authError=g.value?s("controller.units.auth_error_passphrase"):s("controller.units.auth_error_credentials"),g.value?de(V):de(p)):(w.value.getWebsocketId=s(oe(L)),w.value.getWebsocketIdDetails=L.toString())}finally{N.value.getWebsocketId=!1}if(d.value){const L=((o=(G=t.unit)==null?void 0:G.info)==null?void 0:o.unit_name)||((f=t.unit)==null?void 0:f.id),U=st.resolve({path:"/controller/unit-terminal",query:{websocketId:d.value,unitName:L}});window.open(U.href,"_blank"),l("close")}}return(m,A)=>(b(),D(e(_e),{visible:a.visible,title:e(s)("controller.units.open_ssh_terminal"),kind:"info",primaryLabel:e(s)("controller.units.open_terminal"),cancelLabel:e(s)("common.cancel"),primaryButtonKind:"primary",primaryButtonLoading:e(N).getWebsocketId,primaryButtonDisabled:C.value,closeAriaLabel:e(s)("common.close"),onClose:A[3]||(A[3]=k=>l("close")),onPrimaryClick:I},{default:h(()=>[R("div",zr,[v.value?W("",!0):(b(),D(e(J),{key:0,kind:"info",title:e(s)("controller.units.popup_permission_title"),description:e(s)("controller.units.popup_permission_description"),primaryButtonLabel:e(s)("common.dont_show_again"),onPrimaryClick:ee,closeAriaLabel:e(s)("common.close")},null,8,["title","description","primaryButtonLabel","closeAriaLabel"])),e(w).getXsrfToken?(b(),D(e(J),{key:1,kind:"error",title:e(s)("error.cannot_retrieve_xsrf_token"),description:e(w).getXsrfToken,closeAriaLabel:e(s)("common.close")},be({_:2},[e(w).getXsrfTokenDetails?{name:"details",fn:h(()=>[T(y(e(w).getXsrfTokenDetails),1)]),key:"0"}:void 0]),1032,["title","description","closeAriaLabel"])):W("",!0),e(w).getWebsocketId?(b(),D(e(J),{key:2,kind:"error",title:e(s)("error.cannot_retrieve_websocket_id"),description:e(w).getWebsocketId,closeAriaLabel:e(s)("common.close")},be({_:2},[e(w).getWebsocketIdDetails?{name:"details",fn:h(()=>[T(y(e(w).getWebsocketIdDetails),1)]),key:"0"}:void 0]),1032,["title","description","closeAriaLabel"])):W("",!0),e(u).listSshKeysError.notificationDescription?(b(),D(e(J),{key:3,kind:"error",title:e(s)("error.cannot_retrieve_ssh_keys"),description:e(u).listSshKeysError.notificationDescription,closeAriaLabel:e(s)("common.close")},be({_:2},[e(u).listSshKeysError.notificationDetails?{name:"details",fn:h(()=>[T(y(e(u).listSshKeysError.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description","closeAriaLabel"])):W("",!0),e(w).getUnitSshKeys?(b(),D(e(J),{key:4,kind:"error",title:e(s)("error.cannot_retrieve_unit_ssh_keys"),description:e(w).getUnitSshKeys,closeAriaLabel:e(s)("common.close")},be({_:2},[e(w).getUnitSshKeysDetails?{name:"details",fn:h(()=>[T(y(e(w).getUnitSshKeysDetails),1)]),key:"0"}:void 0]),1032,["title","description","closeAriaLabel"])):W("",!0),e(w).authError?(b(),D(e(J),{key:5,kind:"error",title:e(s)("controller.units.auth_error"),description:e(w).authError,closeAriaLabel:e(s)("common.close")},null,8,["title","description","closeAriaLabel"])):W("",!0),C.value?(b(),D(e(Re),{key:6,size:"lg",lines:4})):(b(),K(Q,{key:7},[E(e(Le),{label:e(s)("controller.units.unit_username"),modelValue:r.value,"onUpdate:modelValue":A[0]||(A[0]=k=>r.value=k),modelModifiers:{trim:!0},invalidMessage:e(s)(e(w).unitUsername),autocomplete:"username",ref_key:"unitUsernameRef",ref:_},null,8,["label","modelValue","invalidMessage"]),g.value?(b(),D(e(Le),{key:0,label:e(s)("controller.units.passphrase"),modelValue:F.value,"onUpdate:modelValue":A[1]||(A[1]=k=>F.value=k),modelModifiers:{trim:!0},invalidMessage:e(s)(e(w).passphrase),isPassword:"",showPasswordLabel:e(s)("ne_text_input.show_password"),hidePasswordLabel:e(s)("ne_text_input.hide_password"),ref_key:"passphraseRef",ref:V},{tooltip:h(()=>[E(e(ne),null,{content:h(()=>[T(y(e(s)("controller.units.passphrase_tooltip")),1)]),_:1})]),_:1},8,["label","modelValue","invalidMessage","showPasswordLabel","hidePasswordLabel"])):(b(),D(e(Le),{key:1,label:e(s)("controller.units.unit_password"),modelValue:i.value,"onUpdate:modelValue":A[2]||(A[2]=k=>i.value=k),isPassword:"",showPasswordLabel:e(s)("ne_text_input.show_password"),hidePasswordLabel:e(s)("ne_text_input.hide_password"),invalidMessage:e(s)(e(w).unitPassword),autocomplete:"current-password",ref_key:"unitPasswordRef",ref:p},null,8,["label","modelValue","showPasswordLabel","hidePasswordLabel","invalidMessage"]))],64))])]),_:1},8,["visible","title","primaryLabel","cancelLabel","primaryButtonLoading","primaryButtonDisabled","closeAriaLabel"]))}}),Yr={key:1,class:"space-y-6"},Jr={class:"list-inside list-disc"},Zr={class:"flex justify-end"},Qr=ue({__name:"SendOrRevokeSshKeyDrawer",props:{isShown:{type:Boolean,required:!0},action:{type:String,required:!0}},emits:["close"],setup(a,{emit:n}){const t=a,l=n,{t:s}=ce(),c=fe(),u=$e(),$=S([]),r=S(),i=Ht(),d=S(new Xt),v=S(),_=S({sendOrRevokeSshKey:!1}),p=S({sendOrRevokeSshKey:"",sshKeyUnits:[]}),g=ae(()=>c.units.filter(I=>I.connected).map(I=>{var m,A;return{id:I.id,label:((m=I.info)==null?void 0:m.unit_name)||I.id,description:(A=I.info)!=null&&A.unit_name?I.id:""}})),F=ae(()=>$.value.length===g.value.length);me(()=>t.isShown,()=>{t.isShown&&(d.value.clear(),p.value.sendOrRevokeSshKey="",$.value=[],i.loadSshKeys())});function V(){l("close")}function N(){d.value.clear(),p.value.sendOrRevokeSshKey="",p.value.sshKeyUnits=[];const x=[[[_s($.value)],"units",r]];v.value=void 0;const I=x.map(([m,A,k])=>w(m,A,k)).every(m=>m);return v.value&&de(v.value),I}function w(x,I,m){for(let A of x)A.valid||(d.value.set(I,[A.errMessage]),v.value||(v.value=m));return x.every(A=>A.valid)}function C(){if(!N())return;_.value.sendOrRevokeSshKey=!0;const I=[];for(const m of $.value)I.push(z(m));Promise.allSettled(I).then(m=>{_.value.sendOrRevokeSshKey=!1;const A=m.filter(k=>k.status==="rejected");if(A.length>0){const k=t.action==="send"?"controller.units.cannot_send_ssh_key_to_n_units":"controller.units.cannot_revoke_ssh_key_from_n_units";p.value.sendOrRevokeSshKey=s(k,A.length)}else V(),setTimeout(()=>{const k=t.action==="send"?"controller.units.ssh_key_sent_to_n_units":"controller.units.ssh_key_revoked_from_n_units";u.createNotification({title:s(k,$.value.length),kind:"success"})},500)})}async function z(x){const I=i.sshKeys.key_pub,m=t.action==="send"?"add-ssh-key":"remove-ssh-key";try{await ve("ns.controller",m,{ssh_key:I},x.id,{timeout:5e3})}catch(A){throw p.value.sshKeyUnits.push(x.label||x.id),A}}function ee(){st.push(`${hs()}/account`)}function q(){$.value=g.value}function X(){$.value=[]}return(x,I)=>(b(),D(e(at),{isShown:a.isShown,title:t.action==="send"?e(s)("controller.units.send_ssh_public_key"):e(s)("controller.units.revoke_ssh_public_key"),closeAriaLabel:e(s)("common.shell.close_side_drawer"),onClose:V},{default:h(()=>[R("form",{onSubmit:I[1]||(I[1]=qe(()=>{},["prevent"]))},[e(i).listSshKeysLoading?(b(),D(e(Re),{key:0,size:"lg",lines:4})):(b(),K(Q,{key:1},[e(i).sshKeys.key_pub?(b(),K("div",Yr,[E(e(J),{kind:"info",title:t.action==="send"?e(s)("controller.units.send_ssh_public_key"):e(s)("controller.units.revoke_ssh_public_key"),description:t.action==="send"?e(s)("controller.units.send_ssh_key_description"):e(s)("controller.units.revoke_ssh_key_description"),closeAriaLabel:e(s)("common.close"),showDetailsLabel:e(s)("notifications.show_details")},null,8,["title","description","closeAriaLabel","showDetailsLabel"]),R("div",null,[F.value?(b(),D(e(Z),{key:0,kind:"tertiary",onClick:X,class:"-mx-2"},{default:h(()=>[T(y(e(s)("controller.units.deselect_all_units")),1)]),_:1})):(b(),D(e(Z),{key:1,kind:"tertiary",onClick:q,class:"-mx-2"},{default:h(()=>[T(y(e(s)("controller.units.select_all_units")),1)]),_:1})),E(e(Bt),{label:e(s)("controller.units.units"),modelValue:$.value,"onUpdate:modelValue":I[0]||(I[0]=m=>$.value=m),options:g.value,placeholder:e(s)("ne_combobox.choose_multiple"),multiple:"",invalidMessage:e(s)(d.value.getFirstI18nKeyFor("units")),disabled:_.value.sendOrRevokeSshKey,optionalLabel:e(s)("common.optional"),noResultsLabel:e(s)("ne_combobox.no_results"),limitedOptionsLabel:e(s)("ne_combobox.limited_options_label"),noOptionsLabel:e(s)("controller.units.no_unit_is_currently_connected"),"selected-label":e(s)("ne_combobox.selected"),"user-input-label":e(s)("ne_combobox.user_input_label"),ref_key:"selectedUnitsRef",ref:r,class:"mt-2"},null,8,["label","modelValue","options","placeholder","invalidMessage","disabled","optionalLabel","noResultsLabel","limitedOptionsLabel","noOptionsLabel","selected-label","user-input-label"])]),p.value.sendOrRevokeSshKey?(b(),D(e(J),{key:0,kind:"error",title:p.value.sendOrRevokeSshKey},be({_:2},[p.value.sshKeyUnits.length?{name:"details",fn:h(()=>[R("ul",Jr,[(b(!0),K(Q,null,nt(p.value.sshKeyUnits,m=>(b(),K("li",{key:m},y(m),1))),128))])]),key:"0"}:void 0]),1032,["title"])):W("",!0)])):(b(),D(e(J),{key:0,kind:"warning",title:e(s)("controller.units.ssh_key_not_generated"),description:e(s)("controller.units.ssh_key_not_generated_description"),closeAriaLabel:e(s)("common.close"),showDetailsLabel:e(s)("notifications.show_details"),primaryButtonLabel:e(s)("controller.units.go_to_account_settings"),onPrimaryClick:ee},null,8,["title","description","closeAriaLabel","showDetailsLabel","primaryButtonLabel"]))],64)),I[2]||(I[2]=R("hr",{class:"my-8 border-gray-200 dark:border-gray-700"},null,-1)),R("div",Zr,[E(e(Z),{kind:"tertiary",size:"lg",onClick:qe(V,["prevent"]),class:"mr-3"},{default:h(()=>[T(y(e(s)("common.cancel")),1)]),_:1}),E(e(Z),{kind:"primary",size:"lg",onClick:qe(C,["prevent"]),disabled:_.value.sendOrRevokeSshKey||e(i).listSshKeysLoading||!e(i).sshKeys.key_pub,loading:_.value.sendOrRevokeSshKey,type:"submit"},{default:h(()=>[T(y(t.action==="send"?e(s)("controller.units.send_ssh_key"):e(s)("controller.units.revoke_ssh_key")),1)]),_:1},8,["disabled","loading"])])],32)]),_:1},8,["isShown","title","closeAriaLabel"]))}});function Xe(){function a(u){return u?ve("ns.update","check-package-updates",{},u.id):ge("ns.update","check-package-updates",{})}function n(u){return u?ve("ns.update","install-package-updates",{},u.id):ge("ns.update","install-package-updates")}function t(u){return u?ve("ns.update","check-system-update",{},u.id):ge("ns.update","check-system-update")}function l(u){return u?ve("ns.update","update-system",{},u.id):ge("ns.update","update-system")}function s(u,$){const r=Math.floor(u.getTime()/1e3);return $?ve("ns.update","schedule-system-update",{scheduleAt:r},$.id):ge("ns.update","schedule-system-update",{scheduleAt:r})}function c(u){return u?ve("ns.update","schedule-system-update",{scheduleAt:-1},u.id):ge("ns.update","schedule-system-update",{scheduleAt:-1})}return{updatePackageIndex:a,upgradePackages:n,checkUnitImageUpdate:t,upgradeUnitImage:l,scheduleUpgradeUnitImage:s,abortScheduledUpgradeUnitImage:c}}const el={key:2,class:"flex flex-col gap-6"},tl={class:"flex flex-wrap justify-end"},sl={key:3,class:"flex flex-col gap-6"},nl={key:1},al={class:"flex flex-wrap justify-end gap-4"},rl=ue({__name:"ScheduleUpdateDrawer",props:{unit:{}},emits:["close"],setup(a,{emit:n}){const{t}=ce(),{checkUnitImageUpdate:l,upgradeUnitImage:s,scheduleUpgradeUnitImage:c}=Xe(),u=fe(),$=$e(),r=qt(),i=[{id:"now",label:t("standalone.update.now")},{id:"scheduled",label:t("standalone.update.schedule_time_and_date")}],d=a,v=n,_=S();me(()=>d.unit,q=>{q&&(_.value=q,g.value=void 0,p.value=!0,l(_.value).then(async X=>{F.value=X.data.lastVersion,F.value==""?(await u.getUnitInfo(_.value.id),await u.getUnits()):X.data.scheduledAt>0?(V.value=new Date(X.data.scheduledAt*1e3),N.value="scheduled"):N.value="now"}).catch(X=>{g.value=X}).finally(()=>{p.value=!1}))},{immediate:!0});const p=S(!1),g=S(),F=S(""),V=S(new Date),N=S("now"),w=S(!1),C=S();async function z(){try{w.value=!0,C.value=void 0,N.value=="now"?(await s(_.value),u.addUnitUpgradingImage(_.value.id)):await c(V.value,_.value),await u.getUnitInfo(_.value.id),await u.getUnits();let q={kind:"success"};N.value=="now"?(q.id="unit-update",q.title=t("controller.units.image_update_success"),q.description=t("controller.units.image_update_description")):(q.id="schedule-unit-update",q.title=t("controller.units.scheduled_image_update_success")),$.createNotification(q),v("close")}catch(q){C.value=q}finally{w.value=!1}}function ee(){w.value||v("close")}return(q,X)=>(b(),D(e(at),{isShown:q.unit!=null,closeAriaLabel:e(t)("common.shell.close_side_drawer"),title:e(t)("standalone.update.update_system"),onClose:ee},{default:h(()=>[p.value?(b(),D(e(Re),{key:0,lines:10})):g.value?(b(),D(e(J),{key:1,description:e(t)(e(oe)(g.value)),title:e(t)("controller.units.error_fetching_unit_image_version"),kind:"error"},{details:h(()=>[T(y(g.value.toString()),1)]),_:1},8,["description","title"])):F.value==""?(b(),K("div",el,[E(e(J),{title:e(t)("standalone.update.no_updates_available"),kind:"info"},null,8,["title"]),X[5]||(X[5]=R("hr",null,null,-1)),R("div",tl,[E(e(Z),{kind:"primary",onClick:X[0]||(X[0]=x=>v("close"))},{default:h(()=>[T(y(e(t)("common.close")),1)]),_:1})])])):(b(),K("div",sl,[C.value?(b(),D(e(J),{key:0,description:e(t)(e(oe)(C.value)),title:e(t)("controller.units.error_setting_image_update"),kind:"error"},{details:h(()=>[T(y(C.value.toString()),1)]),_:1},8,["description","title"])):W("",!0),E(e(Le),{modelValue:F.value,"onUpdate:modelValue":X[1]||(X[1]=x=>F.value=x),disabled:!0,label:e(t)("standalone.update.update_to_version")},null,8,["modelValue","label"]),E(e(Wt),{modelValue:N.value,"onUpdate:modelValue":X[2]||(X[2]=x=>N.value=x),disabled:w.value,label:e(t)("standalone.update.choose_when_to_update"),options:i},{tooltip:h(()=>[E(e(ne),null,{content:h(()=>[T(y(e(t)("standalone.update.schedule_mode_tooltip")),1)]),_:1})]),_:1},8,["modelValue","disabled","label"]),N.value=="scheduled"?(b(),K("div",nl,[E(e(zt),{class:"mb-2"},{default:h(()=>[T(y(e(t)("standalone.update.time_and_date")),1)]),_:1}),E(e(Yt),{modelValue:V.value,"onUpdate:modelValue":X[3]||(X[3]=x=>V.value=x),clearable:!1,dark:!e(r).isLight,"disabled-dates":x=>x<new Date,"time-picker-inline":!0,disabled:w.value,readonly:w.value},null,8,["modelValue","dark","disabled-dates","disabled","readonly"])])):W("",!0),X[6]||(X[6]=R("hr",null,null,-1)),R("div",al,[E(e(Z),{disabled:w.value,readonly:w.value,kind:"tertiary",onClick:X[4]||(X[4]=x=>v("close"))},{default:h(()=>[T(y(e(t)("common.cancel")),1)]),_:1},8,["disabled","readonly"]),E(e(Z),{disabled:w.value,loading:w.value,readonly:w.value,kind:"primary",onClick:z},{default:h(()=>[N.value=="now"?(b(),K(Q,{key:0},[T(y(e(t)("standalone.update.update_and_reboot")),1)],64)):(b(),K(Q,{key:1},[T(y(e(t)("standalone.update.schedule")),1)],64))]),_:1},8,["disabled","loading","readonly"])])]))]),_:1},8,["isShown","closeAriaLabel","title"]))}}),ll={class:"space-y-4"},il=ue({__name:"CancelUpdateModal",props:{unit:{}},emits:["close"],setup(a,{emit:n}){const{t}=ce(),{abortScheduledUpgradeUnitImage:l}=Xe(),s=fe(),c=$e(),u=a,$=n,r=S(),i=S(!1),d=S();me(()=>u.unit,p=>{p&&(r.value=p)},{immediate:!0});function v(){i.value||$("close")}async function _(){if(d.value=void 0,!r.value){d.value=new Error("Unit is not defined.");return}i.value=!0;try{await l(r.value),await s.getUnitInfo(r.value.id),await s.getUnits(),c.createNotification({kind:"success",id:"abort-scheduled-update",title:t("controller.units.scheduled_image_update_aborted",{name:r.value.info.unit_name})}),$("close")}catch(p){d.value=p}finally{i.value=!1}}return(p,g)=>(b(),D(e(_e),{visible:p.unit!=null,title:e(t)("standalone.update.cancel_update"),"primary-label":e(t)("standalone.update.cancel_update"),kind:"info","cancel-label":e(t)("standalone.update.keep_scheduled_update"),"primary-button-disabled":i.value,"primary-button-loading":i.value,"close-aria-label":e(t)("standalone.update.keep_scheduled_update"),onPrimaryClick:_,onSecondaryClick:v,onClose:v},{default:h(()=>{var F,V;return[R("div",ll,[d.value?(b(),D(e(J),{key:0,description:e(t)(e(oe)(d.value)),title:e(t)("controller.units.error_removing_scheduled_update"),kind:"error"},{details:h(()=>[T(y(d.value.toString()),1)]),_:1},8,["description","title"])):W("",!0),R("p",null,y(e(t)("controller.units.cancel_scheduled_image_update_description",{version:(F=r.value)==null?void 0:F.info.version_update,name:(V=r.value)==null?void 0:V.info.unit_name})),1)])]}),_:1},8,["visible","title","primary-label","cancel-label","primary-button-disabled","primary-button-loading","close-aria-label"]))}}),ol={class:"max-h-96 space-y-3 overflow-y-auto"},ul={key:2,class:"space-y-2"},cl={class:"text-gray-500 dark:text-gray-400"},dl=ue({__name:"UpdateUnitsPackagesModal",props:{unit:{}},emits:["close"],setup(a,{emit:n}){const{t}=ce(),{upgradePackages:l,updatePackageIndex:s}=Xe(),c=fe(),u=$e(),$=a,r=n,i=S(),d=S(!1),v=S(!1),_=S(),p=S([]);me(()=>$.unit,async w=>{if(w){_.value=void 0,d.value=!0,i.value=w;try{const C=await s(i.value);p.value=C.data.updates,d.value=!1}catch(C){_.value=C}}},{immediate:!0});const g=ae(()=>d.value?t("common.loading"):p.value.length>0?t("standalone.update.update"):t("common.close")),F=ae(()=>d.value?"neutral":p.value.length>0?"info":"success");function V(){v.value||r("close")}async function N(){if(_.value=void 0,!i.value){_.value=new Error("Unit is not defined.");return}if(p.value.length<=0){r("close");return}try{v.value=!0,await l(i.value),await c.getUnitInfo(i.value.id),await c.getUnits(),u.createNotification({kind:"success",id:"update-packages",title:t("controller.units.packages_upgrade_in_progress",{name:i.value.info.unit_name})}),c.addUnitUpdating(i.value.id),r("close")}catch(w){_.value=w}finally{v.value=!1}}return(w,C)=>(b(),D(e(_e),{visible:w.unit!=null,title:e(t)("controller.units.check_packages_updates"),"primary-button-disabled":v.value||d.value,"primary-button-loading":v.value||d.value,"cancel-label":p.value.length>0?e(t)("common.cancel"):"","primary-label":g.value,kind:F.value,"close-aria-label":e(t)("common.close"),onPrimaryClick:N,onSecondaryClick:V,onClose:V},{default:h(()=>[R("div",ol,[_.value?(b(),D(e(J),{key:0,description:e(t)(e(oe)(_.value)),title:e(t)("controller.units.error_upgrading_unit_packages"),kind:"error"},{details:h(()=>[T(y(_.value.toString()),1)]),_:1},8,["description","title"])):W("",!0),d.value?(b(),D(e(Re),{key:1,lines:4})):p.value.length>0?(b(),K("div",ul,[R("h6",null,y(e(t)("controller.units.packages_to_update")),1),R("ul",null,[(b(!0),K(Q,null,nt(p.value,z=>(b(),K("li",{key:z.package},[T(y(z.package)+" ",1),R("span",cl,y(e(t)("standalone.update.component_update_details",{versionFrom:z.currentVersion,versionTo:z.latestVersion})),1)]))),128))])])):(b(),K(Q,{key:3},[T(y(e(t)("standalone.update.all_updates_installed_notification")),1)],64))])]),_:1},8,["visible","title","primary-button-disabled","primary-button-loading","cancel-label","primary-label","kind","close-aria-label"]))}}),pl={class:"space-y-4"},fl={key:3},vl={class:"flex flex-wrap justify-end gap-4"},ml=ue({__name:"BatchUnitImageUpdate",props:{show:{type:Boolean}},emits:["close"],setup(a,{emit:n}){const{t}=ce(),l=fe(),s=qt(),{upgradeUnitImage:c,scheduleUpgradeUnitImage:u}=Xe(),$=$e(),r=n;function i(){w.value||r("close")}function d(){return ee.value.clear(),N.value.length<1&&(ee.value.set("units","error.required_option"),de(q.value)),ee.value.size>0}function v(){d()||(w.value=!0,X.value=!1,Promise.allSettled(N.value.map(x=>z.value==="now"?c(x).then(()=>{l.addUnitUpgradingImage(x.id)}):u(C.value,x))).then(async x=>{for(const I of N.value)await l.getUnitInfo(I.id);await l.getUnits(),N.value=[],x.some(I=>I.status==="rejected")?X.value=!0:(r("close"),z.value="now",$.createNotification({title:t("controller.units.batch_updated_systems",x.filter(I=>I.status==="fulfilled").length),kind:"success"}))}).finally(()=>{w.value=!1}))}const _=ae(()=>l.units.filter(x=>{var I,m;return x.connected&&((I=x.info)==null?void 0:I.scheduled_update)<0&&((m=x.info)==null?void 0:m.version_update)!=""}).map(x=>{var I,m;return{id:x.id,label:((I=x.info)==null?void 0:I.unit_name)||x.id,description:(m=x.info)!=null&&m.unit_name?x.id:""}}));function p(){N.value=_.value}function g(){N.value=[]}const F=[{id:"now",label:t("standalone.update.now")},{id:"scheduled",label:t("standalone.update.schedule_time_and_date")}],V=ae(()=>N.value.length===_.value.length),N=S([]),w=S(!1),C=S(new Date),z=S("now"),ee=S(new Xt),q=S(),X=S(!1);return(x,I)=>(b(),D(e(at),{closeAriaLabel:e(t)("common.shell.close_side_drawer"),isShown:x.show,title:e(t)("standalone.update.update_system",2),onClose:i},{default:h(()=>[R("div",pl,[E(e(J),{closeAriaLabel:e(t)("common.close"),description:e(t)("controller.units.batch_update_system"),showDetailsLabel:e(t)("notifications.show_details"),title:e(t)("standalone.update.update_system",2),kind:"info"},null,8,["closeAriaLabel","description","showDetailsLabel","title"]),X.value?(b(),D(e(J),{key:0,description:e(t)("controller.units.error_batch_updating_systems_description"),title:e(t)("controller.units.error_batch_updating_systems"),kind:"warning"},null,8,["description","title"])):W("",!0),V.value?(b(),D(e(Z),{key:1,class:"-mx-2",kind:"tertiary",onClick:g},{default:h(()=>[T(y(e(t)("controller.units.deselect_all_units")),1)]),_:1})):(b(),D(e(Z),{key:2,class:"-mx-2",kind:"tertiary",onClick:p},{default:h(()=>[T(y(e(t)("controller.units.select_all_units")),1)]),_:1})),E(e(Bt),{ref_key:"selectedUnitsRef",ref:q,modelValue:N.value,"onUpdate:modelValue":I[0]||(I[0]=m=>N.value=m),disabled:w.value,invalidMessage:e(t)(ee.value.getFirstI18nKeyFor("units")),label:e(t)("controller.units.units"),limitedOptionsLabel:e(t)("ne_combobox.limited_options_label"),noOptionsLabel:e(t)("controller.units.no_unit_is_currently_connected"),noResultsLabel:e(t)("ne_combobox.no_results"),optionalLabel:e(t)("common.optional"),options:_.value,placeholder:e(t)("ne_combobox.choose_multiple"),"selected-label":e(t)("ne_combobox.selected"),"user-input-label":e(t)("ne_combobox.user_input_label"),multiple:""},null,8,["modelValue","disabled","invalidMessage","label","limitedOptionsLabel","noOptionsLabel","noResultsLabel","optionalLabel","options","placeholder","selected-label","user-input-label"]),E(e(Wt),{modelValue:z.value,"onUpdate:modelValue":I[1]||(I[1]=m=>z.value=m),disabled:w.value,label:e(t)("standalone.update.choose_when_to_update"),options:F},{tooltip:h(()=>[E(e(ne),null,{content:h(()=>[T(y(e(t)("standalone.update.schedule_mode_tooltip")),1)]),_:1})]),_:1},8,["modelValue","disabled","label"]),z.value=="scheduled"?(b(),K("div",fl,[E(e(zt),{class:"mb-2"},{default:h(()=>[T(y(e(t)("standalone.update.time_and_date")),1)]),_:1}),E(e(Yt),{modelValue:C.value,"onUpdate:modelValue":I[2]||(I[2]=m=>C.value=m),clearable:!1,dark:!e(s).isLight,disabled:w.value,"disabled-dates":m=>m<new Date,readonly:w.value,"time-picker-inline":!0},null,8,["modelValue","dark","disabled","disabled-dates","readonly"])])):W("",!0),I[4]||(I[4]=R("hr",null,null,-1)),R("div",vl,[E(e(Z),{disabled:w.value,readonly:w.value,kind:"tertiary",onClick:I[3]||(I[3]=m=>r("close"))},{default:h(()=>[T(y(e(t)("common.cancel")),1)]),_:1},8,["disabled","readonly"]),E(e(Z),{disabled:w.value,loading:w.value,readonly:w.value,kind:"primary",onClick:v},{default:h(()=>[z.value=="now"?(b(),K(Q,{key:0},[T(y(e(t)("standalone.update.update_and_reboot")),1)],64)):(b(),K(Q,{key:1},[T(y(e(t)("standalone.update.schedule")),1)],64))]),_:1},8,["disabled","loading","readonly"])])])]),_:1},8,["closeAriaLabel","isShown","title"]))}}),hl={class:"flex flex-col justify-between md:flex-row md:items-center"},_l={class:"mb-6 text-sm text-gray-500 dark:text-gray-400"},gl={class:"mb-10 flex flex-col justify-between gap-6 2xl:flex-row"},yl={class:"max-w-2xl text-gray-500 dark:text-gray-400"},bl={class:"mb-6 flex flex-col-reverse items-start justify-between gap-6 xl:flex-row"},$l={class:"flex items-center gap-4"},El={key:0,class:"flex shrink-0 flex-row-reverse gap-4 xl:flex-row"},kl=1e4,Ul=ue({__name:"UnitManagerView",setup(a){const{t:n}=ce(),t=fe(),l=Ve(),s=S(""),c=S(!1),u=S(0),$=S(!0),r=S(!1),i=S(!1),d=S(),v=S("send"),_=S(),p=S(),g=S(),F=S(!1),V=ae(()=>s.value?t.units.filter(I=>C(I,s.value)):t.units),N=ae(()=>t.loadingListUnits&&$.value),w=ae(()=>!(l.defaultsLoaded&&(l.validSubscription||t.units.length<we)));function C(I,m){var G,o,f,L,U;const A=/[^a-zA-Z0-9-]/g;m=m.replace(A,"");let k=!1;return k=new RegExp(m,"i").test((G=I.id)==null?void 0:G.replace(A,"")),!!(k||(k=new RegExp(m,"i").test((f=(o=I.info)==null?void 0:o.unit_name)==null?void 0:f.replace(A,"")),k)||(k=new RegExp(m,"i").test((U=(L=I.info)==null?void 0:L.version)==null?void 0:U.replace(A,"")),k))}tt(()=>{l.getDefaults(),z(),u.value=setInterval(t.getUnits,kl)}),gs(()=>{u.value&&clearInterval(u.value)});async function z(){$.value=!0,await t.getUnits(),$.value=!1}function ee(I){d.value=I,r.value=!0}function q(){v.value="send",i.value=!0}function X(){v.value="revoke",i.value=!0}function x(){return[{id:"scheduleSystemUpdate",label:n("standalone.update.update_system",2),iconStyle:"fas",icon:"arrows-rotate",action:()=>F.value=!0},{id:"sendSshKey",label:n("controller.units.send_ssh_public_key"),iconStyle:"fas",icon:"key",action:()=>q()},{id:"revokeSshKey",label:n("controller.units.revoke_ssh_public_key"),iconStyle:"fas",icon:"circle-minus",action:()=>X()}]}return(I,m)=>(b(),K("div",null,[R("div",null,[R("div",hl,[E(e(ys),{tag:"h3",class:"mb-7"},{default:h(()=>[T(y(e(n)("controller.units.title")),1)]),_:1}),R("div",_l,y(e(n)("common.data_updated_every_seconds",{seconds:10})),1)]),R("div",gl,[R("div",yl,y(e(n)("controller.units.page_description")),1),e(l).defaultsLoaded&&!e(l).validSubscription?(b(),D(e($s),{key:0,title:e(n)("controller.units.num_units_left",{num:e(we)-e(t).units.length},e(we)-e(t).units.length),class:"w-96"},{titleTooltip:h(()=>[E(e(ne),null,{content:h(()=>[R("span",null,y(e(n)("controller.units.num_units_left_tooltip",{num:e(t).units.length,max:e(we)})),1)]),_:1})]),default:h(()=>[E(e(bs),{color:"custom","custom-color-classes":"bg-gradient-to-r from-indigo-400 to-indigo-700",progress:e(t).units.length/e(we)*100,size:"sm"},null,8,["progress"])]),_:1},8,["title"])):W("",!0)])]),R("div",bl,[R("div",$l,[E(e(Le),{placeholder:e(n)("controller.units.filter_units"),modelValue:s.value,"onUpdate:modelValue":m[0]||(m[0]=A=>s.value=A),modelModifiers:{trim:!0},disabled:N.value,class:"max-w-xs"},null,8,["placeholder","modelValue","disabled"]),E(e(Z),{kind:"tertiary",onClick:m[1]||(m[1]=A=>s.value=""),disabled:N.value||!s.value},{default:h(()=>[T(y(e(n)("common.clear_filter")),1)]),_:1},8,["disabled"])]),R("div",null,[N.value?W("",!0):(b(),K("div",El,[E(e(Z),{kind:"tertiary",size:"lg",onClick:m[2]||(m[2]=A=>c.value=!0),disabled:w.value,class:"shrink-0"},{prefix:h(()=>[E(e(pe),{icon:["fas","circle-plus"],"aria-hidden":"true"})]),default:h(()=>[T(" "+y(e(n)("controller.units.add_unit")),1)]),_:1},8,["disabled"]),E(e(Kt),{items:x(),openMenuAriaLabel:e(n)("controller.units.open_actions_menu"),alignToRight:""},{button:h(()=>[E(e(Z),{kind:"secondary"},{suffix:h(()=>[E(e(pe),{icon:["fas","chevron-down"],class:"h-4 w-4","aria-hidden":"true"})]),default:h(()=>[T(y(e(n)("controller.units.actions"))+" ",1)]),_:1})]),_:1},8,["items","openMenuAriaLabel"])]))])]),R("div",null,[N.value&&$.value?(b(),D(e(Re),{key:0,lines:7,size:"lg"})):(b(),K(Q,{key:1},[e(mt)(e(t).units)?(b(),D(e(ht),{key:0,title:e(n)("controller.units.no_units_configured"),icon:["fas","server"],class:"mt-4"},{default:h(()=>[E(e(Z),{kind:"primary",size:"lg",onClick:m[3]||(m[3]=A=>c.value=!0)},{prefix:h(()=>[E(e(pe),{icon:["fas","circle-plus"],"aria-hidden":"true"})]),default:h(()=>[T(" "+y(e(n)("controller.units.add_unit")),1)]),_:1})]),_:1},8,["title"])):e(mt)(V.value)?(b(),D(e(ht),{key:1,title:e(n)("controller.units.no_units_found"),description:e(n)("common.try_changing_search_filter"),icon:["fas","circle-info"],class:"mt-4"},{default:h(()=>[E(e(Z),{kind:"tertiary",onClick:m[4]||(m[4]=A=>s.value="")},{default:h(()=>[T(y(e(n)("common.clear_filter")),1)]),_:1})]),_:1},8,["title","description"])):(b(),D(Gr,{key:2,filteredUnits:V.value,onReloadData:z,onOpenSshModal:ee,onScheduleUpdate:m[5]||(m[5]=A=>_.value=A),onAbortUpdate:m[6]||(m[6]=A=>p.value=A),onUpgradeUnitPackages:m[7]||(m[7]=A=>g.value=A)},null,8,["filteredUnits"]))],64))]),E(Br,{visible:c.value,onClose:m[8]||(m[8]=A=>c.value=!1),onReloadData:z},null,8,["visible"]),E(Hr,{visible:r.value,unit:d.value,onClose:m[9]||(m[9]=A=>r.value=!1)},null,8,["visible","unit"]),E(Qr,{isShown:i.value,action:v.value,onClose:m[10]||(m[10]=A=>i.value=!1)},null,8,["isShown","action"]),E(rl,{unit:_.value,onClose:m[11]||(m[11]=A=>_.value=void 0)},null,8,["unit"]),E(il,{unit:p.value,onClose:m[12]||(m[12]=A=>p.value=void 0)},null,8,["unit"]),E(dl,{unit:g.value,onClose:m[13]||(m[13]=A=>g.value=void 0)},null,8,["unit"]),E(ml,{show:F.value,onClose:m[14]||(m[14]=A=>F.value=!1)},null,8,["show"])]))}});export{Ul as default};
