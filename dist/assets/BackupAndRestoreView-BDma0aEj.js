import{d as K,u as Q,r as l,h as c,i as D,w as r,j as w,t as k,l as e,L as A,n as T,Y as ne,ah as re,e as q,V as O,J as _e,k as s,Q as pe,s as ge,m as g,M as te,_ as j,ai as fe,o as be,q as F,y as ue,z as X,F as Z,B as xe,aj as Be,ak as $e,al as oe,am as Me,ad as ye,an as Se,ao as se,H as de,ap as Re,aq as Pe,ar as Le,a0 as we,as as De,P as he,ag as Ve,S as ce,T as Ce,a1 as Ne,at as ze,Z as ke,W as Ie,a9 as je}from"./index-BlEQ5104.js";import{u as Fe}from"./useTabs-BeLQ169O.js";import{d as Oe,a as Ue,u as Te}from"./fileUpload-2kJDzwnA.js";import{_ as ve}from"./FormLayout.vue_vue_type_script_setup_true_lang-DaMAl8E3.js";import{u as qe}from"./useTimer-hCPxFuk6.js";const Ee=K({__name:"DownloadBackupModal",props:{showDownloadModal:{type:Boolean,required:!0},isSetPassphrase:{type:Boolean,required:!0},selectedBackup:{type:String,required:!0},selectedBackupType:{type:String},selectedBackupTime:{type:String},isValidSubscription:{type:Boolean,required:!0},unitName:{type:String}},emits:["success","close"],setup(R,{emit:t}){const{t:a}=Q(),f=R,x=t;let d=l(!1),p=l({...{notificationTitle:"",notificationDescription:""}});function M(){return f.selectedBackupTime?re(new Date(Number(f.selectedBackupTime)*1e3),"PPpp"):f.unitName}async function y(){var n;try{d.value=!0;let h={},z="backup";f.selectedBackup&&(z="registered-download-backup",h={file:f.selectedBackup});let U=await q("ns.backup",z,h);if((n=U==null?void 0:U.data)!=null&&n.backup){const W=await Oe(U.data.backup),J=URL.createObjectURL(W);let H=".tar.gz";f.isValidSubscription?(f.selectedBackupType=="application/pgp-encrypted"||f.selectedBackupType=="application/octet-stream")&&(H+=".gpg"):f.isSetPassphrase&&(H+=".gpg");let V=document.createElement("a");V.href=J,f.selectedBackupTime?V.download="backup-"+f.unitName+"-"+f.selectedBackupTime+H:V.download="backup-"+f.unitName+"-"+Date.now().toString()+H,V.click(),await Ue(U.data.backup),x("close")}}catch(h){p.value.notificationTitle=a("error.cannot_download_backup"),p.value.notificationDescription=a(O(h))}finally{d.value=!1}}return(n,h)=>(c(),D(e(ne),{"primary-button-disabled":e(d),"primary-button-loading":e(d),"primary-label":e(a)("standalone.backup_and_restore.backup.download"),cancelLabel:e(a)("common.cancel"),title:e(a)("standalone.backup_and_restore.backup.download_backup"),visible:R.showDownloadModal,kind:"info","primary-button-kind":"primary","close-aria-label":e(a)("common.close"),onClose:h[0]||(h[0]=z=>n.$emit("close")),onPrimaryClick:h[1]||(h[1]=z=>y())},{default:r(()=>[w("div",null,k(e(a)("standalone.backup_and_restore.backup.modal_download_description",{name:M()})),1),e(p).notificationTitle?(c(),D(e(A),{key:0,class:"my-4",kind:"error",title:e(p).notificationTitle,description:e(p).notificationDescription},null,8,["title","description"])):T("",!0)]),_:1},8,["primary-button-disabled","primary-button-loading","primary-label","cancelLabel","title","visible","close-aria-label"]))}}),Ae=K({__name:"RunBackupModal",props:{showRunBackupModal:{type:Boolean,required:!0},unitName:{type:String}},emits:["success","close"],setup(R,{emit:t}){const{t:a}=Q(),f=t,x=l(!1);let v=l({...{notificationTitle:"",notificationDescription:""}});async function p(){var M,y;x.value=!0;try{let n=await q("ns.backup","registered-backup");(M=n==null?void 0:n.data)!=null&&M.message&&((y=n==null?void 0:n.data)==null?void 0:y.message)==="success"&&f("success")}catch(n){v.value.notificationTitle=a("error.cannot_run_backup"),v.value.notificationDescription=a(O(n))}finally{x.value=!1}}return(M,y)=>(c(),D(e(ne),{"primary-button-disabled":x.value,"primary-button-loading":x.value,"primary-label":e(a)("standalone.backup_and_restore.backup.run_backup"),"secondary-button-disabled":x.value,title:e(a)("standalone.backup_and_restore.backup.run_backup"),visible:R.showRunBackupModal,kind:"info","primary-button-kind":"primary","close-aria-label":e(a)("common.close"),onClose:y[0]||(y[0]=n=>M.$emit("close")),onPrimaryClick:y[1]||(y[1]=n=>p())},{default:r(()=>[w("div",null,k(e(a)("standalone.backup_and_restore.backup.run_backup_description",{name:R.unitName})),1),e(v).notificationTitle?(c(),D(e(A),{key:0,class:"my-4",kind:"error",title:e(v).notificationTitle,description:e(v).notificationDescription},null,8,["title","description"])):T("",!0)]),_:1},8,["primary-button-disabled","primary-button-loading","primary-label","secondary-button-disabled","title","visible","close-aria-label"]))}}),We={class:"space-y-8"},He={class:"flex justify-end gap-4"},Ye=K({__name:"SetPassphraseDrawer",props:{showPassphraseDrawer:{type:Boolean,required:!0},isSetPassphrase:{type:Boolean,required:!0}},emits:["success","close"],setup(R,{emit:t}){const{t:a}=Q(),f=R,x=t;_e(()=>f.showPassphraseDrawer,()=>{p.value={notificationTitle:"",notificationDescription:"",notificationDetails:""}});const d=l({passphrase:""}),v=l(!1);let p=l({notificationTitle:"",notificationDescription:"",notificationDetails:""});async function M(){v.value=!0;let y={passphrase:d.value.passphrase};q("ns.backup","set-passphrase",y).then(n=>{var h;(h=n==null?void 0:n.data)!=null&&h.message&&n.data.message=="success"&&x("success")}).catch(n=>{p.value.notificationTitle=a("error.cannot_set_passphrase"),p.value.notificationDescription=a(O(n)),p.value.notificationDetails=n.toString()}).finally(()=>{v.value=!1,d.value.passphrase=""})}return(y,n)=>(c(),D(e(fe),{"is-shown":R.showPassphraseDrawer,title:e(a)("standalone.backup_and_restore.backup.passphrase_drawer_title"),onClose:n[3]||(n[3]=h=>y.$emit("close"))},{default:r(()=>[w("div",We,[s(e(pe),{modelValue:d.value.passphrase,"onUpdate:modelValue":n[0]||(n[0]=h=>d.value.passphrase=h),label:e(a)("standalone.backup_and_restore.backup.passphrase"),isPassword:"",helperText:e(a)("standalone.backup_and_restore.backup.passphrase_reser_helper"),placeholder:R.isSetPassphrase?e(a)("standalone.backup_and_restore.backup.unchanged"):""},{tooltip:r(()=>[s(e(ge),null,{content:r(()=>[g(k(e(a)("standalone.backup_and_restore.backup.passphrase_helper")),1)]),_:1})]),_:1},8,["modelValue","label","helperText","placeholder"]),e(p).notificationTitle?(c(),D(e(A),{key:0,class:"my-4",kind:"error",title:e(p).notificationTitle,description:e(p).notificationDescription},te({_:2},[e(p).notificationDetails?{name:"details",fn:r(()=>[g(k(e(p).notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):T("",!0),n[4]||(n[4]=w("hr",null,null,-1)),w("div",He,[s(e(j),{disabled:v.value,kind:"tertiary",onClick:n[1]||(n[1]=h=>y.$emit("close"))},{default:r(()=>[g(k(e(a)("common.cancel")),1)]),_:1},8,["disabled"]),s(e(j),{disabled:v.value,kind:"primary",loading:v.value,onClick:n[2]||(n[2]=h=>M())},{default:r(()=>[g(k(e(a)("common.configure")),1)]),_:1},8,["disabled","loading"])])])]),_:1},8,["is-shown","title"]))}}),Ge=K({__name:"DeleteBackupModal",props:{showDeleteModal:{type:Boolean,required:!0},selectedBackupId:{type:String,required:!0},selectedBackupLabel:{type:String,required:!0}},emits:["close"],setup(R,{emit:t}){const{t:a}=Q(),f=R,x=t;let d=l(!1),p=l({...{notificationTitle:"",notificationDescription:""}});async function M(){var y;try{d.value=!0;let n={},h="backup";f.selectedBackupId&&(h="registered-delete-backup",n={id:f.selectedBackupId});let z=await q("ns.backup",h,n);((y=z==null?void 0:z.data)==null?void 0:y.result)==="success"&&x("close")}catch(n){p.value.notificationTitle=a("error.cannot_delete_backup"),p.value.notificationDescription=a(O(n))}finally{d.value=!1}}return(y,n)=>(c(),D(e(ne),{"primary-button-disabled":e(d),"primary-button-loading":e(d),"primary-label":e(a)("standalone.backup_and_restore.backup.delete"),"secondary-button-disabled":e(d),title:e(a)("standalone.backup_and_restore.backup.modal_delete_title"),visible:R.showDeleteModal,kind:"warning","primary-button-kind":"danger","close-aria-label":e(a)("common.close"),onClose:n[0]||(n[0]=h=>y.$emit("close")),onPrimaryClick:n[1]||(n[1]=h=>M())},{default:r(()=>[w("div",null,k(e(a)("standalone.backup_and_restore.backup.modal_delete_description",{name:R.selectedBackupLabel})),1),e(p).notificationTitle?(c(),D(e(A),{key:0,class:"my-4",kind:"error",title:e(p).notificationTitle,description:e(p).notificationDescription},null,8,["title","description"])):T("",!0)]),_:1},8,["primary-button-disabled","primary-button-loading","primary-label","secondary-button-disabled","title","visible","close-aria-label"]))}}),Je={key:0,class:"flex flex-col items-start justify-between gap-4 xl:flex-row"},Ke={class:"max-w-2xl text-sm font-normal text-gray-500 dark:text-gray-400"},Qe={key:0,class:"flex shrink-0 flex-row-reverse gap-4 xl:flex-row"},Ze={class:"flex gap-4"},Xe={key:4,class:"mt-5"},ea={class:"flex justify-center"},aa={class:"mt-2 flex justify-center"},ta={class:"-ml-2.5 flex items-center gap-2 xl:ml-0 xl:justify-end"},ia=K({__name:"BackupContent",setup(R){const{t}=Q(),a=l(!0),f=l(!0),x=l(!1),d=l(!1),v=l(!1),p=l(!1),M=l(!1),y=l(!1),n=l(!1),h=l(""),z=l(""),U=l(""),W=l(""),J=l(""),H=l(""),V=l([]);let P=l({notificationTitle:"",notificationDescription:""});be(()=>{E(),I(),B()});async function E(){var u,o;try{let i=await q("ns.subscription","info",{});(u=i==null?void 0:i.data)!=null&&u.active&&(x.value=(o=i==null?void 0:i.data)==null?void 0:o.active,await S())}catch(i){P.value.notificationTitle=t("error.cannot_retrieve_subscription_info"),P.value.notificationDescription=t(O(i))}finally{a.value=!1}}async function I(){try{let u=await q("system","board");h.value=u.data.hostname}catch(u){P.value.notificationTitle=t("error.cannot_retrieve_system_board"),P.value.notificationDescription=t(O(u))}}async function B(){var u,o;d.value=!1;try{let i=await q("ns.backup","is-passphrase-set",{});(o=(u=i==null?void 0:i.data)==null?void 0:u.values)!=null&&o.set&&(d.value=!0)}catch(i){P.value.notificationTitle=t("error.cannot_retrieve_passphrase"),P.value.notificationDescription=t(O(i))}finally{f.value=!1}}async function S(){var u,o,i;if(x.value)try{let b=await q("ns.backup","registered-list-backups");(i=(o=(u=b==null?void 0:b.data)==null?void 0:u.values)==null?void 0:o.backups)!=null&&i.length&&(V.value=b.data.values.backups,V.value.sort((_,C)=>Number(C.created)-Number(_.created)))}catch(b){P.value.notificationTitle=t("error.cannot_retrieve_backup"),P.value.notificationDescription=t(O(b))}}function G(u,o,i){v.value=!0,z.value=u,U.value=o,H.value=i}function ie(u,o){p.value=!0,W.value=u,J.value=o}function le(){y.value=!1,S(),n.value=!0,setTimeout(function(){n.value=!1},5e3)}function ee(){M.value=!1,B()}function ae(u){return u.replace("application/","")}function L(u){return u=="application/pgp-encrypted"||u=="application/octet-stream"?["fa","lock"]:["fa","unlock"]}function $(u){return[{id:"delete",label:t("common.delete"),iconStyle:"fas",icon:"trash",danger:!0,action:()=>{ie(u.id,re(new Date(Number(u.created)*1e3),"PPpp")+" ("+de(u.size)+")")}}]}function m(){p.value=!1,S()}return(u,o)=>(c(),F(X,null,[w("div",null,[a.value||f.value?(c(),D(e(ue),{key:0,lines:7,size:"lg"})):T("",!0),!a.value&&!f.value&&e(P).notificationTitle?(c(),D(e(A),{key:1,class:"my-4",kind:"error",title:e(P).notificationTitle,description:e(P).notificationDescription},null,8,["title","description"])):T("",!0),!a.value&&!f.value&&n.value?(c(),D(e(A),{key:2,class:"my-4",kind:"success",title:e(t)("standalone.backup_and_restore.backup.success_run_backup")},null,8,["title"])):T("",!0),!a.value&&!f.value&&!e(P).notificationTitle?(c(),F(X,{key:3},[x.value?(c(),F("div",Je,[w("p",Ke,k(e(t)("standalone.backup_and_restore.backup.description_subscription")),1),V.value.length?(c(),F("div",Qe,[s(e(j),{kind:"tertiary",onClick:o[0]||(o[0]=i=>M.value=!0)},{default:r(()=>[g(k(e(t)("standalone.backup_and_restore.backup.configure_passphrase")),1)]),_:1}),s(e(j),{kind:"secondary",onClick:o[1]||(o[1]=i=>y.value=!0)},{prefix:r(()=>[s(e(Z),{icon:["fa","play"],"aria-hidden":"true"})]),default:r(()=>[g(" "+k(e(t)("standalone.backup_and_restore.backup.run_backup")),1)]),_:1})])):T("",!0)])):(c(),D(ve,{key:1,description:e(t)("standalone.backup_and_restore.backup.description"),class:"max-w-12xl"},{default:r(()=>[w("div",Ze,[s(e(j),{kind:"secondary",size:"lg",type:"submit",onClick:o[2]||(o[2]=i=>v.value=!0)},{prefix:r(()=>[s(e(Z),{icon:["fa","circle-arrow-down"]})]),default:r(()=>[g(" "+k(e(t)("standalone.backup_and_restore.backup.download_backup")),1)]),_:1}),s(e(j),{kind:"tertiary",size:"lg",onClick:o[3]||(o[3]=i=>M.value=!0)},{default:r(()=>[g(k(e(t)("standalone.backup_and_restore.backup.configure_passphrase")),1)]),_:1})])]),_:1},8,["description"])),d.value?(c(),D(e(xe),{key:2,icon:["fas","check"],text:e(t)("standalone.backup_and_restore.backup.passphrase_is_set"),kind:"success"},null,8,["text"])):T("",!0)],64)):T("",!0),!a.value&&!f.value&&x.value&&!e(P).notificationTitle?(c(),F("div",Xe,[V.value.length?T("",!0):(c(),D(e(Be),{key:0,title:e(t)("standalone.backup_and_restore.backup.no_backups_found"),icon:["fa","box-archive"]},{default:r(()=>[w("div",ea,[s(e(j),{kind:"primary",size:"lg",onClick:o[4]||(o[4]=i=>y.value=!0)},{prefix:r(()=>[s(e(Z),{icon:["fa","play"],"aria-hidden":"true"})]),default:r(()=>[g(" "+k(e(t)("standalone.backup_and_restore.backup.run_backup")),1)]),_:1})]),w("div",aa,[s(e(j),{kind:"tertiary",size:"lg",onClick:o[5]||(o[5]=i=>M.value=!0)},{default:r(()=>[g(k(e(t)("standalone.backup_and_restore.backup.configure_passphrase")),1)]),_:1})])]),_:1},8,["title"])),V.value.length?(c(),D(e(Pe),{key:1,cardBreakpoint:"xl",ariaLabel:e(t)("standalone.backup_and_restore.backup.backups")},{default:r(()=>[s(e($e),null,{default:r(()=>[s(e(oe),null,{default:r(()=>[g(k(e(t)("standalone.backup_and_restore.backup.date")),1)]),_:1}),s(e(oe),null,{default:r(()=>[g(k(e(t)("standalone.backup_and_restore.backup.mimetype")),1)]),_:1}),s(e(oe),null,{default:r(()=>[g(k(e(t)("standalone.backup_and_restore.backup.size")),1)]),_:1}),s(e(oe))]),_:1}),s(e(Me),null,{default:r(()=>[(c(!0),F(X,null,ye(V.value,i=>(c(),D(e(Se),{key:i.name},{default:r(()=>[s(e(se),{"data-label":e(t)("standalone.backup_and_restore.backup.date")},{default:r(()=>[w("div",null,[s(e(Z),{icon:["fa","clock"],class:"mr-2"}),g(" "+k(e(re)(new Date(Number(i.created)*1e3),"PPpp")),1)])]),_:2},1032,["data-label"]),s(e(se),{"data-label":e(t)("standalone.backup_and_restore.backup.mimetype")},{default:r(()=>[w("div",null,[s(e(Z),{icon:L(i.mimetype),class:"mr-2"},null,8,["icon"]),g(" "+k(e(t)("standalone.backup_and_restore.backup."+ae(i.mimetype))),1)])]),_:2},1032,["data-label"]),s(e(se),{"data-label":e(t)("standalone.backup_and_restore.backup.size")},{default:r(()=>[w("div",null,k(e(de)(i.size)),1)]),_:2},1032,["data-label"]),s(e(se),{"data-label":e(t)("common.actions")},{default:r(()=>[w("div",ta,[s(e(j),{kind:"tertiary",onClick:b=>G(i.id,i.mimetype,i.created.toString())},{prefix:r(()=>[s(e(Z),{icon:["fas","arrow-circle-down"]})]),default:r(()=>[g(" "+k(e(t)("standalone.backup_and_restore.backup.download")),1)]),_:2},1032,["onClick"]),s(e(Re),{items:$(i),"align-to-right":!0},null,8,["items"])])]),_:2},1032,["data-label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["ariaLabel"])):T("",!0)])):T("",!0)]),s(Ee,{showDownloadModal:v.value,isSetPassphrase:d.value,isValidSubscription:x.value,selectedBackupType:U.value,selectedBackup:z.value,selectedBackupTime:H.value,unitName:h.value,onClose:o[6]||(o[6]=i=>v.value=!1)},null,8,["showDownloadModal","isSetPassphrase","isValidSubscription","selectedBackupType","selectedBackup","selectedBackupTime","unitName"]),s(Ae,{showRunBackupModal:y.value,unitName:h.value,onSuccess:o[7]||(o[7]=i=>le()),onClose:o[8]||(o[8]=i=>y.value=!1)},null,8,["showRunBackupModal","unitName"]),s(Ye,{showPassphraseDrawer:M.value,isSetPassphrase:d.value,onSuccess:o[9]||(o[9]=i=>ee()),onClose:o[10]||(o[10]=i=>M.value=!1)},null,8,["showPassphraseDrawer","isSetPassphrase"]),s(Ge,{showDeleteModal:p.value,selectedBackupId:W.value,selectedBackupLabel:J.value,onClose:o[11]||(o[11]=i=>m())},null,8,["showDeleteModal","selectedBackupId","selectedBackupLabel"])],64))}}),la={class:"flex"},na={class:"mr-auto self-start"},oa={class:"space-y-8"},sa={class:"flex justify-end gap-4"},me=45e3,ra=K({__name:"RestoreContent",setup(R){const{t}=Q(),a=l({passphrase:"",file:void 0,backup:""}),f=l(!0),x=l(!1),d=l(!1),v=l(!1),p=l("upload_file"),M=l([]),y=l(!1),n=l(0),h=l(),z=l(),U=[{id:"from_backup",label:t("standalone.backup_and_restore.restore.from_backup")},{id:"upload_file",label:t("standalone.backup_and_restore.restore.from_file")}],W=l(),J=l(),H=l(),V=l(0),P=l(!1),E=l(""),I=l(!1);let B=l({notificationTitle:"",notificationDescription:"",notificationDetails:""}),S=l({notificationTitle:"",notificationDescription:"",notificationDetails:""}),G=l({passphrase:"",file:"",backup:""});be(()=>{ie()});async function ie(){var i,b;try{let _=await q("ns.subscription","info",{});(i=_==null?void 0:_.data)!=null&&i.systemd_id&&((b=_==null?void 0:_.data)!=null&&b.active)&&(d.value=!0,p.value=d.value?"from_backup":"upload_file",await le())}catch(_){B.value.notificationTitle=t("error.cannot_retrieve_subscription_info"),B.value.notificationDescription=t(O(_)),B.value.notificationDetails=_.toString()}finally{f.value=!1}}async function le(){var i,b,_,C;if(d.value)try{let N=await q("ns.backup","registered-list-backups");(_=(b=(i=N==null?void 0:N.data)==null?void 0:i.values)==null?void 0:b.backups)!=null&&_.length&&(M.value=(C=N.data.values.backups)==null?void 0:C.map(Y=>({id:Y.id,label:re(new Date(Number(Y.created)*1e3),"PPpp")+" ("+de(Y.size)+")"})))}catch(N){B.value.notificationTitle=t("error.cannot_retrieve_backup"),B.value.notificationDescription=t(O(N)),B.value.notificationDetails=N.toString()}}function ee(){var _;let i=!0,b=!1;if(p.value==="upload_file"){let{valid:C,errMessage:N}=ce((_=a==null?void 0:a.value)!=null&&_.file?a.value.file:"");C||(G.value.file=t(N),i=!1)}else if(d.value&&p.value==="from_backup"){let{valid:C,errMessage:N}=ce(a.value.backup);C||(G.value.backup=t(N),i=!1),!i&&!b&&Ce(H)}return i}function ae(){G.value={passphrase:"",file:"",backup:""},S.value={notificationTitle:"",notificationDescription:"",notificationDetails:""}}function L(){a.value={passphrase:"",file:void 0,backup:""},E.value="",I.value=!1,V.value=0}function $(){v.value=!1,L(),ae()}async function m(){var i,b;if(ae(),ee()){x.value=!0;let _=!1;try{let C={},N="restore";if(a.value.passphrase&&Object.assign(C,{passphrase:a.value.passphrase}),d.value&&p.value==="from_backup"?(N="registered-restore",Object.assign(C,{file:a.value.backup})):Object.assign(C,{backup:E.value}),!_&&N){let Y=await q("ns.backup",N,C);(i=Y==null?void 0:Y.data)!=null&&i.message&&((b=Y==null?void 0:Y.data)==null?void 0:b.message)==="success"&&(y.value=!0,v.value=!1,o())}else S.value.notificationTitle=t("error.cannot_restore_backup")}catch(C){if(C instanceof Ve)for(const[,N]of C.errorBag){const Y=N[0];G.value.passphrase=t("error.backup_passphrase_"+Y)}else S.value.notificationTitle=t("error.cannot_restore_backup"),S.value.notificationDescription=t(O(C))}finally{x.value=!1}}}async function u(){if(P.value=!1,I.value=!1,!!a.value.file)try{V.value=.1,P.value=!0;const i=await Te(a.value.file,b=>{V.value=b.progress*100});E.value=i.data.data,I.value=!0}catch(i){B.value.notificationTitle=t("error.cannot_upload_backup"),B.value.notificationDescription=t(O(i)),B.value.notificationDetails=i.toString()}finally{P.value=!1}}function o(){z.value=setTimeout(()=>{location.reload()},me),h.value=setInterval(()=>{n.value+=.5},me/200)}return(i,b)=>(c(),F("div",null,[f.value?(c(),D(e(ue),{key:0,lines:4,size:"lg"})):T("",!0),!f.value&&e(B).notificationTitle?(c(),D(e(A),{key:1,class:"my-4",kind:"error",title:e(B).notificationTitle,description:e(B).notificationDescription},te({_:2},[e(B).notificationDetails?{name:"details",fn:r(()=>[g(k(e(B).notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):T("",!0),!f.value&&!e(B).notificationTitle?(c(),D(ve,{key:2,description:e(t)("standalone.backup_and_restore.restore.description"),class:"max-w-6xl"},{default:r(()=>[w("div",la,[w("div",na,[s(e(j),{class:"ml-",kind:"secondary",size:"lg",type:"submit",onClick:b[0]||(b[0]=_=>v.value=!0)},{prefix:r(()=>[s(e(Z),{icon:["fa","rotate"]})]),default:r(()=>[g(" "+k(e(t)("standalone.backup_and_restore.restore.restore_backup")),1)]),_:1})])])]),_:1},8,["description"])):T("",!0),s(e(fe),{"is-shown":v.value,title:e(t)("standalone.backup_and_restore.restore.restore_backup"),onClose:b[7]||(b[7]=_=>$())},{default:r(()=>[w("div",oa,[d.value?(c(),F(X,{key:0},[s(e(Le),{modelValue:p.value,"onUpdate:modelValue":b[1]||(b[1]=_=>p.value=_),label:e(t)("standalone.backup_and_restore.restore.source"),options:U},null,8,["modelValue","label"]),p.value==="from_backup"?(c(),D(e(we),{key:0,modelValue:a.value.backup,"onUpdate:modelValue":b[2]||(b[2]=_=>a.value.backup=_),options:M.value,label:e(t)("standalone.backup_and_restore.restore.backup"),"invalid-message":e(G).backup,noResultsLabel:e(t)("ne_combobox.no_results"),limitedOptionsLabel:e(t)("ne_combobox.limited_options_label"),noOptionsLabel:e(t)("ne_combobox.no_options_label"),"selected-label":e(t)("ne_combobox.selected"),"user-input-label":e(t)("ne_combobox.user_input_label"),optionalLabel:e(t)("common.optional"),class:"grow",ref_key:"backupRef",ref:H},null,8,["modelValue","options","label","invalid-message","noResultsLabel","limitedOptionsLabel","noOptionsLabel","selected-label","user-input-label","optionalLabel"])):T("",!0)],64)):T("",!0),p.value==="upload_file"?(c(),D(e(De),{key:1,label:e(t)("standalone.backup_and_restore.restore.upload_file",{extensions:"*.tar.gz, *.tar.gz.gpg, *.bin"}),dropzoneLabel:e(t)("ne_file_input.dropzone_label"),"invalid-message":e(G).file,onSelect:u,modelValue:a.value.file,"onUpdate:modelValue":b[3]||(b[3]=_=>a.value.file=_),accept:".tar.gz,.tar.gz.gpg,.bin",ref_key:"fileRef",ref:J},null,8,["label","dropzoneLabel","invalid-message","modelValue"])):T("",!0),s(e(pe),{modelValue:a.value.passphrase,"onUpdate:modelValue":b[4]||(b[4]=_=>a.value.passphrase=_),"invalid-message":e(G).passphrase,label:e(t)("standalone.backup_and_restore.restore.passphrase"),isPassword:"",optional:"",optionalLabel:e(t)("common.optional"),ref_key:"passphraseRef",ref:W},{tooltip:r(()=>[s(e(ge),null,{content:r(()=>[g(k(e(t)("standalone.backup_and_restore.restore.passphrase_helper")),1)]),_:1})]),_:1},8,["modelValue","invalid-message","label","optionalLabel"]),b[9]||(b[9]=w("hr",null,null,-1)),e(S).notificationTitle?(c(),D(e(A),{key:2,class:"my-4",kind:"error",title:e(S).notificationTitle,description:e(S).notificationDescription},te({_:2},[e(S).notificationDetails?{name:"details",fn:r(()=>[g(k(e(S).notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):T("",!0),w("div",sa,[s(e(j),{disabled:x.value,kind:"tertiary",onClick:b[5]||(b[5]=_=>$())},{default:r(()=>[g(k(e(t)("common.cancel")),1)]),_:1},8,["disabled"]),s(e(j),{disabled:x.value||(!d.value||p.value==="upload_file")&&!I.value,kind:"primary",loading:x.value,onClick:b[6]||(b[6]=_=>m())},{default:r(()=>[g(k(e(t)("standalone.backup_and_restore.restore.restore")),1)]),_:1},8,["disabled","loading"])])])]),_:1},8,["is-shown","title"]),s(e(ne),{"primary-label":e(t)("common.cancel"),"primary-button-disabled":!0,title:e(t)("standalone.backup_and_restore.restore.restore"),visible:y.value,"cancel-label":"",kind:"warning","close-aria-label":e(t)("common.close"),onClose:b[8]||(b[8]=_=>y.value=!1)},{default:r(()=>[g(k(e(t)("standalone.backup_and_restore.restore.restore_in_progress"))+" ",1),s(e(he),{class:"my-4",progress:n.value},null,8,["progress"])]),_:1},8,["primary-label","title","visible","close-aria-label"])]))}}),ua={key:2,class:"space-y-5"},ca={class:"flex items-center"},da={class:"flex-grow"},pa={class:"px-3 text-sm text-center"},fa={class:"flex-grow"},ba={class:"flex justify-end gap-4"},va=25e3,ka=K({__name:"MigrationDrawer",props:{showMigrationDrawer:{type:Boolean,required:!0}},emits:["success","close"],setup(R,{emit:t}){const{t:a}=Q(),f=R,x=t,d=l({file:void 0,devices:[]}),v=l(!1),p=l(!1),M=l(!1),y=l([]),n=l([{id:"",label:"",selected:"",ipaddr:""}]),h=l(),z=l(),U=l(0),W=l(!1),J=l(""),{startTimer:H,currentProgress:V,clearTimer:P}=qe({duration:va,progressStep:.5,onTimerFinish:()=>{M.value=!1}});let E=l({file:"",devices:[""]}),I=l({notificationTitle:"",notificationDescription:"",notificationDetails:""}),B=l({notificationTitle:"",notificationDescription:"",notificationDetails:""}),S=l({notificationTitle:"",notificationDescription:"",notificationDetails:""});async function G(){var $,m;if(E.value.file="",W.value=!1,!d.value.file)return;const L=ze(d.value.file,"tar.gz");if(!L.valid){E.value.file=a(L.errMessage);return}try{U.value=.1,W.value=!0;const u=await Te(d.value.file,i=>{U.value=i.progress*100});J.value=u.data.data;let o=await q("ns.migration","list-source-devices",{archive:J.value});(m=($=o==null?void 0:o.data)==null?void 0:$.devices)!=null&&m.length&&(n.value=o.data.devices.map(i=>({id:i.hwaddr,selected:void 0,ipaddr:i.ipaddr,label:i.name+(i.ipaddr?" - "+i.ipaddr:"")+(i.role?" - "+i.role:"")})))}catch(u){I.value.notificationTitle=a("error.upload_file_migration"),I.value.notificationDescription=a(O(u)),I.value.notificationDetails=u.toString()}finally{W.value=!1}}be(()=>{ie()});async function ie(){var L,$;v.value=!0;try{let m=await q("ns.migration","list-target-devices",{});($=(L=m==null?void 0:m.data)==null?void 0:L.devices)!=null&&$.length&&(y.value=m.data.devices.map(u=>({id:u.hwaddr,label:u.name+(u.ipaddr?" - "+u.ipaddr:"")+(u.role?" - "+u.role:""),role:u.role,hwaddr:u.hwaddr})))}catch(m){S.value.notificationTitle=a("error.cannot_retrieve_devices"),S.value.notificationDescription=a(O(m)),S.value.notificationDetails=m.toString()}finally{v.value=!1}}function le(){var u;let L=!0,{valid:$,errMessage:m}=ce((u=d==null?void 0:d.value)!=null&&u.file?d.value.file.name:"");if($||(E.value.file=a(m),L=!1),n.value.length){for(let[o,i]of n.value.entries())if(!i.selected){let{valid:b,errMessage:_}=ce(i.selected);b||(E.value.devices[o]=a(_),L=!1)}}return L}function ee(){h.value=void 0,V.value=0,E.value={file:"",devices:[""]}}async function ae(){var L,$;if(ee(),le()){p.value=!0;try{let m=[];if(n.value.length)for(let i of n.value)m.push({old:i.id,new:i.selected});let u={mappings:m,archive:J.value};x("close"),M.value=!0,H();let o=await q("ns.migration","migrate",u);(L=o==null?void 0:o.data)!=null&&L.result&&(($=o==null?void 0:o.data)==null?void 0:$.result)==="success"&&(M.value=!1,P(),x("success"))}catch(m){B.value.notificationTitle=a("error.cannot_migrate"),B.value.notificationDescription=a(O(m)),B.value.notificationDetails=m.toString()}finally{p.value=!1}}}return _e(()=>f.showMigrationDrawer,()=>{f.showMigrationDrawer&&(ee(),d.value={file:void 0,devices:[]})}),(L,$)=>(c(),F("div",null,[s(e(fe),{"is-shown":R.showMigrationDrawer,title:e(a)("standalone.backup_and_restore.migration.drawer_title"),onClose:$[3]||($[3]=m=>L.$emit("close"))},{default:r(()=>[v.value?(c(),D(e(ue),{key:0,lines:5})):T("",!0),!v.value&&e(S).notificationTitle?(c(),D(e(A),{key:1,class:"my-4",kind:"error",title:e(S).notificationTitle,description:e(S).notificationDescription},te({_:2},[e(S).notificationDetails?{name:"details",fn:r(()=>[g(k(e(S).notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):T("",!0),!v.value&&!e(S).notificationTitle?(c(),F("div",ua,[W.value?(c(),D(e(ue),{key:0,lines:5})):(c(),D(e(De),{key:1,label:e(a)("standalone.backup_and_restore.migration.input_upload_file"),progress:U.value,onSelect:G,dropzoneLabel:e(a)("ne_file_input.dropzone_label"),"invalid-message":e(E).file,modelValue:d.value.file,"onUpdate:modelValue":$[0]||($[0]=m=>d.value.file=m),ref_key:"fileRef",ref:z},null,8,["label","progress","dropzoneLabel","invalid-message","modelValue"])),e(I).notificationTitle?(c(),D(e(A),{key:2,class:"my-4",kind:"error",title:e(I).notificationTitle,description:e(I).notificationDescription},te({_:2},[e(I).notificationDetails?{name:"details",fn:r(()=>[g(k(e(I).notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):T("",!0),d.value.file&&!W.value&&n.value.length?(c(),F(X,{key:3},[w("div",null,[s(e(Ne),null,{default:r(()=>[g(k(e(a)("standalone.backup_and_restore.migration.remap_interfaces")),1)]),_:1})]),(c(!0),F(X,null,ye(n.value,(m,u)=>(c(),F("div",{key:u},[w("div",ca,[w("div",da,[s(e(pe),{modelValue:m.label,"onUpdate:modelValue":o=>m.label=o,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),w("div",pa,k(e(a)("standalone.backup_and_restore.migration.to")),1),w("div",fa,[s(e(we),{modelValue:m.selected,"onUpdate:modelValue":o=>m.selected=o,class:"grow",options:y.value,"invalid-message":e(E).devices[u],ref_for:!0,ref:"deviceMigration"+u,noResultsLabel:e(a)("ne_combobox.no_results"),limitedOptionsLabel:e(a)("ne_combobox.limited_options_label"),noOptionsLabel:e(a)("ne_combobox.no_options_label"),"selected-label":e(a)("ne_combobox.selected"),"user-input-label":e(a)("ne_combobox.user_input_label"),optionalLabel:e(a)("common.optional")},null,8,["modelValue","onUpdate:modelValue","options","invalid-message","noResultsLabel","limitedOptionsLabel","noOptionsLabel","selected-label","user-input-label","optionalLabel"])])])]))),128)),s(e(A),{kind:"info",title:e(a)("standalone.backup_and_restore.migration.remap_interfaces_description")},null,8,["title"])],64)):T("",!0),$[4]||($[4]=w("hr",null,null,-1)),e(B).notificationTitle?(c(),D(e(A),{key:4,class:"my-4",kind:"error",title:e(B).notificationTitle,description:e(B).notificationDescription},te({_:2},[e(B).notificationDetails?{name:"details",fn:r(()=>[g(k(e(B).notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):T("",!0),w("div",ba,[s(e(j),{disabled:p.value,kind:"tertiary",onClick:$[1]||($[1]=m=>L.$emit("close"))},{default:r(()=>[g(k(e(a)("common.cancel")),1)]),_:1},8,["disabled"]),s(e(j),{disabled:p.value,kind:"primary",loading:p.value,onClick:$[2]||($[2]=m=>ae())},{default:r(()=>[g(k(e(a)("standalone.backup_and_restore.migration.migrate")),1)]),_:1},8,["disabled","loading"])])])):T("",!0)]),_:1},8,["is-shown","title"]),s(e(ne),{"primary-label":e(a)("common.cancel"),"primary-button-disabled":!0,title:e(a)("standalone.backup_and_restore.migration.migrate"),visible:M.value,"cancel-label":"",kind:"warning","primary-button-kind":"danger","close-aria-label":e(a)("common.close")},{default:r(()=>[g(k(e(a)("standalone.backup_and_restore.migration.migration_in_progress"))+" "+k([...new Set(n.value.map(m=>m.ipaddr).filter(Boolean))].join(", "))+" ",1),s(e(he),{class:"my-4",progress:e(V)},null,8,["progress"])]),_:1},8,["primary-label","title","visible","close-aria-label"])]))}}),ma={class:"mb-8 text-sm font-normal text-gray-500 dark:text-gray-400"},_a={class:"flex"},ga={class:"self-start mr-auto"},ya=K({__name:"MigrationContent",setup(R){const{t}=Q();let a=l(!1),f=l(!1);function x(){f.value=!0,setTimeout(function(){f.value=!1},5e3)}return(d,v)=>(c(),F("div",null,[e(f)?(c(),D(e(A),{key:0,class:"my-4",kind:"success",title:e(t)("standalone.backup_and_restore.migration.success_migration")},null,8,["title"])):T("",!0),s(ve,{class:"max-w-6xl"},{description:r(()=>[w("div",ma,[g(k(e(t)("standalone.backup_and_restore.migration.description"))+" ",1),v[3]||(v[3]=w("div",{class:"mt-4"},null,-1))])]),default:r(()=>[w("div",_a,[w("div",ga,[s(e(j),{class:"ml-6",kind:"secondary",size:"lg",type:"submit",onClick:v[0]||(v[0]=p=>ke(a)?a.value=!0:a=!0)},{prefix:r(()=>[s(e(Z),{icon:["fa","arrow-circle-up"]})]),default:r(()=>[g(" "+k(e(t)("standalone.backup_and_restore.migration.upload_file")),1)]),_:1})])]),s(ka,{showMigrationDrawer:e(a),onSuccess:v[1]||(v[1]=p=>x()),onClose:v[2]||(v[2]=p=>ke(a)?a.value=!1:a=!1)},null,8,["showMigrationDrawer"])]),_:1})]))}}),wa={class:"flex flex-col"},$a=K({__name:"BackupAndRestoreView",setup(R){const{t}=Q(),{tabs:a,selectedTab:f}=Fe([{name:"tab-backup",label:t("standalone.backup_and_restore.tabs.backup")},{name:"tab-restore",label:t("standalone.backup_and_restore.tabs.restore")},{name:"tab-migration",label:t("standalone.backup_and_restore.tabs.migration")}]);return(x,d)=>(c(),F(X,null,[s(e(Ie),{tag:"h3",class:"mb-7"},{default:r(()=>[g(k(e(t)("standalone.backup_and_restore.title")),1)]),_:1}),w("div",wa,[s(e(je),{selected:e(f),srSelectTabLabel:e(t)("ne_tabs.select_a_tab"),srTabsLabel:e(t)("ne_tabs.tabs"),tabs:e(a),class:"mb-8",onSelectTab:d[0]||(d[0]=v=>f.value=v)},null,8,["selected","srSelectTabLabel","srTabsLabel","tabs"]),e(f)=="tab-backup"?(c(),D(ia,{key:0})):T("",!0),e(f)=="tab-restore"?(c(),D(ra,{key:1})):T("",!0),e(f)=="tab-migration"?(c(),D(ya,{key:2})):T("",!0)])],64))}});export{$a as default};
