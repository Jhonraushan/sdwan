import{u as Ye}from"./useTabs-BeLQ169O.js";import{d as ue,u as re,g as $e,h as r,i as h,M as ve,w as s,q as C,z as F,ad as xe,av as z,t as p,n as B,j as k,l as e,k as i,_ as H,m as T,ap as Ze,O as Be,r as u,aa as Xe,J as he,L as we,y as Me,a1 as en,a5 as nn,Q as Y,s as be,a0 as fe,ar as ye,$ as Fe,ai as Ae,e as R,V as Z,ag as ln,S as j,a_ as Ue,aM as tn,aP as Le,bL as Ie,a8 as an,bN as on,c1 as sn,Y as Pe,ax as ke,as as un,at as rn,U as dn,o as pn,b as vn,aj as cn,W as mn,a9 as _n}from"./index-BlEQ5104.js";import{_ as bn}from"./NeTable.vue_vue_type_script_setup_true_lang-BDPau7Vg.js";/* empty css                                                */import{_ as ge}from"./NeMultiTextInput.vue_vue_type_script_setup_true_lang-DwfeP71-.js";import"./isArrayLikeObject-CpCvCe5A.js";const fn={class:"align-center flex justify-end"},gn=ue({__name:"TunnelTable",props:{tunnels:{},isClientTunnel:{type:Boolean}},emits:["tunnel-delete","tunnel-edit","tunnel-toggle-enable","tunnel-download"],setup(q,{emit:S}){const{t}=re(),m=q,n=S,g=[{label:t("standalone.openvpn_tunnel.name"),key:"name"},{label:t("standalone.openvpn_tunnel.port"),key:"port"},...m.isClientTunnel?[]:[{label:t("standalone.openvpn_tunnel.local_networks"),key:"local_networks"}],{label:t("standalone.openvpn_tunnel.remote_networks"),key:"remote_networks"},...m.isClientTunnel?[{label:t("standalone.openvpn_tunnel.remote_hosts"),key:"remote_hosts"}]:[],{label:t("standalone.openvpn_tunnel.topology"),key:"topology"},...m.isClientTunnel?[]:[{label:t("standalone.openvpn_tunnel.vpn_network"),key:"vpn_network"}],{label:t("standalone.openvpn_tunnel.status"),key:"status"},{label:t("standalone.openvpn_tunnel.connection"),key:"connected"},{label:"",key:"menu"}];function b(d){return[{id:"download",label:t("standalone.openvpn_tunnel.download"),iconStyle:"fas",icon:"circle-arrow-down",action:()=>{n("tunnel-download",d)}},{id:"enable_disable",label:d.enabled?t("standalone.openvpn_tunnel.disable"):t("standalone.openvpn_tunnel.enable"),iconStyle:"fas",icon:d.enabled?"circle-xmark":"circle-check",action:()=>{n("tunnel-toggle-enable",d)}},{id:"delete",label:t("common.delete"),iconStyle:"fas",icon:"trash",danger:!0,action:()=>{n("tunnel-delete",d)}}]}function _(d){return d.enabled?[]:["text-gray-400","dark:text-gray-700"]}return(d,f)=>{const V=$e("font-awesome-icon");return r(),h(bn,{data:d.tunnels,headers:g},ve({name:s(({item:o})=>[k("p",{class:z([..._(o)])},p(o.ns_name),3)]),port:s(({item:o})=>[k("p",{class:z([..._(o)])},p(o.port),3)]),remote_networks:s(({item:o})=>[o.remote_network.length>0?(r(!0),C(F,{key:0},xe(o.remote_network.slice(0,2),(v,L)=>(r(),C("p",{key:v,class:z([..._(o)])},p(v)+p(o.remote_network.length>2&&L==1?"...":""),3))),128)):(r(),C("p",{key:1,class:z([..._(o)])},"-",2))]),topology:s(({item:o})=>[k("p",{class:z([..._(o)])},p(o.topology==="subnet"?e(t)("standalone.openvpn_tunnel.subnet"):e(t)("standalone.openvpn_tunnel.p2p")),3)]),status:s(({item:o})=>[k("div",{class:z(["flex","flex-row","items-center",..._(o)])},[i(V,{icon:["fas",o.enabled?"circle-check":"circle-xmark"],class:"mr-2 h-5 w-5","aria-hidden":"true"},null,8,["icon"]),k("p",null,p(o.enabled?e(t)("standalone.openvpn_tunnel.enabled"):e(t)("standalone.openvpn_tunnel.disabled")),1)],2)]),connected:s(({item:o})=>[k("div",{class:z(["flex","flex-row","items-center",..._(o)])},[i(V,{icon:["fas",o.connected?"circle-check":"circle-xmark"],class:z(["mr-2","h-5","w-5",o.connected&&o.enabled?"text-green-600 dark:text-green-400":o.enabled?"text-red-600 dark:text-red-400":""]),"aria-hidden":"true"},null,8,["icon","class"]),k("p",null,p(o.connected?e(t)("standalone.openvpn_tunnel.connected"):e(t)("standalone.openvpn_tunnel.not_connected")),1)],2)]),menu:s(({item:o})=>[k("div",fn,[i(e(H),{kind:"tertiary",onClick:v=>n("tunnel-edit",o)},{prefix:s(()=>[i(V,{icon:["fas","pen-to-square"],class:"h-4 w-4","aria-hidden":"true"})]),default:s(()=>[T(" "+p(e(t)("common.edit")),1)]),_:2},1032,["onClick"]),i(e(Ze),{items:b(o),"align-to-right":!0},null,8,["items"])])]),_:2},[m.isClientTunnel?void 0:{name:"local_networks",fn:s(({item:o})=>[o.local_network.length>0?(r(!0),C(F,{key:0},xe(o.local_network.slice(0,2),(v,L)=>(r(),C("p",{key:v,class:z([..._(o)])},p(v)+p(o.local_network.length>2&&L==1?"...":""),3))),128)):(r(),C("p",{key:1,class:z([..._(o)])},"-",2))]),key:"0"},m.isClientTunnel?{name:"remote_hosts",fn:s(({item:o})=>[o.remote_host.length>0?(r(!0),C(F,{key:0},xe(o.remote_host.slice(0,2),(v,L)=>(r(),C("p",{key:v,class:z([..._(o)])},p(v)+p(o.remote_host.length>2&&L==1?"...":""),3))),128)):B("",!0)]),key:"1"}:void 0,m.isClientTunnel?void 0:{name:"vpn_network",fn:s(({item:o})=>[k("p",{class:z([..._(o)])},p(o.vpn_network),3)]),key:"2"}]),1032,["data"])}}}),yn={key:2,class:"flex flex-col gap-y-6"},kn={class:"font-semibold"},wn={class:"font-semibold"},Vn={class:"flex justify-end"},Tn=ue({__name:"CreateOrEditTunnelDrawer",props:{isShown:{type:Boolean},itemToEdit:{},isClientTunnel:{type:Boolean}},emits:["close","add-edit-tunnel"],setup(q,{emit:S}){const t=q,{isShown:m}=Be(t),{t:n}=re(),g=S,b=u(!1),_=u(!1),d=u({notificationTitle:"",notificationDescription:"",notificationDetails:""}),f=u(new Xe),V=u([]),o=u([]),v=u([]),L=u(!1),D=u(""),M=u(!0),U=u(""),I=u(""),E=u([""]),$=u("subnet"),K=u(""),A=u(""),w=u(""),x=u("udp"),P=u("disabled"),J=u("SHA256"),X=u("AES-256-GCM"),ee=u([""]),ne=u([]),ce=u("auto"),le=u(""),te=u([""]),ae=u("certificate"),oe=u(""),ie=u(""),de=u(""),me=u("bridged"),Se=u([]),Ee=u([]),Ve=u([]),je=[{id:"disabled",label:n("standalone.openvpn_tunnel.disabled")},{id:"lz0",label:"LZO"},{id:"lz4",label:"LZ4"}],ze=[{id:"subnet",label:n("standalone.openvpn_tunnel.subnet")},{id:"p2p",label:n("standalone.openvpn_tunnel.p2p")}],Re=[{id:"certificate",label:n("standalone.openvpn_tunnel.certificate")},{id:"username_password_certificate",label:n("standalone.openvpn_tunnel.username_password_certificate")}],He=[{id:"routed",label:n("standalone.openvpn_tunnel.routed")},{id:"bridged",label:n("standalone.openvpn_tunnel.bridged")}],qe=[{id:"udp",label:n("standalone.openvpn_tunnel.udp")},{id:"tcp",label:n("standalone.openvpn_tunnel.tcp")}],Ke=[{id:"auto",label:n("standalone.openvpn_tunnel.auto")},{id:"1.1",label:"1.1"},{id:"1.2",label:"1.2"}];async function Je(){try{b.value=!0,Ee.value=[{id:"auto",label:n("standalone.openvpn_tunnel.auto"),description:`(${n("standalone.openvpn_tunnel.server_client_negotiation")})`},...(await R("ns.ovpntunnel","list-cipher")).data.ciphers.map(y=>({id:y.name,label:y.name,description:"("+n("standalone.openvpn_tunnel."+y.description)+")"}))],Se.value=[{id:"auto",label:n("standalone.openvpn_tunnel.auto"),description:`(${n("standalone.openvpn_tunnel.server_client_negotiation")})`},...(await R("ns.ovpntunnel","list-digest")).data.digests.map(y=>({id:y.name,label:y.name,description:"("+n("standalone.openvpn_tunnel."+y.description)+")"}))],b.value=!1}catch(y){d.value.notificationTitle=n("error.cannot_retrieve_tunnel_options"),d.value.notificationDescription=n(Z(y)),d.value.notificationDetails=y.toString()}}function Oe(){f.value.clear(),V.value=[],o.value=[],v.value=[]}async function Ge(){var y,a;if(b.value=!0,t.itemToEdit){let c;if(t.isClientTunnel?c=(await R("ns.ovpntunnel","get-tunnel-client",{id:t.itemToEdit.id})).data:c=(await R("ns.ovpntunnel","get-tunnel-server",{id:t.itemToEdit.id})).data,D.value=c.id,U.value=c.ns_name,M.value=c.enabled==="1",I.value=c.port,x.value=c.proto,K.value=c.ifconfig_local??"",A.value=c.ifconfig_remote??"",w.value=c.secret??"",$.value=K.value||A.value||w.value?"p2p":"subnet",P.value=c.compress??"disabled",X.value=c.cipher??"auto",J.value=c.auth??"auto",t.isClientTunnel){const l=c;te.value=l.remote,E.value=l.route??[""],oe.value=l.username??"",ie.value=l.password??"",de.value=l.certificate??"",me.value=l.dev_type==="tun"?"routed":"bridged",ae.value=oe.value||ie.value?"username_password_certificate":"certificate"}else{const l=c;E.value=l.remote??[""],ne.value=((y=l.local)==null?void 0:y.map(N=>({id:N,label:N})))??[],Ve.value=((a=l.local)==null?void 0:a.map(N=>({id:N,label:N})))??[],ee.value=l.ns_public_ip??[],le.value=l.server??""}}else{D.value="",M.value=!0,U.value="",E.value=[""],$.value="subnet",x.value="udp",P.value="disabled",J.value="SHA256",X.value="AES-256-GCM",t.isClientTunnel?(te.value=[""],ae.value="certificate",oe.value="",ie.value="",de.value="",me.value="routed"):ce.value="auto";try{const c=(await R("ns.ovpntunnel","get-defaults")).data;if(I.value=c.port.toString(),K.value=c.ifconfig_local,A.value=c.ifconfig_remote,w.value=c.secret,!t.isClientTunnel){le.value=c.server,ee.value=c.remote;const l=c.route.map(N=>({id:N,label:N}));Ve.value=[...l],ne.value=[...l]}}catch(c){d.value.notificationTitle=n("error.cannot_retrieve_tunnel_defaults"),d.value.notificationDescription=n(Z(c)),d.value.notificationDetails=c.toString()}}b.value=!1}function Te(y,a){for(let c of y)c.valid||f.value.set(a,[n(c.errMessage)]);return y.every(c=>c.valid)}function We(){Oe(),E.value.forEach(()=>{V.value.push("")}),te.value.forEach(()=>{v.value.push("")}),ee.value.forEach(()=>{o.value.push("")});const y=[[[j(K.value),Ue(K.value)],"localP2pIp"],[[j(A.value),Ue(A.value)],"remoteP2pIp"],[[j(w.value)],"presharedKey"]],c=[[[j(U.value),tn(U.value,10)],"name"],...$.value==="p2p"?y:[]].map(([G,W])=>Te(G,W)).every(G=>G);let l=!0;for(let[G,W]of E.value.entries()){const pe=t.isClientTunnel&&$.value=="subnet";let se=[...pe?[]:[j(W)],Le(W)];for(let O of se)if(!O.valid&&(!pe||W!="")){V.value[G]=n(O.errMessage),l=!1;break}}let N=!0;if(t.isClientTunnel){const G=[[[j(oe.value)],"username"],[[j(ie.value)],"password"]],W=[[[j(de.value)],"certificate"],...ae.value==="username_password_certificate"?G:[]],pe=[[[j(I.value),Ie(I.value)],"port"],...$.value==="subnet"?W:[]];let se=!0;for(let[O,Q]of te.value.entries()){let Ce=[j(Q),an(Q)];for(let _e of Ce)if(!_e.valid){v.value[O]=n(_e.errMessage),se=!1;break}}N=pe.map(([O,Q])=>Te(O,Q)).every(O=>O)&&se}else{const G=ne.value.map(O=>Le(O.id)),W=[[[j(le.value),Le(le.value)],"vpnNetwork"]],pe=[[[j(I.value),Ie(I.value)],"port"],...$.value!=="p2p"?W:[],[[on(ne.value),G.find(O=>!O.valid)??{valid:!0}],"localNetworks"]];let se=!0;for(let[O,Q]of ee.value.entries()){let Ce=[j(Q),sn(Q)];for(let _e of Ce)if(!_e.valid){o.value[O]=n(_e.errMessage),se=!1;break}}N=pe.map(([O,Q])=>Te(O,Q)).every(O=>O)&&se}return c&&N&&l}async function Qe(){d.value.notificationTitle="",d.value.notificationDescription="",d.value.notificationDetails="";const y=D.value!="";try{if(_.value=!0,We()){let a={...y?{id:D.value}:{},ns_name:U.value,port:I.value,proto:x.value,compress:P.value==="disabled"?"":P.value,enabled:M.value?"1":"0",auth:J.value==="auto"?"":J.value,remote:[],cipher:X.value==="auto"?"":X.value,...$.value==="subnet"?{}:{ifconfig_local:K.value,ifconfig_remote:A.value,secret:w.value}};if(t.isClientTunnel){const c=y?"edit-client":"add-client",l={...a,...$.value==="subnet"?{certificate:de.value,...ae.value==="username_password_certificate"?{username:oe.value,password:ie.value}:{}}:{},dev_type:me.value=="bridged"?"tap":"tun",remote:te.value,route:E.value.filter(Boolean)};await R("ns.ovpntunnel",c,l)}else{const c=y?"edit-server":"add-server",l={...a,local:ne.value.map(N=>N.id),topology:$.value,ns_public_ip:ee.value,tls_version_min:ce.value==="auto"?"":ce.value,remote:E.value,...$.value==="subnet"?{server:le.value}:{}};await R("ns.ovpntunnel",c,l)}g("add-edit-tunnel"),De()}}catch(a){a instanceof ln?f.value=a.errorBag:(d.value.notificationTitle=n(y?"error.cannot_edit_tunnel":"error.cannot_create_tunnel"),d.value.notificationDescription=n(Z(a)),d.value.notificationDetails=a.toString())}finally{_.value=!1}}function De(){Oe(),d.value.notificationTitle="",d.value.notificationDescription="",d.value.notificationDetails="",g("close")}return he(()=>[t.isClientTunnel,$.value],()=>{t.isClientTunnel&&(V.value=[])}),he(()=>[$.value],()=>{t.itemToEdit||(X.value=$.value==="p2p"?"AES-256-CBC":"AES-256-GCM")}),he(()=>t.isShown,()=>{t.isShown&&Je().then(()=>{Ge()})}),(y,a)=>{const c=$e("font-awesome-icon");return r(),h(e(Ae),{"is-shown":e(m),onClose:a[28]||(a[28]=l=>De()),closeAriaLabel:e(n)("common.shell.close_side_drawer"),title:D.value?y.isClientTunnel?e(n)("standalone.openvpn_tunnel.edit_client_tunnel"):e(n)("standalone.openvpn_tunnel.edit_server_tunnel"):y.isClientTunnel?e(n)("standalone.openvpn_tunnel.add_client_tunnel"):e(n)("standalone.openvpn_tunnel.add_server_tunnel")},{default:s(()=>[d.value.notificationTitle?(r(),h(e(we),{key:0,title:d.value.notificationTitle,description:d.value.notificationDescription,class:"mb-6",kind:"error"},ve({_:2},[d.value.notificationDetails?{name:"details",fn:s(()=>[T(p(d.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):B("",!0),b.value?(r(),h(e(Me),{key:1,lines:20})):(r(),C("div",yn,[k("div",null,[i(e(en),null,{default:s(()=>[T(p(e(n)("standalone.openvpn_tunnel.status")),1)]),_:1}),i(e(nn),{modelValue:M.value,"onUpdate:modelValue":a[0]||(a[0]=l=>M.value=l),label:M.value?e(n)("standalone.openvpn_tunnel.enabled"):e(n)("standalone.openvpn_tunnel.disabled")},null,8,["modelValue","label"])]),i(e(Y),{modelValue:U.value,"onUpdate:modelValue":a[1]||(a[1]=l=>U.value=l),disabled:D.value!="",label:e(n)("standalone.openvpn_tunnel.tunnel_name"),"invalid-message":e(n)(f.value.getFirstI18nKeyFor("ns_name"))},null,8,["modelValue","disabled","label","invalid-message"]),y.isClientTunnel?(r(),C(F,{key:1},[i(ge,{modelValue:te.value,"onUpdate:modelValue":a[6]||(a[6]=l=>te.value=l),"add-item-label":e(n)("standalone.openvpn_tunnel.add_remote_address"),title:e(n)("standalone.openvpn_tunnel.remote_hosts"),"invalid-messages":v.value},null,8,["modelValue","add-item-label","title","invalid-messages"]),i(e(Y),{modelValue:I.value,"onUpdate:modelValue":a[7]||(a[7]=l=>I.value=l),type:"number",label:e(n)("standalone.openvpn_tunnel.remote_port"),"invalid-message":f.value.getFirstFor("port")},null,8,["modelValue","label","invalid-message"])],64)):(r(),C(F,{key:0},[i(ge,{modelValue:ee.value,"onUpdate:modelValue":a[2]||(a[2]=l=>ee.value=l),"add-item-label":e(n)("standalone.openvpn_tunnel.add_endpoint"),title:e(n)("standalone.openvpn_tunnel.public_endpoints"),"invalid-messages":o.value},{tooltip:s(()=>[i(e(be),null,{content:s(()=>[T(p(e(n)("standalone.openvpn_tunnel.public_endpoints_tooltip")),1)]),_:1})]),_:1},8,["modelValue","add-item-label","title","invalid-messages"]),i(e(Y),{modelValue:I.value,"onUpdate:modelValue":a[3]||(a[3]=l=>I.value=l),type:"number",label:e(n)("standalone.openvpn_tunnel.port"),"invalid-message":f.value.getFirstFor("port")},null,8,["modelValue","label","invalid-message"]),i(e(fe),{label:e(n)("standalone.openvpn_tunnel.local_networks"),placeholder:e(n)("standalone.openvpn_tunnel.choose_network"),multiple:!0,options:Ve.value,modelValue:ne.value,"onUpdate:modelValue":a[4]||(a[4]=l=>ne.value=l),"invalid-message":f.value.getFirstFor("localNetworks"),"no-options-label":e(n)("ne_combobox.no_options_label"),"no-results-label":e(n)("ne_combobox.no_results"),"show-selected-label":!0,"selected-label":e(n)("ne_combobox.selected"),"user-input-label":e(n)("ne_combobox.user_input_label"),"accept-user-input":!0,limitedOptionsLabel:e(n)("ne_combobox.limited_options_label"),optionalLabel:e(n)("common.optional")},{tooltip:s(()=>[i(e(be),null,{content:s(()=>[T(p(e(n)("standalone.openvpn_tunnel.local_networks_tooltip")),1)]),_:1})]),_:1},8,["label","placeholder","options","modelValue","invalid-message","no-options-label","no-results-label","selected-label","user-input-label","limitedOptionsLabel","optionalLabel"]),i(ge,{modelValue:E.value,"onUpdate:modelValue":a[5]||(a[5]=l=>E.value=l),"add-item-label":e(n)("standalone.openvpn_tunnel.add_remote_address"),title:e(n)("standalone.openvpn_tunnel.remote_networks"),"invalid-messages":V.value},{tooltip:s(()=>[i(e(be),null,{content:s(()=>[T(p(e(n)("standalone.openvpn_tunnel.remote_networks_tooltip")),1)]),_:1})]),_:1},8,["modelValue","add-item-label","title","invalid-messages"])],64)),i(e(ye),{label:e(n)("standalone.openvpn_tunnel.topology"),options:ze,modelValue:$.value,"onUpdate:modelValue":a[8]||(a[8]=l=>$.value=l)},{tooltip:s(()=>[i(e(be),null,{content:s(()=>[k("p",null,[k("span",kn,p(e(n)("standalone.openvpn_tunnel.topology_tooltip_subnet_title"))+":",1),T(" "+p(e(n)("standalone.openvpn_tunnel.topology_tooltip_subnet_description")),1)]),k("p",null,[k("span",wn,p(e(n)("standalone.openvpn_tunnel.p2p"))+":",1),T(" "+p(e(n)("standalone.openvpn_tunnel.topology_tooltip_p2p_description")),1)])]),_:1})]),_:1},8,["label","modelValue"]),$.value=="subnet"?(r(),C(F,{key:2},[y.isClientTunnel?(r(),C(F,{key:1},[i(e(ye),{label:e(n)("standalone.openvpn_tunnel.authentication"),options:Re,modelValue:ae.value,"onUpdate:modelValue":a[10]||(a[10]=l=>ae.value=l)},null,8,["label","modelValue"]),ae.value=="username_password_certificate"?(r(),C(F,{key:0},[i(e(Y),{modelValue:oe.value,"onUpdate:modelValue":a[11]||(a[11]=l=>oe.value=l),label:e(n)("standalone.openvpn_tunnel.username"),"invalid-message":f.value.getFirstFor("username")},null,8,["modelValue","label","invalid-message"]),i(e(Y),{modelValue:ie.value,"onUpdate:modelValue":a[12]||(a[12]=l=>ie.value=l),"is-password":!0,label:e(n)("standalone.openvpn_tunnel.password"),"invalid-message":f.value.getFirstFor("password")},null,8,["modelValue","label","invalid-message"])],64)):B("",!0),i(e(Fe),{modelValue:de.value,"onUpdate:modelValue":a[13]||(a[13]=l=>de.value=l),label:e(n)("standalone.openvpn_tunnel.certificate"),"invalid-message":f.value.getFirstFor("certificate")},null,8,["modelValue","label","invalid-message"])],64)):(r(),h(e(Y),{key:0,modelValue:le.value,"onUpdate:modelValue":a[9]||(a[9]=l=>le.value=l),label:e(n)("standalone.openvpn_tunnel.vpn_network"),"invalid-message":f.value.getFirstFor("vpnNetwork")},null,8,["modelValue","label","invalid-message"]))],64)):(r(),C(F,{key:3},[i(e(Y),{modelValue:K.value,"onUpdate:modelValue":a[14]||(a[14]=l=>K.value=l),label:e(n)("standalone.openvpn_tunnel.local_p2p_ip"),"invalid-message":f.value.getFirstFor("localP2pIp")},null,8,["modelValue","label","invalid-message"]),i(e(Y),{modelValue:A.value,"onUpdate:modelValue":a[15]||(a[15]=l=>A.value=l),label:e(n)("standalone.openvpn_tunnel.remote_p2p_ip"),"invalid-message":f.value.getFirstFor("remoteP2pIp")},null,8,["modelValue","label","invalid-message"]),y.isClientTunnel?(r(),h(ge,{key:0,modelValue:E.value,"onUpdate:modelValue":a[16]||(a[16]=l=>E.value=l),"add-item-label":e(n)("standalone.openvpn_tunnel.add_remote_address"),title:e(n)("standalone.openvpn_tunnel.remote_networks"),"invalid-messages":V.value},null,8,["modelValue","add-item-label","title","invalid-messages"])):B("",!0),i(e(Fe),{modelValue:w.value,"onUpdate:modelValue":a[17]||(a[17]=l=>w.value=l),label:e(n)("standalone.openvpn_tunnel.preshared_key"),"invalid-message":f.value.getFirstFor("presharedKey")},null,8,["modelValue","label","invalid-message"])],64)),k("div",null,[i(e(H),{kind:"tertiary",onClick:a[18]||(a[18]=l=>L.value=!L.value)},{suffix:s(()=>[i(c,{icon:["fas",L.value?"chevron-up":"chevron-down"],class:"h-4 w-4","aria-hidden":"true"},null,8,["icon"])]),default:s(()=>[T(p(e(n)("standalone.dns_dhcp.advanced_settings"))+" ",1)]),_:1})]),L.value?(r(),C(F,{key:4},[y.isClientTunnel?(r(),C(F,{key:0},[$.value!="p2p"?(r(),h(ge,{key:0,modelValue:E.value,"onUpdate:modelValue":a[19]||(a[19]=l=>E.value=l),"add-item-label":e(n)("standalone.openvpn_tunnel.add_remote_address"),title:e(n)("standalone.openvpn_tunnel.extra_remote_networks"),optional:"","optional-label":e(n)("common.optional"),"invalid-messages":V.value},{tooltip:s(()=>[i(e(be),null,{content:s(()=>[T(p(e(n)("standalone.openvpn_tunnel.extra_remote_networks_tooltip")),1)]),_:1})]),_:1},8,["modelValue","add-item-label","title","optional-label","invalid-messages"])):B("",!0),i(e(ye),{label:e(n)("standalone.openvpn_tunnel.mode"),options:He,modelValue:me.value,"onUpdate:modelValue":a[20]||(a[20]=l=>me.value=l)},null,8,["label","modelValue"])],64)):B("",!0),i(e(ye),{label:e(n)("standalone.openvpn_tunnel.protocol"),options:qe,modelValue:x.value,"onUpdate:modelValue":a[21]||(a[21]=l=>x.value=l)},null,8,["label","modelValue"]),i(e(fe),{label:e(n)("standalone.openvpn_tunnel.compression"),options:je,"no-options-label":e(n)("ne_combobox.no_options_label"),"no-results-label":e(n)("ne_combobox.no_results"),modelValue:P.value,"onUpdate:modelValue":a[22]||(a[22]=l=>P.value=l),limitedOptionsLabel:e(n)("ne_combobox.limited_options_label"),"selected-label":e(n)("ne_combobox.selected"),"user-input-label":e(n)("ne_combobox.user_input_label"),optionalLabel:e(n)("common.optional")},null,8,["label","no-options-label","no-results-label","modelValue","limitedOptionsLabel","selected-label","user-input-label","optionalLabel"]),i(e(fe),{label:e(n)("standalone.openvpn_tunnel.digest"),options:Se.value,"no-options-label":e(n)("ne_combobox.no_options_label"),"no-results-label":e(n)("ne_combobox.no_results"),modelValue:J.value,"onUpdate:modelValue":a[23]||(a[23]=l=>J.value=l),limitedOptionsLabel:e(n)("ne_combobox.limited_options_label"),"selected-label":e(n)("ne_combobox.selected"),"user-input-label":e(n)("ne_combobox.user_input_label"),optionalLabel:e(n)("common.optional")},null,8,["label","options","no-options-label","no-results-label","modelValue","limitedOptionsLabel","selected-label","user-input-label","optionalLabel"]),i(e(fe),{label:e(n)("standalone.openvpn_tunnel.cipher"),options:Ee.value,"no-options-label":e(n)("ne_combobox.no_options_label"),"no-results-label":e(n)("ne_combobox.no_results"),modelValue:X.value,"onUpdate:modelValue":a[24]||(a[24]=l=>X.value=l),limitedOptionsLabel:e(n)("ne_combobox.limited_options_label"),"selected-label":e(n)("ne_combobox.selected"),"user-input-label":e(n)("ne_combobox.user_input_label"),optionalLabel:e(n)("common.optional")},null,8,["label","options","no-options-label","no-results-label","modelValue","limitedOptionsLabel","selected-label","user-input-label","optionalLabel"]),y.isClientTunnel?B("",!0):(r(),h(e(fe),{key:1,label:e(n)("standalone.openvpn_tunnel.enforce_minimum_tls_version"),"no-options-label":e(n)("ne_combobox.no_options_label"),"no-results-label":e(n)("ne_combobox.no_results"),options:Ke,modelValue:ce.value,"onUpdate:modelValue":a[25]||(a[25]=l=>ce.value=l),limitedOptionsLabel:e(n)("ne_combobox.limited_options_label"),"selected-label":e(n)("ne_combobox.selected"),"user-input-label":e(n)("ne_combobox.user_input_label"),optionalLabel:e(n)("common.optional")},null,8,["label","no-options-label","no-results-label","modelValue","limitedOptionsLabel","selected-label","user-input-label","optionalLabel"]))],64)):B("",!0),a[29]||(a[29]=k("hr",null,null,-1)),k("div",Vn,[i(e(H),{kind:"tertiary",class:"mr-4",onClick:a[26]||(a[26]=l=>De())},{default:s(()=>[T(p(e(n)("common.cancel")),1)]),_:1}),i(e(H),{kind:"primary",onClick:a[27]||(a[27]=l=>Qe()),disabled:_.value,loading:_.value},{default:s(()=>[T(p(e(n)("common.save")),1)]),_:1},8,["disabled","loading"])])]))]),_:1},8,["is-shown","closeAriaLabel","title"])}}}),Dn=ue({__name:"DeleteTunnelModal",props:{visible:{type:Boolean},itemToDelete:{}},emits:["close","tunnel-deleted"],setup(q,{emit:S}){const{t}=re(),m=q,n=S,g=u({notificationDescription:"",notificationDetails:""}),b=u(!1);async function _(){if(m.itemToDelete){g.value.notificationDescription="",g.value.notificationDetails="",b.value=!0;try{await R("ns.ovpntunnel","delete-tunnel",{id:m.itemToDelete.id}),n("tunnel-deleted"),n("close")}catch(f){g.value.notificationDescription=t(Z(f)),g.value.notificationDetails=f.toString()}finally{b.value=!1}}}function d(){g.value.notificationDescription="",g.value.notificationDetails="",n("close")}return(f,V)=>(r(),h(e(Pe),{visible:f.visible,kind:"warning",title:e(t)("standalone.openvpn_tunnel.delete_tunnel"),primaryLabel:e(t)("common.delete"),primaryButtonDisabled:b.value,primaryButtonLoading:b.value,"primary-button-kind":"danger","close-aria-label":e(t)("common.close"),onPrimaryClick:V[0]||(V[0]=o=>_()),onClose:V[1]||(V[1]=o=>d())},{default:s(()=>{var o;return[T(p(e(t)("standalone.openvpn_tunnel.delete_tunnel_message",{name:((o=f.itemToDelete)==null?void 0:o.ns_name)??""}))+" ",1),g.value.notificationDescription?(r(),h(e(we),{key:0,kind:"error",title:e(t)("error.cannot_delete_tunnel"),description:g.value.notificationDescription,class:"my-2"},ve({_:2},[g.value.notificationDetails?{name:"details",fn:s(()=>[T(p(g.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):B("",!0)]}),_:1},8,["visible","title","primaryLabel","primaryButtonDisabled","primaryButtonLoading","close-aria-label"]))}}),Cn={class:"flex flex-col gap-y-1 text-left"},xn={class:"text-gray-500 dark:text-gray-400"},hn=ue({__name:"DownloadTunnelModal",props:{visible:{type:Boolean},itemToDownload:{}},emits:["close","tunnel-downloaded"],setup(q,{emit:S}){const t=q,{t:m}=re(),n=S,{visible:g,itemToDownload:b}=Be(t),_=u({notificationDescription:"",notificationDetails:""}),d=u(!1),f=u(""),V=[{id:"nethsecurity_client_configuration",label:m("standalone.openvpn_tunnel.nethsecurity_client_configuration",{product:ke()}),description:m("standalone.openvpn_tunnel.nethsecurity_client_configuration_description",{product:ke()})}];async function o(){if(b.value&&f.value)try{if(_.value.notificationDescription="",_.value.notificationDetails="",d.value=!0,f.value=="nethsecurity_client_configuration"){const D=JSON.stringify((await R("ns.ovpntunnel","export-client",{id:b.value.id})).data);var L=document.createElement("a");L.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(D)),L.setAttribute("download",`${b.value.ns_name?b.value.ns_name:"tunnel"}.json`),document.body.appendChild(L),L.click(),L.remove()}n("tunnel-downloaded"),v()}catch(D){_.value.notificationDescription=m(Z(D)),_.value.notificationDetails=D.toString()}finally{d.value=!1}}function v(){_.value.notificationDescription="",_.value.notificationDetails="",f.value="",n("close")}return(L,D)=>(r(),h(e(Pe),{visible:e(g),kind:"neutral",title:e(m)("standalone.openvpn_tunnel.download"),primaryLabel:e(m)("standalone.openvpn_tunnel.download"),primaryButtonDisabled:!f.value||d.value,primaryButtonLoading:d.value,"close-aria-label":e(m)("common.close"),onPrimaryClick:D[1]||(D[1]=M=>o()),onClose:D[2]||(D[2]=M=>v())},{default:s(()=>{var M;return[T(p(e(m)("standalone.openvpn_tunnel.download_tunnel_message",{name:(M=e(b))==null?void 0:M.ns_name}))+" ",1),i(e(ye),{card:!0,options:V,modelValue:f.value,"onUpdate:modelValue":D[0]||(D[0]=U=>f.value=U),label:"","grid-style":"grid-cols-1 gap-3",class:"mt-4","card-size":"lg"},{option:s(({option:U})=>[k("div",Cn,[k("p",null,p(U.label),1),k("p",xn,p(U.description),1)])]),_:1},8,["modelValue"]),_.value.notificationDescription?(r(),h(e(we),{key:0,kind:"error",title:e(m)("error.cannot_download_tunnel"),description:_.value.notificationDescription,class:"mt-4"},ve({_:2},[_.value.notificationDetails?{name:"details",fn:s(()=>[T(p(_.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):B("",!0)]}),_:1},8,["visible","title","primaryLabel","primaryButtonDisabled","primaryButtonLoading","close-aria-label"]))}}),Ln={class:"flex flex-col gap-y-6"},$n={class:"flex justify-end"},Sn=ue({__name:"ImportConfigurationDrawer",props:{isShown:{type:Boolean}},emits:["close","tunnel-imported"],setup(q,{emit:S}){const{t}=re(),m=u({notificationDescription:"",notificationDetails:""}),n=u(""),g=u(!1),b=u(null),_=S;function d(){m.value.notificationDescription="",m.value.notificationDetails="",n.value="",b.value=null,_("close")}async function f(){var o;m.value.notificationDescription="",m.value.notificationDetails="";const V=rn(b.value,"json");if(!V.valid){n.value=t(V.errMessage);return}try{g.value=!0;const v=await((o=b.value)==null?void 0:o.text());await R("ns.ovpntunnel","import-client",JSON.parse(v??"{}")),_("tunnel-imported"),d()}catch(v){v instanceof SyntaxError?m.value.notificationDescription=t("standalone.openvpn_tunnel.could_not_parse_configuration_file"):(m.value.notificationDescription=t(Z(v)),m.value.notificationDetails=v.toString())}finally{g.value=!1}}return(V,o)=>(r(),h(e(Ae),{"is-shown":V.isShown,onClose:o[3]||(o[3]=v=>d()),closeAriaLabel:e(t)("common.shell.close_side_drawer"),title:e(t)("standalone.openvpn_tunnel.import_configuration")},{default:s(()=>[k("div",Ln,[m.value.notificationDescription?(r(),h(e(we),{key:0,kind:"error",title:e(t)("error.cannot_import_configuration"),description:m.value.notificationDescription},ve({_:2},[m.value.notificationDetails?{name:"details",fn:s(()=>[T(p(m.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):B("",!0),k("div",null,[i(e(un),{label:`${e(t)("standalone.openvpn_tunnel.nethsecurity_client_configuration",{product:e(ke)()})} (*.json)`,"invalid-message":n.value,dropzoneLabel:e(t)("ne_file_input.dropzone_label"),modelValue:b.value,"onUpdate:modelValue":o[0]||(o[0]=v=>b.value=v)},null,8,["label","invalid-message","dropzoneLabel","modelValue"])]),o[4]||(o[4]=k("hr",null,null,-1)),k("div",$n,[i(e(H),{kind:"tertiary",class:"mr-4",onClick:o[1]||(o[1]=v=>d())},{default:s(()=>[T(p(e(t)("common.cancel")),1)]),_:1}),i(e(H),{kind:"primary",onClick:o[2]||(o[2]=v=>f()),disabled:g.value,loading:g.value},{default:s(()=>[T(p(e(t)("standalone.openvpn_tunnel.import")),1)]),_:1},8,["disabled","loading"])])])]),_:1},8,["is-shown","closeAriaLabel","title"]))}}),En={class:"flex flex-col gap-y-6"},On={class:"flex flex-col justify-between gap-6 xl:flex-row"},Fn={class:"max-w-2xl text-sm font-normal text-gray-500 dark:text-gray-400"},Un={key:0,class:"shrink-0"},In={key:1,class:"flex shrink-0 flex-row-reverse items-start justify-end gap-4 xl:flex-row"},Nn={key:1,class:"flex flex-col gap-y-2"},Bn=1e4,Ne=ue({__name:"TunnelManager",props:{manageClientTunnels:{type:Boolean}},setup(q){const S=q,{t}=re(),m=dn(),n=u(!0),g=u([]),b=u(null),_=u(!1),d=u(!1),f=u(!1),V=u(!1),o=u(0),v=u({notificationTitle:"",notificationDescription:"",notificationDetails:""});async function L(w=!0){try{w&&(n.value=!0);const x=await R("ns.ovpntunnel","list-tunnels");S.manageClientTunnels?g.value=x.data.clients:g.value=x.data.servers}catch(x){v.value.notificationTitle=S.manageClientTunnels?t("error.cannot_retrieve_client_tunnels"):t("error.cannot_retrieve_server_tunnels"),v.value.notificationDescription=t(Z(x)),v.value.notificationDetails=x.toString()}finally{w&&(n.value=!1)}}function D(w){b.value=w,_.value=!0}function M(w){b.value=w,d.value=!0}function U(w){b.value=w,f.value=!0}function I(){V.value=!0}function E(){b.value=null,d.value=!1,f.value=!1,_.value=!1,V.value=!1}function $(){v.value={notificationTitle:"",notificationDescription:"",notificationDetails:""}}async function K(w){try{$(),await R("ns.ovpntunnel",w.enabled?"disable-tunnel":"enable-tunnel",{id:w.id}),await A()}catch(x){v.value.notificationTitle=t(w.enabled?"error.cannot_disable_tunnel":"error.cannot_enable_tunnel"),v.value.notificationDescription=t(Z(x)),v.value.notificationDetails=x.toString()}}async function A(){$(),await L(),await m.getChanges()}return pn(()=>{L(),o.value=setInterval(()=>L(!1),Bn)}),vn(()=>{o.value&&clearInterval(o.value)}),(w,x)=>{const P=$e("font-awesome-icon");return r(),C(F,null,[k("div",En,[k("div",On,[k("p",Fn,p(w.manageClientTunnels?e(t)("standalone.openvpn_tunnel.client_tunnel_description",{product:e(ke)()}):e(t)("standalone.openvpn_tunnel.server_tunnel_description",{product:e(ke)()})),1),g.value.length>0?(r(),C(F,{key:0},[w.manageClientTunnels?(r(),C("div",In,[i(e(H),{kind:"tertiary",onClick:x[1]||(x[1]=J=>D(null))},{prefix:s(()=>[i(P,{icon:["fas","circle-plus"],class:"h-4 w-4","aria-hidden":"true"})]),default:s(()=>[T(" "+p(e(t)("standalone.openvpn_tunnel.add_client_tunnel")),1)]),_:1}),i(e(H),{kind:"secondary",onClick:I},{prefix:s(()=>[i(P,{icon:["fas","circle-arrow-up"],class:"h-4 w-4","aria-hidden":"true"})]),default:s(()=>[T(" "+p(e(t)("standalone.openvpn_tunnel.import_configuration")),1)]),_:1})])):(r(),C("div",Un,[i(e(H),{kind:"secondary",onClick:x[0]||(x[0]=J=>D(null))},{prefix:s(()=>[i(P,{icon:["fas","circle-plus"],class:"h-4 w-4","aria-hidden":"true"})]),default:s(()=>[T(" "+p(e(t)("standalone.openvpn_tunnel.add_server_tunnel")),1)]),_:1})]))],64)):B("",!0)]),v.value.notificationTitle?(r(),h(e(we),{key:0,kind:"error",title:v.value.notificationTitle,description:v.value.notificationDescription},ve({_:2},[v.value.notificationDetails?{name:"details",fn:s(()=>[T(p(v.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):B("",!0),n.value?(r(),h(e(Me),{key:1,lines:8,size:"lg"})):(r(),C(F,{key:2},[g.value.length==0?(r(),h(e(cn),{key:0,title:w.manageClientTunnels?e(t)("standalone.openvpn_tunnel.no_client_tunnel_found"):e(t)("standalone.openvpn_tunnel.no_server_tunnel_found"),icon:["fas","globe"]},{default:s(()=>[w.manageClientTunnels?(r(),C("div",Nn,[i(e(H),{kind:"primary",onClick:I},{prefix:s(()=>[i(P,{icon:["fas","circle-arrow-up"],class:"h-4 w-4","aria-hidden":"true"})]),default:s(()=>[T(" "+p(e(t)("standalone.openvpn_tunnel.import_configuration")),1)]),_:1}),i(e(H),{kind:"tertiary",onClick:x[3]||(x[3]=J=>D(null))},{prefix:s(()=>[i(P,{icon:["fas","circle-plus"],class:"h-4 w-4","aria-hidden":"true"})]),default:s(()=>[T(" "+p(e(t)("standalone.openvpn_tunnel.add_client_tunnel")),1)]),_:1})])):(r(),h(e(H),{key:0,kind:"primary",onClick:x[2]||(x[2]=J=>D(null))},{prefix:s(()=>[i(P,{icon:["fas","circle-plus"],class:"h-4 w-4","aria-hidden":"true"})]),default:s(()=>[T(p(e(t)("standalone.openvpn_tunnel.add_server_tunnel")),1)]),_:1}))]),_:1},8,["title"])):(r(),h(gn,{key:1,"is-client-tunnel":w.manageClientTunnels,tunnels:g.value,onTunnelDelete:M,onTunnelDownload:U,onTunnelEdit:D,onTunnelToggleEnable:K},null,8,["is-client-tunnel","tunnels"]))],64))]),i(Tn,{"item-to-edit":b.value,onClose:E,onAddEditTunnel:A,"is-shown":_.value,"is-client-tunnel":w.manageClientTunnels},null,8,["item-to-edit","is-shown","is-client-tunnel"]),i(Dn,{visible:d.value,"item-to-delete":b.value,onClose:E,onTunnelDeleted:A},null,8,["visible","item-to-delete"]),i(hn,{visible:f.value,"item-to-download":b.value,onClose:E},null,8,["visible","item-to-download"]),w.manageClientTunnels?(r(),h(Sn,{key:0,"is-shown":V.value,onClose:E,onTunnelImported:A},null,8,["is-shown"])):B("",!0)],64)}}}),Mn={class:"flex flex-col justify-between md:flex-row md:items-center"},An={class:"mb-6 text-sm text-gray-500 dark:text-gray-400"},Kn=ue({__name:"OpenvpnTunnelView",setup(q){const{t:S}=re(),{tabs:t,selectedTab:m}=Ye([{name:"server-tunnel",label:S("standalone.openvpn_tunnel.tabs.server_tunnel")},{name:"client-tunnel",label:S("standalone.openvpn_tunnel.tabs.client_tunnel")}]);return(n,g)=>(r(),C(F,null,[k("div",Mn,[i(e(mn),{tag:"h3",class:"mb-7"},{default:s(()=>[T(p(e(S)("standalone.openvpn_tunnel.title")),1)]),_:1}),k("div",An,p(e(S)("common.data_updated_every_seconds",{seconds:10})),1)]),k("div",null,[i(e(_n),{selected:e(m),srSelectTabLabel:e(S)("ne_tabs.select_a_tab"),srTabsLabel:e(S)("ne_tabs.tabs"),tabs:e(t),class:"mb-8",onSelectTab:g[0]||(g[0]=b=>m.value=b)},null,8,["selected","srSelectTabLabel","srTabsLabel","tabs"]),e(m)=="server-tunnel"?(r(),h(Ne,{key:0,manageClientTunnels:!1})):(r(),h(Ne,{key:1,manageClientTunnels:!0}))])],64))}});export{Kn as default};
