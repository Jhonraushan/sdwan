import{d as U,u as j,r as p,c as Y,g as X,h as a,i as T,w as n,j as f,av as Q,t as r,k as v,l as e,_ as O,m as x,q as h,N as q,z as N,ad as W,n as L,e as M,V as z,aa as _e,J as ie,bV as Se,a5 as G,L as F,M as I,a0 as $e,s as Pe,Q as ee,y as le,a4 as ye,aj as ae,Y as oe,T as fe,S as te,U as ge,o as be,a1 as Le,ai as Ve,ag as Be,a_ as Ne,W as Me,a9 as ze}from"./index-BlEQ5104.js";import{u as De}from"./upperFirst-EX6YhY0o.js";import{v as Fe}from"./network-qu7sidyZ.js";import{u as Ie}from"./firewall-C9mbeSo1.js";import{u as Oe}from"./useTabs-BeLQ169O.js";function Ee($){return De($.replace(/-/g," ").replace(/netify./g,""))}function Ue($){return De($.replace(/-/g," "))}function ke($){switch($.name){case"netify.facebook":return["fab","facebook"];case"netify.amazon-prime":return["fab","amazon"];case"netify.whatsapp":return["fab","whatsapp"];case"netify.instagram":return["fab","instagram"];case"netify.netflix":return["fab","netflix"];case"netify.telegram":return["fab","telegram"];case"netify.tiktok":return["fab","tiktok"];case"netify.youtube":return["fab","youtube"];case"netify.facebook-messenger":return["fab","facebook-messenger"];case"netify.twitter":return["fab","square-x-twitter"];case"netify.vimeo":return["fab","vimeo"];case"netify.snapchat":return["fab","snapchat"];case"netify.pinterest":return["fab","pinterest"];case"netify.nordvpn":return["fab","nord-vpn"];case"netify.twitch":return["fab","twitch"];case"netify.teamviewer":return["fas","arrows-left-right"];default:return $.type==="application"?["fas","shapes"]:["fas","diagram-project"]}}const je={class:"ml-3 text-gray-500 dark:text-gray-400"},Ke={key:0,class:"flex items-center"},qe={key:1,class:"flex items-center"},He={class:"divide-y divide-gray-300 dark:divide-gray-600"},Qe={class:"pb-3 font-semibold"},We={class:"grid grid-cols-1 gap-3 pt-3 md:grid-cols-2"},Ye={class:"truncate"},Z=8,Xe=U({__name:"DpiRuleCard",props:{rule:{},zones:{}},emits:["editRule","deleteRule","reloadData"],setup($,{emit:E}){const o=$,s=E,{t:i}=j();let c=p({editRule:!1});const l=p(""),R=p(""),u=Y(()=>o.rule.criteria.length==Z+1?o.rule.criteria.slice(0,Z+1):o.rule.criteria.slice(0,Z)),m=Y(()=>o.zones.find(d=>{var D;return(D=d.interfaces)==null?void 0:D.includes(o.rule.interface)}));function w(){return o.rule.criteria.filter(d=>d.type==="application").map(d=>d.name)}function S(){return o.rule.criteria.filter(d=>d.type==="protocol").map(d=>d.name)}async function B(){c.value.editRule=!0;const d=w(),D=S(),A={"config-name":o.rule["config-name"],enabled:!o.rule.enabled,device:o.rule.device,applications:d,protocols:D};try{await M("ns.dpi","edit-rule",A),s("reloadData")}catch(C){console.error(C),l.value=i("error.cannot_edit_dpi_rule"),R.value=i(z(C))}finally{c.value.editRule=!1}}return(d,D)=>{var C,g;const A=X("font-awesome-icon");return a(),T(e(q),{menuItems:[{id:"enable_disable",label:d.rule.enabled?e(i)("common.disable"):e(i)("common.enable"),iconStyle:"fas",icon:d.rule.enabled?"circle-xmark":"circle-check",action:()=>B()},{id:"delete",label:e(i)("common.delete"),icon:"trash",iconStyle:"fas",action:()=>s("deleteRule",d.rule),danger:!0}],errorTitle:l.value,errorDescription:R.value,class:Q(["border-l-4",(C=m.value)!=null&&C.name?e(Fe)((g=m.value)==null?void 0:g.name):""])},{title:n(()=>[f("div",{class:Q({"opacity-50":!d.rule.enabled})},[f("span",null,r(d.rule.interface),1),f("span",je,r(d.rule.device),1)],2)]),topRight:n(()=>[v(e(O),{kind:"tertiary",size:"lg",onClick:D[0]||(D[0]=t=>s("editRule",d.rule))},{prefix:n(()=>[v(A,{icon:["fas","pen-to-square"],class:"h-4 w-4","aria-hidden":"true"})]),default:n(()=>[x(" "+r(e(i)("common.edit")),1)]),_:1})]),default:n(()=>[f("div",{class:Q({"opacity-50":!d.rule.enabled})},[d.rule.enabled?(a(),h("div",Ke,[v(A,{icon:["fas","circle-check"],class:"mr-2 h-4 w-4","aria-hidden":"true"}),f("span",null,r(e(i)("common.enabled")),1)])):(a(),h("div",qe,[v(A,{icon:["fas","circle-xmark"],class:"mr-2 h-4 w-4","aria-hidden":"true"}),f("span",null,r(e(i)("common.disabled")),1)])),v(e(q),{alternateBackground:"",class:"mt-4"},{default:n(()=>[f("div",He,[f("div",Qe,r(e(i)("standalone.dpi.blocked_apps_and_protocols")),1),f("div",We,[(a(!0),h(N,null,W(u.value,t=>(a(),h("div",{key:t.id,class:"flex items-center"},[v(A,{icon:e(ke)(t),class:"mr-2 h-4 w-4","aria-hidden":"true"},null,8,["icon"]),f("span",Ye,r(e(Ee)(t.name)),1)]))),128))])]),d.rule.criteria.length>u.value.length?(a(),T(e(O),{key:0,kind:"tertiary",size:"sm",onClick:D[1]||(D[1]=t=>s("editRule",d.rule)),class:"-ml-2 mt-3"},{default:n(()=>[x(r(e(i)("standalone.dpi.plus_num_others",{num:d.rule.criteria.length-u.value.length})),1)]),_:1})):L("",!0)]),_:1})],2)]),_:1},8,["menuItems","errorTitle","errorDescription","class"])}}}),Je={class:"space-y-6"},Ze={class:"mb-2 flex flex-col justify-between lg:flex-row lg:items-end"},Ge={class:"flex items-end"},et={class:"mb-2 mt-4"},tt={key:2,class:"grid grid-cols-1 gap-x-6 gap-y-3 sm:grid-cols-2 2xl:grid-cols-3"},it={class:"mb-4 flex items-center space-x-4"},lt={class:"text-base"},at={class:"grid grid-cols-1 gap-x-6 gap-y-3 md:grid-cols-2 2xl:grid-cols-3"},ot={class:"flex min-w-0 grow items-center justify-between"},st={class:"flex min-w-0 items-center gap-4"},nt={class:"flex flex-col"},rt={class:"font-medium"},ct={key:0,class:"text-xs uppercase text-gray-500 dark:text-gray-400"},ut={key:1,class:"mt-3 text-sm text-rose-700 dark:text-rose-400"},dt={key:2,class:"mt-4 text-gray-500 dark:text-gray-400"},pt=2,me=24,vt=8,ft=U({__name:"ManageDpiRuleModal",props:{visible:{type:Boolean,default:!1},ruleToEdit:{type:Object,default:void 0},allRules:{type:Array,default:()=>[]}},emits:["close","reloadData"],setup($,{emit:E}){const o=$,s=E,{t:i}=j(),c=p(!0),l=p(),R=p([]),u=p([]),m=p(""),w=p(),S=p(!1),B=p(0),d=p(0),D=p({}),A=p([]),C=p();let g=p({listApplications:!1,listDevices:!1,listPopularApps:!1,addRule:!1,editRule:!1}),t=p({interface:"",listApplicationsErrorTitle:"",listApplicationsErrorDescription:"",listApplicationsErrorDetails:"",listDevicesErrorTitle:"",listDevicesErrorDescription:"",listDevicesErrorDetails:"",listPopularAppsErrorTitle:"",listPopularAppsErrorDescription:"",listPopularAppsErrorDetails:"",addRuleErrorTitle:"",addRuleErrorDescription:"",addRuleErrorDetails:"",editRuleErrorTitle:"",editRuleErrorDescription:"",editRuleErrorDetails:""});const k=p(new _e),H=Y(()=>!o.ruleToEdit),se=Y(()=>S.value?A.value:u.value),ne=Y(()=>{let _=0;return Object.values(D.value).forEach(y=>{y&&_++}),_});ie(()=>o.visible,()=>{o.visible&&(o.ruleToEdit?c.value=o.ruleToEdit.enabled:c.value=!0,l.value=void 0,R.value=[],u.value=[],m.value="",S.value=!1,B.value=0,d.value=0,D.value={},A.value=[],re(),k.value.clear(),xe(),Re(),we())}),Se(m,()=>{ce()},{debounce:500});function re(){t.value.interface="",t.value.listApplicationsErrorTitle="",t.value.listApplicationsErrorDescription="",t.value.listApplicationsErrorDetails="",t.value.listDevicesErrorTitle="",t.value.listDevicesErrorDescription="",t.value.listDevicesErrorDetails="",t.value.listPopularAppsErrorTitle="",t.value.listPopularAppsErrorDescription="",t.value.listPopularAppsErrorDetails="",t.value.addRuleErrorTitle="",t.value.addRuleErrorDescription="",t.value.addRuleErrorDetails="",t.value.editRuleErrorTitle="",t.value.editRuleErrorDescription="",t.value.editRuleErrorDetails=""}function he(){m.value="",d.value=0,ce(),fe(w)}async function xe(){t.value.listPopularAppsErrorTitle="",t.value.listPopularAppsErrorDescription="",t.value.listPopularAppsErrorDetails="",g.value.listPopularApps=!0;try{const _=await M("ns.dpi","list-popular");u.value=_.data.values.data,o.ruleToEdit&&o.ruleToEdit.criteria.forEach(y=>{D.value[y.name]=!0,u.value.find(b=>b.name===y.name)||u.value.unshift(y)})}catch(_){console.error(_),t.value.listPopularAppsErrorTitle=i("error.cannot_retrieve_popular_apps"),t.value.listPopularAppsErrorDescription=i(z(_)),t.value.listPopularAppsErrorDetails=_.toString()}finally{g.value.listPopularApps=!1}}async function Re(){t.value.listDevicesErrorTitle="",t.value.listDevicesErrorDescription="",t.value.listDevicesErrorDetails="",g.value.listDevices=!0;try{const y=(await M("ns.dpi","list-devices")).data.values.filter(P=>{var V;return!o.allRules.find(K=>K.device===P.device)||((V=o.ruleToEdit)==null?void 0:V.device)===P.device});R.value=y.map(P=>({id:P.device,label:P.interface,description:P.device})),o.ruleToEdit&&(l.value=o.ruleToEdit.device)}catch(_){console.error(_),t.value.listDevicesErrorTitle=i("error.cannot_retrieve_devices"),t.value.listDevicesErrorDescription=i(z(_)),t.value.listDevicesErrorDetails=_.toString()}finally{g.value.listDevices=!1}}async function we(){var _;try{const y=await M("ns.dpi","list-applications",{limit:1});B.value=(_=y.data)==null?void 0:_.values.meta.total}catch(y){console.error(y)}}async function ce(){if(m.value.length<pt){S.value=!1;return}t.value.listApplicationsErrorTitle="",t.value.listApplicationsErrorDescription="",t.value.listApplicationsErrorDetails="",g.value.listApplications=!0;try{const _=await M("ns.dpi","list-applications",{search:m.value.replace(/ /g,"-"),limit:me});A.value=_.data.values.data,d.value=_.data.values.meta.total,S.value=!0}catch(_){console.error(_),t.value.listApplicationsErrorTitle=i("error.cannot_retrieve_applications"),t.value.listApplicationsErrorDescription=i(z(_)),t.value.listApplicationsErrorDetails=_.toString()}finally{g.value.listApplications=!1}}function ue(){const _=[];for(const[y,P]of Object.entries(D.value))if(P){const b=u.value.find(V=>V.name===y);b&&b.type==="application"&&_.push(y)}return _}function de(){const _=[];for(const[y,P]of Object.entries(D.value))if(P){const b=u.value.find(V=>V.name===y);b&&b.type==="protocol"&&_.push(y)}return _}function pe(){re();let _=!0;k.value.clear();const y=te(l.value);return y.valid||(k.value.set("interface",[String(y.errMessage)]),_&&(_=!1,fe(C))),ne.value==0&&(k.value.set("apps",["standalone.dpi.select_at_least_one_app_or_protocol"]),_=!1),_}async function Te(){if(!pe())return;t.value.addRuleErrorTitle="",t.value.addRuleErrorDescription="",t.value.addRuleErrorDetails="",g.value.addRule=!0;const y=ue(),P=de(),b={enabled:c.value,device:l.value,applications:y,protocols:P};try{await M("ns.dpi","add-rule",b),s("close"),s("reloadData")}catch(V){console.error(V),t.value.addRuleErrorTitle=i("error.cannot_create_dpi_rule"),t.value.addRuleErrorDescription=i(z(V)),t.value.addRuleErrorDetails=V.toString()}finally{g.value.addRule=!1}}async function Ae(){var V;if(!pe())return;t.value.editRuleErrorTitle="",t.value.editRuleErrorDescription="",t.value.editRuleErrorDetails="",g.value.editRule=!0;const y=ue(),P=de(),b={"config-name":(V=o.ruleToEdit)==null?void 0:V["config-name"],enabled:c.value,device:l.value,applications:y,protocols:P};try{await M("ns.dpi","edit-rule",b),s("close"),s("reloadData")}catch(K){console.error(K),t.value.editRuleErrorTitle=i("error.cannot_edit_dpi_rule"),t.value.editRuleErrorDescription=i(z(K)),t.value.editRuleErrorDetails=K.toString()}finally{g.value.editRule=!1}}function Ce(_,y){const P=_.target.checked;D.value[y.name]=P,P&&(u.value.find(V=>V.name===y.name)||u.value.unshift(y))}return(_,y)=>{const P=X("font-awesome-icon");return a(),T(e(oe),{visible:$.visible,size:"xxl",title:H.value?e(i)("standalone.dpi.create_rule"):e(i)("standalone.dpi.edit_rule"),primaryLabel:H.value?e(i)("standalone.dpi.create_rule"):e(i)("standalone.dpi.save_rule"),cancelLabel:e(i)("common.cancel"),primaryButtonDisabled:e(g).addRule||e(g).editRule,primaryButtonLoading:e(g).addRule||e(g).editRule,closeAriaLabel:e(i)("common.close"),onClose:y[3]||(y[3]=b=>s("close")),onPrimaryClick:y[4]||(y[4]=b=>H.value?Te():Ae())},{default:n(()=>[f("div",Je,[v(e(G),{modelValue:c.value,"onUpdate:modelValue":y[0]||(y[0]=b=>c.value=b),label:e(i)("standalone.dpi.enable_rule")},null,8,["modelValue","label"]),e(t).listDevicesErrorTitle?(a(),T(e(F),{key:0,kind:"error",title:e(t).listDevicesErrorTitle,description:e(t).listDevicesErrorDescription},I({_:2},[e(t).listDevicesErrorDetails?{name:"details",fn:n(()=>[x(r(e(t).listDevicesErrorDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):L("",!0),v(e($e),{modelValue:l.value,"onUpdate:modelValue":y[1]||(y[1]=b=>l.value=b),options:R.value,label:e(i)("standalone.dpi.source"),placeholder:e(i)("standalone.dpi.choose_interface"),"invalid-message":e(i)(k.value.getFirstI18nKeyFor("interface")),noResultsLabel:e(i)("ne_combobox.no_results"),limitedOptionsLabel:e(i)("ne_combobox.limited_options_label"),noOptionsLabel:e(i)("standalone.dpi.no_interfaces_available"),"selected-label":e(i)("ne_combobox.selected"),"user-input-label":e(i)("ne_combobox.user_input_label"),optionalLabel:e(i)("common.optional"),class:"max-w-xs",ref_key:"interfaceRef",ref:C},{tooltip:n(()=>[v(e(Pe),{placement:"right-end"},{content:n(()=>[x(r(e(i)("standalone.dpi.source_tooltip")),1)]),_:1})]),_:1},8,["modelValue","options","label","placeholder","invalid-message","noResultsLabel","limitedOptionsLabel","noOptionsLabel","selected-label","user-input-label","optionalLabel"]),f("div",null,[f("div",Ze,[f("div",Ge,[v(e(ee),{label:e(i)("standalone.dpi.apps_and_protocols"),modelValue:m.value,"onUpdate:modelValue":y[2]||(y[2]=b=>m.value=b),modelModifiers:{trim:!0},disabled:e(g).listPopularApps,placeholder:B.value?e(i)("standalone.dpi.apps_and_protocols_placeholder",{num:B.value}):"",class:"w-96",ref_key:"searchQueryRef",ref:w},null,8,["label","modelValue","disabled","placeholder"])]),f("div",et,r(e(i)("standalone.dpi.num_apps_and_protocols_selected",{num:ne.value,total:B.value})),1)]),v(e(q),null,{default:n(()=>[e(t).listPopularAppsErrorTitle?(a(),T(e(F),{key:0,kind:"error",title:e(t).listPopularAppsErrorTitle,description:e(t).listPopularAppsErrorDescription},I({_:2},[e(t).listPopularAppsErrorDetails?{name:"details",fn:n(()=>[x(r(e(t).listPopularAppsErrorDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):L("",!0),e(t).listApplicationsErrorTitle?(a(),T(e(F),{key:1,kind:"error",title:e(t).listApplicationsErrorTitle,description:e(t).listApplicationsErrorDescription},I({_:2},[e(t).listApplicationsErrorDetails?{name:"details",fn:n(()=>[x(r(e(t).listApplicationsErrorDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):e(g).listPopularApps||e(g).listApplications?(a(),h("div",tt,[(a(),h(N,null,W(vt,b=>f("div",{key:b,class:"overflow-hidden bg-gray-100 py-2 pl-4 pr-1 text-sm text-gray-700 dark:bg-gray-900 dark:text-gray-200 sm:rounded-lg sm:shadow"},[v(e(le),{lines:2})])),64))])):(a(),h(N,{key:3},[S.value?(a(),h(N,{key:0},[f("div",it,[f("div",lt,r(e(i)("standalone.dpi.search_results")),1),v(e(O),{kind:"tertiary",disabled:!m.value,onClick:he},{default:n(()=>[x(r(e(i)("standalone.dpi.clear_search")),1)]),_:1},8,["disabled"])]),e(ye)(se.value)?(a(),T(e(ae),{key:0,icon:["fas","circle-info"],title:e(i)("standalone.dpi.no_apps_or_protocols_found"),description:e(i)("standalone.dpi.try_changing_search_filter")},null,8,["title","description"])):L("",!0)],64)):L("",!0),f("div",at,[(a(!0),h(N,null,W(se.value,b=>(a(),T(e(q),{key:b.id,class:Q({"opacity-50":b.missing}),alternateBackground:""},{default:n(()=>{var V,K,ve;return[f("div",ot,[f("div",st,[v(P,{icon:e(ke)(b),class:"h-6 w-6","aria-hidden":"true"},null,8,["icon"]),f("div",nt,[f("div",rt,r(e(Ee)(b.name)),1),b.missing||(V=b.category)!=null&&V.name?(a(),h("div",ct,[b.missing?(a(),h(N,{key:0},[x(r(e(i)("standalone.dpi.available_with_subscription")),1)],64)):(a(),h(N,{key:1},[x(r(e(i)(`standalone.dpi.type_${b.type}`))+" ",1),(K=b.category)!=null&&K.name?(a(),h(N,{key:0},[x(" / "+r(e(Ue)((ve=b.category)==null?void 0:ve.name)),1)],64)):L("",!0)],64))])):L("",!0)])]),v(e(G),{disabled:b.missing,onChange:J=>Ce(J,b),modelValue:D.value[b.name],"onUpdate:modelValue":J=>D.value[b.name]=J,class:"relative left-3"},null,8,["disabled","onChange","modelValue","onUpdate:modelValue"])])]}),_:2},1032,["class"]))),128))]),k.value.getFirstI18nKeyFor("apps")?(a(),h("div",ut,r(e(i)(k.value.getFirstI18nKeyFor("apps"))),1)):L("",!0),d.value>me?(a(),h("div",dt,r(e(i)("standalone.dpi.continue_typing_to_show_other_search_results")),1)):L("",!0)],64))]),_:1})]),e(t).addRuleErrorTitle?(a(),T(e(F),{key:1,kind:"error",title:e(t).addRuleErrorTitle,description:e(t).addRuleErrorDescription},I({_:2},[e(t).addRuleErrorDetails?{name:"details",fn:n(()=>[x(r(e(t).addRuleErrorDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):L("",!0),e(t).editRuleErrorTitle?(a(),T(e(F),{key:2,kind:"error",title:e(t).editRuleErrorTitle,description:e(t).editRuleErrorDescription},I({_:2},[e(t).editRuleErrorDetails?{name:"details",fn:n(()=>[x(r(e(t).editRuleErrorDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):L("",!0)])]),_:1},8,["visible","title","primaryLabel","cancelLabel","primaryButtonDisabled","primaryButtonLoading","closeAriaLabel"])}}}),mt=U({__name:"DeleteDpiRuleModal",props:{visible:{type:Boolean},rule:{}},emits:["close","reloadData"],setup($,{emit:E}){const o=$,s=E,{t:i}=j();let c=p({deleteRule:!1}),l=p({notificationTitle:"",notificationDescription:"",notificationDetails:""});ie(()=>o.visible,()=>{o.visible&&(l.value.notificationTitle="",l.value.notificationDescription="",l.value.notificationDetails="")});async function R(){if(o.rule){l.value.notificationTitle="",l.value.notificationDescription="",l.value.notificationDetails="",c.value.deleteRule=!0;try{await M("ns.dpi","delete-rule",{"config-name":o.rule["config-name"]}),s("close"),s("reloadData")}catch(u){console.error(u),l.value.notificationTitle=i("error.cannot_delete_rule"),l.value.notificationDescription=i(z(u)),l.value.notificationDetails=u.toString()}finally{c.value.deleteRule=!1}}}return(u,m)=>(a(),T(e(oe),{visible:u.visible,title:e(i)("standalone.dpi.delete_rule"),kind:"warning",primaryLabel:e(i)("standalone.dpi.delete_rule"),cancelLabel:e(i)("common.cancel"),primaryButtonKind:"danger",primaryButtonDisabled:e(c).deleteRule,primaryButtonLoading:e(c).deleteRule,closeAriaLabel:e(i)("common.close"),onClose:m[0]||(m[0]=w=>s("close")),onPrimaryClick:R},{default:n(()=>{var w;return[x(r(e(i)("standalone.dpi.confirm_delete_rule",{iface:(w=u.rule)==null?void 0:w.interface}))+" ",1),e(l).notificationTitle?(a(),T(e(F),{key:0,kind:"error",title:e(l).notificationTitle,description:e(l).notificationDescription,class:"mt-4"},I({_:2},[e(l).notificationDetails?{name:"details",fn:n(()=>[x(r(e(l).notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):L("",!0)]}),_:1},8,["visible","title","primaryLabel","cancelLabel","primaryButtonDisabled","primaryButtonLoading","closeAriaLabel"]))}}),_t={class:"mb-8 flex items-start justify-between"},yt={class:"max-w-2xl text-gray-500 dark:text-gray-400"},gt={key:1,class:"grid grid-cols-1 gap-x-6 gap-y-6 sm:grid-cols-2 2xl:grid-cols-3"},bt={key:1,class:"grid grid-cols-1 gap-x-6 gap-y-6 sm:grid-cols-2 2xl:grid-cols-3"},Dt=U({__name:"DpiRules",setup($){const{t:E}=j(),o=Ie(),s=ge(),i=p([]),c=p(!1),l=p(),R=p(!1);let u=p({listRules:!0}),m=p({listRules:"",listRulesDetails:""});be(()=>{w()});function w(){S(),o.fetch(),s.getChanges()}async function S(){u.value.listRules=!0,m.value.listRules="",m.value.listRulesDetails="";try{const A=await M("ns.dpi","list-rules");i.value=A.data.values}catch(A){console.error(A),m.value.listRules=E(z(A)),m.value.listRulesDetails=A.toString()}finally{u.value.listRules=!1}}function B(){l.value=void 0,c.value=!0}function d(A){l.value=A,c.value=!0}function D(A){l.value=A,R.value=!0}return(A,C)=>{const g=X("FontAwesomeIcon");return a(),h("div",null,[f("div",_t,[f("div",yt,r(e(E)("standalone.dpi.rules_description")),1),i.value.length?(a(),T(e(O),{key:0,kind:"secondary",size:"lg",onClick:B,class:"ml-6 shrink-0"},{prefix:n(()=>[v(g,{icon:["fas","circle-plus"],"aria-hidden":"true"})]),default:n(()=>[x(" "+r(e(E)("standalone.dpi.create_rule")),1)]),_:1})):L("",!0)]),e(m).listRules?(a(),T(e(F),{key:0,kind:"error",title:e(E)("error.cannot_retrieve_dpi_rules"),description:e(m).listRules,class:"mb-5"},I({_:2},[e(m).listRulesDetails?{name:"details",fn:n(()=>[x(r(e(m).listRulesDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):e(u).listRules?(a(),h("div",gt,[(a(),h(N,null,W(3,t=>v(e(q),{key:t},{default:n(()=>[v(e(le),{size:"lg",lines:5})]),_:2},1024)),64))])):(a(),h(N,{key:2},[e(ye)(i.value)?(a(),T(e(ae),{key:0,title:e(E)("standalone.dpi.no_rules_found"),icon:["fas","circle-info"]},{default:n(()=>[v(e(O),{kind:"primary",size:"lg",onClick:B},{prefix:n(()=>[v(g,{icon:["fas","circle-plus"],"aria-hidden":"true"})]),default:n(()=>[x(" "+r(e(E)("standalone.dpi.create_rule")),1)]),_:1})]),_:1},8,["title"])):(a(),h("div",bt,[(a(!0),h(N,null,W(i.value,(t,k)=>(a(),T(Xe,{key:k,rule:t,zones:e(o).zones,onEditRule:d,onDeleteRule:D,onReloadData:w},null,8,["rule","zones"]))),128))]))],64)),v(ft,{visible:c.value,ruleToEdit:l.value,allRules:i.value,onClose:C[0]||(C[0]=t=>c.value=!1),onReloadData:w},null,8,["visible","ruleToEdit","allRules"]),v(mt,{visible:R.value,rule:l.value,onClose:C[1]||(C[1]=t=>R.value=!1),onReloadData:w},null,8,["visible","rule"])])}}}),Et=U({__name:"DeleteDpiExceptionModal",props:{visible:{type:Boolean},itemToDelete:{}},emits:["close","dpi-exception-deleted"],setup($,{emit:E}){const{t:o}=j(),s=$,i=E,c=p({notificationDescription:"",notificationDetails:""}),l=p(!1);async function R(){if(s.itemToDelete)try{c.value={notificationDescription:"",notificationDetails:""},l.value=!0,await M("ns.dpi","delete-exemption",{"config-name":s.itemToDelete["config-name"]}),i("dpi-exception-deleted"),i("close")}catch(m){c.value.notificationDescription=o(z(m)),c.value.notificationDetails=m.toString()}finally{l.value=!1}}function u(){c.value={notificationDescription:"",notificationDetails:""},i("close")}return(m,w)=>(a(),T(e(oe),{visible:m.visible,kind:"warning",title:e(o)("standalone.dpi.delete_exception"),primaryLabel:e(o)("common.delete"),primaryButtonDisabled:l.value,primaryButtonLoading:l.value,"close-aria-label":e(o)("common.close"),onPrimaryClick:w[0]||(w[0]=S=>R()),onClose:w[1]||(w[1]=S=>u())},{default:n(()=>{var S;return[x(r(e(o)("standalone.dpi.delete_exception_message",{name:((S=m.itemToDelete)==null?void 0:S.description)??""}))+" ",1),c.value.notificationDescription?(a(),T(e(F),{key:0,kind:"error",title:e(o)("error.cannot_delete_dpi_exception"),description:c.value.notificationDescription,class:"my-2"},I({_:2},[c.value.notificationDetails?{name:"details",fn:n(()=>[x(r(c.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):L("",!0)]}),_:1},8,["visible","title","primaryLabel","primaryButtonDisabled","primaryButtonLoading","close-aria-label"]))}}),kt={key:0,class:"flex items-center"},ht={key:1,class:"flex items-center"},xt={class:"divide-y divide-gray-300 dark:divide-gray-600"},Rt=U({__name:"DpiExceptionCard",props:{exception:{}},emits:["delete","edit"],setup($,{emit:E}){const{t:o}=j(),s=E;return(i,c)=>{const l=X("font-awesome-icon");return a(),T(e(q),{menuItems:[{id:"delete",label:e(o)("common.delete"),icon:"trash",iconStyle:"fas",action:()=>s("delete",i.exception),danger:!0}],class:"border-l-4 border-indigo-400 dark:border-indigo-500"},{title:n(()=>[f("div",{class:Q({"opacity-50":!i.exception.enabled})},[f("span",null,r(i.exception.description),1)],2)]),topRight:n(()=>[v(e(O),{kind:"tertiary",size:"lg",onClick:c[0]||(c[0]=R=>s("edit",i.exception))},{prefix:n(()=>[v(l,{icon:["fas","pen-to-square"],class:"h-4 w-4","aria-hidden":"true"})]),default:n(()=>[x(" "+r(e(o)("common.edit")),1)]),_:1})]),default:n(()=>[f("div",{class:Q({"opacity-50":!i.exception.enabled})},[i.exception.enabled?(a(),h("div",kt,[v(l,{icon:["fas","circle-check"],class:"mr-2 h-4 w-4","aria-hidden":"true"}),f("span",null,r(e(o)("common.enabled")),1)])):(a(),h("div",ht,[v(l,{icon:["fas","circle-xmark"],class:"mr-2 h-4 w-4","aria-hidden":"true"}),f("span",null,r(e(o)("common.disabled")),1)])),v(e(q),{alternateBackground:"",class:"mt-4"},{default:n(()=>[f("div",xt,[f("p",null,r(i.exception.criteria),1)])]),_:1})],2)]),_:1},8,["menuItems"])}}}),wt={class:"flex flex-col gap-y-6"},Tt={class:"flex justify-end"},At=U({__name:"CreateOrDeleteDpiExceptionDrawer",props:{isShown:{type:Boolean},itemToEdit:{}},emits:["close","add-edit-exception"],setup($,{emit:E}){const o=$,{t:s}=j(),i=E,c=p(!1),l=p({notificationTitle:"",notificationDescription:"",notificationDetails:""}),R=p(new _e),u=p(""),m=p(!0),w=p(""),S=p("");function B(){var g,t,k,H;u.value=((g=o.itemToEdit)==null?void 0:g["config-name"])??"",m.value=((t=o.itemToEdit)==null?void 0:t.enabled)??!0,w.value=((k=o.itemToEdit)==null?void 0:k.criteria)??"",S.value=((H=o.itemToEdit)==null?void 0:H.description)??""}function d(g,t){for(let k of g)k.valid||R.value.set(t,[k.errMessage]);return g.every(k=>k.valid)}function D(){return R.value.clear(),[[[te(S.value)],"description"],[[te(w.value),Ne(w.value)],"criteria"]].map(([t,k])=>d(t,k)).every(t=>t)}async function A(){l.value.notificationTitle="",l.value.notificationDescription="",l.value.notificationDetails="",R.value.clear();const g=u.value!="";try{c.value=!0;const t=g?"edit-exemption":"add-exemption";if(D()){let k={criteria:w.value,description:S.value,enabled:m.value};g&&(k["config-name"]=u.value),await M("ns.dpi",t,k),i("add-edit-exception"),C()}}catch(t){t instanceof Be?R.value=t.errorBag:(l.value.notificationTitle=s(g?"error.cannot_edit_dpi_exception":"error.cannot_create_dpi_exception"),l.value.notificationDescription=s(z(t)),l.value.notificationDetails=t.toString())}finally{c.value=!1}}function C(){R.value.clear(),l.value.notificationTitle="",l.value.notificationDescription="",l.value.notificationDetails="",B(),i("close")}return ie(()=>o.isShown,()=>{B()}),(g,t)=>(a(),T(e(Ve),{"is-shown":g.isShown,onClose:t[5]||(t[5]=k=>C()),closeAriaLabel:e(s)("common.shell.close_side_drawer"),title:u.value?e(s)("standalone.dpi.edit_exception"):e(s)("standalone.dpi.add_exception")},{default:n(()=>[l.value.notificationTitle?(a(),T(e(F),{key:0,title:l.value.notificationTitle,description:l.value.notificationDescription,class:"mb-6",kind:"error"},I({_:2},[l.value.notificationDetails?{name:"details",fn:n(()=>[x(r(l.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):L("",!0),f("div",wt,[f("div",null,[v(e(Le),null,{default:n(()=>[x(r(e(s)("standalone.dpi.status")),1)]),_:1}),v(e(G),{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=k=>m.value=k),label:m.value?e(s)("common.enabled"):e(s)("common.disabled")},null,8,["modelValue","label"])]),v(e(ee),{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=k=>w.value=k),label:e(s)("standalone.dpi.ip_address"),"invalid-message":e(s)(R.value.getFirstI18nKeyFor("criteria"))},null,8,["modelValue","label","invalid-message"]),v(e(ee),{modelValue:S.value,"onUpdate:modelValue":t[2]||(t[2]=k=>S.value=k),label:e(s)("standalone.dpi.exception_name"),"invalid-message":e(s)(R.value.getFirstI18nKeyFor("description"))},null,8,["modelValue","label","invalid-message"]),t[6]||(t[6]=f("hr",null,null,-1)),f("div",Tt,[v(e(O),{kind:"tertiary",class:"mr-4",onClick:t[3]||(t[3]=k=>C())},{default:n(()=>[x(r(e(s)("common.cancel")),1)]),_:1}),v(e(O),{kind:"primary",onClick:t[4]||(t[4]=k=>A()),disabled:c.value,loading:c.value},{default:n(()=>[x(r(u.value?e(s)("common.save"):e(s)("standalone.dpi.add_exception")),1)]),_:1},8,["disabled","loading"])])])]),_:1},8,["is-shown","closeAriaLabel","title"]))}}),Ct={class:"flex flex-col gap-y-6"},St={class:"flex flex-row items-center justify-between"},$t={class:"max-w-2xl text-sm font-normal text-gray-500 dark:text-gray-400"},Pt={key:0,class:"ml-2 flex shrink-0 flex-col gap-x-0 gap-y-2 sm:flex-row sm:gap-x-2 sm:gap-y-0"},Lt={key:1,class:"grid grid-cols-1 gap-x-6 gap-y-6 sm:grid-cols-2 2xl:grid-cols-3"},Vt=U({__name:"DpiExceptions",setup($){const{t:E}=j(),o=ge(),s=p(!1),i=p([]),c=p(null),l=p(!1),R=p(!1),u=p({notificationTitle:"",notificationDescription:"",notificationDetails:""});function m(d){c.value=d,l.value=!0}function w(d){c.value=d,R.value=!0}async function S(){try{s.value=!0,i.value=(await M("ns.dpi","list-exemptions")).data.values}catch(d){u.value.notificationTitle=E("error.cannot_retrieve_dpi_exceptions"),u.value.notificationDescription=E(z(d)),u.value.notificationDetails=d.toString()}finally{s.value=!1}}async function B(){await S(),await o.getChanges()}return be(()=>{S()}),(d,D)=>{const A=X("font-awesome-icon");return a(),h(N,null,[f("div",Ct,[f("div",St,[f("p",$t,r(e(E)("standalone.dpi.exceptions_description")),1),i.value.length>0?(a(),h("div",Pt,[v(e(O),{kind:"secondary",onClick:D[0]||(D[0]=C=>m(null))},{prefix:n(()=>[v(A,{icon:["fas","circle-plus"],class:"h-4 w-4","aria-hidden":"true"})]),default:n(()=>[x(" "+r(e(E)("standalone.dpi.add_exception")),1)]),_:1})])):L("",!0)]),u.value.notificationTitle?(a(),T(e(F),{key:0,kind:"error",title:u.value.notificationTitle,description:u.value.notificationDescription},I({_:2},[u.value.notificationDetails?{name:"details",fn:n(()=>[x(r(u.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):L("",!0),s.value?(a(),T(e(le),{key:1,lines:10})):u.value.notificationTitle?L("",!0):(a(),h(N,{key:2},[i.value.length==0?(a(),T(e(ae),{key:0,title:e(E)("standalone.dpi.no_exception_found"),icon:["fas","circle-info"]},{default:n(()=>[v(e(O),{kind:"primary",onClick:D[1]||(D[1]=C=>m(null))},{prefix:n(()=>[v(A,{icon:["fas","circle-plus"],class:"h-4 w-4","aria-hidden":"true"})]),default:n(()=>[x(r(e(E)("standalone.dpi.add_exception")),1)]),_:1})]),_:1},8,["title"])):(a(),h("div",Lt,[(a(!0),h(N,null,W(i.value,(C,g)=>(a(),T(Rt,{key:g,exception:C,onDelete:w,onEdit:m},null,8,["exception"]))),128))]))],64))]),v(Et,{visible:R.value,"item-to-delete":c.value,onClose:D[2]||(D[2]=C=>R.value=!1),onDpiExceptionDeleted:D[3]||(D[3]=C=>B())},null,8,["visible","item-to-delete"]),v(At,{"is-shown":l.value,"item-to-edit":c.value,onClose:D[4]||(D[4]=C=>l.value=!1),onAddEditException:D[5]||(D[5]=C=>B())},null,8,["is-shown","item-to-edit"])],64)}}}),Bt={class:"text-sm"},Ot=U({__name:"DpiFilterView",setup($){const{t:E}=j(),{tabs:o,selectedTab:s}=Oe([{name:"rules",label:E("standalone.dpi.rules")},{name:"exceptions",label:E("standalone.dpi.exceptions")}]);return(i,c)=>(a(),h("div",Bt,[v(e(Me),{tag:"h3",class:"mb-7"},{default:n(()=>[x(r(e(E)("standalone.dpi.title")),1)]),_:1}),v(e(ze),{tabs:e(o),selected:e(s),srTabsLabel:e(E)("ne_tabs.tabs"),srSelectTabLabel:e(E)("ne_tabs.select_a_tab"),onSelectTab:c[0]||(c[0]=l=>s.value=l),class:"mb-8"},null,8,["tabs","selected","srTabsLabel","srSelectTabLabel"]),f("div",null,[e(s)==="rules"?(a(),T(Dt,{key:0})):e(s)==="exceptions"?(a(),T(Vt,{key:1})):L("",!0)])]))}});export{Ot as default};
