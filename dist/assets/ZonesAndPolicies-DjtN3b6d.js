import{d as Y,u as Q,U as ue,r as m,aa as ge,c as F,J as ae,o as ce,h as c,i as y,w as i,l as e,L as B,V as N,q as T,n as j,k as l,Q as ze,a0 as le,a5 as oe,ar as ne,s as we,m as p,t as _,j as v,_ as W,ai as Ce,bH as ye,T as xe,e as M,ag as ke,S as Te,aM as Ee,Y as he,aI as Le,W as Ve,F as O,aK as Pe,al as P,ak as Se,a4 as te,an as se,ao as V,aj as Oe,z as U,ad as ie,am as Ue,aq as Re,av as de,B as $e,ap as Ze}from"./index-BlEQ5104.js";import{u as G,S as q,T as J}from"./firewall-C9mbeSo1.js";import{z as K,A as Ae,B as H,C as re,a as Be}from"./network-qu7sidyZ.js";const je={key:1,class:"space-y-8"},Ie={class:"flex justify-end gap-4"},De=Y({__name:"CreateOrEditZoneDrawer",props:{isShown:{type:Boolean,default:!1},zoneToEdit:{type:Object,default:void 0}},emits:["close","success"],setup(E,{emit:t}){const d=E,h=t,{t:o}=Q(),S=ue(),f=G(),u=m(""),x=m(),C=m([]),k=m([]),w=m("input-drop"),g=m("forward-drop"),b=m(!1),r=m(!1),a=m(!1),L=m(),R=m(new ge),$=F(()=>!d.zoneToEdit),fe=[{id:"input-drop",label:"DROP"},{id:"input-reject",label:"REJECT"},{id:"input-accept",label:"ACCEPT"}],pe=[{id:"forward-drop",label:"DROP"},{id:"forward-reject",label:"REJECT"},{id:"forward-accept",label:"ACCEPT"}];ae(()=>d.isShown,()=>{d.isShown&&(L.value=void 0,R.value.clear(),d.zoneToEdit?(u.value=d.zoneToEdit.name,C.value=K(d.zoneToEdit,f.forwardings).map(n=>({id:n.destination,label:n.destination.toUpperCase()})),k.value=Ae(d.zoneToEdit,f.forwardings).map(n=>({id:n.source,label:n.source.toUpperCase()})),w.value=Z(d.zoneToEdit.input,"input"),g.value=Z(d.zoneToEdit.forward,"forward"),b.value=!!H(d.zoneToEdit,f.forwardings),r.value=d.zoneToEdit.logging):(u.value="",C.value=[],k.value=[],w.value=Z(J.DROP,"input"),g.value=Z(J.DROP,"forward"),b.value=!1,r.value=!1,ye(()=>{xe(x)})))}),ae(()=>u.value,()=>{u.value!==u.value.toUpperCase()&&(u.value=u.value.toUpperCase())}),ce(()=>{f.loading&&f.fetch()});const I=F(()=>f.zones.filter(n=>n.name!=q.WAN&&(!d.zoneToEdit||d.zoneToEdit.name!==n.name)).map(n=>({id:n.name,label:n.name.toUpperCase()}))),X=F(()=>I.value.slice(0,2).map(n=>n.label.toUpperCase()).join(", ").concat("..."));function _e(){M("ns.firewall","edit_zone",{name:u.value.toLowerCase(),input:A(w.value),forward:A(g.value),traffic_to_wan:b.value,forwards_to:C.value.map(n=>n.id),forwards_from:k.value.map(n=>n.id),log:r.value}).then(()=>{S.getChanges(),f.fetch(),h("success")}).catch(n=>L.value=n).then(()=>a.value=!1)}function be(){ve()||(a.value=!0,M("ns.firewall","create_zone",{name:u.value.toLowerCase(),input:A(w.value),forward:A(g.value),traffic_to_wan:b.value,forwards_to:C.value.map(n=>n.id),forwards_from:k.value.map(n=>n.id),log:r.value}).then(()=>{S.getChanges(),f.fetch(),h("success")}).catch(n=>{n instanceof ke?R.value=n.errorBag:L.value=n}).then(()=>a.value=!1))}function me(){$.value?be():_e()}function ve(){R.value.clear();const n=[Te(u.value),Ee(u.value.toLowerCase())];return n.forEach(s=>{s.valid||R.value.set("name",[String(s.errMessage)])}),n.some(s=>!s.valid)}function Z(n,s){return`${s}-${n}`}function A(n){const[,s]=n.split("-");return s.toUpperCase()}return(n,s)=>{var ee;return c(),y(e(Ce),{isShown:E.isShown,title:$.value?e(o)("standalone.zones_and_policies.add_zone"):e(o)("standalone.zones_and_policies.edit_zone_name",{name:(ee=E.zoneToEdit)==null?void 0:ee.name}),closeAriaLabel:e(o)("common.shell.close_side_drawer"),onClose:s[9]||(s[9]=D=>h("close"))},{default:i(()=>{var D;return[e(f).error?(c(),y(e(B),{key:0,title:e(o)(e(N)(e(f).error)),kind:"error"},null,8,["title"])):(c(),T("div",je,[L.value?(c(),y(e(B),{key:0,title:e(o)(e(N)(L.value.message)),kind:"error"},null,8,["title"])):j("",!0),l(e(ze),{modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=z=>u.value=z),disabled:a.value||!$.value,"invalid-message":e(o)(R.value.getFirstI18nKeyFor("name")),label:e(o)("standalone.zones_and_policies.name"),placeholder:e(o)("standalone.zones_and_policies.name"),ref_key:"nameRef",ref:x},null,8,["modelValue","disabled","invalid-message","label","placeholder"]),l(e(le),{modelValue:C.value,"onUpdate:modelValue":s[1]||(s[1]=z=>C.value=z),disabled:a.value,label:e(o)("standalone.zones_and_policies.allow_forwards_to"),options:I.value,placeholder:X.value,multiple:"",noResultsLabel:e(o)("ne_combobox.no_results"),limitedOptionsLabel:e(o)("ne_combobox.limited_options_label"),noOptionsLabel:e(o)("ne_combobox.no_options_label"),"selected-label":e(o)("ne_combobox.selected"),"user-input-label":e(o)("ne_combobox.user_input_label"),optionalLabel:e(o)("common.optional")},null,8,["modelValue","disabled","label","options","placeholder","noResultsLabel","limitedOptionsLabel","noOptionsLabel","selected-label","user-input-label","optionalLabel"]),l(e(le),{modelValue:k.value,"onUpdate:modelValue":s[2]||(s[2]=z=>k.value=z),disabled:a.value,label:e(o)("standalone.zones_and_policies.allow_forwards_from"),options:I.value,placeholder:X.value,multiple:"",noResultsLabel:e(o)("ne_combobox.no_results"),limitedOptionsLabel:e(o)("ne_combobox.limited_options_label"),noOptionsLabel:e(o)("ne_combobox.no_options_label"),"selected-label":e(o)("ne_combobox.selected"),"user-input-label":e(o)("ne_combobox.user_input_label"),optionalLabel:e(o)("common.optional")},null,8,["modelValue","disabled","label","options","placeholder","noResultsLabel","limitedOptionsLabel","noOptionsLabel","selected-label","user-input-label","optionalLabel"]),((D=E.zoneToEdit)==null?void 0:D.name)!==e(q).WAN?(c(),y(e(oe),{key:1,modelValue:b.value,"onUpdate:modelValue":s[3]||(s[3]=z=>b.value=z),disabled:a.value,topLabel:e(o)("standalone.zones_and_policies.traffic_to_wan"),label:b.value?e(o)("common.enabled"):e(o)("common.disabled")},null,8,["modelValue","disabled","topLabel","label"])):j("",!0),l(e(ne),{modelValue:w.value,"onUpdate:modelValue":s[4]||(s[4]=z=>w.value=z),disabled:a.value,label:e(o)("standalone.zones_and_policies.traffic_to_firewall"),options:fe},null,8,["modelValue","disabled","label"]),l(e(ne),{modelValue:g.value,"onUpdate:modelValue":s[5]||(s[5]=z=>g.value=z),disabled:a.value,label:e(o)("standalone.zones_and_policies.traffic_to_same_zone"),options:pe},null,8,["modelValue","disabled","label"]),l(e(oe),{modelValue:r.value,"onUpdate:modelValue":s[6]||(s[6]=z=>r.value=z),disabled:a.value,topLabel:e(o)("standalone.zones_and_policies.logging"),label:r.value?e(o)("common.enabled"):e(o)("common.disabled")},{topTooltip:i(()=>[l(e(we),null,{content:i(()=>[p(_(e(o)("standalone.zones_and_policies.enable_logging_tooltip")),1)]),_:1})]),_:1},8,["modelValue","disabled","topLabel","label"]),s[10]||(s[10]=v("hr",null,null,-1)),v("div",Ie,[l(e(W),{disabled:a.value,kind:"tertiary",size:"lg",onClick:s[7]||(s[7]=z=>n.$emit("close"))},{default:i(()=>[p(_(e(o)("common.cancel")),1)]),_:1},8,["disabled"]),l(e(W),{disabled:a.value,loading:a.value,kind:"primary",size:"lg",onClick:s[8]||(s[8]=z=>me())},{default:i(()=>[p(_($.value?e(o)("standalone.zones_and_policies.add_zone"):e(o)("common.save")),1)]),_:1},8,["disabled","loading"])])]))]}),_:1},8,["isShown","title","closeAriaLabel"])}}}),Fe=Y({__name:"DeleteZoneModal",props:{zone:{type:Object,default:void 0}},emits:["success","cancel"],setup(E,{emit:t}){const{t:d}=Q(),h=G(),o=ue(),S=E,f=t,u=m(!1),x=m();function C(){var w;u.value=!0,M("ns.firewall","delete_zone",{config_name:(w=S.zone)==null?void 0:w.configName}).then(()=>{h.fetch(),o.getChanges(),f("success")}).catch(g=>x.value=g).finally(()=>u.value=!1)}function k(){u.value||f("cancel")}return(w,g)=>{var b;return c(),y(e(he),{"primary-button-disabled":u.value,"primary-button-loading":u.value,"primary-label":e(d)("common.delete"),"secondary-button-disabled":u.value,title:e(d)("standalone.zones_and_policies.delete_zone",[(b=E.zone)==null?void 0:b.name]),visible:E.zone!=null,kind:"warning","primary-button-kind":"danger","close-aria-label":e(d)("common.close"),onClose:g[0]||(g[0]=r=>k()),onPrimaryClick:g[1]||(g[1]=r=>C())},{default:i(()=>[x.value?(c(),y(e(B),{key:0,title:e(d)(e(N)(x.value.message)),kind:"error"},null,8,["title"])):j("",!0)]),_:1},8,["primary-button-disabled","primary-button-loading","primary-label","secondary-button-disabled","title","visible","close-aria-label"])}}}),Ne={class:"space-y-8"},We={class:"flex flex-wrap gap-6"},Me={class:"grow text-sm font-normal dark:text-gray-400"},qe={class:"flex items-center gap-x-4"},Je={class:"uppercase"},Ke={class:"flex flex-wrap gap-2"},He={key:0},Ye={class:"flex items-center gap-x-2"},Qe={class:"flex items-center gap-x-2"},Ge={class:"flex items-center gap-x-2"},Xe={class:"flex items-center gap-2"},ea={class:"-ml-2.5 flex 2xl:ml-0"},na=Y({__name:"ZonesAndPolicies",setup(E){const{t}=Q(),d=G(),h=m(10),{currentPage:o,paginatedItems:S}=Le(()=>d.zonesWithoutAliases,{itemsPerPage:h}),f=m(!1),u=m(),x=m();ce(()=>{d.fetch()});function C(b){switch(b){case J.ACCEPT:return"arrow-right";default:return"ban"}}function k(b){return Object.values(q).includes(b.name)}function w(){x.value=void 0,f.value=!0}function g(b){x.value=b,f.value=!0}return(b,r)=>(c(),T("div",Ne,[l(e(Ve),{tag:"h3",class:"mb-7"},{default:i(()=>[p(_(e(t)("standalone.zones_and_policies.title")),1)]),_:1}),v("div",We,[v("p",Me,_(e(t)("standalone.zones_and_policies.description")),1),v("div",null,[l(e(W),{kind:"secondary",onClick:w,size:"lg"},{prefix:i(()=>[l(e(O),{icon:["fas","circle-plus"]})]),default:i(()=>[p(" "+_(e(t)("standalone.zones_and_policies.add_zone")),1)]),_:1})])]),e(d).error?(c(),y(e(B),{key:0,title:e(t)(e(d).error.message),kind:"error"},null,8,["title"])):(c(),y(e(Re),{key:1,ariaLabel:e(t)("standalone.zones_and_policies.firewall_zones"),cardBreakpoint:"2xl",loading:e(d).loading,skeletonColumns:6,skeletonRows:5},{paginator:i(()=>[l(e(Pe),{"current-page":e(o),"total-rows":e(d).zonesWithoutAliases.length,"page-size":h.value,"nav-pagination-label":e(t)("ne_table.pagination"),"next-label":e(t)("ne_table.go_to_next_page"),"previous-label":e(t)("ne_table.go_to_previous_page"),"range-of-total-label":e(t)("ne_table.of"),"page-size-label":e(t)("ne_table.show"),onSelectPage:r[0]||(r[0]=a=>{o.value=a}),onSelectPageSize:r[1]||(r[1]=a=>{h.value=a})},null,8,["current-page","total-rows","page-size","nav-pagination-label","next-label","previous-label","range-of-total-label","page-size-label"])]),default:i(()=>[l(e(Se),null,{default:i(()=>[l(e(P),null,{default:i(()=>[p(_(e(t)("standalone.zones_and_policies.zone")),1)]),_:1}),l(e(P),null,{default:i(()=>[p(_(e(t)("standalone.zones_and_policies.allow_forwards_to")),1)]),_:1}),l(e(P),null,{default:i(()=>[p(_(e(t)("standalone.zones_and_policies.traffic_to_wan")),1)]),_:1}),l(e(P),null,{default:i(()=>[p(_(e(t)("standalone.zones_and_policies.traffic_to_firewall")),1)]),_:1}),l(e(P),null,{default:i(()=>[p(_(e(t)("standalone.zones_and_policies.traffic_to_same_zone")),1)]),_:1}),l(e(P),null,{default:i(()=>[p(_(e(t)("standalone.zones_and_policies.interfaces")),1)]),_:1}),l(e(P),null,{default:i(()=>[p(_(e(t)("standalone.zones_and_policies.logging")),1)]),_:1}),l(e(P))]),_:1}),l(e(Ue),null,{default:i(()=>[e(te)(e(S))?(c(),y(e(se),{key:0},{default:i(()=>[l(e(V),{colspan:"9"},{default:i(()=>[l(e(Oe),{title:e(t)("ne_table.no_items"),icon:["fas","table"],class:"bg-white dark:bg-gray-950"},null,8,["title"])]),_:1})]),_:1})):(c(!0),T(U,{key:1},ie(e(S),a=>(c(),y(e(se),{key:a.name},{default:i(()=>[l(e(V),{"data-label":e(t)("standalone.zones_and_policies.zone")},{default:i(()=>[v("div",qe,[v("div",{class:de([e(re)(a.name),"flex h-10 w-10 items-center justify-center rounded-full"])},[l(e(O),{icon:["fas",e(Be)(a.name)],class:"h-5 w-5"},null,8,["icon"])],2),v("span",Je,_(a.name),1)])]),_:2},1032,["data-label"]),l(e(V),{"data-label":e(t)("standalone.zones_and_policies.allow_forwards_to")},{default:i(()=>[v("div",Ke,[(c(!0),T(U,null,ie(e(K)(a,e(d).forwardings),L=>(c(),y(e($e),{key:L.name,text:L.destination.toUpperCase(),kind:"custom",customColorClasses:e(re)(L.destination)},null,8,["text","customColorClasses"]))),128)),e(te)(e(K)(a,e(d).forwardings))?(c(),T("span",He,"-")):j("",!0)])]),_:2},1032,["data-label"]),l(e(V),{"data-label":e(t)("standalone.zones_and_policies.traffic_to_wan")},{default:i(()=>[v("div",Ye,[e(H)(a,e(d).forwardings)==null?(c(),T(U,{key:0},[p(" -")],64)):e(H)(a,e(d).forwardings)?(c(),T(U,{key:1},[l(e(O),{icon:["fas","arrow-right"]}),r[6]||(r[6]=v("p",null,"ACCEPT",-1))],64)):(c(),T(U,{key:2},[l(e(O),{icon:["fas","ban"]}),r[7]||(r[7]=v("p",null,"REJECT",-1))],64))])]),_:2},1032,["data-label"]),l(e(V),{"data-label":e(t)("standalone.zones_and_policies.traffic_to_firewall")},{default:i(()=>[v("div",Qe,[l(e(O),{icon:["fas",C(a.input)]},null,8,["icon"]),p(" "+_(a.input.toUpperCase()),1)])]),_:2},1032,["data-label"]),l(e(V),{"data-label":e(t)("standalone.zones_and_policies.traffic_to_same_zone")},{default:i(()=>[v("div",Ge,[l(e(O),{icon:["fas",C(a.forward)]},null,8,["icon"]),p(" "+_(a.forward.toUpperCase()),1)])]),_:2},1032,["data-label"]),l(e(V),{"data-label":e(t)("standalone.zones_and_policies.interfaces")},{default:i(()=>[a.interfaces.length>0?(c(),T(U,{key:0},[p(_(a.interfaces.join(", ")),1)],64)):(c(),T(U,{key:1},[p("-")],64))]),_:2},1032,["data-label"]),l(e(V),{"data-label":e(t)("standalone.zones_and_policies.logging")},{default:i(()=>[v("div",Xe,[l(e(O),{icon:["fas",a.logging?"circle-check":"circle-xmark"],class:de(["h-4 w-4",{"text-green-600 dark:text-green-400":a.logging}]),"aria-hidden":"true"},null,8,["icon","class"]),p(" "+_(a.logging?e(t)("common.enabled"):e(t)("common.disabled")),1)])]),_:2},1032,["data-label"]),l(e(V),{"data-label":e(t)("common.actions")},{default:i(()=>[v("div",ea,[l(e(Ze),{items:[{id:"edit",label:e(t)("common.edit"),action:()=>g(a),icon:"pen-to-square"},{id:"delete",danger:!0,label:e(t)("common.delete"),action:()=>u.value=a,icon:"trash",disabled:k(a)}],"align-to-right":""},null,8,["items"])])]),_:2},1032,["data-label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["ariaLabel","loading"])),l(De,{isShown:f.value,zoneToEdit:x.value,onClose:r[2]||(r[2]=a=>f.value=!1),onSuccess:r[3]||(r[3]=a=>f.value=!1)},null,8,["isShown","zoneToEdit"]),l(Fe,{zone:u.value,onCancel:r[4]||(r[4]=a=>u.value=void 0),onSuccess:r[5]||(r[5]=a=>u.value=void 0)},null,8,["zone"])]))}});export{na as default};
