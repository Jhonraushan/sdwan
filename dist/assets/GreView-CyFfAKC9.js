import{d as be,ac as Fe,u as ye,r as l,aa as Oe,c as _e,J as ae,h as R,i as M,w as r,j as k,l as e,L as Re,n as ke,k as n,a5 as he,Q as x,m as d,t as _,R as me,_ as ne,ai as Le,bH as Ue,T as Ne,e as G,V as K,ay as we,az as Se,S as Be,U as qe,o as $e,b as ze,g as We,q as te,W as Ge,M as Ke,y as Ze,z as se,al as I,ak as He,ad as Je,am as Qe,aq as Xe,aj as Ye,an as el,ao as D}from"./index-BlEQ5104.js";/* empty css                                                */import{_ as ll}from"./DeleteTunnelModal.vue_vue_type_script_setup_true_lang-2XdVzv1U.js";import{u as al}from"./firewall-C9mbeSo1.js";import{u as tl}from"./useObjects-D-lIOcFM.js";const sl={class:"space-y-6"},nl={class:"flex justify-end"},ol=be({__name:"GreDrawer",props:{ruleType:{type:String,required:!0},currentRule:{type:Object},isDuplicatingRule:{type:Boolean,default:!1},isShown:{type:Boolean,default:!1},knownTags:{type:Array,required:!0}},emits:["close","reloadData","save"],setup(Z,{emit:f}){const H=Fe(),s=Z,h=f,{t:o}=ye();tl(),al();const P=l(""),L=l(),A=l(),b=l(),E=l(),U=l(),T=l(),N=l(),F=l(),j=l(),y=l(!1),p=l(""),i=l(""),S=l(""),g=l(""),V=l(""),B=l(""),q=l(""),$=l(""),z=l("source_address"),W=l("destination_address"),J=l([""]);l([""]);const Q=l([""]),oe=l(""),ie=l("");l(),l();const re=l("*");l();const ue=l("*");l();const Ve=l([]),C=l("*");l();const xe=l([]),de=l("DROP"),O=l([]);l();const Pe=l([]),X=l("");l();const ce=l("bottom"),ve=l(!1),Y=l([]),ee=l(!1),m=l(new Oe);l([]),l([]),l([]);let c=l({listServiceSuggestions:!1,listObjectSuggestions:!1,listProtocols:!1,saveRule:!1}),w=l({listServiceSuggestions:"",listServiceSuggestionsDetails:"",listObjectSuggestions:"",listObjectSuggestionsDetails:"",listProtocols:"",listProtocolsDetails:"",saveRule:"",saveRuleDetails:""});const fe=_e(()=>!s.currentRule),pe=_e(()=>!!s.currentRule&&!s.isDuplicatingRule);ae(()=>s.isShown,()=>{var t;s.isShown&&(Me(),m.value.clear(),Ue(()=>{Ne(L)}),Ee(),Ae(),fe.value?(y.value=!0,P.value="",z.value="source_address",W.value="destination_address",J.value=[""],oe.value="",Q.value=[""],ie.value="",re.value="*",ue.value="*",C.value="*",de.value="DROP",O.value=[],X.value="",ce.value="bottom",Y.value=[],ee.value=!1,ve.value=!1):s.currentRule&&(y.value=s.currentRule.enabled||!1,re.value=s.currentRule.src||"*",ue.value=s.currentRule.dest||"*",C.value="*",O.value=[],de.value=s.currentRule.target||"DROP",ce.value="bottom",Y.value=((t=s.currentRule.ns_tag)==null?void 0:t.map(a=>({id:a,label:a})))||[],ee.value=s.currentRule.log||!1,ve.value=Y.value.length>0||ee.value,pe.value?P.value=s.currentRule.name||"":P.value=o("standalone.firewall_rules.duplicated_rule_name",{name:s.currentRule.name})))}),ae(()=>C.value,()=>{C.value==="custom"&&je()});function Ie(t){if(!t.src_ip)return[];const a=[];if(t.ns_src)z.value="source_object",oe.value=t.ns_src;else if(t.src_ip.length){z.value="source_address";for(const u of t.src_ip)a.push(u.value)}else z.value="source_any";a.length?J.value=a:J.value=[""]}function De(t){if(!t.dest_ip)return[];const a=[];if(t.ns_dst)W.value="destination_object",ie.value=t.ns_dst;else if(t.dest_ip.length){W.value="destination_address";for(const u of t.dest_ip)a.push(u.value)}else W.value="destination_any";a.length?Q.value=a:Q.value=[""]}function le(){h("close")}function Me(){for(const[t,a]of Object.entries(w.value))typeof a=="string"?w.value[t]="":Array.isArray(a)&&(w.value[t]=[])}async function Ae(){c.value.listObjectSuggestions=!0;try{const t=await G("ns.firewall","list-object-suggestions");Ve.value=t.data.objects,s.currentRule&&(Ie(s.currentRule),De(s.currentRule))}catch(t){console.error(t),w.value.listObjectSuggestions=o(K(t)),w.value.listObjectSuggestionsDetails=t.toString()}finally{c.value.listObjectSuggestions=!1}}async function Ee(){c.value.listServiceSuggestions=!0;try{const t=await G("ns.firewall","list-service-suggestions");xe.value=t.data.services.map(a=>{const u=o("standalone.firewall_rules.service_ports",{protocols:a.proto.join("/").toUpperCase(),ports:a.port},1);return{id:a.id,label:a.id,description:u,protocols:a.proto,port:a.port}}),s.currentRule&&(s.currentRule.ns_service==="custom"?(C.value="custom",X.value=s.currentRule.dest_port.join(", ")||""):(C.value=s.currentRule.ns_service||"*",X.value="",O.value=[]))}catch(t){console.error(t),w.value.listServiceSuggestions=o(K(t)),w.value.listServiceSuggestionsDetails=t.toString()}finally{c.value.listServiceSuggestions=!1}}async function je(){c.value.listProtocols=!0;try{const a=(await G("ns.redirects","list-protocols")).data.protocols.filter(u=>u!=="all");Pe.value=a.map(u=>({id:u,label:u.toUpperCase()})),s.currentRule&&(s.currentRule.proto.length&&s.currentRule.ns_service==="custom"?O.value=s.currentRule.proto.map(u=>({id:u,label:u.toUpperCase()})):O.value=[])}catch(t){console.error(t),w.value.listProtocols=o(K(t)),w.value.listProtocolsDetails=t.toString()}finally{c.value.listProtocols=!1}}const Ce=()=>{m.value.clear();let t=!0;return[{key:"tunnelName",value:p,ref:A},{key:"localVirtulaIP",value:i,ref:b},{key:"peerVirtulaIP",value:S,ref:E},{key:"localExternIP",value:g,ref:U},{key:"peerExternIP",value:V,ref:T},{key:"key",value:B,ref:N},{key:"keepAliveInternal",value:q,ref:F},{key:"keepAliveRetry",value:$,ref:j}].forEach(u=>{Be(u.value.value).valid||(m.value.set(u.key,o("error.required")),t=!1)}),t},ge={tunnelName:p,localVirtulaIP:i,peerVirtulaIP:S,localExternIP:g,peerExternIP:V,key:B,keepAliveInternal:q,keepAliveRetry:$};Object.keys(ge).forEach(t=>{ae(ge[t],a=>{a!==""&&m.value.delete(t)})});const Te=async()=>{try{if(!Ce())return;const t={service:y.value,tunnel_name:p.value,Local_virtual_ip:i.value,peer_virtual_ip:S.value,Local_extern_ip:g.value,peer_extern_ip:V.value};if((await we.post(`${Se()}/gre`,{method:'"add-config',payload:{service:y.value,tunnel_name:p.value,Local_virtual_ip:i.value,peer_virtual_ip:S.value,Local_extern_ip:g.value,peer_extern_ip:V.value}})).data.code===200)H.createNotification({title:"Success",description:"Configuration saved successfully.",kind:"success"}),y.value=!1,m.value.clear(),h("save",t),le();else throw new Error("Failed to save configuration.")}catch{}};return(t,a)=>(R(),M(e(Le),{isShown:Z.isShown,title:e(o)("standalone.wire_guard.add_client_tunnel"),closeAriaLabel:e(o)("standalone.wire_guard.add_client_tunnel"),onClose:le},{default:r(()=>{var u;return[k("form",null,[k("div",sl,[pe.value&&((u=s.currentRule)!=null&&u.system_rule)?(R(),M(e(Re),{key:0,kind:"warning",title:e(o)("standalone.firewall_rules.editing_system_rule_warning_title"),description:e(o)("standalone.firewall_rules.editing_system_rule_warning_description")},null,8,["title","description"])):ke("",!0),n(e(he),{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=v=>y.value=v),label:y.value?e(o)("common.enabled"):e(o)("common.disabled"),topLabel:e(o)("common.status"),disabled:e(c).saveRule},null,8,["modelValue","label","topLabel","disabled"]),n(e(x),{label:e(o)("standalone.gre.tunnel_name"),modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=v=>p.value=v),modelModifiers:{trim:!0},invalidMessage:m.value.getFirstFor("tunnelName"),disabled:e(c).saveRule,ref_key:"tunnelNameRef",ref:A},null,8,["label","modelValue","invalidMessage","disabled"]),n(e(x),{label:e(o)("standalone.gre.local_virtual_ip"),modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=v=>i.value=v),modelModifiers:{trim:!0},invalidMessage:m.value.getFirstFor("localVirtulaIP"),disabled:e(c).saveRule,ref_key:"localVirtulaIPRef",ref:b},null,8,["label","modelValue","invalidMessage","disabled"]),n(e(x),{label:e(o)("standalone.gre.peer_virtual_ip"),modelValue:S.value,"onUpdate:modelValue":a[3]||(a[3]=v=>S.value=v),modelModifiers:{trim:!0},invalidMessage:m.value.getFirstFor("peerVirtulaIP"),disabled:e(c).saveRule,ref_key:"peerVirtulaIPRef",ref:E},null,8,["label","modelValue","invalidMessage","disabled"]),n(e(x),{label:e(o)("standalone.gre.local_extern_ip"),modelValue:g.value,"onUpdate:modelValue":a[4]||(a[4]=v=>g.value=v),modelModifiers:{trim:!0},invalidMessage:m.value.getFirstFor("localExternIP"),disabled:e(c).saveRule,ref_key:"localExternIPRef",ref:U},null,8,["label","modelValue","invalidMessage","disabled"]),n(e(x),{label:e(o)("standalone.gre.peer_extern_ip"),modelValue:V.value,"onUpdate:modelValue":a[5]||(a[5]=v=>V.value=v),modelModifiers:{trim:!0},invalidMessage:m.value.getFirstFor("peerExternIP"),disabled:e(c).saveRule,ref_key:"peerExternIPRef",ref:T},null,8,["label","modelValue","invalidMessage","disabled"]),n(e(x),{label:e(o)("standalone.gre.key"),modelValue:B.value,"onUpdate:modelValue":a[6]||(a[6]=v=>B.value=v),modelModifiers:{trim:!0},invalidMessage:m.value.getFirstFor("key"),disabled:e(c).saveRule,ref_key:"keyRef",ref:N},null,8,["label","modelValue","invalidMessage","disabled"]),n(e(x),{label:e(o)("standalone.gre.keep_alive_internal"),modelValue:q.value,"onUpdate:modelValue":a[7]||(a[7]=v=>q.value=v),modelModifiers:{trim:!0},invalidMessage:m.value.getFirstFor("keepAliveInternal"),disabled:e(c).saveRule,ref_key:"keepAliveInternalRef",ref:F},null,8,["label","modelValue","invalidMessage","disabled"]),n(e(x),{label:e(o)("standalone.gre.keep_alive_retry"),modelValue:$.value,"onUpdate:modelValue":a[8]||(a[8]=v=>$.value=v),modelModifiers:{trim:!0},invalidMessage:m.value.getFirstFor("keepAliveRetry"),disabled:e(c).saveRule,ref_key:"keepAliveRetryRef",ref:j},null,8,["label","modelValue","invalidMessage","disabled"])]),a[9]||(a[9]=k("hr",{class:"my-8 border-gray-200 dark:border-gray-700"},null,-1)),k("div",nl,[n(e(ne),{kind:"tertiary",size:"lg",onClick:me(le,["prevent"]),disabled:e(c).saveRule,class:"mr-3"},{default:r(()=>[d(_(e(o)("common.cancel")),1)]),_:1},8,["disabled"]),n(e(ne),{kind:"primary",size:"lg",onClick:me(Te,["prevent"]),disabled:e(c).saveRule,loading:e(c).saveRule},{default:r(()=>[d(_(fe.value?e(o)("standalone.wire_guard.save"):e(o)("standalone.wire_guard.save")),1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["isShown","title","closeAriaLabel"]))}}),il={class:"flex flex-col"},rl={class:"flex flex-col justify-between md:flex-row md:items-center"},ul={class:"mb-6 text-sm text-gray-500 dark:text-gray-400"},dl={class:"space-y-6"},cl={class:"flex flex-col items-start justify-between gap-6 lg:flex-row"},vl={class:"max-w-2xl text-sm font-normal text-gray-500 dark:text-gray-400"},fl=1e4,yl=be({__name:"GreView",setup(Z){const{t:f}=ye(),H=qe(),s=l(!0),h=l([]),o=l(null),P=l(!1),L=l(!1),A=l(0),b=l({notificationTitle:"",notificationDescription:"",notificationDetails:""});async function E(p=!0){try{p&&(s.value=!0),h.value=(await G("ns.ipsectunnel","list-tunnels")).data.tunnels,s.value=!1}catch(i){b.value.notificationTitle=f("error.cannot_retrieve_ipsec_tunnels"),b.value.notificationDescription=f(K(i)),b.value.notificationDetails=i.toString()}finally{p&&(s.value=!1)}}function U(p){o.value=p,P.value=!0}function T(){o.value=null,L.value=!1,P.value=!1}function N(){b.value={notificationTitle:"",notificationDescription:"",notificationDetails:""}}async function F(){N(),await E(),await H.getChanges()}$e(()=>{E(),y(),A.value=setInterval(()=>E(!1),fl)}),ze(()=>{A.value&&clearInterval(A.value)});const j=l(),y=async()=>{try{s.value=!0,(await we.post(`${Se()}/wireguard`,{method:"get-config",payload:{}})).data.code===200&&(s.value=!1,j.value=[])}catch(p){s.value=!1,console.error("Error:====",p)}s.value=!1};return(p,i)=>{const S=We("font-awesome-icon");return R(),te(se,null,[k("div",il,[k("div",rl,[n(e(Ge),{tag:"h3",class:"mb-7"},{default:r(()=>[d(_(e(f)("standalone.gre.title")),1)]),_:1}),k("div",ul,_(e(f)("common.data_updated_every_seconds",{seconds:10})),1)]),k("div",dl,[k("div",cl,[k("p",vl,_(e(f)("standalone.wire_guard.description")),1)]),b.value.notificationTitle?(R(),M(e(Re),{key:0,kind:"error",title:b.value.notificationTitle,description:b.value.notificationDescription},Ke({_:2},[b.value.notificationDetails?{name:"details",fn:r(()=>[d(_(b.value.notificationDetails),1)]),key:"0"}:void 0]),1032,["title","description"])):ke("",!0),s.value?(R(),M(e(Ze),{key:1,lines:8,size:"lg"})):(R(),te(se,{key:2},[j.value.length>0?(R(),M(e(Xe),{key:0,cardBreakpoint:"md",class:"mt-2"},{default:r(()=>[n(e(He),null,{default:r(()=>[n(e(I),null,{default:r(()=>i[1]||(i[1]=[d("Local Public Key")])),_:1}),n(e(I),null,{default:r(()=>i[2]||(i[2]=[d("Local Network")])),_:1}),n(e(I),null,{default:r(()=>i[3]||(i[3]=[d("Listen Port")])),_:1}),n(e(I),null,{default:r(()=>i[4]||(i[4]=[d("Server IP")])),_:1}),n(e(I),null,{default:r(()=>i[5]||(i[5]=[d("Server Port")])),_:1}),n(e(I),null,{default:r(()=>i[6]||(i[6]=[d("Peer Public Key")])),_:1}),n(e(I),null,{default:r(()=>i[7]||(i[7]=[d("Allowed IPs")])),_:1})]),_:1}),n(e(Qe),null,{default:r(()=>[(R(!0),te(se,null,Je(j.value,(g,V)=>(R(),M(e(el),{key:V},{default:r(()=>[n(e(D),{"data-label":e(f)("standalone.real_time_monitor.interface")},{default:r(()=>[d(_(g.local_public_key),1)]),_:2},1032,["data-label"]),n(e(D),{"data-label":e(f)("standalone.real_time_monitor.interface")},{default:r(()=>[d(_(g.local_network),1)]),_:2},1032,["data-label"]),n(e(D),{"data-label":e(f)("standalone.real_time_monitor.interface")},{default:r(()=>[d(_(g.listen_port),1)]),_:2},1032,["data-label"]),n(e(D),{"data-label":e(f)("standalone.real_time_monitor.interface")},{default:r(()=>[d(_(g.server_ip),1)]),_:2},1032,["data-label"]),n(e(D),{"data-label":e(f)("standalone.real_time_monitor.interface")},{default:r(()=>[d(_(g.server_port),1)]),_:2},1032,["data-label"]),n(e(D),{"data-label":e(f)("standalone.real_time_monitor.interface")},{default:r(()=>[d(_(g.peer_public_key),1)]),_:2},1032,["data-label"]),n(e(D),{"data-label":e(f)("standalone.real_time_monitor.interface")},{default:r(()=>[d(_(g.allowed_ips),1)]),_:2},1032,["data-label"])]),_:2},1024))),128))]),_:1})]),_:1})):(R(),M(e(Ye),{key:1,title:e(f)("standalone.wire_guard.no_wire_guard_found"),icon:["fas","globe"]},{default:r(()=>[n(e(ne),{kind:"primary",onClick:i[0]||(i[0]=g=>U(null))},{prefix:r(()=>[n(S,{icon:["fas","circle-plus"],class:"h-4 w-4","aria-hidden":"true"})]),default:r(()=>[d(" "+_(e(f)("standalone.wire_guard.add_wire_guard_tunnel")),1)]),_:1})]),_:1},8,["title"]))],64))])]),n(ll,{visible:L.value,"item-to-delete":o.value,onClose:T,onTunnelDeleted:F},null,8,["visible","item-to-delete"]),n(ol,{"item-to-edit":o.value,onClose:T,"rule-type":"forward","known-tags":[],onAddEditTunnel:F,"is-shown":P.value},null,8,["item-to-edit","is-shown"])],64)}}});export{yl as default};
